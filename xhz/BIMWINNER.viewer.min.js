"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var BIMWINNER={CLASS:"BIMWINNER",VERSION_NUMBER:"3.0.0",VERSION_STATE:"Dev",_isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},_isString:function(e){return"string"==typeof e||e instanceof String},_copy:function(e){return this._apply(e,{})},_apply:function(e,t){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t},_applyIf:function(e,t){for(var o in e)e.hasOwnProperty(o)&&(void 0!==t[o]&&null!==t[o]||(t[o]=e[o]));return t},Class:function(e,t){var o=null,n=t||e,s=o="function"==typeof n.__construct?n.__construct:"function"==typeof e.prototype.__construct?function(){e.prototype.__construct.apply(this,arguments)}:function(){};if(void 0===t)s.prototype=n;else{var i=function(){};i.prototype=jQuery.extend({},e.prototype),jQuery.extend(i.prototype,t),s.prototype=new i}return s}};BIMWINNER.Pinyin=function(){var e=function(e){this.initialize(e)},t={checkPolyphone:!1,charcase:"default"};e.fn=e.prototype={init:function(e){this.options=o(t,e)},initialize:function(e){this.init(e),this.char_dict="YDYQSXMWZSSXJBYMGCCZQPSSQBYCDSCDQLDYLYBSSJGYZZJJFKCCLZDHWDWZJLJPFYYNWJJTMYHZWZHFLZPPQHGSCYYYNJQYXXGJHHSDSJNKKTMOMLCRXYPSNQSECCQZGGLLYJLMYZZSECYKYYHQWJSSGGYXYZYJWWKDJHYCHMYXJTLXJYQBYXZLDWRDJRWYSRLDZJPCBZJJBRCFTLECZSTZFXXZHTRQHYBDLYCZSSYMMRFMYQZPWWJJYFCRWFDFZQPYDDWYXKYJAWJFFXYPSFTZYHHYZYSWCJYXSCLCXXWZZXNBGNNXBXLZSZSBSGPYSYZDHMDZBQBZCWDZZYYTZHBTSYYBZGNTNXQYWQSKBPHHLXGYBFMJEBJHHGQTJCYSXSTKZHLYCKGLYSMZXYALMELDCCXGZYRJXSDLTYZCQKCNNJWHJTZZCQLJSTSTBNXBTYXCEQXGKWJYFLZQLYHYXSPSFXLMPBYSXXXYDJCZYLLLSJXFHJXPJBTFFYABYXBHZZBJYZLWLCZGGBTSSMDTJZXPTHYQTGLJSCQFZKJZJQNLZWLSLHDZBWJNCJZYZSQQYCQYRZCJJWYBRTWPYFTWEXCSKDZCTBZHYZZYYJXZCFFZZMJYXXSDZZOTTBZLQWFCKSZSXFYRLNYJMBDTHJXSQQCCSBXYYTSYFBXDZTGBCNSLCYZZPSAZYZZSCJCSHZQYDXLBPJLLMQXTYDZXSQJTZPXLCGLQTZWJBHCTSYJSFXYEJJTLBGXSXJMYJQQPFZASYJNTYDJXKJCDJSZCBARTDCLYJQMWNQNCLLLKBYBZZSYHQQLTWLCCXTXLLZNTYLNEWYZYXCZXXGRKRMTCNDNJTSYYSSDQDGHSDBJGHRWRQLYBGLXHLGTGXBQJDZPYJSJYJCTMRNYMGRZJCZGJMZMGXMPRYXKJNYMSGMZJYMKMFXMLDTGFBHCJHKYLPFMDXLQJJSMTQGZSJLQDLDGJYCALCMZCSDJLLNXDJFFFFJCZFMZFFPFKHKGDPSXKTACJDHHZDDCRRCFQYJKQCCWJDXHWJLYLLZGCFCQDSMLZPBJJPLSBCJGGDCKKDEZSQCCKJGCGKDJTJDLZYCXKLQSCGJCLTFPCQCZGWPJDQYZJJBYJHSJDZWGFSJGZKQCCZLLPSPKJGQJHZZLJPLGJGJJTHJJYJZCZMLZLYQBGJWMLJKXZDZNJQSYZMLJLLJKYWXMKJLHSKJGBMCLYYMKXJQLBMLLKMDXXKWYXYSLMLPSJQQJQXYXFJTJDXMXXLLCXQBSYJBGWYMBGGBCYXPJYGPEPFGDJGBHBNSQJYZJKJKHXQFGQZKFHYGKHDKLLSDJQXPQYKYBNQSXQNSZSWHBSXWHXWBZZXDMNSJBSBKBBZKLYLXGWXDRWYQZMYWSJQLCJXXJXKJEQXSCYETLZHLYYYSDZPAQYZCMTLSHTZCFYZYXYLJSDCJQAGYSLCQLYYYSHMRQQKLDXZSCSSSYDYCJYSFSJBFRSSZQSBXXPXJYSDRCKGJLGDKZJZBDKTCSYQPYHSTCLDJDHMXMCGXYZHJDDTMHLTXZXYLYMOHYJCLTYFBQQXPFBDFHHTKSQHZYYWCNXXCRWHOWGYJLEGWDQCWGFJYCSNTMYTOLBYGWQWESJPWNMLRYDZSZTXYQPZGCWXHNGPYXSHMYQJXZTDPPBFYHZHTJYFDZWKGKZBLDNTSXHQEEGZZYLZMMZYJZGXZXKHKSTXNXXWYLYAPSTHXDWHZYMPXAGKYDXBHNHXKDPJNMYHYLPMGOCSLNZHKXXLPZZLBMLSFBHHGYGYYGGBHSCYAQTYWLXTZQCEZYDQDQMMHTKLLSZHLSJZWFYHQSWSCWLQAZYNYTLSXTHAZNKZZSZZLAXXZWWCTGQQTDDYZTCCHYQZFLXPSLZYGPZSZNGLNDQTBDLXGTCTAJDKYWNSYZLJHHZZCWNYYZYWMHYCHHYXHJKZWSXHZYXLYSKQYSPSLYZWMYPPKBYGLKZHTYXAXQSYSHXASMCHKDSCRSWJPWXSGZJLWWSCHSJHSQNHCSEGNDAQTBAALZZMSSTDQJCJKTSCJAXPLGGXHHGXXZCXPDMMHLDGTYBYSJMXHMRCPXXJZCKZXSHMLQXXTTHXWZFKHCCZDYTCJYXQHLXDHYPJQXYLSYYDZOZJNYXQEZYSQYAYXWYPDGXDDXSPPYZNDLTWRHXYDXZZJHTCXMCZLHPYYYYMHZLLHNXMYLLLMDCPPXHMXDKYCYRDLTXJCHHZZXZLCCLYLNZSHZJZZLNNRLWHYQSNJHXYNTTTKYJPYCHHYEGKCTTWLGQRLGGTGTYGYHPYHYLQYQGCWYQKPYYYTTTTLHYHLLTYTTSPLKYZXGZWGPYDSSZZDQXSKCQNMJJZZBXYQMJRTFFBTKHZKBXLJJKDXJTLBWFZPPTKQTZTGPDGNTPJYFALQMKGXBDCLZFHZCLLLLADPMXDJHLCCLGYHDZFGYDDGCYYFGYDXKSSEBDHYKDKDKHNAXXYBPBYYHXZQGAFFQYJXDMLJCSQZLLPCHBSXGJYNDYBYQSPZWJLZKSDDTACTBXZDYZYPJZQSJNKKTKNJDJGYYPGTLFYQKASDNTCYHBLWDZHBBYDWJRYGKZYHEYYFJMSDTYFZJJHGCXPLXHLDWXXJKYTCYKSSSMTWCTTQZLPBSZDZWZXGZAGYKTYWXLHLSPBCLLOQMMZSSLCMBJCSZZKYDCZJGQQDSMCYTZQQLWZQZXSSFPTTFQMDDZDSHDTDWFHTDYZJYQJQKYPBDJYYXTLJHDRQXXXHAYDHRJLKLYTWHLLRLLRCXYLBWSRSZZSYMKZZHHKYHXKSMDSYDYCJPBZBSQLFCXXXNXKXWYWSDZYQOGGQMMYHCDZTTFJYYBGSTTTYBYKJDHKYXBELHTYPJQNFXFDYKZHQKZBYJTZBXHFDXKDASWTAWAJLDYJSFHBLDNNTNQJTJNCHXFJSRFWHZFMDRYJYJWZPDJKZYJYMPCYZNYNXFBYTFYFWYGDBNZZZDNYTXZEMMQBSQEHXFZMBMFLZZSRXYMJGSXWZJSPRYDJSJGXHJJGLJJYNZZJXHGXKYMLPYYYCXYTWQZSWHWLYRJLPXSLSXMFSWWKLCTNXNYNPSJSZHDZEPTXMYYWXYYSYWLXJQZQXZDCLEEELMCPJPCLWBXSQHFWWTFFJTNQJHJQDXHWLBYZNFJLALKYYJLDXHHYCSTYYWNRJYXYWTRMDRQHWQCMFJDYZMHMYYXJWMYZQZXTLMRSPWWCHAQBXYGZYPXYYRRCLMPYMGKSJSZYSRMYJSNXTPLNBAPPYPYLXYYZKYNLDZYJZCZNNLMZHHARQMPGWQTZMXXMLLHGDZXYHXKYXYCJMFFYYHJFSBSSQLXXNDYCANNMTCJCYPRRNYTYQNYYMBMSXNDLYLYSLJRLXYSXQMLLYZLZJJJKYZZCSFBZXXMSTBJGNXYZHLXNMCWSCYZYFZLXBRNNNYLBNRTGZQYSATSWRYHYJZMZDHZGZDWYBSSCSKXSYHYTXXGCQGXZZSHYXJSCRHMKKBXCZJYJYMKQHZJFNBHMQHYSNJNZYBKNQMCLGQHWLZNZSWXKHLJHYYBQLBFCDSXDLDSPFZPSKJYZWZXZDDXJSMMEGJSCSSMGCLXXKYYYLNYPWWWGYDKZJGGGZGGSYCKNJWNJPCXBJJTQTJWDSSPJXZXNZXUMELPXFSXTLLXCLJXJJLJZXCTPSWXLYDHLYQRWHSYCSQYYBYAYWJJJQFWQCQQCJQGXALDBZZYJGKGXPLTZYFXJLTPADKYQHPMATLCPDCKBMTXYBHKLENXDLEEGQDYMSAWHZMLJTWYGXLYQZLJEEYYBQQFFNLYXRDSCTGJGXYYNKLLYQKCCTLHJLQMKKZGCYYGLLLJDZGYDHZWXPYSJBZKDZGYZZHYWYFQYTYZSZYEZZLYMHJJHTSMQWYZLKYYWZCSRKQYTLTDXWCTYJKLWSQZWBDCQYNCJSRSZJLKCDCDTLZZZACQQZZDDXYPLXZBQJYLZLLLQDDZQJYJYJZYXNYYYNYJXKXDAZWYRDLJYYYRJLXLLDYXJCYWYWNQCCLDDNYYYNYCKCZHXXCCLGZQJGKWPPCQQJYSBZZXYJSQPXJPZBSBDSFNSFPZXHDWZTDWPPTFLZZBZDMYYPQJRSDZSQZSQXBDGCPZSWDWCSQZGMDHZXMWWFYBPDGPHTMJTHZSMMBGZMBZJCFZWFZBBZMQCFMBDMCJXLGPNJBBXGYHYYJGPTZGZMQBQTCGYXJXLWZKYDPDYMGCFTPFXYZTZXDZXTGKMTYBBCLBJASKYTSSQYYMSZXFJEWLXLLSZBQJJJAKLYLXLYCCTSXMCWFKKKBSXLLLLJYXTYLTJYYTDPJHNHNNKBYQNFQYYZBYYESSESSGDYHFHWTCJBSDZZTFDMXHCNJZYMQWSRYJDZJQPDQBBSTJGGFBKJBXTGQHNGWJXJGDLLTHZHHYYYYYYSXWTYYYCCBDBPYPZYCCZYJPZYWCBDLFWZCWJDXXHYHLHWZZXJTCZLCDPXUJCZZZLYXJJTXPHFXWPYWXZPTDZZBDZCYHJHMLXBQXSBYLRDTGJRRCTTTHYTCZWMXFYTWWZCWJWXJYWCSKYBZSCCTZQNHXNWXXKHKFHTSWOCCJYBCMPZZYKBNNZPBZHHZDLSYDDYTYFJPXYNGFXBYQXCBHXCPSXTYZDMKYSNXSXLHKMZXLYHDHKWHXXSSKQYHHCJYXGLHZXCSNHEKDTGZXQYPKDHEXTYKCNYMYYYPKQYYYKXZLTHJQTBYQHXBMYHSQCKWWYLLHCYYLNNEQXQWMCFBDCCMLJGGXDQKTLXKGNQCDGZJWYJJLYHHQTTTNWCHMXCXWHWSZJYDJCCDBQCDGDNYXZTHCQRXCBHZTQCBXWGQWYYBXHMBYMYQTYEXMQKYAQYRGYZSLFYKKQHYSSQYSHJGJCNXKZYCXSBXYXHYYLSTYCXQTHYSMGSCPMMGCCCCCMTZTASMGQZJHKLOSQYLSWTMXSYQKDZLJQQYPLSYCZTCQQPBBQJZCLPKHQZYYXXDTDDTSJCXFFLLCHQXMJLWCJCXTSPYCXNDTJSHJWXDQQJSKXYAMYLSJHMLALYKXCYYDMNMDQMXMCZNNCYBZKKYFLMCHCMLHXRCJJHSYLNMTJZGZGYWJXSRXCWJGJQHQZDQJDCJJZKJKGDZQGJJYJYLXZXXCDQHHHEYTMHLFSBDJSYYSHFYSTCZQLPBDRFRZTZYKYWHSZYQKWDQZRKMSYNBCRXQBJYFAZPZZEDZCJYWBCJWHYJBQSZYWRYSZPTDKZPFPBNZTKLQYHBBZPNPPTYZZYBQNYDCPJMMCYCQMCYFZZDCMNLFPBPLNGQJTBTTNJZPZBBZNJKLJQYLNBZQHKSJZNGGQSZZKYXSHPZSNBCGZKDDZQANZHJKDRTLZLSWJLJZLYWTJNDJZJHXYAYNCBGTZCSSQMNJPJYTYSWXZFKWJQTKHTZPLBHSNJZSYZBWZZZZLSYLSBJHDWWQPSLMMFBJDWAQYZTCJTBNNWZXQXCDSLQGDSDPDZHJTQQPSWLYYJZLGYXYZLCTCBJTKTYCZJTQKBSJLGMGZDMCSGPYNJZYQYYKNXRPWSZXMTNCSZZYXYBYHYZAXYWQCJTLLCKJJTJHGDXDXYQYZZBYWDLWQCGLZGJGQRQZCZSSBCRPCSKYDZNXJSQGXSSJMYDNSTZTPBDLTKZWXQWQTZEXNQCZGWEZKSSBYBRTSSSLCCGBPSZQSZLCCGLLLZXHZQTHCZMQGYZQZNMCOCSZJMMZSQPJYGQLJYJPPLDXRGZYXCCSXHSHGTZNLZWZKJCXTCFCJXLBMQBCZZWPQDNHXLJCTHYZLGYLNLSZZPCXDSCQQHJQKSXZPBAJYEMSMJTZDXLCJYRYYNWJBNGZZTMJXLTBSLYRZPYLSSCNXPHLLHYLLQQZQLXYMRSYCXZLMMCZLTZSDWTJJLLNZGGQXPFSKYGYGHBFZPDKMWGHCXMSGDXJMCJZDYCABXJDLNBCDQYGSKYDQTXDJJYXMSZQAZDZFSLQXYJSJZYLBTXXWXQQZBJZUFBBLYLWDSLJHXJYZJWTDJCZFQZQZZDZSXZZQLZCDZFJHYSPYMPQZMLPPLFFXJJNZZYLSJEYQZFPFZKSYWJJJHRDJZZXTXXGLGHYDXCSKYSWMMZCWYBAZBJKSHFHJCXMHFQHYXXYZFTSJYZFXYXPZLCHMZMBXHZZSXYFYMNCWDABAZLXKTCSHHXKXJJZJSTHYGXSXYYHHHJWXKZXSSBZZWHHHCWTZZZPJXSNXQQJGZYZYWLLCWXZFXXYXYHXMKYYSWSQMNLNAYCYSPMJKHWCQHYLAJJMZXHMMCNZHBHXCLXTJPLTXYJHDYYLTTXFSZHYXXSJBJYAYRSMXYPLCKDUYHLXRLNLLSTYZYYQYGYHHSCCSMZCTZQXKYQFPYYRPFFLKQUNTSZLLZMWWTCQQYZWTLLMLMPWMBZSSTZRBPDDTLQJJBXZCSRZQQYGWCSXFWZLXCCRSZDZMCYGGDZQSGTJSWLJMYMMZYHFBJDGYXCCPSHXNZCSBSJYJGJMPPWAFFYFNXHYZXZYLREMZGZCYZSSZDLLJCSQFNXZKPTXZGXJJGFMYYYSNBTYLBNLHPFZDCYFBMGQRRSSSZXYSGTZRNYDZZCDGPJAFJFZKNZBLCZSZPSGCYCJSZLMLRSZBZZLDLSLLYSXSQZQLYXZLSKKBRXBRBZCYCXZZZEEYFGKLZLYYHGZSGZLFJHGTGWKRAAJYZKZQTSSHJJXDCYZUYJLZYRZDQQHGJZXSSZBYKJPBFRTJXLLFQWJHYLQTYMBLPZDXTZYGBDHZZRBGXHWNJTJXLKSCFSMWLSDQYSJTXKZSCFWJLBXFTZLLJZLLQBLSQMQQCGCZFPBPHZCZJLPYYGGDTGWDCFCZQYYYQYSSCLXZSKLZZZGFFCQNWGLHQYZJJCZLQZZYJPJZZBPDCCMHJGXDQDGDLZQMFGPSYTSDYFWWDJZJYSXYYCZCYHZWPBYKXRYLYBHKJKSFXTZJMMCKHLLTNYYMSYXYZPYJQYCSYCWMTJJKQYRHLLQXPSGTLYYCLJSCPXJYZFNMLRGJJTYZBXYZMSJYJHHFZQMSYXRSZCWTLRTQZSSTKXGQKGSPTGCZNJSJCQCXHMXGGZTQYDJKZDLBZSXJLHYQGGGTHQSZPYHJHHGYYGKGGCWJZZYLCZLXQSFTGZSLLLMLJSKCTBLLZZSZMMNYTPZSXQHJCJYQXYZXZQZCPSHKZZYSXCDFGMWQRLLQXRFZTLYSTCTMJCXJJXHJNXTNRZTZFQYHQGLLGCXSZSJDJLJCYDSJTLNYXHSZXCGJZYQPYLFHDJSBPCCZHJJJQZJQDYBSSLLCMYTTMQTBHJQNNYGKYRQYQMZGCJKPDCGMYZHQLLSLLCLMHOLZGDYYFZSLJCQZLYLZQJESHNYLLJXGJXLYSYYYXNBZLJSSZCQQCJYLLZLTJYLLZLLBNYLGQCHXYYXOXCXQKYJXXXYKLXSXXYQXCYKQXQCSGYXXYQXYGYTQOHXHXPYXXXULCYEYCHZZCBWQBBWJQZSCSZSSLZYLKDESJZWMYMCYTSDSXXSCJPQQSQYLYYZYCMDJDZYWCBTJSYDJKCYDDJLBDJJSODZYSYXQQYXDHHGQQYQHDYXWGMMMAJDYBBBPPBCMUUPLJZSMTXERXJMHQNUTPJDCBSSMSSSTKJTSSMMTRCPLZSZMLQDSDMJMQPNQDXCFYNBFSDQXYXHYAYKQYDDLQYYYSSZBYDSLNTFQTZQPZMCHDHCZCWFDXTMYQSPHQYYXSRGJCWTJTZZQMGWJJTJHTQJBBHWZPXXHYQFXXQYWYYHYSCDYDHHQMNMTMWCPBSZPPZZGLMZFOLLCFWHMMSJZTTDHZZYFFYTZZGZYSKYJXQYJZQBHMBZZLYGHGFMSHPZFZSNCLPBQSNJXZSLXXFPMTYJYGBXLLDLXPZJYZJYHHZCYWHJYLSJEXFSZZYWXKZJLUYDTMLYMQJPWXYHXSKTQJEZRPXXZHHMHWQPWQLYJJQJJZSZCPHJLCHHNXJLQWZJHBMZYXBDHHYPZLHLHLGFWLCHYYTLHJXCJMSCPXSTKPNHQXSRTYXXTESYJCTLSSLSTDLLLWWYHDHRJZSFGXTSYCZYNYHTDHWJSLHTZDQDJZXXQHGYLTZPHCSQFCLNJTCLZPFSTPDYNYLGMJLLYCQHYSSHCHYLHQYQTMZYPBYWRFQYKQSYSLZDQJMPXYYSSRHZJNYWTQDFZBWWTWWRXCWHGYHXMKMYYYQMSMZHNGCEPMLQQMTCWCTMMPXJPJJHFXYYZSXZHTYBMSTSYJTTQQQYYLHYNPYQZLCYZHZWSMYLKFJXLWGXYPJYTYSYXYMZCKTTWLKSMZSYLMPWLZWXWQZSSAQSYXYRHSSNTSRAPXCPWCMGDXHXZDZYFJHGZTTSBJHGYZSZYSMYCLLLXBTYXHBBZJKSSDMALXHYCFYGMQYPJYCQXJLLLJGSLZGQLYCJCCZOTYXMTMTTLLWTGPXYMZMKLPSZZZXHKQYSXCTYJZYHXSHYXZKXLZWPSQPYHJWPJPWXQQYLXSDHMRSLZZYZWTTCYXYSZZSHBSCCSTPLWSSCJCHNLCGCHSSPHYLHFHHXJSXYLLNYLSZDHZXYLSXLWZYKCLDYAXZCMDDYSPJTQJZLNWQPSSSWCTSTSZLBLNXSMNYYMJQBQHRZWTYYDCHQLXKPZWBGQYBKFCMZWPZLLYYLSZYDWHXPSBCMLJBSCGBHXLQHYRLJXYSWXWXZSLDFHLSLYNJLZYFLYJYCDRJLFSYZFSLLCQYQFGJYHYXZLYLMSTDJCYHBZLLNWLXXYGYYHSMGDHXXHHLZZJZXCZZZCYQZFNGWPYLCPKPYYPMCLQKDGXZGGWQBDXZZKZFBXXLZXJTPJPTTBYTSZZDWSLCHZHSLTYXHQLHYXXXYYZYSWTXZKHLXZXZPYHGCHKCFSYHUTJRLXFJXPTZTWHPLYXFCRHXSHXKYXXYHZQDXQWULHYHMJTBFLKHTXCWHJFWJCFPQRYQXCYYYQYGRPYWSGSUNGWCHKZDXYFLXXHJJBYZWTSXXNCYJJYMSWZJQRMHXZWFQSYLZJZGBHYNSLBGTTCSYBYXXWXYHXYYXNSQYXMQYWRGYQLXBBZLJSYLPSYTJZYHYZAWLRORJMKSCZJXXXYXCHDYXRYXXJDTSQFXLYLTSFFYXLMTYJMJUYYYXLTZCSXQZQHZXLYYXZHDNBRXXXJCTYHLBRLMBRLLAXKYLLLJLYXXLYCRYLCJTGJCMTLZLLCYZZPZPCYAWHJJFYBDYYZSMPCKZDQYQPBPCJPDCYZMDPBCYYDYCNNPLMTMLRMFMMGWYZBSJGYGSMZQQQZTXMKQWGXLLPJGZBQCDJJJFPKJKCXBLJMSWMDTQJXLDLPPBXCWRCQFBFQJCZAHZGMYKPHYYHZYKNDKZMBPJYXPXYHLFPNYYGXJDBKXNXHJMZJXSTRSTLDXSKZYSYBZXJLXYSLBZYSLHXJPFXPQNBYLLJQKYGZMCYZZYMCCSLCLHZFWFWYXZMWSXTYNXJHPYYMCYSPMHYSMYDYSHQYZCHMJJMZCAAGCFJBBHPLYZYLXXSDJGXDHKXXTXXNBHRMLYJSLTXMRHNLXQJXYZLLYSWQGDLBJHDCGJYQYCMHWFMJYBMBYJYJWYMDPWHXQLDYGPDFXXBCGJSPCKRSSYZJMSLBZZJFLJJJLGXZGYXYXLSZQYXBEXYXHGCXBPLDYHWETTWWCJMBTXCHXYQXLLXFLYXLLJLSSFWDPZSMYJCLMWYTCZPCHQEKCQBWLCQYDPLQPPQZQFJQDJHYMMCXTXDRMJWRHXCJZYLQXDYYNHYYHRSLSRSYWWZJYMTLTLLGTQCJZYABTCKZCJYCCQLJZQXALMZYHYWLWDXZXQDLLQSHGPJFJLJHJABCQZDJGTKHSSTCYJLPSWZLXZXRWGLDLZRLZXTGSLLLLZLYXXWGDZYGBDPHZPBRLWSXQBPFDWOFMWHLYPCBJCCLDMBZPBZZLCYQXLDOMZBLZWPDWYYGDSTTHCSQSCCRSSSYSLFYBFNTYJSZDFNDPDHDZZMBBLSLCMYFFGTJJQWFTMTPJWFNLBZCMMJTGBDZLQLPYFHYYMJYLSDCHDZJWJCCTLJCLDTLJJCPDDSQDSSZYBNDBJLGGJZXSXNLYCYBJXQYCBYLZCFZPPGKCXZDZFZTJJFJSJXZBNZYJQTTYJYHTYCZHYMDJXTTMPXSPLZCDWSLSHXYPZGTFMLCJTYCBPMGDKWYCYZCDSZZYHFLYCTYGWHKJYYLSJCXGYWJCBLLCSNDDBTZBSCLYZCZZSSQDLLMQYYHFSLQLLXFTYHABXGWNYWYYPLLSDLDLLBJCYXJZMLHLJDXYYQYTDLLLBUGBFDFBBQJZZMDPJHGCLGMJJPGAEHHBWCQXAXHHHZCHXYPHJAXHLPHJPGPZJQCQZGJJZZUZDMQYYBZZPHYHYBWHAZYJHYKFGDPFQSDLZMLJXKXGALXZDAGLMDGXMWZQYXXDXXPFDMMSSYMPFMDMMKXKSYZYSHDZKXSYSMMZZZMSYDNZZCZXFPLSTMZDNMXCKJMZTYYMZMZZMSXHHDCZJEMXXKLJSTLWLSQLYJZLLZJSSDPPMHNLZJCZYHMXXHGZCJMDHXTKGRMXFWMCGMWKDTKSXQMMMFZZYDKMSCLCMPCGMHSPXQPZDSSLCXKYXTWLWJYAHZJGZQMCSNXYYMMPMLKJXMHLMLQMXCTKZMJQYSZJSYSZHSYJZJCDAJZYBSDQJZGWZQQXFKDMSDJLFWEHKZQKJPEYPZYSZCDWYJFFMZZYLTTDZZEFMZLBNPPLPLPEPSZALLTYLKCKQZKGENQLWAGYXYDPXLHSXQQWQCQXQCLHYXXMLYCCWLYMQYSKGCHLCJNSZKPYZKCQZQLJPDMDZHLASXLBYDWQLWDNBQCRYDDZTJYBKBWSZDXDTNPJDTCTQDFXQQMGNXECLTTBKPWSLCTYQLPWYZZKLPYGZCQQPLLKCCYLPQMZCZQCLJSLQZDJXLDDHPZQDLJJXZQDXYZQKZLJCYQDYJPPYPQYKJYRMPCBYMCXKLLZLLFQPYLLLMBSGLCYSSLRSYSQTMXYXZQZFDZUYSYZTFFMZZSMZQHZSSCCMLYXWTPZGXZJGZGSJSGKDDHTQGGZLLBJDZLCBCHYXYZHZFYWXYZYMSDBZZYJGTSMTFXQYXQSTDGSLNXDLRYZZLRYYLXQHTXSRTZNGZXBNQQZFMYKMZJBZYMKBPNLYZPBLMCNQYZZZSJZHJCTZKHYZZJRDYZHNPXGLFZTLKGJTCTSSYLLGZRZBBQZZKLPKLCZYSSUYXBJFPNJZZXCDWXZYJXZZDJJKGGRSRJKMSMZJLSJYWQSKYHQJSXPJZZZLSNSHRNYPZTWCHKLPSRZLZXYJQXQKYSJYCZTLQZYBBYBWZPQDWWYZCYTJCJXCKCWDKKZXSGKDZXWWYYJQYYTCYTDLLXWKCZKKLCCLZCQQDZLQLCSFQCHQHSFSMQZZLNBJJZBSJHTSZDYSJQJPDLZCDCWJKJZZLPYCGMZWDJJBSJQZSYZYHHXJPBJYDSSXDZNCGLQMBTSFSBPDZDLZNFGFJGFSMPXJQLMBLGQCYYXBQKDJJQYRFKZTJDHCZKLBSDZCFJTPLLJGXHYXZCSSZZXSTJYGKGCKGYOQXJPLZPBPGTGYJZGHZQZZLBJLSQFZGKQQJZGYCZBZQTLDXRJXBSXXPZXHYZYCLWDXJJHXMFDZPFZHQHQMQGKSLYHTYCGFRZGNQXCLPDLBZCSCZQLLJBLHBZCYPZZPPDYMZZSGYHCKCPZJGSLJLNSCDSLDLXBMSTLDDFJMKDJDHZLZXLSZQPQPGJLLYBDSZGQLBZLSLKYYHZTTNTJYQTZZPSZQZTLLJTYYLLQLLQYZQLBDZLSLYYZYMDFSZSNHLXZNCZQZPBWSKRFBSYZMTHBLGJPMCZZLSTLXSHTCSYZLZBLFEQHLXFLCJLYLJQCBZLZJHHSSTBRMHXZHJZCLXFNBGXGTQJCZTMSFZKJMSSNXLJKBHSJXNTNLZDNTLMSJXGZJYJCZXYJYJWRWWQNZTNFJSZPZSHZJFYRDJSFSZJZBJFZQZZHZLXFYSBZQLZSGYFTZDCSZXZJBQMSZKJRHYJZCKMJKHCHGTXKXQGLXPXFXTRTYLXJXHDTSJXHJZJXZWZLCQSBTXWXGXTXXHXFTSDKFJHZYJFJXRZSDLLLTQSQQZQWZXSYQTWGWBZCGZLLYZBCLMQQTZHZXZXLJFRMYZFLXYSQXXJKXRMQDZDMMYYBSQBHGZMWFWXGMXLZPYYTGZYCCDXYZXYWGSYJYZNBHPZJSQSYXSXRTFYZGRHZTXSZZTHCBFCLSYXZLZQMZLMPLMXZJXSFLBYZMYQHXJSXRXSQZZZSSLYFRCZJRCRXHHZXQYDYHXSJJHZCXZBTYNSYSXJBQLPXZQPYMLXZKYXLXCJLCYSXXZZLXDLLLJJYHZXGYJWKJRWYHCPSGNRZLFZWFZZNSXGXFLZSXZZZBFCSYJDBRJKRDHHGXJLJJTGXJXXSTJTJXLYXQFCSGSWMSBCTLQZZWLZZKXJMLTMJYHSDDBXGZHDLBMYJFRZFSGCLYJBPMLYSMSXLSZJQQHJZFXGFQFQBPXZGYYQXGZTCQWYLTLGWSGWHRLFSFGZJMGMGBGTJFSYZZGZYZAFLSSPMLPFLCWBJZCLJJMZLPJJLYMQDMYYYFBGYGYZMLYZDXQYXRQQQHSYYYQXYLJTYXFSFSLLGNQCYHYCWFHCCCFXPYLYPLLZYXXXXXKQHHXSHJZCFZSCZJXCPZWHHHHHAPYLQALPQAFYHXDYLUKMZQGGGDDESRNNZLTZGCHYPPYSQJJHCLLJTOLNJPZLJLHYMHEYDYDSQYCDDHGZUNDZCLZYZLLZNTNYZGSLHSLPJJBDGWXPCDUTJCKLKCLWKLLCASSTKZZDNQNTTLYYZSSYSSZZRYLJQKCQDHHCRXRZYDGRGCWCGZQFFFPPJFZYNAKRGYWYQPQXXFKJTSZZXSWZDDFBBXTBGTZKZNPZZPZXZPJSZBMQHKCYXYLDKLJNYPKYGHGDZJXXEAHPNZKZTZCMXCXMMJXNKSZQNMNLWBWWXJKYHCPSTMCSQTZJYXTPCTPDTNNPGLLLZSJLSPBLPLQHDTNJNLYYRSZFFJFQWDPHZDWMRZCCLODAXNSSNYZRESTYJWJYJDBCFXNMWTTBYLWSTSZGYBLJPXGLBOCLHPCBJLTMXZLJYLZXCLTPNCLCKXTPZJSWCYXSFYSZDKNTLBYJCYJLLSTGQCBXRYZXBXKLYLHZLQZLNZCXWJZLJZJNCJHXMNZZGJZZXTZJXYCYYCXXJYYXJJXSSSJSTSSTTPPGQTCSXWZDCSYFPTFBFHFBBLZJCLZZDBXGCXLQPXKFZFLSYLTUWBMQJHSZBMDDBCYSCCLDXYCDDQLYJJWMQLLCSGLJJSYFPYYCCYLTJANTJJPWYCMMGQYYSXDXQMZHSZXPFTWWZQSWQRFKJLZJQQYFBRXJHHFWJJZYQAZMYFRHCYYBYQWLPEXCCZSTYRLTTDMQLYKMBBGMYYJPRKZNPBSXYXBHYZDJDNGHPMFSGMWFZMFQMMBCMZZCJJLCNUXYQLMLRYGQZCYXZLWJGCJCGGMCJNFYZZJHYCPRRCMTZQZXHFQGTJXCCJEAQCRJYHPLQLSZDJRBCQHQDYRHYLYXJSYMHZYDWLDFRYHBPYDTSSCNWBXGLPZMLZZTQSSCPJMXXYCSJYTYCGHYCJWYRXXLFEMWJNMKLLSWTXHYYYNCMMCWJDQDJZGLLJWJRKHPZGGFLCCSCZMCBLTBHBQJXQDSPDJZZGKGLFQYWBZYZJLTSTDHQHCTCBCHFLQMPWDSHYYTQWCNZZJTLBYMBPDYYYXSQKXWYYFLXXNCWCXYPMAELYKKJMZZZBRXYYQJFLJPFHHHYTZZXSGQQMHSPGDZQWBWPJHZJDYSCQWZKTXXSQLZYYMYSDZGRXCKKUJLWPYSYSCSYZLRMLQSYLJXBCXTLWDQZPCYCYKPPPNSXFYZJJRCEMHSZMSXLXGLRWGCSTLRSXBZGBZGZTCPLUJLSLYLYMTXMTZPALZXPXJTJWTCYYZLBLXBZLQMYLXPGHDSLSSDMXMBDZZSXWHAMLCZCPJMCNHJYSNSYGCHSKQMZZQDLLKABLWJXSFMOCDXJRRLYQZKJMYBYQLYHETFJZFRFKSRYXFJTWDSXXSYSQJYSLYXWJHSNLXYYXHBHAWHHJZXWMYLJCSSLKYDZTXBZSYFDXGXZJKHSXXYBSSXDPYNZWRPTQZCZENYGCXQFJYKJBZMLJCMQQXUOXSLYXXLYLLJDZBTYMHPFSTTQQWLHOKYBLZZALZXQLHZWRRQHLSTMYPYXJJXMQSJFNBXYXYJXXYQYLTHYLQYFMLKLJTMLLHSZWKZHLJMLHLJKLJSTLQXYLMBHHLNLZXQJHXCFXXLHYHJJGBYZZKBXSCQDJQDSUJZYYHZHHMGSXCSYMXFEBCQWWRBPYYJQTYZCYQYQQZYHMWFFHGZFRJFCDPXNTQYZPDYKHJLFRZXPPXZDBBGZQSTLGDGYLCQMLCHHMFYWLZYXKJLYPQHSYWMQQGQZMLZJNSQXJQSYJYCBEHSXFSZPXZWFLLBCYYJDYTDTHWZSFJMQQYJLMQXXLLDTTKHHYBFPWTYYSQQWNQWLGWDEBZWCMYGCULKJXTMXMYJSXHYBRWFYMWFRXYQMXYSZTZZTFYKMLDHQDXWYYNLCRYJBLPSXCXYWLSPRRJWXHQYPHTYDNXHHMMYWYTZCSQMTSSCCDALWZTCPQPYJLLQZYJSWXMZZMMYLMXCLMXCZMXMZSQTZPPQQBLPGXQZHFLJJHYTJSRXWZXSCCDLXTYJDCQJXSLQYCLZXLZZXMXQRJMHRHZJBHMFLJLMLCLQNLDXZLLLPYPSYJYSXCQQDCMQJZZXHNPNXZMEKMXHYKYQLXSXTXJYYHWDCWDZHQYYBGYBCYSCFGPSJNZDYZZJZXRZRQJJYMCANYRJTLDPPYZBSTJKXXZYPFDWFGZZRPYMTNGXZQBYXNBUFNQKRJQZMJEGRZGYCLKXZDSKKNSXKCLJSPJYYZLQQJYBZSSQLLLKJXTBKTYLCCDDBLSPPFYLGYDTZJYQGGKQTTFZXBDKTYYHYBBFYTYYBCLPDYTGDHRYRNJSPTCSNYJQHKLLLZSLYDXXWBCJQSPXBPJZJCJDZFFXXBRMLAZHCSNDLBJDSZBLPRZTSWSBXBCLLXXLZDJZSJPYLYXXYFTFFFBHJJXGBYXJPMMMPSSJZJMTLYZJXSWXTYLEDQPJMYGQZJGDJLQJWJQLLSJGJGYGMSCLJJXDTYGJQJQJCJZCJGDZZSXQGSJGGCXHQXSNQLZZBXHSGZXCXYLJXYXYYDFQQJHJFXDHCTXJYRXYSQTJXYEFYYSSYYJXNCYZXFXMSYSZXYYSCHSHXZZZGZZZGFJDLTYLNPZGYJYZYYQZPBXQBDZTZCZYXXYHHSQXSHDHGQHJHGYWSZTMZMLHYXGEBTYLZKQWYTJZRCLEKYSTDBCYKQQSAYXCJXWWGSBHJYZYDHCSJKQCXSWXFLTYNYZPZCCZJQTZWJQDZZZQZLJJXLSBHPYXXPSXSHHEZTXFPTLQYZZXHYTXNCFZYYHXGNXMYWXTZSJPTHHGYMXMXQZXTSBCZYJYXXTYYZYPCQLMMSZMJZZLLZXGXZAAJZYXJMZXWDXZSXZDZXLEYJJZQBHZWZZZQTZPSXZTDSXJJJZNYAZPHXYYSRNQDTHZHYYKYJHDZXZLSWCLYBZYECWCYCRYLCXNHZYDZYDYJDFRJJHTRSQTXYXJRJHOJYNXELXSFSFJZGHPZSXZSZDZCQZBYYKLSGSJHCZSHDGQGXYZGXCHXZJWYQWGYHKSSEQZZNDZFKWYSSTCLZSTSYMCDHJXXYWEYXCZAYDMPXMDSXYBSQMJMZJMTZQLPJYQZCGQHXJHHLXXHLHDLDJQCLDWBSXFZZYYSCHTYTYYBHECXHYKGJPXHHYZJFXHWHBDZFYZBCAPNPGNYDMSXHMMMMAMYNBYJTMPXYYMCTHJBZYFCGTYHWPHFTWZZEZSBZEGPFMTSKFTYCMHFLLHGPZJXZJGZJYXZSBBQSCZZLZCCSTPGXMJSFTCCZJZDJXCYBZLFCJSYZFGSZLYBCWZZBYZDZYPSWYJZXZBDSYUXLZZBZFYGCZXBZHZFTPBGZGEJBSTGKDMFHYZZJHZLLZZGJQZLSFDJSSCBZGPDLFZFZSZYZYZSYGCXSNXXCHCZXTZZLJFZGQSQYXZJQDCCZTQCDXZJYQJQCHXZTDLGSCXZSYQJQTZWLQDQZTQCHQQJZYEZZZPBWKDJFCJPZTYPQYQTTYNLMBDKTJZPQZQZZFPZSBNJLGYJDXJDZZKZGQKXDLPZJTCJDQBXDJQJSTCKNXBXZMSLYJCQMTJQWWCJQNJNLLLHJCWQTBZQYDZCZPZZDZYDDCYZZZCCJTTJFZDPRRTZTJDCQTQZDTJNPLZBCLLCTZSXKJZQZPZLBZRBTJDCXFCZDBCCJJLTQQPLDCGZDBBZJCQDCJWYNLLZYZCCDWLLXWZLXRXNTQQCZXKQLSGDFQTDDGLRLAJJTKUYMKQLLTZYTDYYCZGJWYXDXFRSKSTQTENQMRKQZHHQKDLDAZFKYPBGGPZREBZZYKZZSPEGJXGYKQZZZSLYSYYYZWFQZYLZZLZHWCHKYPQGNPGBLPLRRJYXCCSYYHSFZFYBZYYTGZXYLXCZWXXZJZBLFFLGSKHYJZEYJHLPLLLLCZGXDRZELRHGKLZZYHZLYQSZZJZQLJZFLNBHGWLCZCFJYSPYXZLZLXGCCPZBLLCYBBBBUBBCBPCRNNZCZYRBFSRLDCGQYYQXYGMQZWTZYTYJXYFWTEHZZJYWLCCNTZYJJZDEDPZDZTSYQJHDYMBJNYJZLXTSSTPHNDJXXBYXQTZQDDTJTDYYTGWSCSZQFLSHLGLBCZPHDLYZJYCKWTYTYLBNYTSDSYCCTYSZYYEBHEXHQDTWNYGYCLXTSZYSTQMYGZAZCCSZZDSLZCLZRQXYYELJSBYMXSXZTEMBBLLYYLLYTDQYSHYMRQWKFKBFXNXSBYCHXBWJYHTQBPBSBWDZYLKGZSKYHXQZJXHXJXGNLJKZLYYCDXLFYFGHLJGJYBXQLYBXQPQGZTZPLNCYPXDJYQYDYMRBESJYYHKXXSTMXRCZZYWXYQYBMCLLYZHQYZWQXDBXBZWZMSLPDMYSKFMZKLZCYQYCZLQXFZZYDQZPZYGYJYZMZXDZFYFYTTQTZHGSPCZMLCCYTZXJCYTJMKSLPZHYSNZLLYTPZCTZZCKTXDHXXTQCYFKSMQCCYYAZHTJPCYLZLYJBJXTPNYLJYYNRXSYLMMNXJSMYBCSYSYLZYLXJJQYLDZLPQBFZZBLFNDXQKCZFYWHGQMRDSXYCYTXNQQJZYYPFZXDYZFPRXEJDGYQBXRCNFYYQPGHYJDYZXGRHTKYLNWDZNTSMPKLBTHBPYSZBZTJZSZZJTYYXZPHSSZZBZCZPTQFZMYFLYPYBBJQXZMXXDJMTSYSKKBJZXHJCKLPSMKYJZCXTMLJYXRZZQSLXXQPYZXMKYXXXJCLJPRMYYGADYSKQLSNDHYZKQXZYZTCGHZTLMLWZYBWSYCTBHJHJFCWZTXWYTKZLXQSHLYJZJXTMPLPYCGLTBZZTLZJCYJGDTCLKLPLLQPJMZPAPXYZLKKTKDZCZZBNZDYDYQZJYJGMCTXLTGXSZLMLHBGLKFWNWZHDXUHLFMKYSLGXDTWWFRJEJZTZHYDXYKSHWFZCQSHKTMQQHTZHYMJDJSKHXZJZBZZXYMPAGQMSTPXLSKLZYNWRTSQLSZBPSPSGZWYHTLKSSSWHZZLYYTNXJGMJSZSUFWNLSOZTXGXLSAMMLBWLDSZYLAKQCQCTMYCFJBSLXCLZZCLXXKSBZQCLHJPSQPLSXXCKSLNHPSFQQYTXYJZLQLDXZQJZDYYDJNZPTUZDSKJFSLJHYLZSQZLBTXYDGTQFDBYAZXDZHZJNHHQBYKNXJJQCZMLLJZKSPLDYCLBBLXKLELXJLBQYCXJXGCNLCQPLZLZYJTZLJGYZDZPLTQCSXFDMNYCXGBTJDCZNBGBQYQJWGKFHTNPYQZQGBKPBBYZMTJDYTBLSQMPSXTBNPDXKLEMYYCJYNZCTLDYKZZXDDXHQSHDGMZSJYCCTAYRZLPYLTLKXSLZCGGEXCLFXLKJRTLQJAQZNCMBYDKKCXGLCZJZXJHPTDJJMZQYKQSECQZDSHHADMLZFMMZBGNTJNNLGBYJBRBTMLBYJDZXLCJLPLDLPCQDHLXZLYCBLCXZZJADJLNZMMSSSMYBHBSQKBHRSXXJMXSDZNZPXLGBRHWGGFCXGMSKLLTSJYYCQLTSKYWYYHYWXBXQYWPYWYKQLSQPTNTKHQCWDQKTWPXXHCPTHTWUMSSYHBWCRWXHJMKMZNGWTMLKFGHKJYLSYYCXWHYECLQHKQHTTQKHFZLDXQWYZYYDESBPKYRZPJFYYZJCEQDZZDLATZBBFJLLCXDLMJSSXEGYGSJQXCWBXSSZPDYZCXDNYXPPZYDLYJCZPLTXLSXYZYRXCYYYDYLWWNZSAHJSYQYHGYWWAXTJZDAXYSRLTDPSSYYFNEJDXYZHLXLLLZQZSJNYQYQQXYJGHZGZCYJCHZLYCDSHWSHJZYJXCLLNXZJJYYXNFXMWFPYLCYLLABWDDHWDXJMCXZTZPMLQZHSFHZYNZTLLDYWLSLXHYMMYLMBWWKYXYADTXYLLDJPYBPWUXJMWMLLSAFDLLYFLBHHHBQQLTZJCQJLDJTFFKMMMBYTHYGDCQRDDWRQJXNBYSNWZDBYYTBJHPYBYTTJXAAHGQDQTMYSTQXKBTZPKJLZRBEQQSSMJJBDJOTGTBXPGBKTLHQXJJJCTHXQDWJLWRFWQGWSHCKRYSWGFTGYGBXSDWDWRFHWYTJJXXXJYZYSLPYYYPAYXHYDQKXSHXYXGSKQHYWFDDDPPLCJLQQEEWXKSYYKDYPLTJTHKJLTCYYHHJTTPLTZZCDLTHQKZXQYSTEEYWYYZYXXYYSTTJKLLPZMCYHQGXYHSRMBXPLLNQYDQHXSXXWGDQBSHYLLPJJJTHYJKYPPTHYYKTYEZYENMDSHLCRPQFDGFXZPSFTLJXXJBSWYYSKSFLXLPPLBBBLBSFXFYZBSJSSYLPBBFFFFSSCJDSTZSXZRYYSYFFSYZYZBJTBCTSBSDHRTJJBYTCXYJEYLXCBNEBJDSYXYKGSJZBXBYTFZWGENYHHTHZHHXFWGCSTBGXKLSXYWMTMBYXJSTZSCDYQRCYTWXZFHMYMCXLZNSDJTTTXRYCFYJSBSDYERXJLJXBBDEYNJGHXGCKGSCYMBLXJMSZNSKGXFBNBPTHFJAAFXYXFPXMYPQDTZCXZZPXRSYWZDLYBBKTYQPQJPZYPZJZNJPZJLZZFYSBTTSLMPTZRTDXQSJEHBZYLZDHLJSQMLHTXTJECXSLZZSPKTLZKQQYFSYGYWPCPQFHQHYTQXZKRSGTTSQCZLPTXCDYYZXSQZSLXLZMYCPCQBZYXHBSXLZDLTCDXTYLZJYYZPZYZLTXJSJXHLPMYTXCQRBLZSSFJZZTNJYTXMYJHLHPPLCYXQJQQKZZSCPZKSWALQSBLCCZJSXGWWWYGYKTJBBZTDKHXHKGTGPBKQYSLPXPJCKBMLLXDZSTBKLGGQKQLSBKKTFXRMDKBFTPZFRTBBRFERQGXYJPZSSTLBZTPSZQZSJDHLJQLZBPMSMMSXLQQNHKNBLRDDNXXDHDDJCYYGYLXGZLXSYGMQQGKHBPMXYXLYTQWLWGCPBMQXCYZYDRJBHTDJYHQSHTMJSBYPLWHLZFFNYPMHXXHPLTBQPFBJWQDBYGPNZTPFZJGSDDTQSHZEAWZZYLLTYYBWJKXXGHLFKXDJTMSZSQYNZGGSWQSPHTLSSKMCLZXYSZQZXNCJDQGZDLFNYKLJCJLLZLMZZNHYDSSHTHZZLZZBBHQZWWYCRZHLYQQJBEYFXXXWHSRXWQHWPSLMSSKZTTYGYQQWRSLALHMJTQJSMXQBJJZJXZYZKXBYQXBJXSHZTSFJLXMXZXFGHKZSZGGYLCLSARJYHSLLLMZXELGLXYDJYTLFBHBPNLYZFBBHPTGJKWETZHKJJXZXXGLLJLSTGSHJJYQLQZFKCGNNDJSSZFDBCTWWSEQFHQJBSAQTGYPQLBXBMMYWXGSLZHGLZGQYFLZBYFZJFRYSFMBYZHQGFWZSYFYJJPHZBYYZFFWODGRLMFTWLBZGYCQXCDJYGZYYYYTYTYDWEGAZYHXJLZYYHLRMGRXXZCLHNELJJTJTPWJYBJJBXJJTJTEEKHWSLJPLPSFYZPQQBDLQJJTYYQLYZKDKSQJYYQZLDQTGJQYZJSUCMRYQTHTEJMFCTYHYPKMHYZWJDQFHYYXWSHCTXRLJHQXHCCYYYJLTKTTYTMXGTCJTZAYYOCZLYLBSZYWJYTSJYHBYSHFJLYGJXXTMZYYLTXXYPZLXYJZYZYYPNHMYMDYYLBLHLSYYQQLLNJJYMSOYQBZGDLYXYLCQYXTSZEGXHZGLHWBLJHEYXTWQMAKBPQCGYSHHEGQCMWYYWLJYJHYYZLLJJYLHZYHMGSLJLJXCJJYCLYCJPCPZJZJMMYLCQLNQLJQJSXYJMLSZLJQLYCMMHCFMMFPQQMFYLQMCFFQMMMMHMZNFHHJGTTHHKHSLNCHHYQDXTMMQDCYZYXYQMYQYLTDCYYYZAZZCYMZYDLZFFFMMYCQZWZZMABTBYZTDMNZZGGDFTYPCGQYTTSSFFWFDTZQSSYSTWXJHXYTSXXYLBYQHWWKXHZXWZNNZZJZJJQJCCCHYYXBZXZCYZTLLCQXYNJYCYYCYNZZQYYYEWYCZDCJYCCHYJLBTZYYCQWMPWPYMLGKDLDLGKQQBGYCHJXY",this.full_dict={a:"啊阿锕",ai:"埃挨哎唉哀皑癌蔼矮艾碍爱隘诶捱嗳嗌嫒瑷暧砹锿霭",an:"鞍氨安俺按暗岸胺案谙埯揞犴庵桉铵鹌顸黯",ang:"肮昂盎",ao:"凹敖熬翱袄傲奥懊澳坳拗嗷噢岙廒遨媪骜聱螯鏊鳌鏖",ba:"芭捌扒叭吧笆八疤巴拔跋靶把耙坝霸罢爸茇菝萆捭岜灞杷钯粑鲅魃",bai:"白柏百摆佰败拜稗薜掰鞴",ban:"斑班搬扳般颁板版扮拌伴瓣半办绊阪坂豳钣瘢癍舨",bang:"邦帮梆榜膀绑棒磅蚌镑傍谤蒡螃",bao:"苞胞包褒雹保堡饱宝抱报暴豹鲍爆勹葆宀孢煲鸨褓趵龅",bo:"剥薄玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳亳蕃啵饽檗擘礴钹鹁簸跛",bei:"杯碑悲卑北辈背贝钡倍狈备惫焙被孛陂邶埤蓓呗怫悖碚鹎褙鐾",ben:"奔苯本笨畚坌锛",beng:"崩绷甭泵蹦迸唪嘣甏",bi:"逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必辟壁臂避陛匕仳俾芘荜荸吡哔狴庳愎滗濞弼妣婢嬖璧贲畀铋秕裨筚箅篦舭襞跸髀",bian:"鞭边编贬扁便变卞辨辩辫遍匾弁苄忭汴缏煸砭碥稹窆蝙笾鳊",biao:"标彪膘表婊骠飑飙飚灬镖镳瘭裱鳔",bie:"鳖憋别瘪蹩鳘",bin:"彬斌濒滨宾摈傧浜缤玢殡膑镔髌鬓",bing:"兵冰柄丙秉饼炳病并禀邴摒绠枋槟燹",bu:"捕卜哺补埠不布步簿部怖拊卟逋瓿晡钚醭",ca:"擦嚓礤",cai:"猜裁材才财睬踩采彩菜蔡",can:"餐参蚕残惭惨灿骖璨粲黪",cang:"苍舱仓沧藏伧",cao:"操糙槽曹草艹嘈漕螬艚",ce:"厕策侧册测刂帻恻",ceng:"层蹭噌",cha:"插叉茬茶查碴搽察岔差诧猹馇汊姹杈楂槎檫钗锸镲衩",chai:"拆柴豺侪茈瘥虿龇",chan:"搀掺蝉馋谗缠铲产阐颤冁谄谶蒇廛忏潺澶孱羼婵嬗骣觇禅镡裣蟾躔",chang:"昌猖场尝常长偿肠厂敞畅唱倡伥鬯苌菖徜怅惝阊娼嫦昶氅鲳",chao:"超抄钞朝嘲潮巢吵炒怊绉晁耖",che:"车扯撤掣彻澈坼屮砗",chen:"郴臣辰尘晨忱沉陈趁衬称谌抻嗔宸琛榇肜胂碜龀",cheng:"撑城橙成呈乘程惩澄诚承逞骋秤埕嵊徵浈枨柽樘晟塍瞠铖裎蛏酲",chi:"吃痴持匙池迟弛驰耻齿侈尺赤翅斥炽傺墀芪茌搋叱哧啻嗤彳饬沲媸敕胝眙眵鸱瘛褫蚩螭笞篪豉踅踟魑",chong:"充冲虫崇宠茺忡憧铳艟",chou:"抽酬畴踌稠愁筹仇绸瞅丑俦圳帱惆溴妯瘳雠鲋",chu:"臭初出橱厨躇锄雏滁除楚础储矗搐触处亍刍憷绌杵楮樗蜍蹰黜",chuan:"揣川穿椽传船喘串掾舛惴遄巛氚钏镩舡",chuang:"疮窗幢床闯创怆",chui:"吹炊捶锤垂陲棰槌",chun:"春椿醇唇淳纯蠢促莼沌肫朐鹑蝽",chuo:"戳绰蔟辶辍镞踔龊",ci:"疵茨磁雌辞慈瓷词此刺赐次荠呲嵯鹚螅糍趑",cong:"聪葱囱匆从丛偬苁淙骢琮璁枞",cu:"凑粗醋簇猝殂蹙",cuan:"蹿篡窜汆撺昕爨",cui:"摧崔催脆瘁粹淬翠萃悴璀榱隹",cun:"村存寸磋忖皴",cuo:"撮搓措挫错厝脞锉矬痤鹾蹉躜",da:"搭达答瘩打大耷哒嗒怛妲疸褡笪靼鞑",dai:"呆歹傣戴带殆代贷袋待逮怠埭甙呔岱迨逯骀绐玳黛",dan:"耽担丹单郸掸胆旦氮但惮淡诞弹蛋亻儋卩萏啖澹檐殚赕眈瘅聃箪",dang:"当挡党荡档谠凼菪宕砀铛裆",dao:"刀捣蹈倒岛祷导到稻悼道盗叨啁忉洮氘焘忑纛",de:"德得的锝",deng:"蹬灯登等瞪凳邓噔嶝戥磴镫簦",di:"堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔氐籴诋谛邸坻莜荻嘀娣柢棣觌砥碲睇镝羝骶",dian:"颠掂滇碘点典靛垫电佃甸店惦奠淀殿丶阽坫埝巅玷癜癫簟踮",diao:"碉叼雕凋刁掉吊钓调轺铞蜩粜貂",die:"跌爹碟蝶迭谍叠佚垤堞揲喋渫轶牒瓞褶耋蹀鲽鳎",ding:"丁盯叮钉顶鼎锭定订丢仃啶玎腚碇町铤疔耵酊",dong:"东冬董懂动栋侗恫冻洞垌咚岽峒夂氡胨胴硐鸫",dou:"兜抖斗陡豆逗痘蔸钭窦窬蚪篼酡",du:"都督毒犊独读堵睹赌杜镀肚度渡妒芏嘟渎椟橐牍蠹笃髑黩",duan:"端短锻段断缎彖椴煅簖",dui:"堆兑队对怼憝碓",dun:"墩吨蹲敦顿囤钝盾遁炖砘礅盹镦趸",duo:"掇哆多夺垛躲朵跺舵剁惰堕咄哚缍柁铎裰踱",e:"蛾峨鹅俄额讹娥恶厄扼遏鄂饿噩谔垩垭苊莪萼呃愕屙婀轭曷腭硪锇锷鹗颚鳄",en:"恩蒽摁唔嗯",er:"而儿耳尔饵洱二贰迩珥铒鸸鲕",fa:"发罚筏伐乏阀法珐垡砝",fan:"藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛蘩幡犭梵攵燔畈蹯",fang:"坊芳方肪房防妨仿访纺放匚邡彷钫舫鲂",fei:"菲非啡飞肥匪诽吠肺废沸费芾狒悱淝妃绋绯榧腓斐扉祓砩镄痱蜚篚翡霏鲱",fen:"芬酚吩氛分纷坟焚汾粉奋份忿愤粪偾瀵棼愍鲼鼢",feng:"丰封枫蜂峰锋风疯烽逢冯缝讽奉凤俸酆葑沣砜",fu:"佛否夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐匐凫郛芙苻茯莩菔呋幞滏艴孚驸绂桴赙黻黼罘稃馥虍蚨蜉蝠蝮麸趺跗鳆",ga:"噶嘎蛤尬呷尕尜旮钆",gai:"该改概钙盖溉丐陔垓戤赅胲",gan:"干甘杆柑竿肝赶感秆敢赣坩苷尴擀泔淦澉绀橄旰矸疳酐",gang:"冈刚钢缸肛纲岗港戆罡颃筻",gong:"杠工攻功恭龚供躬公宫弓巩汞拱贡共蕻廾咣珙肱蚣蛩觥",gao:"篙皋高膏羔糕搞镐稿告睾诰郜蒿藁缟槔槁杲锆",ge:"哥歌搁戈鸽胳疙割革葛格阁隔铬个各鬲仡哿塥嗝纥搿膈硌铪镉袼颌虼舸骼髂",gei:"给",gen:"根跟亘茛哏艮",geng:"耕更庚羹埂耿梗哽赓鲠",gou:"钩勾沟苟狗垢构购够佝诟岣遘媾缑觏彀鸲笱篝鞲",gu:"辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇嘏诂菰哌崮汩梏轱牯牿胍臌毂瞽罟钴锢瓠鸪鹄痼蛄酤觚鲴骰鹘",gua:"刮瓜剐寡挂褂卦诖呱栝鸹",guai:"乖拐怪哙",guan:"棺关官冠观管馆罐惯灌贯倌莞掼涫盥鹳鳏",guang:"光广逛犷桄胱疒",gui:"瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽匦刿庋宄妫桧炅晷皈簋鲑鳜",gun:"辊滚棍丨衮绲磙鲧",guo:"锅郭国果裹过馘蠃埚掴呙囗帼崞猓椁虢锞聒蜮蜾蝈",ha:"哈",hai:"骸孩海氦亥害骇咴嗨颏醢",han:"酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉邗菡撖阚瀚晗焓颔蚶鼾",hen:"夯痕很狠恨",hang:"杭航沆绗珩桁",hao:"壕嚎豪毫郝好耗号浩薅嗥嚆濠灏昊皓颢蚝",he:"呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺诃劾壑藿嗑嗬阖盍蚵翮",hei:"嘿黑",heng:"哼亨横衡恒訇蘅",hong:"轰哄烘虹鸿洪宏弘红黉讧荭薨闳泓",hou:"喉侯猴吼厚候后堠後逅瘊篌糇鲎骺",hu:"呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户冱唿囫岵猢怙惚浒滹琥槲轷觳烀煳戽扈祜鹕鹱笏醐斛",hua:"花哗华猾滑画划化话劐浍骅桦铧稞",huai:"槐徊怀淮坏还踝",huan:"欢环桓缓换患唤痪豢焕涣宦幻郇奂垸擐圜洹浣漶寰逭缳锾鲩鬟",huang:"荒慌黄磺蝗簧皇凰惶煌晃幌恍谎隍徨湟潢遑璜肓癀蟥篁鳇",hui:"灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘诙茴荟蕙哕喙隳洄彗缋珲晖恚虺蟪麾",hun:"荤昏婚魂浑混诨馄阍溷缗",huo:"豁活伙火获或惑霍货祸攉嚯夥钬锪镬耠蠖",ji:"击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际妓继纪居丌乩剞佶佴脔墼芨芰萁蒺蕺掎叽咭哜唧岌嵴洎彐屐骥畿玑楫殛戟戢赍觊犄齑矶羁嵇稷瘠瘵虮笈笄暨跻跽霁鲚鲫髻麂",jia:"嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁伽郏拮岬浃迦珈戛胛恝铗镓痂蛱笳袈跏",jian:"歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僭谏谫菅蒹搛囝湔蹇謇缣枧柙楗戋戬牮犍毽腱睑锏鹣裥笕箴翦趼踺鲣鞯",jiang:"僵姜将浆江疆蒋桨奖讲匠酱降茳洚绛缰犟礓耩糨豇",jiao:"蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫佼僬茭挢噍峤徼姣纟敫皎鹪蛟醮跤鲛",jie:"窖揭接皆秸街阶截劫节桔杰捷睫竭洁结解姐戒藉芥界借介疥诫届偈讦诘喈嗟獬婕孑桀獒碣锴疖袷颉蚧羯鲒骱髫",jin:"巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽卺荩堇噤馑廑妗缙瑾槿赆觐钅锓衿矜",jing:"劲荆兢茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净刭儆阱菁獍憬泾迳弪婧肼胫腈旌",jiong:"炯窘冂迥扃",jiu:"揪究纠玖韭久灸九酒厩救旧臼舅咎就疚僦啾阄柩桕鹫赳鬏",ju:"鞠拘狙疽驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧倨讵苣苴莒掬遽屦琚枸椐榘榉橘犋飓钜锔窭裾趄醵踽龃雎鞫",juan:"捐鹃娟倦眷卷绢鄄狷涓桊蠲锩镌隽",jue:"撅攫抉掘倔爵觉决诀绝厥劂谲矍蕨噘崛獗孓珏桷橛爝镢蹶觖",jun:"均菌钧军君峻俊竣浚郡骏捃狻皲筠麇",ka:"喀咖卡佧咔胩",ke:"咯坷苛柯棵磕颗科壳咳可渴克刻客课岢恪溘骒缂珂轲氪瞌钶疴窠蝌髁",kai:"开揩楷凯慨剀垲蒈忾恺铠锎",kan:"刊堪勘坎砍看侃凵莰莶戡龛瞰",kang:"康慷糠扛抗亢炕坑伉闶钪",kao:"考拷烤靠尻栲犒铐",ken:"肯啃垦恳垠裉颀",keng:"吭忐铿",kong:"空恐孔控倥崆箜",kou:"抠口扣寇芤蔻叩眍筘",ku:"枯哭窟苦酷库裤刳堀喾绔骷",kua:"夸垮挎跨胯侉",kuai:"块筷侩快蒯郐蒉狯脍",kuan:"宽款髋",kuang:"匡筐狂框矿眶旷况诓诳邝圹夼哐纩贶",kui:"亏盔岿窥葵奎魁傀馈愧溃馗匮夔隗揆喹喟悝愦阕逵暌睽聩蝰篑臾跬",kun:"坤昆捆困悃阃琨锟醌鲲髡",kuo:"括扩廓阔蛞",la:"垃拉喇蜡腊辣啦剌摺邋旯砬瘌",lai:"莱来赖崃徕涞濑赉睐铼癞籁",lan:"蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥啉岚懔漤榄斓罱镧褴",lang:"琅榔狼廊郎朗浪莨蒗啷阆锒稂螂",lao:"捞劳牢老佬姥酪烙涝唠崂栳铑铹痨醪",le:"勒乐肋仂叻嘞泐鳓",lei:"雷镭蕾磊累儡垒擂类泪羸诔荽咧漯嫘缧檑耒酹",ling:"棱冷拎玲菱零龄铃伶羚凌灵陵岭领另令酃塄苓呤囹泠绫柃棂瓴聆蛉翎鲮",leng:"楞愣",li:"厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俪俚郦坜苈莅蓠藜捩呖唳喱猁溧澧逦娌嫠骊缡珞枥栎轹戾砺詈罹锂鹂疠疬蛎蜊蠡笠篥粝醴跞雳鲡鳢黧",lian:"俩联莲连镰廉怜涟帘敛脸链恋炼练挛蔹奁潋濂娈琏楝殓臁膦裢蠊鲢",liang:"粮凉梁粱良两辆量晾亮谅墚椋踉靓魉",liao:"撩聊僚疗燎寥辽潦了撂镣廖料蓼尥嘹獠寮缭钌鹩耢",lie:"列裂烈劣猎冽埒洌趔躐鬣",lin:"琳林磷霖临邻鳞淋凛赁吝蔺嶙廪遴檩辚瞵粼躏麟",liu:"溜琉榴硫馏留刘瘤流柳六抡偻蒌泖浏遛骝绺旒熘锍镏鹨鎏",long:"龙聋咙笼窿隆垄拢陇弄垅茏泷珑栊胧砻癃",lou:"楼娄搂篓漏陋喽嵝镂瘘耧蝼髅",lu:"芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮垆摅撸噜泸渌漉璐栌橹轳辂辘氇胪镥鸬鹭簏舻鲈",lv:"驴吕铝侣旅履屡缕虑氯律率滤绿捋闾榈膂稆褛",luan:"峦孪滦卵乱栾鸾銮",lue:"掠略锊",lun:"轮伦仑沦纶论囵",luo:"萝螺罗逻锣箩骡裸落洛骆络倮荦摞猡泺椤脶镙瘰雒",ma:"妈麻玛码蚂马骂嘛吗唛犸嬷杩麽",mai:"埋买麦卖迈脉劢荬咪霾",man:"瞒馒蛮满蔓曼慢漫谩墁幔缦熳镘颟螨鳗鞔",mang:"芒茫盲忙莽邙漭朦硭蟒",meng:"氓萌蒙檬盟锰猛梦孟勐甍瞢懵礞虻蜢蠓艋艨黾",miao:"猫苗描瞄藐秒渺庙妙喵邈缈缪杪淼眇鹋蜱",mao:"茅锚毛矛铆卯茂冒帽貌贸侔袤勖茆峁瑁昴牦耄旄懋瞀蛑蝥蟊髦",me:"么",mei:"玫枚梅酶霉煤没眉媒镁每美昧寐妹媚坶莓嵋猸浼湄楣镅鹛袂魅",men:"门闷们扪玟焖懑钔",mi:"眯醚靡糜迷谜弥米秘觅泌蜜密幂芈冖谧蘼嘧猕獯汨宓弭脒敉糸縻麋",mian:"棉眠绵冕免勉娩缅面沔湎腼眄",mie:"蔑灭咩蠛篾",min:"民抿皿敏悯闽苠岷闵泯珉",ming:"明螟鸣铭名命冥茗溟暝瞑酩",miu:"谬",mo:"摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谟茉蓦馍嫫镆秣瘼耱蟆貊貘",mou:"谋牟某厶哞婺眸鍪",mu:"拇牡亩姆母墓暮幕募慕木目睦牧穆仫苜呒沐毪钼",na:"拿哪呐钠那娜纳内捺肭镎衲箬",nai:"氖乃奶耐奈鼐艿萘柰",nan:"南男难囊喃囡楠腩蝻赧",nao:"挠脑恼闹孬垴猱瑙硇铙蛲",ne:"淖呢讷",nei:"馁",nen:"嫩能枘恁",ni:"妮霓倪泥尼拟你匿腻逆溺伲坭猊怩滠昵旎祢慝睨铌鲵",nian:"蔫拈年碾撵捻念廿辇黏鲇鲶",niang:"娘酿",niao:"鸟尿茑嬲脲袅",nie:"捏聂孽啮镊镍涅乜陧蘖嗫肀颞臬蹑",nin:"您柠",ning:"狞凝宁拧泞佞蓥咛甯聍",niu:"牛扭钮纽狃忸妞蚴",nong:"脓浓农侬",nu:"奴努怒呶帑弩胬孥驽",nv:"女恧钕衄",nuan:"暖",nuenue:"虐",nue:"疟谑",nuo:"挪懦糯诺傩搦喏锘",ou:"哦欧鸥殴藕呕偶沤怄瓯耦",pa:"啪趴爬帕怕琶葩筢",pai:"拍排牌徘湃派俳蒎",pan:"攀潘盘磐盼畔判叛爿泮袢襻蟠蹒",pang:"乓庞旁耪胖滂逄",pao:"抛咆刨炮袍跑泡匏狍庖脬疱",pei:"呸胚培裴赔陪配佩沛掊辔帔淠旆锫醅霈",pen:"喷盆湓",peng:"砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰坯堋嘭怦蟛",pi:"砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬丕陴邳郫圮鼙擗噼庀媲纰枇甓睥罴铍痦癖疋蚍貔",pian:"篇偏片骗谝骈犏胼褊翩蹁",piao:"飘漂瓢票剽嘌嫖缥殍瞟螵",pie:"撇瞥丿苤氕",pin:"拼频贫品聘拚姘嫔榀牝颦",ping:"乒坪苹萍平凭瓶评屏俜娉枰鲆",po:"坡泼颇婆破魄迫粕叵鄱溥珀钋钷皤笸",pou:"剖裒踣",pu:"扑铺仆莆葡菩蒲埔朴圃普浦谱曝瀑匍噗濮璞氆镤镨蹼",qi:"期欺栖戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫亟亓圻芑萋葺嘁屺岐汔淇骐绮琪琦杞桤槭欹祺憩碛蛴蜞綦綮趿蹊鳍麒",qia:"掐恰洽葜",qian:"牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉佥阡芊芡荨掮岍悭慊骞搴褰缱椠肷愆钤虔箝",qiang:"枪呛腔羌墙蔷强抢嫱樯戗炝锖锵镪襁蜣羟跫跄",qiao:"橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍劁诮谯荞愀憔缲樵毳硗跷鞒",qie:"切茄且怯窃郄唼惬妾挈锲箧",qin:"钦侵亲秦琴勤芹擒禽寝沁芩蓁蕲揿吣嗪噙溱檎螓衾",qing:"青轻氢倾卿清擎晴氰情顷请庆倩苘圊檠磬蜻罄箐謦鲭黥",qiong:"琼穷邛茕穹筇銎",qiu:"秋丘邱球求囚酋泅俅氽巯艽犰湫逑遒楸赇鸠虬蚯蝤裘糗鳅鼽",qu:"趋区蛆曲躯屈驱渠取娶龋趣去诎劬蕖蘧岖衢阒璩觑氍祛磲癯蛐蠼麴瞿黢",quan:"圈颧权醛泉全痊拳犬券劝诠荃獾悛绻辁畎铨蜷筌鬈",que:"缺炔瘸却鹊榷确雀阙悫",qun:"裙群逡",ran:"然燃冉染苒髯",rang:"瓤壤攘嚷让禳穰",rao:"饶扰绕荛娆桡",ruo:"惹若弱",re:"热偌",ren:"壬仁人忍韧任认刃妊纫仞荏葚饪轫稔衽",reng:"扔仍",ri:"日",rong:"戎茸蓉荣融熔溶容绒冗嵘狨缛榕蝾",rou:"揉柔肉糅蹂鞣",ru:"茹蠕儒孺如辱乳汝入褥蓐薷嚅洳溽濡铷襦颥",ruan:"软阮朊",rui:"蕊瑞锐芮蕤睿蚋",run:"闰润",sa:"撒洒萨卅仨挲飒",sai:"腮鳃塞赛噻",san:"三叁伞散彡馓氵毵糁霰",sang:"桑嗓丧搡磉颡",sao:"搔骚扫嫂埽臊瘙鳋",se:"瑟色涩啬铩铯穑",sen:"森",seng:"僧",sha:"莎砂杀刹沙纱傻啥煞脎歃痧裟霎鲨",shai:"筛晒酾",shan:"珊苫杉山删煽衫闪陕擅赡膳善汕扇缮剡讪鄯埏芟潸姗骟膻钐疝蟮舢跚鳝",shang:"墒伤商赏晌上尚裳垧绱殇熵觞",shao:"梢捎稍烧芍勺韶少哨邵绍劭苕潲蛸笤筲艄",she:"奢赊蛇舌舍赦摄射慑涉社设厍佘猞畲麝",shen:"砷申呻伸身深娠绅神沈审婶甚肾慎渗诜谂吲哂渖椹矧蜃",sheng:"声生甥牲升绳省盛剩胜圣丞渑媵眚笙",shi:"师失狮施湿诗尸虱十石拾时什食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试谥埘莳蓍弑唑饣轼耆贳炻礻铈铊螫舐筮豕鲥鲺",shou:"收手首守寿授售受瘦兽扌狩绶艏",shu:"蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕倏塾菽忄沭涑澍姝纾毹腧殳镯秫鹬",shua:"刷耍唰涮",shuai:"摔衰甩帅蟀",shuan:"栓拴闩",shuang:"霜双爽孀",shui:"谁水睡税",shun:"吮瞬顺舜恂",shuo:"说硕朔烁蒴搠嗍濯妁槊铄",si:"斯撕嘶思私司丝死肆寺嗣四伺似饲巳厮俟兕菥咝汜泗澌姒驷缌祀祠锶鸶耜蛳笥",song:"松耸怂颂送宋讼诵凇菘崧嵩忪悚淞竦",sou:"搜艘擞嗽叟嗖嗾馊溲飕瞍锼螋",su:"苏酥俗素速粟僳塑溯宿诉肃夙谡蔌嗉愫簌觫稣",suan:"酸蒜算",sui:"虽隋随绥髓碎岁穗遂隧祟蓑冫谇濉邃燧眭睢",sun:"孙损笋荪狲飧榫跣隼",suo:"梭唆缩琐索锁所唢嗦娑桫睃羧",ta:"塌他它她塔獭挞蹋踏闼溻遢榻沓",tai:"胎苔抬台泰酞太态汰邰薹肽炱钛跆鲐",tan:"坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭郯蕈昙钽锬覃",tang:"汤塘搪堂棠膛唐糖傥饧溏瑭铴镗耥螗螳羰醣",thang:"倘躺淌",theng:"趟烫",tao:"掏涛滔绦萄桃逃淘陶讨套挑鼗啕韬饕",te:"特",teng:"藤腾疼誊滕",ti:"梯剔踢锑提题蹄啼体替嚏惕涕剃屉荑悌逖绨缇鹈裼醍",tian:"天添填田甜恬舔腆掭忝阗殄畋钿蚺",tiao:"条迢眺跳佻祧铫窕龆鲦",tie:"贴铁帖萜餮",ting:"厅听烃汀廷停亭庭挺艇莛葶婷梃蜓霆",tong:"通桐酮瞳同铜彤童桶捅筒统痛佟僮仝茼嗵恸潼砼",tou:"偷投头透亠",tu:"凸秃突图徒途涂屠土吐兔堍荼菟钍酴",tuan:"湍团疃",tui:"推颓腿蜕褪退忒煺",tun:"吞屯臀饨暾豚窀",tuo:"拖托脱鸵陀驮驼椭妥拓唾乇佗坨庹沱柝砣箨舄跎鼍",wa:"挖哇蛙洼娃瓦袜佤娲腽",wai:"歪外",wan:"豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕剜芄苋菀纨绾琬脘畹蜿箢",wang:"汪王亡枉网往旺望忘妄罔尢惘辋魍",wei:"威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫倭偎诿隈葳薇帏帷崴嵬猥猬闱沩洧涠逶娓玮韪軎炜煨熨痿艉鲔",wen:"瘟温蚊文闻纹吻稳紊问刎愠阌汶璺韫殁雯",weng:"嗡翁瓮蓊蕹",wo:"挝蜗涡窝我斡卧握沃莴幄渥杌肟龌",wu:"巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误兀仵阢邬圬芴庑怃忤浯寤迕妩骛牾焐鹉鹜蜈鋈鼯",xi:"昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细僖兮隰郗茜葸蓰奚唏徙饩阋浠淅屣嬉玺樨曦觋欷熹禊禧钸皙穸蜥蟋舾羲粞翕醯鼷",xia:"瞎虾匣霞辖暇峡侠狭下厦夏吓掀葭嗄狎遐瑕硖瘕罅黠",xian:"锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线冼藓岘猃暹娴氙祆鹇痫蚬筅籼酰跹",xiang:"相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象芗葙饷庠骧缃蟓鲞飨",xiao:"萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效哓咻崤潇逍骁绡枭枵筱箫魈",xie:"楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑偕亵勰燮薤撷廨瀣邂绁缬榭榍歙躞",xin:"薪芯锌欣辛新忻心信衅囟馨莘歆铽鑫",xing:"星腥猩惺兴刑型形邢行醒幸杏性姓陉荇荥擤悻硎",xiong:"兄凶胸匈汹雄熊芎",xiu:"休修羞朽嗅锈秀袖绣莠岫馐庥鸺貅髹",xu:"墟戌需虚嘘须徐许蓄酗叙旭序畜恤絮婿绪续讴诩圩蓿怵洫溆顼栩煦砉盱胥糈醑",xuan:"轩喧宣悬旋玄选癣眩绚儇谖萱揎馔泫洵渲漩璇楦暄炫煊碹铉镟痃",xue:"靴薛学穴雪血噱泶鳕",xun:"勋熏循旬询寻驯巡殉汛训讯逊迅巽埙荀薰峋徇浔曛窨醺鲟",ya:"压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶伢揠吖岈迓娅琊桠氩砑睚痖",yan:"焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验厣靥赝俨偃兖讠谳郾鄢芫菸崦恹闫阏洇湮滟妍嫣琰晏胭腌焱罨筵酽魇餍鼹",yang:"殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾徉怏泱炀烊恙蛘鞅",yao:"邀腰妖瑶摇尧遥窑谣姚咬舀药要耀夭爻吆崾徭瀹幺珧杳曜肴鹞窈繇鳐",ye:"椰噎耶爷野冶也页掖业叶曳腋夜液谒邺揶馀晔烨铘",yi:"一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎刈劓佾诒圪圯埸懿苡薏弈奕挹弋呓咦咿噫峄嶷猗饴怿怡悒漪迤驿缢殪贻旖熠钇镒镱痍瘗癔翊衤蜴舣羿翳酏黟",yin:"茵荫因殷音阴姻吟银淫寅饮尹引隐印胤鄞堙茚喑狺夤氤铟瘾蚓霪龈",ying:"英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映嬴郢茔莺萦撄嘤膺滢潆瀛瑛璎楹鹦瘿颍罂",yo:"哟唷",yong:"拥佣臃痈庸雍踊蛹咏泳涌永恿勇用俑壅墉慵邕镛甬鳙饔",you:"幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼卣攸侑莸呦囿宥柚猷牖铕疣蝣鱿黝鼬",yu:"迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁吁遇喻峪御愈欲狱育誉浴寓裕预豫驭禺毓伛俣谀谕萸蓣揄喁圄圉嵛狳饫庾阈妪妤纡瑜昱觎腴欤於煜燠聿钰鹆瘐瘀窳蝓竽舁雩龉",yuan:"鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院塬沅媛瑗橼爰眢鸢螈鼋",yue:"曰约越跃钥岳粤月悦阅龠樾刖钺",yun:"耘云郧匀陨允运蕴酝晕韵孕郓芸狁恽纭殒昀氲",za:"匝砸杂拶咂",zai:"栽哉灾宰载再在咱崽甾",zan:"攒暂赞瓒昝簪糌趱錾",zang:"赃脏葬奘戕臧",zao:"遭糟凿藻枣早澡蚤躁噪造皂灶燥唣缫",ze:"责择则泽仄赜啧迮昃笮箦舴",zei:"贼",zen:"怎谮",zeng:"增憎曾赠缯甑罾锃",zha:"扎喳渣札轧铡闸眨栅榨咋乍炸诈揸吒咤哳怍砟痄蚱齄",zhai:"摘斋宅窄债寨砦",zhan:"瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽谵搌旃",zhang:"樟章彰漳张掌涨杖丈帐账仗胀瘴障仉鄣幛嶂獐嫜璋蟑",zhao:"招昭找沼赵照罩兆肇召爪诏棹钊笊",zhe:"遮折哲蛰辙者锗蔗这浙谪陬柘辄磔鹧褚蜇赭",zhen:"珍斟真甄砧臻贞针侦枕疹诊震振镇阵缜桢榛轸赈胗朕祯畛鸩",zheng:"蒸挣睁征狰争怔整拯正政帧症郑证诤峥钲铮筝",zhi:"芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒卮陟郅埴芷摭帙忮彘咫骘栉枳栀桎轵轾攴贽膣祉祗黹雉鸷痣蛭絷酯跖踬踯豸觯",zhong:"中盅忠钟衷终种肿重仲众冢锺螽舂舯踵",zhou:"舟周州洲诌粥轴肘帚咒皱宙昼骤啄着倜诹荮鬻纣胄碡籀舳酎鲷",zhu:"珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻伫侏邾苎茱洙渚潴驺杼槠橥炷铢疰瘃蚰竺箸翥躅麈",zhua:"抓",zhuai:"拽",zhuan:"专砖转撰赚篆抟啭颛",zhuang:"桩庄装妆撞壮状丬",zhui:"椎锥追赘坠缀萑骓缒",zhun:"谆准",zhuo:"捉拙卓桌琢茁酌灼浊倬诼廴蕞擢啜浞涿杓焯禚斫",zi:"兹咨资姿滋淄孜紫仔籽滓子自渍字谘嵫姊孳缁梓辎赀恣眦锱秭耔笫粢觜訾鲻髭",zong:"鬃棕踪宗综总纵腙粽",zou:"邹走奏揍鄹鲰",zu:"租足卒族祖诅阻组俎菹啐徂驵蹴",zuan:"钻纂攥缵",zui:"嘴醉最罪",zun:"尊遵撙樽鳟",zuo:"昨左佐柞做作坐座阝阼胙祚酢",cou:"薮楱辏腠",nang:"攮哝囔馕曩",o:"喔",dia:"嗲",chuai:"嘬膪踹",cen:"岑涔",diu:"铥",nou:"耨",fou:"缶",bia:"髟"},this.polyphone={19969:"DZ",19975:"WM",19988:"QJ",20048:"YL",20056:"SC",20060:"NM",20094:"QG",20127:"QJ",20167:"QC",20193:"YG",20250:"KH",20256:"ZC",20282:"SC",20285:"QJG",20291:"TD",20314:"YD",20340:"NE",20375:"TD",20389:"YJ",20391:"CZ",20415:"PB",20446:"YS",20447:"SQ",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20985:"AW",21032:"PB",21048:"XQ",21049:"SC",21089:"YS",21119:"JC",21242:"SB",21273:"SC",21305:"YP",21306:"QO",21330:"ZC",21333:"SDC",21345:"QK",21378:"CA",21397:"SC",21414:"XS",21442:"SC",21477:"JG",21480:"TD",21484:"ZS",21494:"YX",21505:"YX",21512:"HG",21523:"XH",21537:"PB",21542:"PF",21549:"KH",21571:"E",21574:"DA",21588:"TD",21589:"O",21618:"ZC",21621:"KHA",21632:"ZJ",21654:"KG",21679:"LKG",21683:"KH",21710:"A",21719:"YH",21734:"WOE",21769:"A",21780:"WN",21804:"XH",21834:"A",21899:"ZD",21903:"RN",21908:"WO",21939:"ZC",21956:"SA",21964:"YA",21970:"TD",22003:"A",22031:"JG",22040:"XS",22060:"ZC",22066:"ZC",22079:"MH",22129:"XJ",22179:"XA",22237:"NJ",22244:"TD",22280:"JQ",22300:"YH",22313:"XW",22331:"YQ",22343:"YJ",22351:"PH",22395:"DC",22412:"TD",22484:"PB",22500:"PB",22534:"ZD",22549:"DH",22561:"PB",22612:"TD",22771:"KQ",22831:"HB",22841:"JG",22855:"QJ",22865:"XQ",23013:"ML",23081:"WM",23487:"SX",23558:"QJ",23561:"YW",23586:"YW",23614:"YW",23615:"SN",23631:"PB",23646:"ZS",23663:"ZT",23673:"YG",23762:"TD",23769:"ZS",23780:"QJ",23884:"QK",24055:"XH",24113:"DC",24162:"ZC",24191:"GA",24273:"QJ",24324:"NL",24377:"TD",24378:"QJ",24439:"PF",24554:"ZS",24683:"TD",24694:"WE",24733:"LK",24925:"TN",25094:"ZG",25100:"XQ",25103:"XH",25153:"PB",25170:"PB",25179:"KG",25203:"PB",25240:"ZS",25282:"FB",25303:"NA",25324:"KG",25341:"ZY",25373:"WZ",25375:"XJ",25384:"A",25457:"A",25528:"SD",25530:"SC",25552:"TD",25774:"ZC",25874:"ZC",26044:"YW",26080:"WM",26292:"PB",26333:"PB",26355:"ZY",26366:"CZ",26397:"ZC",26399:"QJ",26415:"ZS",26451:"SB",26526:"ZC",26552:"JG",26561:"TD",26588:"JG",26597:"CZ",26629:"ZS",26638:"YL",26646:"XQ",26653:"KG",26657:"XJ",26727:"HG",26894:"ZC",26937:"ZS",26946:"ZC",26999:"KJ",27099:"KJ",27449:"YQ",27481:"XS",27542:"ZS",27663:"ZS",27748:"TS",27784:"SC",27788:"ZD",27795:"TD",27812:"O",27850:"PB",27852:"MB",27895:"SL",27898:"PL",27973:"QJ",27981:"KH",27986:"HX",27994:"XJ",28044:"YC",28065:"WG",28177:"SM",28267:"QJ",28291:"KH",28337:"ZQ",28463:"TL",28548:"DC",28601:"TD",28689:"PB",28805:"JG",28820:"QG",28846:"PB",28952:"TD",28975:"ZC",29100:"A",29325:"QJ",29575:"SL",29602:"FB",30010:"TD",30044:"CX",30058:"PF",30091:"YSP",30111:"YN",30229:"XJ",30427:"SC",30465:"SX",30631:"YQ",30655:"QJ",30684:"QJG",30707:"SD",30729:"XH",30796:"LG",30917:"PB",31074:"NM",31085:"JZ",31109:"SC",31181:"ZC",31192:"MLB",31293:"JQ",31400:"YX",31584:"YJ",31896:"ZN",31909:"ZY",31995:"XJ",32321:"PF",32327:"ZY",32418:"HG",32420:"XQ",32421:"HG",32438:"LG",32473:"GJ",32488:"TD",32521:"QJ",32527:"PB",32562:"ZSQ",32564:"JZ",32735:"ZD",32793:"PB",33071:"PF",33098:"XL",33100:"YA",33152:"PB",33261:"CX",33324:"BP",33333:"TD",33406:"YA",33426:"WM",33432:"PB",33445:"JG",33486:"ZN",33493:"TS",33507:"QJ",33540:"QJ",33544:"ZC",33564:"XQ",33617:"YT",33632:"QJ",33636:"XH",33637:"YX",33694:"WG",33705:"PF",33728:"YW",33882:"SR",34067:"WM",34074:"YW",34121:"QJ",34255:"ZC",34259:"XL",34425:"JH",34430:"XH",34485:"KH",34503:"YS",34532:"HG",34552:"XS",34558:"YE",34593:"ZL",34660:"YQ",34892:"XH",34928:"SC",34999:"QJ",35048:"PB",35059:"SC",35098:"ZC",35203:"TQ",35265:"JX",35299:"JX",35782:"SZ",35828:"YS",35830:"E",35843:"TD",35895:"YG",35977:"MH",36158:"JG",36228:"QJ",36426:"XQ",36466:"DC",36710:"JC",36711:"ZYG",36767:"PB",36866:"SK",36951:"YW",37034:"YX",37063:"XH",37218:"ZC",37325:"ZC",38063:"PB",38079:"TD",38085:"QY",38107:"DC",38116:"TD",38123:"YD",38224:"HG",38241:"XTC",38271:"ZC",38415:"YE",38426:"KH",38461:"YD",38463:"AE",38466:"PB",38477:"XJ",38518:"YT",38551:"WK",38585:"ZC",38704:"XS",38739:"LJ",38761:"GJ",38808:"SQ",39048:"JG",39049:"XJ",39052:"HG",39076:"CZ",39271:"XT",39534:"TD",39552:"TD",39584:"PB",39647:"SB",39730:"LG",39748:"TPB",40109:"ZQ",40479:"ND",40516:"HG",40536:"HG",40583:"QJ",40765:"YQ",40784:"QJ",40840:"YK",40863:"QJG"}},getFullChars:function(e){for(var t,o="",n=(new RegExp("[a-zA-Z0-9- ]"),0),s=e.length;n<s;n++){var i=e.substr(n,1),a=i.charCodeAt(0);a>40869||a<19968?o+=i:!1!==(t=this._getFullChar(i))&&(o+=t)}return o},getCamelChars:function(e){if("string"!=typeof e)throw new Error(-1,"函数getFisrt需要字符串类型参数!");for(var t=[],o=0,n=e.length;o<n;o++){var s=e.charAt(o);t.push(this._getChar(s))}return this._getResult(t)},_getFullChar:function(e){for(var t in this.full_dict)if(-1!==this.full_dict[t].indexOf(e))return this._capitalize(t);return!1},_capitalize:function(e){if(e.length>0){return e.substr(0,1).toUpperCase()+e.substr(1,e.length)}},_getChar:function(e){var t=e.charCodeAt(0);return t>40869||t<19968?e:this.options.checkPolyphone&&this.polyphone[t]?this.polyphone[t]:this.char_dict.charAt(t-19968)},_getResult:function(e){if(!this.options.checkPolyphone)return e.join("");for(var t=[""],o=0,n=e.length;o<n;o++){var s=e[o],i=s.length;if(1==i)for(r=0;r<t.length;r++)t[c]+=s;else{var a=t.slice(0);t=[];for(var r=0;r<i;r++){for(var l=a.slice(0),c=0;c<l.length;c++)l[c]+=s.charAt(r);t=t.concat(l)}}}return t}};var o=function(e,t){for(var o in t)e[o]=t[o];return e};return new e(arguments)}(),BIMWINNER.lobibox=function(){function e(e,t){this.$input=null,this.$type="prompt",this.$promptType=e,t=$.extend({},i.prompt.DEFAULT_OPTIONS,t),this.$options=this._processInput(t),this._init(),this.debug(this)}function t(e){this.$type="confirm",this.$options=this._processInput(e),this._init(),this.debug(this)}function o(e,t){this.$type=e,this.$options=this._processInput(t),this._init(),this.debug(this)}function n(e){this.$type="progress",this.$progressBarElement=null,this.$options=this._processInput(e),this.$progress=0,this._init(),this.debug(this)}function s(e,t){this.$type=e,this.$options=this._processInput(t),this._init(),this.debug(this)}var i=this;Math.randomString=function(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)t+=o.charAt(Math.floor(Math.random()*o.length));return t},i.viewport="body",i.counter=0,i.prompt=function(t,o){return new e(t,o)},i.confirm=function(e){return new t(e)},i.progress=function(e){return new n(e)},i.error={},i.success={},i.warning={},i.info={},i.alert=function(e,t){if(["success","error","warning","info"].indexOf(e)>-1)return new o(e,t)},i.window=function(e){return new s("window",e)};var a={$type:null,$el:null,$options:null,debug:function(){this.$options.debug&&window.console.debug.apply(window.console,arguments)},_processInput:function(e){if($.isArray(e.buttons)){for(var t={},o=0;o<e.buttons.length;o++)t[e.buttons[o]]=i.base.OPTIONS.buttons[e.buttons[o]];e.buttons=t}e.customBtnClass=e.customBtnClass?e.customBtnClass:i.base.DEFAULTS.customBtnClass;for(var o in e.buttons)if(e.buttons.hasOwnProperty(o)){var n=e.buttons[o];(n=$.extend({},i.base.OPTIONS.buttons[o],n)).class||(n.class=e.customBtnClass),e.buttons[o]=n}return void 0===(e=$.extend({},i.base.DEFAULTS,e)).showClass&&(e.showClass=i.base.OPTIONS.showClass),void 0===e.hideClass&&(e.hideClass=i.base.OPTIONS.hideClass),void 0===e.baseClass&&(e.baseClass=i.base.OPTIONS.baseClass),void 0===e.delayToRemove&&(e.delayToRemove=i.base.OPTIONS.delayToRemove),e.iconClass||(e.iconClass=i.base.OPTIONS.icons[e.iconSource][this.$type]),e},_init:function(){var e=this;e._createMarkup(),e.setTitle(e.$options.title),e.$options.draggable&&!e._isMobileScreen()&&(e.$el.addClass("draggable"),e._enableDrag()),e.$options.closeButton&&e._addCloseButton(),e.$options.closeOnEsc&&$(document).on("keyup.lobibox",function(t){27===t.which&&e.destroy()}),e.$options.baseClass&&e.$el.addClass(e.$options.baseClass),e.$options.showClass&&(e.$el.removeClass(e.$options.hideClass),e.$el.addClass(e.$options.showClass)),e.$el.data("lobibox",e)},_calculatePosition:function(e){var t,o=this;t="top"===e?30:"bottom"===e?$(window).outerHeight()-o.$el.outerHeight()-30:($(window).outerHeight()-o.$el.outerHeight())/2;return{left:($(window).outerWidth()-o.$el.outerWidth())/2,top:t}},_createButton:function(e,t){var o=this,n=$("<button></button>").addClass(t.class).attr("data-type",e).html(t.text);return o.$options.callback&&"function"==typeof o.$options.callback&&n.on("click.lobibox",function(t){var n=$(this);o._onButtonClick(o.$options.buttons[e],e),o.$options.callback(o,n.data("type"),t)}),n.click(function(){o._onButtonClick(o.$options.buttons[e],e)}),n},_onButtonClick:function(e,t){var o=this;("ok"===t&&"prompt"===o.$type&&o.isValid()||"prompt"!==o.$type||"ok"!==t)&&e&&e.closeOnClick&&o.destroy()},_generateButtons:function(){var e=this,t=[];for(var o in e.$options.buttons)if(e.$options.buttons.hasOwnProperty(o)){var n=e.$options.buttons[o],s=e._createButton(o,n);t.push(s)}return t},_createMarkup:function(){var e=this,t=$('<div class="lobibox"></div>');t.attr("data-is-modal",e.$options.modal);var o=$('<div class="lobibox-header"></div>').append('<span class="lobibox-title"></span>'),n=$('<div class="lobibox-body"></div>');if(t.append(o),t.append(n),e.$options.buttons&&!$.isEmptyObject(e.$options.buttons)){var s=$('<div class="lobibox-footer"></div>');s.append(e._generateButtons()),t.append(s),i.base.OPTIONS.buttonsAlign.indexOf(e.$options.buttonsAlign)>-1&&s.addClass("text-"+e.$options.buttonsAlign)}e.$el=t.addClass(i.base.OPTIONS.modalClasses[e.$type])},_setSize:function(){var e=this;e.setWidth(e.$options.width),"auto"===e.$options.height?e.setHeight(e.$el.outerHeight()):e.setHeight(e.$options.height)},_calculateBodyHeight:function(e){var t=this.$el.find(".lobibox-header").outerHeight(),o=this.$el.find(".lobibox-footer").outerHeight();return e-(t||0)-(o||0)},_addBackdrop:function(){0===$(".lobibox-backdrop").length&&$(i.viewport).append('<div class="lobibox-backdrop"></div>')},_triggerEvent:function(e){var t=this;t.$options[e]&&"function"==typeof t.$options[e]&&t.$options[e](t)},_calculateWidth:function(e){var t=this;return(e=Math.min(Math.max(e,t.$options.width),$(window).outerWidth()))===$(window).outerWidth()&&(e-=2*t.$options.horizontalOffset),e},_calculateHeight:function(e){var t=this;return(e=Math.min(Math.max(e,t.$options.height),$(window).outerHeight()))===$(window).outerHeight()&&(e-=2*t.$options.verticalOffset),e},_addCloseButton:function(){var e=this,t=$('<span class="btn-close">&times;</span>');e.$el.find(".lobibox-header").append(t),t.on("mousedown",function(e){e.stopPropagation()}),t.on("click.lobibox",function(){e.destroy()})},_position:function(){this._setSize();var e=this._calculatePosition();this.setPosition(e.left,e.top)},_isMobileScreen:function(){return $(window).outerWidth()<768},_enableDrag:function(){var e=this.$el,t=e.find(".lobibox-header");t.on("mousedown.lobibox",function(t){e.attr("offset-left",t.offsetX),e.attr("offset-top",t.offsetY),e.attr("allow-drag","true")}),t.on("touchstart.lobibox",function(t){var o=e.position().left,n=e.position().top,s=t.originalEvent.targetTouches[0].clientX,i=t.originalEvent.targetTouches[0].clientY;e.attr("offset-left",s-o),e.attr("offset-top",i-n),e.attr("allow-drag","true")}),$(document).on("mouseup.lobibox",function(){e.attr("allow-drag","false")}),$(document).on("mousemove.lobibox",function(t){if("true"===e.attr("allow-drag")){var o=t.clientX-parseInt(e.attr("offset-left"),10)-parseInt(e.css("border-left-width"),10),n=t.clientY-parseInt(e.attr("offset-top"),10)-parseInt(e.css("border-top-width"),10);n<0&&(n=5),n>$(window).height()&&(n=$(window).height()-10),o<0&&(o=5),o>$(window).width()&&(o=$(window).width()-10),e.css({left:o,top:n})}}),$(document).on("touchend.lobibox",function(){e.attr("allow-drag","false")}),$(document).on("touchmove.lobibox",function(t){if("true"===e.attr("allow-drag")){var o=t.originalEvent.targetTouches[0].clientX-parseInt(e.attr("offset-left"),10)-parseInt(e.css("border-left-width"),10),n=t.originalEvent.targetTouches[0].clientY-parseInt(e.attr("offset-top"),10)-parseInt(e.css("border-top-width"),10);n<0&&(n=5),n>$(window).height()&&(n=$(window).height()-10),o<0&&(o=5),o>$(window).width()&&(o=$(window).width()-10),e.css({left:o,top:n})}})},_setContent:function(e){return this.$el.find(".lobibox-body").html(e),this},_beforeShow:function(){this._triggerEvent("onShow")},_afterShow:function(){var e=this;i.counter++,e.$el.attr("data-nth",i.counter),e.$options.draggable||$(window).on("resize.lobibox-"+e.$el.attr("data-nth"),function(){e.refreshWidth(),e.refreshHeight(),e.$el.css("left","50%").css("margin-left","-"+e.$el.width()/2+"px"),e.$el.css("top","50%").css("margin-top","-"+e.$el.height()/2+"px")}),e._triggerEvent("shown")},_beforeClose:function(){this._triggerEvent("beforeClose")},_afterClose:function(){var e=this;e.$options.draggable||$(window).off("resize.lobibox-"+e.$el.attr("data-nth")),e._triggerEvent("closed")},_beforeHide:function(){this._triggerEvent("beforeHide")},_afterHide:function(){this._triggerEvent("afterHide")},hide:function(){function e(){t.$el.addClass("lobibox-hidden"),0===$(".lobibox[data-is-modal=true]:not(.lobibox-hidden)").length&&($(".lobibox-backdrop").remove(),$(i.viewport).removeClass(i.base.OPTIONS.bodyClass)),t._afterHide()}var t=this;return t._beforeHide(),t.$options.hideClass?(t.$el.removeClass(t.$options.showClass),t.$el.addClass(t.$options.hideClass),setTimeout(function(){e()},t.$options.delayToRemove)):e(),this},destroy:function(){function e(){t.$el.remove(),0===$(".lobibox[data-is-modal=true]").length&&($(".lobibox-backdrop").remove(),$(i.viewport).removeClass(i.base.OPTIONS.bodyClass)),t._afterClose()}var t=this;return t._beforeClose(),t.$options.hideClass?(t.$el.removeClass(t.$options.showClass).addClass(t.$options.hideClass),setTimeout(function(){e()},t.$options.delayToRemove)):e(),this},setWidth:function(e){return this.$el.css("width",this._calculateWidth(e)),this},refreshWidth:function(){this.setWidth(this.$el.width())},refreshHeight:function(){this.setHeight(this.$el.height())},setHeight:function(e){return this.$el.css("height",this._calculateHeight(e)).find(".lobibox-body").css("height",this.$options.height-41),this},setSize:function(e,t){return this.setWidth(e),this.setHeight(t),this},setPosition:function(e,t){var o;return"number"==typeof e&&"number"==typeof t?o={left:e,top:t}:"string"==typeof e?o=this._calculatePosition(e):"object"==typeof e&&(o=e),this.$el.css(o),this},setTitle:function(e){return this.$el.find(".lobibox-title").html(e)},getTitle:function(){return this.$el.find(".lobibox-title").html()},show:function(){var e=this,t=$(i.viewport);if(e._beforeShow(),e.$el.removeClass("lobibox-hidden"),t.append(e.$el),e.$options.buttons){e.$el.find(".lobibox-footer").children()[0].focus()}return e.$options.modal&&(t.addClass(i.base.OPTIONS.bodyClass),e._addBackdrop()),!1!==e.$options.delay&&setTimeout(function(){e.destroy()},e.$options.delay),e._afterShow(),e}};i.base={},i.base.OPTIONS={bodyClass:"lobibox-open",modalClasses:{error:"lobibox-error",success:"lobibox-success",info:"lobibox-info",warning:"lobibox-warning",confirm:"lobibox-confirm",progress:"lobibox-progress",prompt:"lobibox-prompt",default:"lobibox-default",window:"lobibox-window"},buttonsAlign:["left","center","right"],buttons:{ok:{class:"lobibox-btn lobibox-btn-default",text:"OK",closeOnClick:!0},cancel:{class:"lobibox-btn lobibox-btn-cancel",text:"Cancel",closeOnClick:!0},yes:{class:"lobibox-btn lobibox-btn-yes",text:"Yes",closeOnClick:!0},no:{class:"lobibox-btn lobibox-btn-no",text:"No",closeOnClick:!0}},icons:{bootstrap:{confirm:"glyphicon glyphicon-question-sign",success:"glyphicon glyphicon-ok-sign",error:"glyphicon glyphicon-remove-sign",warning:"glyphicon glyphicon-exclamation-sign",info:"glyphicon glyphicon-info-sign"},fontAwesome:{confirm:"fa fa-question-circle",success:"fa fa-check-circle",error:"fa fa-times-circle",warning:"fa fa-exclamation-circle",info:"fa fa-info-circle"}}},i.base.DEFAULTS={horizontalOffset:5,verticalOffset:5,width:600,height:"auto",closeButton:!0,draggable:!0,customBtnClass:"lobibox-btn lobibox-btn-default",modal:!1,debug:!1,buttonsAlign:"center",closeOnEsc:!0,delayToRemove:200,delay:!1,baseClass:"animated-super-fast",showClass:"zoomIn",hideClass:"zoomOut",iconSource:"bootstrap",onShow:null,shown:null,beforeClose:null,closed:null},e.prototype=$.extend({},a,{constructor:e,_processInput:function(t){var o=a._processInput.call(this,t);return o.buttons={ok:i.base.OPTIONS.buttons.ok,cancel:i.base.OPTIONS.buttons.cancel},t=$.extend({},o,e.DEFAULT_OPTIONS,t)},_init:function(){a._init.call(this),this.show()},_afterShow:function(){this._setContent(this._createInput())._position(),this.$input.focus(),a._afterShow.call(this)},_createInput:function(){var e,t=this;return t.$options.multiline?t.$input=$("<textarea></textarea>").attr("rows",t.$options.lines):t.$input=$('<input type="'+t.$promptType+'"/>'),t.$input.addClass("lobibox-input").attr(t.$options.attrs),t.$options.value&&t.setValue(t.$options.value),t.$options.label&&(e=$("<label>"+t.$options.label+"</label>")),$("<div></div>").append(e,t.$input)},setValue:function(e){return this.$input.val(e),this},getValue:function(){return this.$input.val()},isValid:function(){var e=this,t=e.$el.find(".lobibox-input-error-message");return e.$options.required&&!e.getValue()?(e.$input.addClass("invalid"),0===t.length&&(e.$el.find(".lobibox-body").append('<p class="lobibox-input-error-message">'+e.$options.errorMessage+"</p>"),e._position(),e.$input.focus()),!1):(e.$input.removeClass("invalid"),t.remove(),e._position(),e.$input.focus(),!0)}}),e.DEFAULT_OPTIONS={width:400,attrs:{},value:"",multiline:!1,lines:3,type:"text",label:"",required:!0,errorMessage:"The field is required"},t.prototype=$.extend({},a,{constructor:t,_processInput:function(e){var t=a._processInput.call(this,e);return t.buttons={yes:i.base.OPTIONS.buttons.yes,no:i.base.OPTIONS.buttons.no},e=$.extend({},t,i.confirm.DEFAULTS,e)},_init:function(){a._init.call(this),this.show()},_afterShow:function(){var e=this,t=$("<div></div>");e.$options.iconClass&&t.append($('<div class="lobibox-icon-wrapper"></div>').append('<i class="lobibox-icon '+e.$options.iconClass+'"></i>')),t.append('<div class="lobibox-body-text-wrapper"><span class="lobibox-body-text">'+e.$options.msg+"</span></div>"),e._setContent(t.html()),e._position(),a._afterShow.call(e)}}),i.confirm.DEFAULTS={title:"Question",width:500},o.prototype=$.extend({},a,{constructor:o,_processInput:function(e){var t=a._processInput.call(this,e);return t.buttons={ok:i.base.OPTIONS.buttons.ok},e=$.extend({},t,i.alert.OPTIONS[this.$type],i.alert.DEFAULTS,e)},_init:function(){a._init.call(this),this.show()},_afterShow:function(){var e=this,t=$("<div></div>");e.$options.iconClass&&t.append($('<div class="lobibox-icon-wrapper"></div>').append('<i class="lobibox-icon '+e.$options.iconClass+'"></i>')),t.append('<div class="lobibox-body-text-wrapper"><span class="lobibox-body-text">'+e.$options.msg+"</span></div>"),e._setContent(t.html()),e._position(),a._afterShow.call(e)}}),i.alert.OPTIONS={warning:{title:"Warning"},info:{title:"Information"},success:{title:"Success"},error:{title:"Error"}},i.alert.DEFAULTS={},n.prototype=$.extend({},a,{constructor:n,_processInput:function(e){var t=a._processInput.call(this,e);return e=$.extend({},t,i.progress.DEFAULTS,e)},_init:function(){a._init.call(this),this.show()},_afterShow:function(){var e=this;e.$options.progressTpl?e.$progressBarElement=$(e.$options.progressTpl):e.$progressBarElement=e._createProgressbar();var t;e.$options.label&&(t=$("<label>"+e.$options.label+"</label>"));var o=$("<div></div>").append(t,e.$progressBarElement);e._setContent(o),e._position(),a._afterShow.call(e)},_createProgressbar:function(){var e=$('<div class="lobibox-progress-bar-wrapper lobibox-progress-outer"></div>').append('<div class="lobibox-progress-bar lobibox-progress-element"></div>');return this.$options.showProgressLabel&&e.append('<span class="lobibox-progress-text" data-role="progress-text"></span>'),e},setProgress:function(e){var t=this;if(100!==t.$progress)return e=Math.min(100,Math.max(0,e)),t.$progress=e,t._triggerEvent("progressUpdated"),100===t.$progress&&t._triggerEvent("progressCompleted"),t.$el.find(".lobibox-progress-element").css("width",e.toFixed(1)+"%"),t.$el.find('[data-role="progress-text"]').html(e.toFixed(1)+"%"),t},getProgress:function(){return this.$progress}}),i.progress.DEFAULTS={width:500,showProgressLabel:!0,label:"",progressTpl:!1,progressUpdated:null,progressCompleted:null},s.prototype=$.extend({},a,{constructor:s,_processInput:function(e){var t=a._processInput.call(this,e);return e.content&&"function"==typeof e.content&&(e.content=e.content()),e.content instanceof jQuery&&(e.content=e.content.clone()),e=$.extend({},t,i.window.DEFAULTS,e)},_init:function(){var e=this;a._init.call(e),e.setContent(e.$options.content),e.$options.url&&e.$options.autoload?(e.$options.showAfterLoad||e.show(),e.load(function(){e.$options.showAfterLoad&&e.show()})):e.show()},_afterShow:function(){this._position(),a._afterShow.call(this)},_addCloseButton:function(){var e=this,t=$('<span class="btn-close">&times;</span>');e.$el.find(".lobibox-header").append(t),t.on("mousedown",function(e){e.stopPropagation()}),t.on("click.lobibox",function(){e.windowHide()})},_beforeWindowShow:function(){this._triggerEvent("beforeWindowShow")},_beforeWindowHide:function(){this._triggerEvent("beforeWindowHide")},_afterWindowShow:function(){this._triggerEvent("afterWindowShow")},_afterWindowHide:function(){this._triggerEvent("afterWindowHide")},windowHide:function(){return this._beforeWindowHide(),this.$el.addClass("hide"),this._afterWindowHide(),this},windowShow:function(){return this._beforeWindowShow(),this.$el.removeClass("hide"),this._afterWindowShow(),this.$el[0].style.zIndex=(new Date).getTime()-i.window.startTime,this},setParams:function(e){return this.$options.params=e,this},getParams:function(){return this.$options.params},setLoadMethod:function(e){return this.$options.loadMethod=e,this},getLoadMethod:function(){return this.$options.loadMethod},setContent:function(e){return this.$options.content=e,this.$el.find(".lobibox-body").html("").append(e),this},getContent:function(){return this.$options.content},setUrl:function(e){return this.$options.url=e,this},getUrl:function(){return this.$options.url},load:function(e){var t=this;return t.$options.url?($.ajax(t.$options.url,{method:t.$options.loadMethod,data:t.$options.params}).done(function(o){t.setContent(o),e&&"function"==typeof e&&e(o)}),t):t}}),i.window.DEFAULTS={width:480,height:600,content:"",url:"",draggable:!0,autoload:!0,loadMethod:"GET",showAfterLoad:!0,params:{}},i.window.startTime=(new Date).getTime();i.notify=function(e,t){if(["default","info","warning","error","success"].indexOf(e)>-1){var o=new function(e,t){this.$type=null,this.$options=null,this.$el=null;var o=this,n=function(e){e.closest(".lb-notify-tabs").find(">li").removeClass("active"),e.addClass("active");var t=$(e.find(">a").attr("href"));t.closest(".lb-notify-wrapper").find(">.lb-tab-pane").removeClass("active"),t.addClass("active")},s=function(e){var t=$("<li></li>",{class:i.notify.OPTIONS[o.$type].class});return $("<a></a>",{href:"#"+e}).append('<i class="tab-control-icon '+o.$options.icon+'"></i>').appendTo(t),t},a=function(){return $("<div></div>",{class:"lb-tab-pane",id:Math.randomString(10)})},r=function(e){o.$options.closable&&$('<span class="lobibox-close">&times;</span>').click(function(){o.remove()}).appendTo(e)},l=function(e){o.$options.closeOnClick&&e.click(function(){o.remove()})},c=function(e){if(o.$options.delay){if(o.$options.delayIndicator){var t=$('<div class="lobibox-delay-indicator"><div></div></div>');e.append(t)}var n=0,s=1e3/30,i=(new Date).getTime(),a=setInterval(function(){o.$options.continueDelayOnInactiveTab?n=(new Date).getTime()-i:n+=s;var e=100*n/o.$options.delay;e>=100&&(e=100,o.remove(),a=clearInterval(a)),o.$options.delayIndicator&&t.find("div").css("width",e+"%")},s);o.$options.pauseDelayOnHover&&e.on("mouseenter.lobibox",function(){s=0}).on("mouseleave.lobibox",function(){s=1e3/30})}},d=function(e){return e=Math.min($(window).outerWidth(),e)};this.remove=function(){o.$el.removeClass(o.$options.showClass).addClass(o.$options.hideClass);var e=o.$el.parent(),t=e.closest(".lobibox-notify-wrapper-large"),s="#"+e.attr("id"),a=t.find('>.lb-notify-tabs>li:has(a[href="'+s+'"])');return a.addClass(i.notify.OPTIONS.class).addClass(o.$options.hideClass),setTimeout(function(){if("normal"===o.$options.size||"mini"===o.$options.size)o.$el.remove();else if("large"===o.$options.size){var t=function(e){var t=e.prev();return 0===t.length&&(t=e.next()),0===t.length?null:t}(a);t&&n(t),a.remove(),e.remove()}var s=i.notify.list,r=s.indexOf(o);s.splice(r,1);var l=s[r];l&&l.$options.showAfterPrevious&&l._init()},500),o},o._init=function(){var e=function(){var e,t,n,s,a,u=i.notify.OPTIONS,p=$("<div></div>",{class:"lobibox-notify "+u[o.$type].class+" "+u.class+" "+o.$options.showClass});return n=$('<div class="lobibox-notify-icon-wrapper"></div>').appendTo(p),e=$('<div class="lobibox-notify-icon"></div>').appendTo(n),t=$("<div></div>").appendTo(e),o.$options.img?t.append('<img src="'+o.$options.img+'"/>'):o.$options.icon?t.append('<div class="icon-el"><i class="'+o.$options.icon+'"></i></div>'):p.addClass("without-icon"),a=$('<div class="lobibox-notify-msg">'+o.$options.msg+"</div>"),!1!==o.$options.messageHeight&&a.css("max-height",o.$options.messageHeight),s=$("<div></div>",{class:"lobibox-notify-body"}).append(a).appendTo(p),o.$options.title&&s.prepend('<div class="lobibox-notify-title">'+o.$options.title+"<div>"),r(p),"normal"!==o.$options.size&&"mini"!==o.$options.size||(l(p),c(p)),o.$options.width&&p.css("width",d(o.$options.width)),p}();if("mini"===o.$options.size&&e.addClass("notify-mini"),"string"==typeof o.$options.position){var t=function(){var e,t=("large"===o.$options.size?".lobibox-notify-wrapper-large":".lobibox-notify-wrapper")+"."+o.$options.position.replace(/\s/gi,".");return 0===(e=$(t)).length&&(e=$("<div></div>").addClass(t.replace(/\./g," ").trim()).appendTo($(i.viewport)),"large"===o.$options.size&&e.append($('<ul class="lb-notify-tabs"></ul>')).append($('<div class="lb-notify-wrapper"></div>'))),e}();!function(e,t){if("normal"===o.$options.size)t.hasClass("bottom")?t.prepend(e):t.append(e);else if("mini"===o.$options.size)t.hasClass("bottom")?t.prepend(e):t.append(e);else if("large"===o.$options.size){var i=a().append(e),r=s(i.attr("id"));t.find(".lb-notify-wrapper").append(i),t.find(".lb-notify-tabs").append(r),n(r),r.find(">a").click(function(){n(r)})}}(e,t),t.hasClass("center")&&t.css("margin-left","-"+t.width()/2+"px")}else $(i.viewport).append(e),e.css({position:"fixed",left:o.$options.position.left,top:o.$options.position.top});o.$el=e,o.$options.sound&&new Audio(o.$options.sound).play(),o.$options.rounded&&o.$el.addClass("rounded"),o.$el.on("click.lobibox",function(e){o.$options.onClickUrl&&(window.location.href=o.$options.onClickUrl),o.$options.onClick&&"function"==typeof o.$options.onClick&&o.$options.onClick.call(o,e)}),o.$el.data("lobibox",o)},this.$type=e,this.$options=function(e){return"mini"!==e.size&&"large"!==e.size||(e=$.extend({},i.notify.OPTIONS[e.size],e)),"mini"!==(e=$.extend({},i.notify.OPTIONS[o.$type],i.notify.DEFAULTS,e)).size&&!0===e.title?e.title=i.notify.OPTIONS[o.$type].title:"mini"===e.size&&!0===e.title&&(e.title=!1),e.icon,!0===e.sound&&(e.sound=i.notify.OPTIONS[o.$type].sound),e.sound&&(e.sound=e.soundPath+e.sound+e.soundExt),e}(t),o.$options.showAfterPrevious&&0!==i.notify.list.length||this._init()}(e,t);return i.notify.list.push(o),o}},i.notify.list=[],i.notify.closeAll=function(){var e=i.notify.list;for(var t in e)e[t].remove()},i.notify.DEFAULTS={title:!0,size:"normal",soundPath:"sounds/",soundExt:".ogg",showClass:"fadeInDown",hideClass:"zoomOut",icon:!0,msg:"",img:null,closable:!0,hideCloseButton:!1,delay:5e3,delayIndicator:!0,closeOnClick:!0,width:400,sound:!0,position:"bottom right",iconSource:"bootstrap",rounded:!1,messageHeight:60,pauseDelayOnHover:!0,onClickUrl:null,showAfterPrevious:!1,continueDelayOnInactiveTab:!0,onClick:null},i.notify.OPTIONS={class:"animated-fast",large:{width:500,messageHeight:96},mini:{class:"notify-mini",messageHeight:32},default:{class:"lobibox-notify-default",title:"Default",sound:!1},success:{class:"lobibox-notify-success",title:"Success",sound:"sound2"},error:{class:"lobibox-notify-error",title:"Error",sound:"sound4"},warning:{class:"lobibox-notify-warning",title:"Warning",sound:"sound5"},info:{class:"lobibox-notify-info",title:"Information",sound:"sound6"},icons:{bootstrap:{success:"glyphicon glyphicon-ok-sign",error:"glyphicon glyphicon-remove-sign",warning:"glyphicon glyphicon-exclamation-sign",info:"glyphicon glyphicon-info-sign"},fontAwesome:{success:"fa fa-check-circle",error:"fa fa-times-circle",warning:"fa fa-exclamation-circle",info:"fa fa-info-circle"}}}},BIMWINNER.CODE_STATE="BETA",BIMWINNER.DEBUG=!1,BIMWINNER.Material={IfcRoof:{color:[.837255,.203922,.270588,1]},IfcSlab:{color:[.637255,.603922,.670588,1]},IfcWall:{color:[.537255,.337255,.237255,1]},IfcWallStandardCase:{color:[.537255,.337255,.237255,1]},IfcDoor:{color:[.637255,.603922,.670588,1]},IfcWindow:{color:[.137255,.403922,.870588,.4]},IfcOpeningElement:{color:[.137255,.403922,.870588,0]},IfcRailing:{color:[.137255,.403922,.870588,1]},IfcColumn:{color:[.137255,.403922,.870588,1]},IfcBeam:{color:[.137255,.403922,.870588,1]},IfcFurnishingElement:{color:[.137255,.403922,.870588,1]},IfcCurtainWall:{color:[.137255,.403922,.870588,1]},IfcStair:{color:[.637255,.603922,.670588,1]},IfcStairFlight:{color:[.637255,.603922,.670588,1]},IfcBuildingElementProxy:{color:[.5,.5,.5,1]},IfcFlowSegment:{color:[.137255,.403922,.870588,1]},IfcFlowitting:{color:[.137255,.403922,.870588,1]},IfcFlowTerminal:{color:[.137255,.403922,.870588,1]},IfcProxy:{color:[.137255,.403922,.870588,1]},IfcSite:{color:[.137255,.403922,.870588,1]},IfcLightFixture:{color:[.8470588235,.8470588235,.870588,1]},IfcDuctSegment:{color:[.8470588235,.427450980392,0,1]},IfcDistributionFlowElement:{color:[.8470588235,.427450980392,0,1]},IfcDuctFitting:{color:[.8470588235,.427450980392,0,1]},IfcPlate:{color:[.137255,.403922,.870588,.5]},IfcAirTerminal:{color:[.8470588235,.427450980392,0,1]},IfcMember:{color:[.8470588235,.427450980392,0,1]},IfcCovering:{color:[.8470588235,.427450980392,0,1]},IfcTransportElement:{color:[.8470588235,.427450980392,0,1]},IfcFlowController:{color:[.8470588235,.427450980392,0,1]},IfcFlowFitting:{color:[.8470588235,.427450980392,0,1]},IfcRamp:{color:[.8470588235,.427450980392,0,1]},IfcFurniture:{color:[.8470588235,.427450980392,0,1]},IfcFooting:{color:[.8470588235,.427450980392,0,1]},IfcSystemFurnitureElement:{color:[.8470588235,.427450980392,0,1]},IfcSpace:{color:[.137255,.303922,.570588,.5]},DEFAULT:{color:[.8470588235,.427450980392,0,1]}},BIMWINNER.DeviceTypeTest={},BIMWINNER.DeviceTypeTest.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window},BIMWINNER.DeviceTypeTest.isBrowser=function(){return"undefined"!=typeof navigator},BIMWINNER.DeviceTypeTest.isIE11=function(){return BIMWINNER.DeviceTypeTest.isBrowser()&&!!navigator.userAgent.match(/Edge|Trident\/7\./)},BIMWINNER.DeviceTypeTest.isIOSDevice=function(){return!!BIMWINNER.DeviceTypeTest.isBrowser&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())},BIMWINNER.DeviceTypeTest.isAndroidDevice=function(){return!!BIMWINNER.DeviceTypeTest.isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("android")},BIMWINNER.DeviceTypeTest.isMobileDevice=function(){return!!BIMWINNER.DeviceTypeTest.isBrowser&&(this.isIOSDevice()||this.isAndroidDevice())},BIMWINNER.DeviceTypeTest.isSafari=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")},BIMWINNER.DeviceTypeTest.isFirefox=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;return-1!==navigator.userAgent.toLowerCase().indexOf("firefox")},BIMWINNER.DeviceTypeTest.isMac=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;return-1!==navigator.userAgent.toLowerCase().indexOf("mac os")},BIMWINNER.DeviceTypeTest.isWindows=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")},BIMWINNER.Listener=function(){this._handleMap=new function(e,t){this.items=[];var o=(t=t||0)+1;this.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(;;){e=arguments[0];var n=o++;if(!this.items[n])return this.items[n]=e,n}},this.removeItem=function(e){var t=this.items[e];return delete this.items[e],t}},this._locSubs={},this._handleLocs={},this.props={},this.fire=function(e,t,o){!0!==o&&(this.props[e]=t);var n,s=this._locSubs[e];if(s)for(var i in s)s.hasOwnProperty(i)&&(n=s[i]).callback.call(n.scope,t)},this.on=function(e,t,o){var n=this._locSubs[e];n||(n={},this._locSubs[e]=n);var s=this._handleMap.addItem();n[s]={scope:o||this,callback:t},this._handleLocs[s]=e;var i=this.props[e];return i&&t.call(o||this,i),s},this.off=function(e){var t=this._handleLocs[e];if(t){delete this._handleLocs[e];var o=this._locSubs[t];o&&delete o[e],this._handleMap.removeItem(e)}},this.once=function(e,t,o){var n=this,s=this.on(e,function(e){n.off(s),t(e)},o)}},BIMWINNER.Input=function(e){this.listener=new BIMWINNER.Listener;var t=this;this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0,this.translationFlag=!1,this.theMeasuredDistance=!1,this.theMeasuredDistanceSize=.1,this.zoomFlag=!1,this.touchstart=!1,this.touchmove=!1,this.touchend=!1,this.theInitialStadia=1,e.addEventListener("contextmenu",function(e){e.preventDefault()},!1),e.addEventListener("touchstart",this._touchstartListener=function(o){if(t.enabled){t.touchstart=!0;var n=[o.touches[0].clientX,o.touches[0].clientY];e.focus(),t.listener.fire("touchstart",n,o,!0)}}),e.addEventListener("touchend",this._touchendListener=function(e){if(t.enabled){t.touchend=!0;var o=[e.changedTouches[0].clientX,e.changedTouches[0].clientY];t.listener.fire("touchend",o,e,!0)}}),e.addEventListener("touchmove",this._touchmoveListener=function(e){if(t.enabled){t.touchmove=!0,e.preventDefault();var o=[e.touches[0].clientX,e.touches[0].clientY];t.listener.fire("touchmove",o,e,!0)}}),e.addEventListener("mousedown",this._mouseDownListener=function(o){if(t.enabled){switch(o.which){case 1:t.mouseDownLeft=!0;break;case 2:t.mouseDownMiddle=!0;break;case 3:t.mouseDownRight=!0}var n=t._getClickCoordsWithinElement(o);e.focus(),t.listener.fire("mousedown",n,o,!0)}}),e.addEventListener("mouseup",this._mouseUpListener=function(e){if(t.enabled){switch(e.which){case 1:t.mouseDownLeft=!1;break;case 2:t.mouseDownMiddle=!1;break;case 3:t.mouseDownRight=!1}var o=t._getClickCoordsWithinElement(e);t.listener.fire("mouseup",o,e,!0)}}),e.addEventListener("dblclick",this._dblClickListener=function(e){if(t.enabled){switch(e.which){case 1:t.mouseDownLeft=!1,t.mouseDownRight=!1;break;case 2:t.mouseDownMiddle=!1;break;case 3:t.mouseDownLeft=!1,t.mouseDownRight=!1}var o=t._getClickCoordsWithinElement(e);t.listener.fire("dblclick",o,e,!0)}}),e.addEventListener("mousemove",this._mouseMoveListener=function(e){if(t.enabled){var o=t._getClickCoordsWithinElement(e);t.listener.fire("mousemove",o,e,!0)}}),e.addEventListener("mousewheel",this._mouseWheelListener=function(e,o){if(t.enabled){var e=window.event||e,n=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));e.preventDefault();var s=e.offsetX,i=e.offsetY;t.listener.fire("mousewheel",{delta:n,offsetx:s,offsety:i},e,!0)}}),e.addEventListener("DOMMouseScroll",this._mouseWheelListener=function(e,o){if(t.enabled){var e=window.event||e,n=Math.min(1,Math.max(-1,e.wheelDelta||-e.detail));e.preventDefault();var s=e.offsetX,i=e.offsetY;t.listener.fire("mousewheel",{delta:n,offsetx:s,offsety:i},e,!0)}}),function(){var e,o;t.listener.on("mousedown",function(t){e=t.x,o=t.y}),t.listener.on("touchstart",function(t){e=t.x,o=t.y}),t.listener.on("mouseup",function(n){e===n.x&&o===n.y&&t.listener.fire("mouseclicked",n,!0)}),t.listener.on("touchend",function(e){})}(),this._getClickCoordsWithinElement=function(e){var t=[0,0];if(e){for(var o=e.target,n=0,s=0;o.offsetParent;)n+=o.offsetLeft,s+=o.offsetTop,o=o.offsetParent;t[0]=e.pageX-n,t[1]=e.pageY-s}else e=window.event,t.x=e.x,t.y=e.y;return t};this.keyCode={KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32}},BIMWINNER.ObjectSet=function(e){this.className="BIMWINNER.ObjectSet",this.listener=new BIMWINNER.Listener;var t=this;this.alwaysVisible=!1,this.showBox=!0,this.objects={},this.boxHelper={},this.box=new THREE.Object3D,e.scene.add(t.box),this.numObjects=0,this.boundary={},this._boundaryDirty=!0,this.clear=function(){for(var e in this.objects)this.objects.hasOwnProperty(e)&&n(this.objects[e]);t.listener.fire("updated",{cleared:!0})},this.addObjects=function(e){for(var n=0,s=e.length;n<s;n++)o(e[n]);t.listener.fire("updated",{added:{objects:e}})};var o=function(e){var o=e.key||e.id;if($.isArray(e.material))for(var n=0;n<e.material.length;n++)e.material[n].color.setRGB(.25,.68,0),e.material[n].depthTest=!t.alwaysVisible,!e.material[n].transparent&&t.alwaysVisible&&(e.material[n].transparent=!0,e.userData.objectSetChange=!0);else e.material.color.setRGB(.25,.68,0),e.material.depthTest=!t.alwaysVisible,!e.material.transparent&&t.alwaysVisible&&(e.material.transparent=!0,e.userData.objectSetChange=!0);e.highlight=!0,e.visible=!0,t.objects[o]=e,t.boxHelper[o]=new THREE.BoxHelper(e),t.showBox&&t.box.add(t.boxHelper[o]),t.numObjects=Object.getOwnPropertyNames(t.objects).length},n=function(o){var n=o.key||o.id;if($.isArray(o.material))for(var s=0;s<o.material.length;s++)o.userData.color.clone?o.material[s].color=o.userData.color.clone():o.material[s].color.setRGB(o.userData.color[4*s],o.userData.color[4*s+1],o.userData.color[4*s+2]),o.material[s].depthTest=!0,o.userData.objectSetChange&&!o.userData.transparentChange&&(o.material[s].transparent=o.userData.originalMaterial[s].transparent);else o.material.color=o.userData.color.clone(),o.material.depthTest=!0,o.userData.objectSetChange&&!o.userData.transparentChange&&(o.material.transparent=o.userData.originalMaterial[0].transparent);o.userData.objectSetChange=!1,o.highlight=!1,o.userData&&"IfcSpace"==o.userData.type&&(o.visible=!1),delete t.objects[n],t.numObjects=Object.getOwnPropertyNames(t.objects).length,t.box.remove(t.boxHelper[n]),delete t.boxHelper[n],t.numObjects<=0&&(e.scene.remove(t.box),t.box=new THREE.Object3D,e.scene.add(t.box))};this.removeObjects=function(e){for(var o=0,s=e.length;o<s;o++)n(e[o]);t.listener.fire("updated",{removed:{objects:e}})},this.addObjectIds=function(n){for(var s,i,a=0,r=n.length;a<r;a++)s=n[a],(i=e.components[s])?o(i):console.warn("addObjectIds - object not found: '"+s+"'");t.listener.fire("updated",{added:{objectIds:n}})},this.removeObjectIds=function(o){for(var s,i,a=0,r=o.length;a<r;a++)s=o[a],(i=e.components[s])?n(i):console.warn("removeObjectIds - object not found: '"+s+"'");t.listener.fire("updated",{removed:{objectIds:o}})},this.addTypes=function(n){for(var s,i,a,r=0,l=n.length;r<l;r++)if(s=n[r],(i=e.getComponentTypeArray())[s])for(a in i[s])i.hasOwnProperty(a)&&o(i[a]);else console.warn("addTypes - 类型没有找到: '"+s+"'");t.listener.fire("updated",{added:{types:n}})},this.removeTypes=function(o){for(var s,i,a,r=0,l=o.length;r<l;r++)if(s=o[r],(i=e.getComponentTypeArray())[s])for(a in i[s])i.hasOwnProperty(a)&&n(this.objects[a]);else console.warn("removeTypes - 类型没有找到: '"+s+"'");t.listener.fire("updated",{removed:{types:o}})},this.withObjects=function(e){for(var t in this.objects)this.objects.hasOwnProperty(t)&&e(this.objects[t])},this.getBoundary=function(){t.boundary=null,t.boundary=new THREE.Box3(new THREE.Vector3,new THREE.Vector3);var e=!0;for(var o in t.objects)if(t.objects[o].visible){var n=(new THREE.Box3).expandByObject(t.objects[o]);e?(t.boundary=n.clone(),e=!1):t.boundary.union(n),n=null}return t.boundary},this.getCenter=function(){return t.getBoundary().getCenter()}},BIMWINNER.CameraFlyAnimation=function(e,t,o){var n=this;this.lister=new BIMWINNER.Listener,this._look1=new THREE.Vector3,this._eye1=new THREE.Vector3,this._up1=new THREE.Vector3,this._look2=new THREE.Vector3,this._eye2=new THREE.Vector3,this._up2=new THREE.Vector3,this._dist=0,this._flying=!1,this._ok=null,this._onTick=null,this._camera=t||e.camera,this._tempVec=new THREE.Vector3,this._eyeVec=new THREE.Vector3,this._lookVec=new THREE.Vector3,this._stopFOV=55,this._time1=null,this._time2=null,this.easing=!1!==e.easing,this._duration=e.duration||800,this.camera=t||e.camera,this.cameraControl=o||e.cameraControl,this.flyTo=function(t,o){!n.cameraControl instanceof BIMWINNER.OrbitControls&&console.warn("非轨道球控制模式不支持视角飞跃方法"),n.cameraControl.forbidRotate&&n.cameraControl.forbidRotate(),n._flying&&n.stop(),n._ok=o,this._arc=void 0===t.arc?0:t.arc;var i=n.camera;n._look1=n.cameraControl.target.clone(),n._eye1=i.position.clone(),n._up1=i.up.clone();var a=t.backOff||.5;if(a<0?a=0:a>1&&(a=1),a=1-a,t.boundary){var r=t.boundary;if(r.xmax<=r.xmin||r.ymax<=r.ymin||r.zmax<=r.zmin)return;var l=t.dist||2.5,c=Math.abs(BIMSURFER.math.lenVec3(n._vec)),d=BIMSURFER.math.getBoundaryDiag(r),u=Math.abs(d/(1+.8*a)/Math.tan(n._stopFOV/2))/c*l;n._look2=BIMSURFER.math.getBoundaryCenter(r),n._look2=[n._look2[0],n._look2[1],n._look2[2]],t.offset&&(n._look2[0]+=t.offset[0],n._look2[1]+=t.offset[1],n._look2[2]+=t.offset[2]),n._eye2=BIMSURFER.math.addVec3(n._look2,BIMSURFER.math.mulVec3Scalar(n._vec,u,[])),n._up2=BIMSURFER.math.vec3(),n._up2[1]=1}else{n._look1=n.cameraControl.target.clone(),n._eye1=i.position.clone(),n._up1=i.up.clone();var p=t;p.look&&p.look.isVector3?n._look2=p.look:$.isArray(p.look)?n._look2=new THREE.Vector3(p.look[0],p.look[1],p.look[2]):n._look2=n.cameraControl.target.clone(),p.eye&&p.eye.isVector3?n._eye2=p.eye:$.isArray(p.eye)?n._eye2=new THREE.Vector3(p.eye[0],p.eye[1],p.eye[2]):n._eye2=n.camera.position.clone(),p.up&&p.up.isVector3?n._up2=p.up:$.isArray(p.up)?n._up2=new THREE.Vector3(p.up[0],p.up[1],p.up[2]):n._up2=i.up.clone()}n.lister.fire("started",t,!0),n._time1=(new Date).getTime(),n._time2=n._time1+n._duration,n._tick=e.listener.on("tick",function(e){s(1e3*e.time)}),n._flying=!0};var s=function(t){if(n._flying){var o=((t=(new Date).getTime())-n._time1)/(n._time2-n._time1);if(o>1)return n._camera.position.copy(n._eye2),n._camera.lookAt(n._look2),n.cameraControl.target.copy(n._look2),n._camera.up.copy(n._up2),n._camera.updateProjectionMatrix(),void n.stop();o=n.easing?i(o,0,1,1):o,n._camera.position.copy((new THREE.Vector3).lerpVectors(n._eye1,n._eye2,o));var s=(new THREE.Vector3).lerpVectors(n._look1,n._look2,o);n.cameraControl.target.copy(s),n._camera.lookAt(s),n._camera.up.copy((new THREE.Vector3).lerpVectors(n._up1,n._up2,o)),n._camera.updateProjectionMatrix(),e.cameraControl.update()}},i=function(e,t,o,n){return e/=n,-o*e*(e-2)+t};this.stop=function(){if(n._flying){e.listener.off(n._tick),n._flying=!1,n._time1=null,n._time2=null,n.lister.fire("stopped",!0,!0);var t=n._ok;t&&(n._ok=!1,t())}}},BIMWINNER.FirstPersonControls=function(e,t,o){function n(e){e.preventDefault()}function s(e,t){return function(){t.apply(e,arguments)}}var i=this;this.className="FirstPersonControls",this.camera=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.enabled=!0,this.collisionEnabled=!1,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.touchCameraMove=!1,this.touchLensMove=!1,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.jump=!1,this.targetChange=!1,this.keyDown=!1,this.mouseDragOn=!1,this.pointerLock=!1,this.havePointerLock,this.collision=new BIMWINNER.CollisionDetection({},o),this.collisionResult=null,this.deviceTest=BIMWINNER.DeviceTypeTest,this.viewX=0,this.viewY=0;var a=0,r=0,l=0,c=0,d={},u=$('<div class="roamReticle"></div>');if(this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),i.havePointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,!i.deviceTest.isMobileDevice()&&i.havePointerLock){$('<div id="blocker"> <div id="instructions"> <span style="font-size:40px">点击进入沉浸式浏览</span> <br />(W, A, S, D键 = 移动, esc键 = 退出, 鼠标移动 = 镜头环绕) </div> </div>').appendTo($(o.viewportDiv));var p=document.getElementById("blocker"),f=document.getElementById("instructions"),m=function(e){document.pointerLockElement===i.domElement||document.mozPointerLockElement===i.domElement||document.webkitPointerLockElement===i.domElement?(i.pointerLock=!0,p.style.display="none",o.ClickSelectObjects.pointerLock=!0,o?(u.appendTo($("#"+o.viewport)),u.css({top:i.viewY/2-30,left:i.viewX/2-30})):(u.appendTo($("body")),u.css({top:i.viewY/2-30,left:i.viewX/2-30}))):(i.pointerLock=!1,o.ClickSelectObjects.pointerLock=!1,p.style.display="-webkit-box",p.style.display="-moz-box",p.style.display="box",f.style.display="",u.remove(),i.domElement.focus())},h=function(e){f.style.display="",i.pointerLock=!1};document.addEventListener("pointerlockchange",m,!1),document.addEventListener("mozpointerlockchange",m,!1),document.addEventListener("webkitpointerlockchange",m,!1),document.addEventListener("pointerlockerror",h,!1),document.addEventListener("mozpointerlockerror",h,!1),document.addEventListener("webkitpointerlockerror",h,!1),f.addEventListener("click",function(e){f.style.display="none",i.domElement.requestPointerLock=i.domElement.requestPointerLock||i.domElement.mozRequestPointerLock||i.domElement.webkitRequestPointerLock,i.domElement.requestPointerLock()},!1)}else{if(this.pointerLock=!1,i.deviceTest.isMobileDevice()){$('<div id="blocker"> <div id="instructions"> <div style="font-size:40px">点击进入漫游模式</div> <br /><div style="font-size:40px;    width: 40%;top: 60%;left: 0%;position: absolute;">触摸屏幕左侧并滑动  控制相机移动</div> <div style="font-size:40px;width: 40%;top: 60%;right: 0%;position: absolute;">触摸屏幕右侧并滑动  控制镜头环绕</div></div> </div>').appendTo(o.viewportDiv)}else{$('<div id="blocker"> <div id="instructions"> <span style="font-size:40px">点击进入漫游模式</span> <br />(W, A, S, D键 = 移动,  鼠标左键按下并移动 = 镜头环绕) </div> </div>').appendTo(o.viewportDiv)}var g=document.getElementById("blocker");document.getElementById("instructions").addEventListener("click",function(e){g.style.display="none",g.remove()},!1)}this.roamingState=function(){},this.handleResize=function(){this.domElement===document?(this.viewX=window.innerWidth,this.viewY=window.innerHeight):(this.viewX=this.domElement.offsetWidth,this.viewY=this.domElement.offsetHeight)},this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),0==e.button&&(this.mouseDown=!0,a=e.pageX-this.domElement.offsetLeft,r=e.pageY-this.domElement.offsetTop),this.mouseDragOn=!0},this.onMouseUp=function(e){e.preventDefault(),e.stopPropagation(),i.havePointerLock||0==e.button&&(this.mouseDown=!1),this.mouseDragOn=!1},this.onMouseMove=function(e){if(i.havePointerLock&&i.pointerLock)this.mouseX=-e.movementX||e.mozMovementX||e.webkitMovementX||0,this.mouseY=e.movementY||e.mozMovementY||e.webkitMovementY||0,i.keyDown;else if(i.mouseDown){var t=e.pageX-this.domElement.offsetLeft,o=e.pageY-this.domElement.offsetTop;this.mouseX=a-t,this.mouseY=o-r,a=t,r=o,i.keyDown}},this.onTouchStart=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),l=e.changedTouches[0].clientX-this.domElement.offsetLeft,c=e.changedTouches[0].clientY-this.domElement.offsetTop,l>i.viewX/2?d.lensMove||(d.lensMove={x:l,y:c,id:e.changedTouches[0].identifier},i.touchLensMove=!0):d.cameraMove||(d.cameraMove={x:l,y:c,id:e.changedTouches[0].identifier},i.touchCameraMove=!0)},this.onTouchEnd=function(e){e.preventDefault(),e.stopPropagation();for(var t=0;t<e.changedTouches.length;t++)d.cameraMove&&d.cameraMove.id==e.changedTouches[t].identifier?(i.touchCameraMove=!1,i.moveRight=!1,i.moveLeft=!1,i.moveBackward=!1,i.moveForward=!1,d.cameraMove=void 0):d.lensMove&&d.lensMove.id==e.changedTouches[t].identifier&&(i.touchLensMove=!1,d.lensMove=void 0)},this.onTouchMove=function(e){for(var t=0;t<e.changedTouches.length;t++){if(i.touchLensMove){if(d.lensMove&&d.lensMove.id==e.changedTouches[t].identifier){var o=e.changedTouches[t].clientX-this.domElement.offsetLeft,n=e.changedTouches[t].clientY-this.domElement.offsetTop;this.mouseX=d.lensMove.x-o,this.mouseY=n-d.lensMove.y,d.lensMove.x=o,d.lensMove.y=n}}else if(i.touchCameraMove&&d.cameraMove&&d.cameraMove.id==e.changedTouches[t].identifier){var s=e.changedTouches[t].clientX-this.domElement.offsetLeft,a=e.changedTouches[t].clientY-this.domElement.offsetTop,r=s-d.cameraMove.x,l=a-d.cameraMove.y;d.cameraMove.x=s,d.cameraMove.y=a,Math.abs(r)>=Math.abs(l)?r>0?i.moveRight=!0:i.moveLeft=!0:l>0?i.moveBackward=!0:i.moveForward=!0}i.keyDown}},this.onKeyDown=function(e){switch(e.keyCode){case 38:this.mouseY=-2;break;case 87:this.moveForward=!0;break;case 37:this.mouseX=2;break;case 65:this.moveLeft=!0;break;case 40:this.mouseY=2;break;case 83:this.moveBackward=!0;break;case 39:this.mouseX=-2;break;case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 32:this.jump=!0}i.keyDown=!0},this.onKeyUp=function(e){switch(e.keyCode){case 38:this.mouseY=0;break;case 87:this.moveForward=!1;break;case 37:this.mouseX=0;break;case 65:this.moveLeft=!1;break;case 40:this.mouseY=0;break;case 83:this.moveBackward=!1;break;case 39:this.mouseX=0;break;case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1;break;case 32:this.jump=!1}i.keyDown=!1},this.update=function(e){if(!1!==this.enabled){if(e=1,this.heightSpeed){var t=THREE.Math.clamp(this.camera.position.dot(this.camera.up),this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var o=e*this.lookSpeed;this.activeLook||(o=0);var n=1;this.constrainVertical&&(n=Math.PI/(this.verticalMax-this.verticalMin)),0==this.mouseX&&0==this.mouseY||(i.targetChange=!0),this.lon+=this.mouseX*o,this.lookVertical&&(this.lat-=this.mouseY*o*n),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var s=this.target,a=this.camera.position;this.camera.up.x||(this.camera.up.y?(s.x=a.x+1*Math.sin(this.phi)*Math.cos(this.theta),s.y=a.y+1*Math.cos(this.phi),s.z=a.z+1*Math.sin(this.phi)*Math.sin(this.theta)):(s.x=a.x+1*Math.sin(this.phi)*Math.cos(this.theta),s.y=a.y+1*Math.sin(this.phi)*Math.sin(this.theta),s.z=a.z+1*Math.cos(this.phi))),this.camera.lookAt(s),this.target.copy(s),this.target.x=s.x,this.target.y=s.y,this.target.z=s.z;var r=e*this.movementSpeed;if(i.collisionEnabled){if(this.moveForward||this.moveBackward||this.moveLeft||this.moveRight||this.moveUp||this.moveDown){var l=s.clone().sub(this.camera.position).normalize(),c=i.collision.run(this.camera.position,l);i.targetChange&&(i.collisionResult=i.determineTheMove(c),i.targetChange=!1),i.collisionResult||(i.collisionResult=i.determineTheMove(c)),Math.abs(i.collisionResult.front)>r&&(this.moveForward||this.autoForward&&!this.moveBackward)&&(this.camera.translateZ(-(r+this.autoSpeedFactor)),i.collisionResult.front-=r,i.collisionResult.back+=r,this.adjustHeight(c),this.adjustMoveForFront(c,s,r)),Math.abs(i.collisionResult.back)>r&&this.moveBackward&&(this.camera.translateZ(r),i.collisionResult.back-=r,i.collisionResult.front+=r,this.adjustHeight(c)),Math.abs(i.collisionResult.left)>r&&this.moveLeft&&(this.camera.translateX(-r),i.collisionResult.left-=r,i.collisionResult.right+=r,this.adjustMoveForLeft(c,s,r)),Math.abs(i.collisionResult.right)>r&&this.moveRight&&(this.camera.translateX(r),i.collisionResult.right-=r,i.collisionResult.left+=r,this.adjustMoveForRight(c,s,r))}this.moveUp&&this.camera.translateY(r),this.moveDown&&this.camera.translateY(-r)}else(this.moveForward||this.autoForward&&!this.moveBackward)&&this.camera.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.camera.translateZ(r),this.moveLeft&&this.camera.translateX(-r),this.moveRight&&this.camera.translateX(r),this.moveUp&&this.camera.translateY(r),this.moveDown&&this.camera.translateY(-r);this.mouseX=0,this.mouseY=0}},this.adjustHeight=function(e){if(e.bottom.length>0){var t=e.bottom[0].distance;if(t>1500){o=Math.abs(t-1e3);this.camera.position.z-=o+50}if(t<500){var o=Math.abs(500-t);this.camera.position.z+=o}}};this.adjustMoveForFront=function(e,t,o){var n=i.collision.drawMapForCode(this,e,t);n&&(n.leftResult<300||n.rightResult<300||n.updownResult<400)&&Math.abs(i.collisionResult.back)>o&&(this.camera.translateZ(o),i.collisionResult.back-=o,i.collisionResult.front+=o)},this.adjustMoveForRight=function(e,t,o){var n=i.collision.drawMapForCode(this,e,t);n&&n.updownResult<400&&(this.camera.translateX(-o),i.collisionResult.right+=o,i.collisionResult.left-=o)},this.adjustMoveForLeft=function(e,t,o){var n=i.collision.drawMapForCode(this,e,t);n&&n.updownResult<400&&(this.camera.translateX(o),i.collisionResult.left=o,i.collisionResult.right-=o)},this.determineTheMove=function(e){var t={};for(var o in e)if(e[o][0])switch(o){case"top":t[o]=e[o][0].distance-i.collision.height-10;break;case"bottom":t[o]=e[o][0].distance-i.collision.eyeHeight-10;break;case"front":case"back":t[o]=e[o][0].distance-10-i.collision.thickness/2;break;case"left":case"right":t[o]=e[o][0].distance-10-i.collision.width/2;break;default:t[o]=e[o][0].distance-10}else t[o]=1/0;return t},this.dispose=function(){this.domElement.removeEventListener("contextmenu",n,!1),this.domElement.removeEventListener("mousedown",E,!1),this.domElement.removeEventListener("mousemove",Y,!1),this.domElement.removeEventListener("mouseup",v,!1),this.domElement.removeEventListener("touchstart",b,!1),this.domElement.removeEventListener("touchmove",T,!1),this.domElement.removeEventListener("touchend",C,!1),window.removeEventListener("keydown",M,!1),window.removeEventListener("keyup",L,!1),document.getElementById("blocker")&&document.getElementById("blocker").remove(),u.remove()};var Y=s(this,this.onMouseMove),E=s(this,this.onMouseDown),v=s(this,this.onMouseUp),T=s(this,this.onTouchMove),b=s(this,this.onTouchStart),C=s(this,this.onTouchEnd),M=s(this,this.onKeyDown),L=s(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",n,!1),this.domElement.addEventListener("mousemove",Y,!1),this.domElement.addEventListener("mousedown",E,!1),this.domElement.addEventListener("mouseup",v,!1),this.domElement.addEventListener("touchmove",T,!1),this.domElement.addEventListener("touchstart",b,!1),this.domElement.addEventListener("touchend",C,!1),window.addEventListener("keydown",M,!1),window.addEventListener("keyup",L,!1),this.handleResize()},BIMWINNER.FirstPersonControls.prototype=Object.create(THREE.EventDispatcher.prototype),BIMWINNER.FirstPersonControls.prototype.constructor=BIMWINNER.FirstPersonControls,BIMWINNER.ClickSelectObjects=function(e,t){function o(e){if(p.enabled){var t=c(e);f.x=d=t[0],f.y=u=t[1]}}function n(t){if(p.enabled){var o=c(t);(o[0]>d?o[0]-d<5:d-o[0]<5)&&(o[1]>u?o[1]-u<5:u-o[1]<5)&&(f.x=d=o[0],f.y=u=o[1],p.pointerLock&&(f.x=e.viewerdiv.width()/2,f.y=e.viewerdiv.height()/2),l("pick"))}}function s(e){p.enabled&&(f.x=d=e.changedTouches[0].clientX,f.y=u=e.changedTouches[0].clientY)}function i(e){p.enabled&&(e.changedTouches[0].clientX>d?e.changedTouches[0].clientX-d<5:d-e.changedTouches[0].clientX<5)&&(e.changedTouches[0].clientY>u?e.changedTouches[0].clientY-u<5:u-e.changedTouches[0].clientY<5)&&(f.x=d=e.changedTouches[0].clientX,f.y=u=e.changedTouches[0].clientY,l("pick"))}function a(e){p.enabled&&e.ctrlKey&&(p.multi=!0)}function r(e){p.enabled&&(e.ctrlKey||(p.multi=!1))}function l(o){var n=new THREE.Vector3(f.x/e.renderer.domElement.clientWidth*2-1,-f.y/e.renderer.domElement.clientHeight*2+1,.5);p.raycaster.setFromCamera(n,e.camera);var s=p.raycaster.intersectObjects(t.children);p.listener.fire("pick",s),s.length>0?"move"==o?m!=s[0].object&&(m&&m.material.emissive.setHex(m.currentHex),(m=s[0].object).currentHex=m.material.emissive.getHex(),m.material.emissive.setHex(16777215)):e.objectSet.objects[s[0].object.key]?e.objectSet.removeObjects([s[0].object]):(p.multi||e.objectSet.clear(),e.objectSet.addObjects([s[0].object])):"move"==o?(m&&m.material.emissive.setHex(m.currentHex),m=null):e.objectSet.clear(),n=null}function c(e){var t=[0,0];if(e){for(var o=e.target,n=0,s=0;o.offsetParent;)n+=o.offsetLeft,s+=o.offsetTop,o=o.offsetParent;t[0]=e.pageX-n,t[1]=e.pageY-s}else e=window.event,t.x=e.x,t.y=e.y;return t}var d,u,p=this,f=new THREE.Vector2;this.listener=new BIMWINNER.Listener,this.enabled=!0,this.raycaster=new THREE.Raycaster,this.domElement=e.renderer.domElement,this.activeEventListener=function(){this.mousedown=p.domElement.addEventListener("mousedown",o,!1),this.mouseup=p.domElement.addEventListener("mouseup",n,!1),this.keydown=document.addEventListener("keydown",a,!1),this.keyup=document.addEventListener("keyup",r,!1)},this.disposeEventListener=function(){this.mousedown=p.domElement.removeEventListener("mousedown",o,!1),this.mouseup=p.domElement.removeEventListener("mouseup",n,!1),this.keydown=document.removeEventListener("keydown",a,!1),this.keyup=document.removeEventListener("keyup",r,!1)},this.dispose=function(){this.disposeEventListener(),this.touchDisabled()},this.disabled=function(){this.disposeEventListener(),this.touchDisabled()},this.touchEnabled=function(){this.touchstart=p.domElement.addEventListener("touchstart",s,!1),this.touchend=p.domElement.addEventListener("touchend",i,!1)},this.touchDisabled=function(){this.touchstart=p.domElement.removeEventListener("touchstart",s,!1),this.touchend=p.domElement.removeEventListener("touchend",i,!1)};var m;this.multi=!1,p.pointerLock=!1,p.raycaster.setFromCamera(f,e.camera),p.activeEventListener(),p.touchEnabled()},BIMWINNER.OrbitControls=function(e,t,o){function n(){return Math.pow(.95,Y.zoomSpeed)}function s(e){S.theta-=e}function i(e){S.phi-=e}function a(e){Y.camera instanceof THREE.PerspectiveCamera?(Z/=e,w=!0):Y.camera instanceof THREE.OrthographicCamera?(Y.camera.zoom=Math.max(Y.minZoom,Math.min(Y.maxZoom,Y.camera.zoom*e)),Y.camera.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),Y.enableZoom=!1)}function r(e){Y.camera instanceof THREE.PerspectiveCamera?Z*=e:Y.camera instanceof THREE.OrthographicCamera?(Y.camera.zoom=Math.max(Y.minZoom,Math.min(Y.maxZoom,Y.camera.zoom/e)),Y.camera.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),Y.enableZoom=!1)}function l(e){D.set(e.clientX,e.clientY)}function c(e){if(!1!==Y.enabled){if(e.preventDefault(),e.button===Y.mouseButtons.ORBIT){if(!1===Y.enableRotate)return;!function(e){H.set(e.clientX,e.clientY)}(e),C=b.ROTATE}else if(e.button===Y.mouseButtons.PAN2){if(!1===Y.enablePan)return;l(e),C=b.PAN}else if(e.button===Y.mouseButtons.PAN){if(!1===Y.enablePan)return;l(e),C=b.PAN}C!==b.NONE&&(Y.domElement.addEventListener("mousemove",d,!1),Y.domElement.addEventListener("mouseup",u,!1),Y.dispatchEvent(v))}}function d(e){if(!1!==Y.enabled)if(e.preventDefault(),C===b.ROTATE){if(!1===Y.enableRotate)return;!function(e){B.set(e.clientX,e.clientY),X.subVectors(B,H);var t=Y.domElement===document?Y.domElement.body:Y.domElement;s(2*Math.PI*X.x/t.clientWidth*Y.rotateSpeed),i(2*Math.PI*X.y/t.clientHeight*Y.rotateSpeed),H.copy(B),Y.update()}(e)}else if(C===b.DOLLY){if(!1===Y.enableZoom)return;!function(e){P.set(e.clientX,e.clientY),A.subVectors(P,R),A.y>0?a(n()):A.y<0&&r(n()),R.copy(P),Y.update()}(e)}else if(C===b.PAN){if(!1===Y.enablePan)return;!function(e){J.set(e.clientX,e.clientY),x.subVectors(J,D),G(x.x,x.y),D.copy(J),Y.update()}(e)}}function u(e){!1!==Y.enabled&&(Y.domElement.removeEventListener("mousemove",d,!1),Y.domElement.removeEventListener("mouseup",u,!1),Y.dispatchEvent(T),C=b.NONE)}function p(e){!1===Y.enabled||!1===Y.enableZoom||C!==b.NONE&&C!==b.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?r(n()):e.deltaY>0&&a(n()),Y.update()}(e),Y.dispatchEvent(v),Y.dispatchEvent(T))}function f(e){!1!==Y.enabled&&!1!==Y.enableKeys&&!1!==Y.enablePan&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&function(e){switch(e.keyCode){case Y.keys.PANUP:G(0,-Y.keyPanSpeed),Y.update();break;case Y.keys.PANBOTTOM:G(0,Y.keyPanSpeed),Y.update();break;case Y.keys.PANLEFT:G(-Y.keyPanSpeed,0),Y.update();break;case Y.keys.PANRIGHT:G(Y.keyPanSpeed,0),Y.update();break;case Y.keys.ROTATEUP:i(-Y.rotateSpeed/8),Y.update();break;case Y.keys.ROTATEBOTTOM:i(Y.rotateSpeed/8),Y.update();break;case Y.keys.ROTATELEFT:s(-Y.rotateSpeed/8),Y.update();break;case Y.keys.ROTATERIGHT:s(Y.rotateSpeed/8),Y.update();break;case Y.keys.ZOOMIN:a(n()),Y.update();break;case Y.keys.ZOOMOUT:r(n()),Y.update()}}(e)}function m(e){if(!1!==Y.enabled){switch(e.touches.length){case 1:if(!1===Y.enableRotate)return;!function(e){H.set(e.touches[0].pageX,e.touches[0].pageY)}(e),C=b.TOUCH_ROTATE;break;case 2:if(!1===Y.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);R.set(0,n)}(e),C=b.TOUCH_DOLLY;break;case 3:if(!1===Y.enablePan)return;!function(e){D.set(e.touches[0].pageX,e.touches[0].pageY)}(e),C=b.TOUCH_PAN;break;default:C=b.NONE}C!==b.NONE&&Y.dispatchEvent(v)}}function h(e){if(!1!==Y.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===Y.enableRotate)return;if(C!==b.TOUCH_ROTATE)return;!function(e){B.set(e.touches[0].pageX,e.touches[0].pageY),X.subVectors(B,H);var t=Y.domElement===document?Y.domElement.body:Y.domElement;s(2*Math.PI*X.x/t.clientWidth*Y.rotateSpeed),i(2*Math.PI*X.y/t.clientHeight*Y.rotateSpeed),H.copy(B),Y.update()}(e);break;case 2:if(!1===Y.enableZoom)return;if(C!==b.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+o*o);P.set(0,s),A.subVectors(P,R),A.y>0?r(n()):A.y<0&&a(n()),R.copy(P),Y.update()}(e);break;case 3:if(!1===Y.enablePan)return;if(C!==b.TOUCH_PAN)return;!function(e){J.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(J,D),G(x.x,x.y),D.copy(J),Y.update()}(e);break;default:C=b.NONE}}function g(e){!1!==Y.enabled&&(Y.dispatchEvent(T),C=b.NONE)}var Y=this;this.camera=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3(0,0,0),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={PANLEFT:65,PANUP:87,PANRIGHT:68,PANBOTTOM:83,ROTATELEFT:37,ROTATEUP:38,ROTATERIGHT:39,ROTATEBOTTOM:40,ZOOMIN:109,ZOOMOUT:107},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT,PAN2:THREE.MOUSE.MIDDLE},this.target0=this.target.clone(),this.position0=this.camera.position.clone(),this.zoom0=this.camera.zoom,this.getPolarAngle=function(){return L.phi},this.getAzimuthalAngle=function(){return L.theta},this.reset=function(){Y.target.copy(Y.target0),Y.camera.position.copy(Y.position0),Y.camera.zoom=Y.zoom0,Y.camera.updateProjectionMatrix(),Y.dispatchEvent(E),Y.update(),C=b.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=o.clone().inverse(),i=new THREE.Vector3,a=new THREE.Quaternion;return function(){var e=Y.camera.position;return t.copy(e).sub(Y.target),t.applyQuaternion(o),L.setFromVector3(t),Y.autoRotate&&C===b.NONE&&s(2*Math.PI/60/60*Y.autoRotateSpeed),L.theta+=S.theta,L.phi+=S.phi,L.theta=Math.max(Y.minAzimuthAngle,Math.min(Y.maxAzimuthAngle,L.theta)),L.phi=Math.max(Y.minPolarAngle,Math.min(Y.maxPolarAngle,L.phi)),L.makeSafe(),L.radius*=Z,L.radius=Math.max(Y.minDistance,Math.min(Y.maxDistance,L.radius)),Y.target.add(y),t.setFromSpherical(L),t.applyQuaternion(n),e.copy(Y.target).add(t),Y.camera.lookAt(Y.target),!0===Y.enableDamping?(S.theta*=1-Y.dampingFactor,S.phi*=1-Y.dampingFactor):S.set(0,0,0),Z=1,y.set(0,0,0),!!(w||i.distanceToSquared(Y.camera.position)>M||8*(1-a.dot(Y.camera.quaternion))>M)&&(Y.dispatchEvent(E),i.copy(Y.camera.position),a.copy(Y.camera.quaternion),w=!1,!0)}}(),this.disabled=function(){Y.disposeEventListener()},this.dispose=function(){Y.disposeEventListener()},this.activeEventListener=function(){Y.domElement.addEventListener("mousedown",c,!1),Y.domElement.addEventListener("wheel",p,!1),Y.domElement.addEventListener("touchstart",m,!1),Y.domElement.addEventListener("touchend",g,!1),Y.domElement.addEventListener("touchmove",h,!1),window.addEventListener("keydown",f,!1)},this.disposeEventListener=function(){Y.domElement.removeEventListener("mousedown",c,!1),Y.domElement.removeEventListener("wheel",p,!1),Y.domElement.removeEventListener("touchstart",m,!1),Y.domElement.removeEventListener("touchend",g,!1),Y.domElement.removeEventListener("touchmove",h,!1),Y.domElement.removeEventListener("mousemove",d,!1),Y.domElement.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",f,!1)},this.activeEventListener();var E={type:"change"},v={type:"start"},T={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},C=b.NONE,M=1e-6,L=new THREE.Spherical,S=new THREE.Spherical,Z=1,y=new THREE.Vector3,w=!1,H=new THREE.Vector2,B=new THREE.Vector2,X=new THREE.Vector2,D=new THREE.Vector2,J=new THREE.Vector2,x=new THREE.Vector2,R=new THREE.Vector2,P=new THREE.Vector2,A=new THREE.Vector2,Q=function(){var e=new THREE.Vector3;return function(t,o){e.setFromMatrixColumn(o,0),e.multiplyScalar(-t),y.add(e)}}(),F=function(){var e=new THREE.Vector3;return function(t,o){e.setFromMatrixColumn(o,1),e.multiplyScalar(t),y.add(e)}}(),G=function(){var e=new THREE.Vector3;return function(t,o){var n=Y.domElement===document?Y.domElement.body:Y.domElement;if(Y.camera instanceof THREE.PerspectiveCamera){var s=Y.camera.position;e.copy(s).sub(Y.target);var i=e.length();i*=Math.tan(Y.camera.fov/2*Math.PI/180),Q(2*t*i/n.clientHeight,Y.camera.matrix),F(2*o*i/n.clientHeight,Y.camera.matrix)}else Y.camera instanceof THREE.OrthographicCamera?(Q(t*(Y.camera.right-Y.camera.left)/Y.camera.zoom/n.clientWidth,Y.camera.matrix),F(o*(Y.camera.top-Y.camera.bottom)/Y.camera.zoom/n.clientHeight,Y.camera.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),Y.enablePan=!1)}}();this.update()},BIMWINNER.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),BIMWINNER.OrbitControls.prototype.constructor=BIMWINNER.OrbitControls,Object.defineProperties(BIMWINNER.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),BIMWINNER.Debug=function(e){var t=this;this.debugMode={},this.modeState={lightDubug:!1,cameraDubug:!1,materialDubug:!1,geometryDubug:!1},this.lightDebug=function(){var e=new dat.GUI;this.update=function(){},this.destroy=function(){e.destroy()}},this.render=function(){t.modeState.lightDubug?t.debugMode.lightDubug.update():t.modeState.cameraDubug&&t.debugMode.cameraDubug.update(),t.modeState.materialDubug&&t.debugMode.materialDubug.update(),t.modeState.geometryDubug&&t.debugMode.geometryDubug.update()};!function(){var o={lightDubug:!1,cameraDubug:!1,materialDubug:!1,geometryDubug:!1},n=new dat.GUI;n.add(o,"lightDubug").onChange(function(){t.modeState.lightDubug=!t.modeState.lightDubug,t.modeState.lightDubug?t.debugMode.lightDubug=new BIMWINNER.Debug.LightDebug(e):t.debugMode.lightDubug&&t.debugMode.lightDubug.destroy()}),n.add(o,"cameraDubug").onChange(function(){t.modeState.cameraDubug=!t.modeState.cameraDubug,t.modeState.cameraDubug?t.debugMode.cameraDubug=new BIMWINNER.Debug.CameraDebug(e):t.debugMode.cameraDubug&&t.debugMode.cameraDubug.destroy()}),n.add(o,"materialDubug").onChange(function(){t.modeState.materialDubug=!t.modeState.materialDubug,t.modeState.materialDubug?t.debugMode.materialDubug=new BIMWINNER.Debug.MaterialDebug(e):t.debugMode.materialDubug&&t.debugMode.materialDubug.destroy()}),n.add(o,"geometryDubug").onChange(function(){t.modeState.geometryDubug=!t.modeState.geometryDubug,t.modeState.geometryDubug?t.debugMode.geometryDubug=new BIMWINNER.Debug.GeometryDebug(e):t.debugMode.geometryDubug&&t.debugMode.geometryDubug.destroy()})}()},BIMWINNER.Debug.GeometryDebug=function(e){var t=new dat.GUI,o=1,n=!1,s=!0,i=this,a=new function(){this.positionX=0,this.positionY=0,this.positionZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this.visible=!0,this.width=0,this.height=0,this.depth=0,this.vertices=0,this.faces=0};t.remember(a),this.update=function(){1!=o&&n&&(o.position.set(a.positionX,a.positionY,a.positionZ),o.scale.set(a.scaleX,a.scaleY,a.scaleZ),o.rotation.set(a.rotationX*Math.PI/180,a.rotationY*Math.PI/180,a.rotationZ*Math.PI/180),o.visible=a.visible,o.geometry instanceof THREE.BufferGeometry&&(o.geometry.width=a.width,o.geometry.height=a.height,o.geometry.depth=a.depth))},this.destroy=function(){t.destroy()};this.init=function(){var e=t.addFolder("selected model position");e.add(a,"positionX").min(o.position.x/10).max(10*o.position.x).step(10).listen(),e.add(a,"positionY").min(o.position.y/10).max(10*o.position.y).step(10).listen(),e.add(a,"positionZ").min(o.position.z/10).max(10*o.position.z).step(10).listen();var n=t.addFolder("selected model scale");n.add(a,"scaleX").min(o.scale.x/50).max(10*o.scale.x).step(.01).listen(),n.add(a,"scaleY").min(o.scale.y/50).max(10*o.scale.y).step(.01).listen(),n.add(a,"scaleZ").min(o.scale.z/50).max(10*o.scale.z).step(.01).listen();var s=t.addFolder("selected model rotation");s.add(a,"rotationX").min(0).max(360).step(5).listen(),s.add(a,"rotationY").min(0).max(360).step(5).listen(),s.add(a,"rotationZ").min(0).max(360).step(5).listen();if(t.addFolder("selected model visible").add(a,"visible"),o.geometry instanceof THREE.BufferGeometry){(i=t.addFolder("selected model size")).add(a,"width"),i.add(a,"height"),i.add(a,"depth")}else if(o.geometry instanceof THREE.Geometry){var i=t.addFolder("selected model v&f");i.add(a,"vertices").listen(),i.add(a,"faces").listen()}},e.listentoSelectObjs(function(e,t){(function(e){a.positionX=e.position.x,a.positionY=e.position.y,a.positionZ=e.position.z,a.scaleX=e.scale.x,a.scaleY=e.scale.y,a.scaleZ=e.scale.z,a.rotationX=180*e.rotation.x/Math.PI,a.rotationY=180*e.rotation.y/Math.PI,a.rotationZ=180*e.rotation.z/Math.PI,a.visible=e.visible,e.geometry instanceof THREE.BufferGeometry?(a.width=e.width,a.height=e.height,a.depth=e.depth):e.geometry instanceof THREE.Geometry&&(a.vertices=e.geometry.vertices.length,a.faces=e.geometry.faces.length),n=!0})(o=t[e]),s&&(i.init(),s=!1),console.log()})},BIMWINNER.Debug.MaterialDebug=function(e){var t=new dat.GUI,o=1,n=!1,s=!0,i=!1,a=this,r=new function(){this.type=[],this.color=[0,128,255],this.roughness=1,this.side="Double",this.opacity=1,this.transparent=!1,this.alphaTest=0};t.remember(r),this.update=function(){if(1!=o&&n&&o.material){var t=o.material;if(r.type,i){var s=[r.color[0]/255,r.color[1]/255,r.color[2]/255];console.log("update color"),e.setColorProcess(s),i=!1}if(void 0!==t.roughness&&Math.abs(t.roughness-r.roughness)>=.01&&(o.material.roughness=r.roughness,o.material.needsUpdate=!0),void 0!==t.side){var a=function(e){var t=2;return"Front"==e?t=0:"Back"==e&&(t=1),t}(r.side);o.material.side!==a&&(o.material.side=a,o.material.needsUpdate=!0,e.renderer.render(e.scene,e.camera))}void 0!==t.opacity&&(o.material.opacity=r.opacity,o.material.needsUpdate=!0),void 0!==t.transparent&&(o.material.transparent=r.transparent,o.material.needsUpdate=!0),void 0!==t.alphaTest&&(o.material.alphaTest=r.alphaTest,o.material.needsUpdate=!0)}},this.destroy=function(){t.destroy()};this.init=function(){t.addFolder("material type").add(r,"type").listen(),t.addColor(r,"color").onChange(function(e){r.color=e,i=!0,console.log(r.color[0]+":"+r.color[1]+":"+r.color[2])}).listen(),t.add(r,"roughness").listen(),t.add(r,"side").listen(),t.add(r,"opacity",0,1).listen(),t.add(r,"transparent").listen(),t.add(r,"alphaTest",0,1).step(.01).listen()},e.listentoSelectObjs(function(e,t){(function(e){r.type=e.material.name||"MeshLambertMaterial",e.material.color&&(r.color[0]=255*e.material.color.r,r.color[1]=255*e.material.color.g,r.color[2]=255*e.material.color.b,console.log("init:"+r.color[0],r.color[1],r.color[2])),e.material.roughness?r.roughness=e.material.roughness:r.roughness="no support.",e.material.side&&(r.side=function(e){return 0==e?"Front":1==e?"Back":"Double"}(e.material.side)),e.material.opacity&&(r.opacity=e.material.opacity),e.material.transparent&&(r.transparent=e.material.transparent),e.material.alphaTest&&(r.alphaTest=e.material.alphaTest),n=!0})(o=t[e]),s&&(a.init(),s=!1)})},BIMWINNER.Debug.CameraDebug=function(e){var t=new dat.GUI,o=e.camera,n=new function(){this.SwitchCamera=function(){e.switchCamera()},this.updateCameraState=function(){this.cameraType=o.name,this.positionX=o.position.x,this.positionY=o.position.y,this.positionZ=o.position.z,this.rotationX=o.rotation.x*THREE.Math.RAD2DEG,this.rotationY=o.rotation.y*THREE.Math.RAD2DEG,this.rotationZ=o.rotation.z*THREE.Math.RAD2DEG,this.scaleX=o.scale.x,this.scaleY=o.scale.y,this.scaleZ=o.scale.z,this.fov=o.fov||0,this.near=o.near||0,this.far=o.far||0,e.cameraControl.wheelingFlag=!1}};this.update=function(){o!=e.camera&&(o=e.camera,n.updateCameraState()),-1!=e.cameraControl.controlState||e.cameraControl.wheelingFlag||e.fly._flying?n.updateCameraState():(o.position.copy(new THREE.Vector3(n.positionX,n.positionY,n.positionZ)),o.rotation.copy(new THREE.Euler(n.rotationX*THREE.Math.DEG2RAD,n.rotationY*THREE.Math.DEG2RAD,n.rotationZ*THREE.Math.DEG2RAD)),o.scale.copy(new THREE.Vector3(n.scaleX,n.scaleY,n.scaleZ)),o.fov=n.fov,o.near=n.near,o.far=n.far,o.updateProjectionMatrix())},this.build=function(){t.add(n,"cameraType").listen(),t.add(n,"SwitchCamera");var o=e.modelBounds.min,s=e.modelBounds.max,i=t.addFolder("Camera position");i.add(n,"positionX").min(20*o.x).max(20*s.x).step(1).listen(),i.add(n,"positionY").min(20*o.y).max(20*s.y).step(1).listen(),i.add(n,"positionZ").min(20*o.z).max(20*s.z).step(1).listen();var a=t.addFolder("Camera rotation");a.add(n,"rotationX").min(-360).max(360).step(.01).listen(),a.add(n,"rotationY").min(-360).max(360).step(.01).listen(),a.add(n,"rotationZ").min(-360).max(360).step(.01).listen();var r=t.addFolder("Camera scale");r.add(n,"scaleX").min(.01).max(10).step(.01).listen(),r.add(n,"scaleY").min(.01).max(10).step(.01).listen(),r.add(n,"scaleZ").min(.01).max(10).step(.01).listen();var l=t.addFolder("Other");l.add(n,"fov").min(-360).max(360).step(.01).listen(),l.add(n,"near").step(10).listen(),l.add(n,"far").step(100).listen()},this.destroy=function(){t.destroy(),e.controls.forEach(function(e){e.activeZoom()})},n.updateCameraState(),t.remember(n),e.controls.forEach(function(e){e.forbidZoom()}),this.build()},BIMWINNER.Debug.LightDebug=function(e){var t,o=new dat.GUI,n=!1,s=!0,i=e.ambientLight,a=e.light,r=this,l=new function(){this.light={},this.positionX=0,this.positionY=0,this.positionZ=0,this.intensity=1},c={ambientColor:[0,128,255,1],dirColor:[0,128,255,1],spotLight:function(){e.light=new THREE.SpotLight("#FF0000"),(t=e.light).position.set(0,1e3,0);var o=new THREE.CubeGeometry(100,100,100),n=new THREE.MeshBasicMaterial({color:11299877}),s=new THREE.Mesh(o,n);s.position.copy(new THREE.Vector3(0,0,0)),e.scene.add(t),e.scene.add(s),console.log("haha")}},d=new function(){this.castShadow=!0};o.remember(l),this.update=function(){i&&n&&i.color&&e.ambientLight.color.setRGB(c.ambientColor[0]/255,c.ambientColor[1]/255,c.ambientColor[2]/255),a&&a.color&&n&&e.light.color.setRGB(c.dirColor[0]/255,c.dirColor[1]/255,c.dirColor[2]/255),a&&a.position&&n&&e.light.position.set(l.positionX,l.positionY,l.positionZ),a&&a.intensity&&n&&(e.light.intensity=l.intensity),a&&n&&(e.light.castShadow=d.castShadow)},this.destroy=function(){o.destroy()};this.init=function(){var e=o.addFolder("DirectionalLight");e.addColor(c,"dirColor").listen(),e.add(l,"intensity",0,5).listen(),e.add(d,"castShadow").listen();var t=e.addFolder("position");t.add(l,"positionX",-5,5).listen(),t.add(l,"positionY",-5,5).listen(),t.add(l,"positionZ",-5,5).listen();o.addFolder("Ambient Light").addColor(c,"ambientColor").listen()},this.start=function(){i&&i.color&&(c.ambientColor[0]=255*i.color.r,c.ambientColor[1]=255*i.color.g,c.ambientColor[2]=255*i.color.b),a&&a.color&&(c.dirColor[0]=255*a.color.r,c.dirColor[1]=255*a.color.g,c.dirColor[2]=255*a.color.b),a&&a.position&&(l.positionX=a.position.x,l.positionY=a.position.y,l.positionZ=a.position.z),a&&a.intensity&&(l.intensity=e.light.intensity),a&&a.castShadow&&(d.castShadow=e.light.castShadow),n=!0,s&&(r.init(),s=!1)},this.start()},BIMWINNER.ViewController=function(e,t){function o(t){t.preventDefault();var o=e._getClickCoordsWithinElement(t),s=n.scene.userData.element.getBoundingClientRect(),i=s.right-s.left,a=s.bottom-s.top;f.x=o[0]/i*2-1,f.y=-o[1]/a*2+1,m.setFromCamera(f,n.scene.userData.camera);var r=m.intersectObjects(n.scene.userData.objects);r.length>0&&function(t){var o=t.position.clone();o.x=o.x||.5,o.y=o.y||.5,o.z=o.z||.5;var s=n.scene.userData.camera,i=n.scene.userData.cameraDistance||s.position.length(),a=new THREE.Vector3(o.x,o.y,o.z);a.setLength(i),n.scene.userData.fly.flyTo({eye:a,look:[0,0,0]}),n.scene.userData.cameraLastRotation=s.rotation.clone();var r=n.mainScene.userData.camera,l=e.modelBounds.getSize(),c=o.x/4*l.x,d=o.y/4*l.y,u=o.z/4*l.z,p=e.modelBounds.getCenter(),f=new THREE.Vector3(c+p.x,d+p.y,u+p.z);n.mainScene.userData.fly.flyTo({eye:new THREE.Vector3(f.x,f.y,f.z),look:e.originalCamera.look}),n.mainScene.userData.cameraLastRotation=r.rotation.clone()}(r[0].object)}var n=this,s=e.imgURL||"";s.endsWith("/")||""==s||(s+="/"),this.render=function(){n.renderer.render(n.scene,n.camera)},this.updateMainCamera=function(){scene.userData.camera=e.camera,scene.userData.cameraLastRotation=e.camera.rotation.clone(),scene.userData.controls=e.cameraControl,scene.userData.fly=e.fly,function(e){var t=n.scene.userData.camera,o=new THREE.Vector3(e.x,e.y,e.z);o.setLength(t.position.length()),t.position.set(o.x,o.y,o.z),t.lookAt(n.scene.position),n.scene.userData.cameraLastRotation=t.rotation.clone()}(scene.userData.camera.position)};var i=[];n.mainScene=e.scene,n.mainScene.name="main",n.mainScene.userData.element=document.getElementById(t),n.mainScene.userData.objects=[],n.mainScene.userData.camera=e.camera,n.mainScene.userData.cameraLastRotation=e.camera.rotation.clone(),n.mainScene.userData.controls=e.cameraControl,n.mainScene.userData.fly=e.fly,i.push(n.mainScene),n.scene=new THREE.Scene,n.scene.name="viewcontroller";var a=document.createElement("div");a.className="list-item2",a.innerHTML="<div class='scene'></div>",n.scene.userData.element=a.querySelector(".scene"),e.viewportDiv.appendChild(a);var r=n.scene.userData.element.getBoundingClientRect(),l=r.right-r.left,c=r.bottom-r.top;n.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),n.renderer.setSize(l,c),n.renderer.sortObjects=!1,n.renderer.domElement.style.position="absolute",n.renderer.domElement.style.left="0px",n.renderer.domElement.style.top="0px",$(n.renderer.domElement).addClass("unselectable"),a.appendChild(n.renderer.domElement),n.scene.userData.renderer=n.renderer,n.camera=new THREE.PerspectiveCamera(45,1,.1,1e3),n.camera.up=new THREE.Vector3(0,0,1),n.camera.position.set(16,16,16),n.camera.lookAt(n.scene.position),n.scene.userData.camera=n.camera,n.scene.userData.cameraLastRotation=n.camera.rotation.clone(),n.scene.userData.cameraDistance=n.camera.position.length(),n.controls=new BIMWINNER.OrbitControls(n.scene.userData.camera,e.renderer.domElement),n.controls.enablePan=!1,n.controls.enableZoom=!1,n.scene.userData.controls=n.controls,n.scene.userData.fly=new BIMWINNER.CameraFlyAnimation(e,n.camera,n.controls),n.scene.userData.objects=[];var d=function(e){var t=new THREE.Mesh,o=new THREE.TextureLoader;o.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAJYSURBVHhe7djdUcMwEABh+kk99EM91EM/IZgwOMiydIrtvYT93jIZ++FWPzN+OQtlAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaApQzw/vpycXr7uP6Ou/8NR8kT4HtmN17fr/8FLbwqbQw6wNKsZkYSfLydrk9XjHbdBb8DNk7wWOPPcQStJwidHa3x5zuIUtwBjbF1T+3xxp/mEm6Mru/Y2OE+2d8BARpzSeboTAb4wwAwA8AMADMAzACwJwygNQaAGQB2aIAdboPg553aJw/uK9FTBVh+//xaNcDWDBBhgJIBJgYYZYAIA5RSBJiPqKJrcgZoMEDJABMDtBhgCwYopQhwBwNEGKBkgIkBRhkgwgAlA0z+eYD5iCq6JmeABgOUDDAxQIsBtlALcAcDRBigZICJAUYZIMIAJQNM/nmA+YgquiZngIa9A7QZYJEBDnJHgNqjBogYD1B7Mji5jV6zpYcIUJ1baHK11f/FAD/WprTkpl304V8dh+BO0u2A2BD/rNzRAtwGSHgErZw3hWJwkYdnuA2QMEBgFZdzG9oC4PpPeQn3DnFx2Q4UAJf/RcIAPedIfdEGDyF09X/JGGB1FbfWa2QLsGv/26EBDtGxBTIM/sfzBXgwBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFQ5/MnLWE6OZbV2ZsAAAAASUVORK5CYII=",function(o){var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:o,overdraw:!0,color:16777215,side:THREE.DoubleSide}));n.position.set(5,0,0),n.rotation.y=.5*Math.PI,n.rotation.x=.5*Math.PI,t.add(n),e.userData.objects.push(n)}),o.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAANxSURBVHhe7d1/kpowHIZx6HGE4yx6HOA6uscBr0PzJU6nXRGR8iPhfT4zsdrdP7rl2SSMimnnJJD16/EnRBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEII4AxEUZQN0mSZrmbqR/RnI7P76KT0R3qVh37JM8r92dyv/Fhwo3rt31cQ/RBZC7X/+2yh+P9tFdXTyFRXQAFkAsqsZizSzY6IZLxv0EV/+DBCSaPYBN/dXFTf39PSwlmgAutvObue7jtSgC8Mf+8niEJQUfAFP/uoIPIHOja0rbQT0NvydkWfgf0ewBhozF8XO4/bf7bs79f4o6gE/YoXenYU9hvBtHn2VkAphr6ixTXG2GiQ8BiCMAcQQgjgDEBR3AzY00Pf/zvH+o43ZO/T86MswA4ghAHAGIIwBxBCCOAMQRgLigA5j7DN4egyeDECUCEEcA4ghAXFQB2NvChp6I2Wu09b5vUVsCM8BG7nbT9rdBIQBxBLCQ7NTf9veH9G9ruYf35hYC2FB7Zwk4rFP/y99PA1EhgA3dW5aAw/JbgNd7AONXgLAiOFQAduWWoSdq5o5PLgPjV4DxJcBPAGHtA5gBFpT5U4GX7FXOya2/DQYBbCy0MwECWNDJnwqM+r7ZOhDOPoAAFlT0lx8YvwZBaPsAAljQlDOB0PYBBLCgKWcCpq4tgDCWAQJYWOHXgVF+G/DtH+yMABb27kkh449/GMvAoQI4u//ToRduzB1zrkD+Zcc+ez8L1JVlsH8EzAAL88f/yz8Y0e8Carv+4b4IYAWFnwb8gxEhzAIEsIKpy4Ad+tt53w+6IIAVTF0GjO1b9vy0EwJYyZRlwL7aNZX75v0+fIIAVlLa0S1K/2BA5b7edI2r4PX3bIEAVlSVtg94ngXsdQtlY28mHZ8htnCoAPZ8QciQoVmgcb/6Ib2TmBlgZX/PAvZhU1nppv2ARPepYTHK3Va/Ke+7r/dDCEAcS4A4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQFqS/Aa1yHFb/IK5cAAAAABJRU5ErkJggg==",function(o){var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:o,overdraw:!0,color:16777215,side:THREE.DoubleSide}));n.position.set(-5,0,0),n.rotation.y=.5*Math.PI,n.rotation.x=.5*Math.PI,t.add(n),e.userData.objects.push(n)}),o.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAANNSURBVHhe7d0BbtowGIbhnx0H5ziYHofkOEt6nJjrZE4XbWKDxgiIbb73kdCQKlWb/MZ2Esh2U2SQ9WP5E6IIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEvUUAoWtst9tdvprOwvJz3PYGAQT7HK4MdWit+RNEYx01XPUGAZwtrA7u3vZueYsL9QcQzjGBFd6bX97iUv0BnMPqWu/cfnmHf1UfwDAMy7tbnPkD8/8tlQcQ7Lw6/7P+f6fuAMKnXTsBuMD6/735cfFZjO0UD8z5UfXv+fL98g8tW/2bQDyEAMQRgDgCEEcA4ghAHAGIq++/jQudNU27cv3fWz/1XABKUN0MED6H9Q96cPUvWWUBDNa1q8Mfx5/hT1VVAKHrYgIrXGsnxj9ZRQGkHf3OH4ybf+mqCSDp6I8r/+nE8N+jkgDSjn42f/erIoC0o99Zy+J/t/KvAySd90e+t6kngLvNAZQsjunlBy1Kfbl2Gpe/c03KXgKGox3X5348oOAABjsy+i9XbADD8Ziw8cOjygyAqX8zBQbA1L+l4gJg6t9WWQEw9W9vOR3M744virj23jPucWrd9d/19+WnOr7K8VyFzADBuo+Eq30z39vIDZ+nKSKA4dhYyr2e+W5fz+Xep8oewPx8n9R13/d8zu/Z8gYQOvtIO/S/pn4O/ufLGEA830+5yzdzrY2M/ktkCiBu+prU831n7c8TH/N6kUwBpDzZ6zffj8am/3UyBeDtFE/M18Tzfdb9F8u2B3AH//20zvn+JvJtAt3B/K3xZdO3mXwBxOP/cLUAb/3Ipm8rGQO4tgzEHf/IxZ4tZQ3gchmYB58d/+aWm0LZjK37uhv331PVan+MHI+JSzMvA20/cbqXSfYAzJ34Nm9G+QNAVgQgjgDEEYA4AhBX32Pi8FTMAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHAOIIQBwBiCMAcQQgjgDEEYA4AhBHANLMfgFpVKNHofN0wAAAAABJRU5ErkJggg==",function(o){var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:o,overdraw:!0,color:16777215,side:THREE.DoubleSide}));n.position.set(0,-5,0),n.rotation.x=.5*Math.PI,t.add(n),e.userData.objects.push(n)}),o.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAANNSURBVHhe7d1tcpswGEVh6HIMy7HZDrCcQJeD1+PqRfTDGYPVGcCS7nlmoCHJj2Z0IgyWnfLhFJD1Y/kXoghAHAGIIwBxBCCOAMQRgDgCEEcA4ghAHAGIIwBxBCCOAMQRgDgCEEcA4ghAHAGIIwBxBCCOAMQRgDgCEEcA4ghAHAGIIwBxBCCOAMQRgDgCEEcA4ghAHAGIIwBxBPCPur8XZVn+2YqxWb6SL9kAmrF4Gmzb7l29fNUbR/dNmZMN4Hab9/PHa/z45x2BbgDz7k0A844AstW1FkDlD1bkfhqQDuBqY19pnwakA/Djf/UHK2zo733vDzIkHYBpW8tgexb4Od7d3rYM2ZtFx2ZwmxsUexPrLDeX2/JTfp78DKCOAMQRgDgCEEcA4ghAHAGI449GfWO3e+q6dx90/hMrHoO7mr8Ny1G6COAFWyswNuVy9JrdOxweFsD2XcTYcQp4wX653/1223MEY5P+iiECWBHyVLHNFKkvGyOAFfYcUdV9LUfrGl+BP0gQAWz48hUsR6/Z0Pe1zQJpPlvIg8A3Qh4QmqmriqqdlqN0EECA0lewHK1L8dKQU0CAwV8W+IMNtYVyT2z1kM0AsZvc5s7F82KK2DeXifvfxrHYIwQzwM5Se1BIAAfo3Nj3tb3KKP4ICOAgFsHYPL/ULEYEcKDQS8hPIoCDxR4BAZwg5ggI4CQWQV9bBHE9MMwmALsV6y5rD9v2uMMX49UBM8DJLIKmtAjsjsHnEcBOQt5w4jcb+lhecEoAO7GhD10iNr8q+RoWy9EIYEehEVxsV837jyOAndnQTxbBxkKS/zldHI0ADmBT/DS1qxFcqu21hmcigIPYED8sgm+XjzGd/w0BHMxWCVXd36ViMZ3/DQGcYGorNxHYehE39vPsTwBybFVZNz2Ky2U+CfhPRoAATmSrzG9DXCuHCUBcNgHU3fM7fe+9hSwLTxEzgDgCEEcA4ghAHAGIIwBxBCAumwBSWBQaI2YAcQQgjgDE8RYx4pgBxBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEII4AxBGAOAIQRwDiCEAcAYgjAHEEIK0ofgGOGAAUafTbiQAAAABJRU5ErkJggg==",function(o){var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:o,overdraw:!0,color:16777215,side:THREE.DoubleSide}));n.position.set(0,5,0),n.rotation.x=.5*Math.PI,t.add(n),e.userData.objects.push(n)}),o.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAFwSURBVHhe7drBCcJAFEDBxHa0Ha1H24ntaD3Rw149qOigvLlsDmEJPD4Edud1Xac4m7EGKQBWAKwAWAGwAmAFwAqAFQArAFYArABYAbACYAXACoAVACsAVgCsAFgBsAJgBcAKgBUAKwBWAKwAWAGwAmAFwAqAFQArAFYArABYAbDfCHA97eaHDufx1k9qArACYAXACoAVACsAVgCsAFgBsAJgBcAKgBUAKwBWAKwA2B8EOB/Gycyr6IlOE4AVACsAVgCsAFgBsAJgfxBgv6zvWfZjJ6EJwAqAFQArAFYArABYAbACYAXACoAVACsAVgCsAFgBsAJgBcAKgBUAKwBWAG3cDPgoeu3gKdvjZXzztzQBWAGwAmAFwAqAFQArADbff0XHY4QmACsAVgCsAFgBsAJgBcAKgBUAKwBWAKwAWAGwAmAFwAqAFQArAFYArABYAbACYAXACoAVACsAVgCsAFgBsAJgBcAKgBUAKwA1TTeT+CFOQxv/cQAAAABJRU5ErkJggg==",function(o){var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:o,overdraw:!0,color:16777215,side:THREE.DoubleSide}));n.position.set(0,0,5),n.rotation.z=.5*Math.PI,t.add(n),e.userData.objects.push(n)}),o.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAKdSURBVHhe7d1rTsJAFEDhqdsp26Hbad1O2c64njqXR6IRClRIpj3nS4xA/EPmcNuBqs1UJGF9nL8LygDgDADOAOAMAM4A4AwAzgDgDADOAOAMAM4A4AwAzgDgDADOAOAMAM4A4AwAzgDgDADOAOAMAM4A4AwAzgDgDADOAOAMAM4A4AwAzgDgDADOAOAMAM4A4AwAzgDgDADOAOAMAM4A4KoIoDuk1DTNpr/SoTs/27o4AeAMAM4A4AwAzgDgDADOAOBQ/zKmiTcc7uzHhzalPudyq9wAcALAGQCcAcAZAJwBwBkA3CYD2H1+ld1ec76nOZsKoOzyU9N06WvYHa8xMIL7NhNALHgXF14cMzgxgvs2EUC8w3droY1g3qoDiNd6jPyywqcHbjCC21YbwLWRPyd+/l4oRKsMYG7k6zmrCuDRkX/NNO5T2o/ne7pYTQDPjvyL+Hh3mrKLf8MqAlg68nNZ/T7H5Q6Mz/aXqDqApSM/lnvKQ2r7uLBDc6oNYOnIL0f6lKcy7tv+9IBmVRnA0pEf53nj8Qq3yECPqCqApSM/xFn+fsRc3vgyVQXQxdx/cuRfjvee5S9TVQA5ZnhbFvNBscXLscXzeL9YVQHEqznnspgPRBCtuMX7v+pOAmM5x4hg5kTO4/3rVBdAiKUfchzTf7+6457H+9eqMoDQl9UefvyGTkTh/v71qg0gRAT7Mbu/f6OqAwix+B7v36f6APReBgBnAHAGAGcAcAYAZwBwBgBnAHAGAGcAcAYAZwBwBgBnAHAGAGcAcKi/Fq6/nABwBgBnAHAGAGcAcAYAZwBwBgBnAHAGAGcAcAYAZwBwBgBnAHAGAGcAcAYAZwBwBgBnAHAGAGcAcAYAZwBwBgBnAHAGAGcAcAaAltI3vumFnEGuKKYAAAAASUVORK5CYII=",function(o){var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:o,overdraw:!0,color:16777215,side:THREE.DoubleSide}));n.position.set(0,0,-5),n.rotation.z=.5*Math.PI,t.add(n),e.userData.objects.push(n)});var n=new THREE.BoxBufferGeometry(2,6,2),s=new THREE.Mesh(n,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));s.position.set(4,0,4),t.add(s),e.userData.objects.push(s);var i=new THREE.Mesh(n,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));i.position.set(4,0,-4),t.add(i),e.userData.objects.push(i);var a=new THREE.Mesh(n,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));a.position.set(-4,0,4),t.add(a),e.userData.objects.push(a);var r=new THREE.Mesh(n,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));r.position.set(-4,0,-4),t.add(r),e.userData.objects.push(r);var l=new THREE.BoxBufferGeometry(6,2,2),c=new THREE.Mesh(l,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));c.position.set(0,-4,4),t.add(c),e.userData.objects.push(c);var d=new THREE.Mesh(l,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));d.position.set(0,-4,-4),t.add(d),e.userData.objects.push(d);var u=new THREE.Mesh(l,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));u.position.set(0,4,4),t.add(u),e.userData.objects.push(u);var p=new THREE.Mesh(l,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));p.position.set(0,4,-4),t.add(p),e.userData.objects.push(p);var f=new THREE.BoxBufferGeometry(2,2,6),m=new THREE.Mesh(f,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));m.position.set(4,-4,0),t.add(m),e.userData.objects.push(m);var h=new THREE.Mesh(f,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));h.position.set(4,4,0),t.add(h),e.userData.objects.push(h);var g=new THREE.Mesh(f,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));g.position.set(-4,-4,0),t.add(g),e.userData.objects.push(g);var Y=new THREE.Mesh(f,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));Y.position.set(-4,4,0),t.add(Y),e.userData.objects.push(Y);var E=new THREE.BoxBufferGeometry(2,2,2),v=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));v.position.set(4,-4,4),t.add(v),e.userData.objects.push(v);var T=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));T.position.set(4,-4,-4),t.add(T),e.userData.objects.push(T);var b=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));b.position.set(4,4,4),t.add(b),e.userData.objects.push(b);var C=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));C.position.set(4,4,-4),t.add(C),e.userData.objects.push(C);var M=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));M.position.set(-4,-4,4),t.add(M),e.userData.objects.push(M);var L=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));L.position.set(-4,-4,-4),t.add(L),e.userData.objects.push(L);var S=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));S.position.set(-4,4,4),t.add(S),e.userData.objects.push(S);var Z=new THREE.Mesh(E,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));return Z.name="back_right_bottom",Z.position.set(-4,4,-4),t.add(Z),e.userData.objects.push(Z),t}(n.scene),u=new THREE.BoxHelper(d,0);n.scene.add(d),n.scene.add(u),i.push(n.scene),document.getElementById(e.viewport).addEventListener("mousemove",function(t){var o=e._getClickCoordsWithinElement(t),s=n.scene.userData.element.getBoundingClientRect(),i=s.right-s.left,a=s.bottom-s.top;f.x=o[0]/i*2-1,f.y=-o[1]/a*2+1,m.setFromCamera(f,n.scene.userData.camera);var r=m.intersectObjects(n.scene.userData.objects);r.length>0?p!=r[0].object&&(p&&p.material.color.set(p.currentColor),(p=r[0].object).currentColor=p.material.color.clone(),p.material.color.set(16761035)):(p&&p.material.color.set(p.currentColor),p=null),n.render()},!1),n.renderer.domElement.addEventListener("mousedown",o,!1),n.render();var p,f=new THREE.Vector2,m=new THREE.Raycaster},BIMWINNER.ObjectMessageLabel=function(e){var t,o,n=this,s=(new BIMWINNER.Listener,150),i=150,a="#555555",r="";this.init=function(){t=$('<div class=msgdiv style="position: absolute;top:0px;left:0px;width:'+s+"px;height:"+i+"px;background-color:"+a+';opacity: 0;z-index: 5000;padding: 10px;border-radius: 5px;">'),(o=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;">')).html(r),t.append(o);var l="#"+e.viewport;$(l).append(t),e.listener.on("tick",function(){t[0].style.opacity="0.0",e.objectSet.numObjects&&function(o){var s;for(var i in o)s=o[i];var a=e.get2DCoordFrom3DCoord(s.position.clone());t[0].style.top=a[1]+"px",t[0].style.left=a[0]+"px",t[0].style.opacity="0.5",n.setText("构件"+s.id)}(e.objectSet.objects)})},this.setLabelSize=function(e,o){s=e,i=o,t[0].style.width=s+"px",t[0].style.height=i+"px"},this.setBackground=function(e){a=e,t[0].style.backgroundColor=a},this.setText=function(e){r=e,o.html(r)}},BIMWINNER.CollisionDetection=function(e,t){var o=this;this.height=e.height?e.height:1800,this.eyeHeight=e.eyeHeight?e.eyeHeight:this.height-120,this.width=e.width?e.width:450,this.thickness=e.thickness?e.thickness:220,this.up=e.up?e.up:new THREE.Vector3(0,0,1);var n,s,i,a,r=new THREE.Raycaster,l=new THREE.Raycaster,c=new THREE.Raycaster,d=new THREE.Raycaster,u=new THREE.Raycaster,p=new THREE.Raycaster,f=new THREE.Raycaster,m=new THREE.Raycaster,h=new THREE.Raycaster,g=new THREE.Raycaster;this.run=function(e,Y){var E={};return r.set(e,new THREE.Vector3(0,0,1)),l.set(e,new THREE.Vector3(0,0,-1)),u.set(e,Y),p.set(e,new THREE.Vector3(-Y.x,-Y.y,-Y.z)),c.set(e,new THREE.Vector3(-Y.y,Y.x,Y.z)),d.set(e,new THREE.Vector3(Y.y,-Y.x,Y.z)),n=new THREE.Vector3(e.x+-o.width*Y.y/2,e.y+o.width*Y.x/2,e.z+Y.z),s=new THREE.Vector3(e.x+o.width*Y.y/2,e.y+-o.width*Y.x/2,e.z+Y.z),i=new THREE.Vector3(e.x+o.thickness*Y.x/2,e.y+o.thickness*Y.y/2,e.z+Y.z),a=new THREE.Vector3(e.x+-o.thickness*Y.x/2,e.y+-o.thickness*Y.y/2,e.z+Y.z),f.set(n,new THREE.Vector3(0,0,-1)),m.set(s,new THREE.Vector3(0,0,-1)),h.set(i,new THREE.Vector3(0,0,-1)),g.set(a,new THREE.Vector3(0,0,-1)),E.top=r.intersectObjects(t.root.children),E.bottom=l.intersectObjects(t.root.children),E.front=u.intersectObjects(t.root.children),E.back=p.intersectObjects(t.root.children),E.left=c.intersectObjects(t.root.children),E.right=d.intersectObjects(t.root.children),E.leftDown=f.intersectObjects(t.root.children),E.rightDown=m.intersectObjects(t.root.children),E.frontDown=h.intersectObjects(t.root.children),E.backDown=g.intersectObjects(t.root.children),E},this.getVerticalVector=function(e,t,o,n,s,i){var a=t*i-s*o,r=-(e*i-n*o),l=e*s-n*t,c={};return c.x=a,c.y=r,c.z=l,c},this.getRatioByLength=function(e,t,o,n){return Math.sqrt(e*e/(t*t+o*o+n*n))},this.drawMapForCode=function(e,t,o){if(t.front.length>0)new THREE.Geometry,t.front[0].point;this.temp=o.clone().sub(e.camera.position).normalize();this.temp.x,this.temp.y,this.temp.z;var n=this.getVerticalVector(0,0,100,this.temp.x,this.temp.y,this.temp.z),s=this.getRatioByLength(200,n.x,n.y,n.z),i=e.camera.position.x-s*n.x,a=e.camera.position.y-s*n.y,r=e.camera.position.z-s*n.z,l=e.camera.position.x+s*n.x,c=e.camera.position.y+s*n.y,d=e.camera.position.z+s*n.z;return this.collisionDetection(i,a,r,l,c,d,n,e)},this.resultValue=new Object,this.collisionDetection=function(e,o,n,s,i,a,r,l){var c={},d=new THREE.Raycaster,u=new THREE.Raycaster;if(d.set(new THREE.Vector3(e,o,n),new THREE.Vector3(-this.temp.x,-this.temp.y,-this.temp.z)),u.set(new THREE.Vector3(s,i,a),new THREE.Vector3(-this.temp.x,-this.temp.y,-this.temp.z)),c.resultLeft=d.intersectObjects(t.root.children),c.resultRight=u.intersectObjects(t.root.children),c.resultLeft.length>0){this.resultValue.leftResult=c.resultLeft[0].distance;c.resultLeft[0].point}if(c.resultRight.length>0){this.resultValue.rightResult=c.resultRight[0].distance;c.resultRight[0].point}return this.compUpDownVector(r,l),this.resultValue},this.compUpDownVector=function(e,o){var n=this.getVerticalVector(e.x,e.y,e.z,this.temp.x,this.temp.y,this.temp.y),s=this.getRatioByLength(70,n.x,n.y,n.z),i=this.getRatioByLength(200,this.temp.x,this.temp.y,this.temp.z),a=o.camera.position,r=a.x-i*this.temp.x,l=a.y-i*this.temp.y,c=a.z-i*this.temp.z,d=r-s*n.x,u=l-s*n.y,p=c-s*n.z,f=new THREE.Raycaster;f.set(new THREE.Vector3(d,u,p),new THREE.Vector3(n.x,n.y,n.z));var m=f.intersectObjects(t.root.children);m.length>0&&(this.resultValue.updownResult=m[0].distance)},drawPointByParameter=function(e,o,n,s,i){var a=new THREE.PointsMaterial({color:i,size:s}),r=new THREE.Vector3(e,o,n),l=new THREE.Geometry;l.vertices.push(r);r=new THREE.Points(l,a);t.scene.add(r)},this.drawLightAmongPoints=function(e,t,o,n,s,i,a,r){return this.collisionDetection(e,t,o,n,s,i,a,r)}},BIMWINNER.Viewer=function(options){function stats(){var e=this.stats=new Stats;e.setMode(0),e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.bottom="0px",$("body")[0].appendChild(e.domElement)}function tick(){self.listener.fire("tick",!0,!0),requestAnimationFrame(tick)}function requestAgain(e,t,o){++t<3?$.ajax({type:"GET",url:e,data:{},success:function(e){e.success?o(e.result):(console.warn("error: "+e.message),self.promptingMessage("warning",e.message))},error:function(e,n,s){requestAgain(this.url,t,o)}}):(console.warn("load component: "+e+" fail !"),self.promptingMessage("warning","加载 "+e+" 失败"))}function jiema(e){var t={},o=self.componentAttribute[e];for(var n in o)if("object"==typeof o[n]){t[decodeURIComponent(n)]={};for(var s in o[n])t[decodeURIComponent(n)][decodeURIComponent(s)]=decodeURIComponent(o[n][s])}else o[n];self.componentAttribute[e]=t}function unique(e){for(var t,o=[],n={},s=0;null!=(t=e[s]);s++)n[t]||(o.push(t),n[t]=!0);return o}var modelId=null;console.log("BIMWINNER VERSION_NUMBER : "+BIMWINNER.VERSION_NUMBER+" 状态："+BIMWINNER.VERSION_STATE),this.Lobibox=new BIMWINNER.lobibox;var Lobibox=this.Lobibox;Lobibox.viewport="#"+options.viewport,this.ajaxList=[];var self=this;this.subAjaxFromList=function(e){var t=self.ajaxList.indexOf(e);-1!==t&&self.ajaxList.splice(t,1)};var originalCameraLocation={};this.originalCamera=originalCameraLocation,this.className="BIMWINNER.Viewer";var uuid=this.uuid=THREE.Math.generateUUID();void 0==options.baseaddress?this.baseaddress="https://api.bos.xyz/":this.baseaddress=options.baseaddress,this.viewControllerFlag=options.viewController,this.DBversion=options.DBversion,this.webApiAddress=options.webApiAddress,void 0==options.cn?this.cn="":this.cn=options.cn,this.imgURL=options.imgURL,void 0==options.imgURL?this.imgURL="https://www.bos.xyz/vizbim/img":this.imgURL=options.imgURL,self.imgURL.endsWith("/")||""==self.imgURL||(self.imgURL=self.imgURL+"/"),this.type=options.type,this.appKey=options.appKey,this.accessToken=options.accessToken,this.accessToken=options.devcode,this.viewport=options.viewport,this.viewportDiv=document.getElementById(options.viewport);var my_innerview="my-innerview-"+uuid;this.viewerdiv=$('<div id="'+my_innerview+'" style="height: 100%; width:100%; margin:0 auto;position:relative" ></div>'),this.viewerdiv.appendTo(self.viewportDiv),this.renderer=new THREE.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!0}),self.renderer.setClearColor(new THREE.Color(15658734),1),self.renderer.setPixelRatio(window.devicePixelRatio),self.renderer.setSize($(self.viewportDiv).width(),$(self.viewportDiv).height()),self.viewerdiv[0].appendChild(self.renderer.domElement);var perspectiveCamera=new THREE.PerspectiveCamera(45,$(self.viewportDiv).width()/$(self.viewportDiv).height(),.01,1e4);perspectiveCamera.position=new THREE.Vector3(1,1,1),perspectiveCamera.up=new THREE.Vector3(0,0,1),perspectiveCamera.name="Perspective Camera";var orthographicCamera=new THREE.OrthographicCamera(-$(self.viewportDiv).width(),$(self.viewportDiv).width(),$(self.viewportDiv).height(),-$(self.viewportDiv).height(),10,1e4);orthographicCamera.position=new THREE.Vector3(1,1,1),orthographicCamera.up=new THREE.Vector3(0,0,1),orthographicCamera.name="Orthographic Camera",this.camera=perspectiveCamera;var perspectiveCameraControl=new BIMWINNER.OrbitControls(perspectiveCamera,self.renderer.domElement,self),orthographicCameraControl=new BIMWINNER.OrbitControls(orthographicCamera,self.renderer.domElement,self);orthographicCameraControl.disposeEventListener(),this.transfromControl=new BIMWINNER.TransformControls(self.camera,self.renderer.domElement,self),this.cameraControl=perspectiveCameraControl,this.controls=[perspectiveCameraControl,orthographicCameraControl];var perspectiveCameraFly=new BIMWINNER.CameraFlyAnimation(self,perspectiveCamera,perspectiveCameraControl),orthographicCameraFly=new BIMWINNER.CameraFlyAnimation(self,orthographicCamera,orthographicCameraControl);this.fly=perspectiveCameraFly,this.scene=new THREE.Scene,self.scene.add(self.transfromControl),!1===self.viewControllerFlag||(this.viewController=new BIMWINNER.ViewController(self,my_innerview)),this.switchCamera=function(){self.camera===orthographicCamera?(self.camera=perspectiveCamera,orthographicCameraControl.disposeEventListener(),perspectiveCameraControl.activeEventListener(),self.cameraControl=perspectiveCameraControl,self.fly=perspectiveCameraFly,self.promptingMessage("success","当前相机为透视相机")):(self.camera=orthographicCamera,perspectiveCameraControl.disposeEventListener(),orthographicCameraControl.activeEventListener(),self.cameraControl=orthographicCameraControl,self.fly=orthographicCameraFly,self.promptingMessage("success","当前相机为正交相机")),self.fly.flyTo({eye:originalCameraLocation.eye,look:originalCameraLocation.look,up:originalCameraLocation.up}),self.camera.zoom=originalCameraLocation.zoom,self.viewController.updateMainCamera()},this.clock=new THREE.Clock,this.input=new BIMWINNER.Input(self.renderer.domElement),this.root=new THREE.Object3D,self.scene.add(self.root),this.lights=new THREE.Object3D,self.scene.add(self.lights);var spotLight=new THREE.SpotLight(16777215);spotLight.position.set(5e3,5e3,5e3),spotLight.angle=Math.PI,spotLight.penumbra=.05,spotLight.decay=.5,spotLight.distance=0,self.lights.add(spotLight),spotLight.target=self.root;var ambientLight=new THREE.AmbientLight(16777215);ambientLight.intensity=.5,self.lights.add(ambientLight),this.calculateBoundary=!1,this.skybox={},this.components={},this.componentGeometrys={},this.componentAttribute={},this.componentData_Info={},this.firstModel=!0,this.documentInfo={},this.componentInfo={},this.componentType={},this.componentData={},this.componentLod={},this.components_primarities={},this.wallIdComp=[],this.noWallIdComp=[],this.alloids=[],this.modelExplosionCoefficient=0,this.modelBounds=new THREE.Box3,this.documentList=[],this.autoResize=!0,this.multiSelect=!1,this.listener=new BIMWINNER.Listener,this.objectSet=new BIMWINNER.ObjectSet(self),self.objectSet.listener.on("updated",function(){if(self.selectedPartsVal="",!$.isEmptyObject(self.objectSet.objects)){var e=self.objectSet.objects,t="";for(var o in e)t=t+o+",";t=t.substring(0,t.length-1),self.selectedPartsVal=t}}),this.ClickSelectObjects=new BIMWINNER.ClickSelectObjects(self,self.root),this.Flag={clip:!1,selectBox:!1,measuredDistance:!1},this.Measurement={measuredNode:{},tempLine:new THREE.Object3D,tempPoint:new THREE.Object3D,point1:{},point2:{},pointCoord1:{},pointCorrd2:{},line:{},mark1:{},mark2:{},markX:{},markY:{},markZ:{},lineX:{},lineY:{},lineZ:{},measureWindow:{}},this.Clip={Empty:Object.freeze([]),boundingBox:new THREE.Object3D,cuttingfirst:!0,clipFace:{front:{clipnum:0,x:1,y:0,z:0},back:{clipnum:1,x:-1,y:0,z:0},right:{clipnum:2,x:0,y:1,z:0},left:{clipnum:3,x:0,y:-1,z:0},top:{clipnum:4,x:0,y:0,z:1},bottom:{clipnum:5,x:0,y:0,z:-1}},clipFaceName:["global_front","global_back","global_right","global_left","global_top","global_bottom"],clipPlane:[new THREE.Plane(new THREE.Vector3(1,0,0),0),new THREE.Plane(new THREE.Vector3(-1,0,0),0),new THREE.Plane(new THREE.Vector3(0,1,0),0),new THREE.Plane(new THREE.Vector3(0,-1,0),0),new THREE.Plane(new THREE.Vector3(0,0,1),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0)],currentClipPlane:"",state:{}},this.SelectBox={boundingBox:new THREE.Object3D,selectFace:{front:{clipnum:0,x:1,y:0,z:0},back:{clipnum:1,x:-1,y:0,z:0},right:{clipnum:2,x:0,y:1,z:0},left:{clipnum:3,x:0,y:-1,z:0},top:{clipnum:4,x:0,y:0,z:1},bottom:{clipnum:5,x:0,y:0,z:-1}},selectFaceName:["global_front","global_back","global_right","global_left","global_top","global_bottom"],currentSelectPlane:"",selectBox:void 0,selected:[],unselected:[]},BIMWINNER.DEBUG&&(self.debug=new BIMWINNER.Debug(self),this.FPSstats=new stats),this.cameraLod={currentLevel:5,oldcam:self.camera,newCam:self.camera,t:1},tick(),this.render=function(){BIMWINNER.CODE_STATE,"FirstPersonControls"==self.cameraControl.className&&self.cameraControl.update(self.clock.getDelta()),self.transfromFlag&&self.transfromControl.update(),BIMWINNER.DEBUG&&(self.debug.render(),self.FPSstats.stats.update()),spotLight.position.copy(self.camera.position),setTimeout(self.render,20),!1===self.viewControllerFlag||self.viewController.render(),self.renderer.render(self.scene,self.camera),self.loadLodByCameraPoistionFlag&&self.loadLodByCameraPoistion()},self.render(),this.loadLodByCameraPoistion=function(){self.cameraLod.newCam=self.camrea,self.cameraLod.oldCam!=self.cameraLod.newCam&&(self.cameraLod.oldCam=self.cameraLod.newCam,self.cameraLod.t=1),0!=self.modelBounds.getCenter().x&&0==self.fly._flying&&(self.cameraLod.from=self.modelBounds.getCenter(),self.cameraLod.to=self.camera.position,1==self.cameraLod.t&&(self.cameraLod.orginalDis=Math.sqrt(Math.pow(self.cameraLod.from.x-self.cameraLod.to.x,2)+Math.pow(self.cameraLod.from.y-self.cameraLod.to.y,2)+Math.pow(self.cameraLod.from.z-self.cameraLod.to.z,2)),self.cameraLod.t=2),self.cameraLod.newDis=Math.sqrt(Math.pow(self.cameraLod.from.x-self.cameraLod.to.x,2)+Math.pow(self.cameraLod.from.y-self.cameraLod.to.y,2)+Math.pow(self.cameraLod.from.z-self.cameraLod.to.z,2)),Math.round(100*self.cameraLod.newDis)!=Math.round(100*self.cameraLod.oldDis)&&self.convertLevel())},this.convertLevel=function(){console.log("orginalDis:",self.cameraLod.orginalDis),console.log("oldDis:",self.cameraLod.oldDis),console.log("newDis:",self.cameraLod.newDis),console.log("currentLevel:",self.cameraLod.currentLevel),self.cameraLod.oldDis=self.cameraLod.newDis,self.cameraLod.oldDis>1.1*self.cameraLod.orginalDis?5!=self.cameraLod.currentLevel&&(self.destroyObjs(),self.showModelByDocumentId(self.documentList[0],function(){},void 0,"Level5"),self.currentLevel=5):self.cameraLod.oldDis<.85*self.cameraLod.orginalDis&&self.cameraLod.oldDis>.7*self.cameraLod.orginalDis?3!=self.cameraLod.currentLevel&&(self.destroyObjs(),self.showModelByDocumentId(self.documentList[0],function(){},void 0,"Level3"),self.currentLevel=3):self.cameraLod.oldDis<.55*self.cameraLod.orginalDis&&self.cameraLod.oldDis>.4*self.cameraLod.orginalDis?1!=self.cameraLod.currentLevel&&(self.destroyObjs(),self.showModelByDocumentId(self.documentList[0],function(){},void 0,"Level1"),self.currentLevel=1):self.cameraLod.oldDis<.3*self.cameraLod.orginalDis&&0!=self.cameraLod.currentLevel&&(self.destroyObjs(),self.showModelByDocumentId(self.documentList[0],function(){},void 0,"Level0"),self.currentLevel=0)},this.arrayConversion=function(){var e=self.selectedPartsVal;if(""!=e&&null!=e)return e.split(",")},this.createGeometry=function(e){for(var t=""+e.guid==void 0?e.guid:e._id,o=[],n=[],s=new THREE.Geometry,i=0;i<e.positions.length;i+=3)s.vertices.push(new THREE.Vector3(e.positions[i],e.positions[i+1],e.positions[i+2])),o.push(new THREE.Vector3(e.normals[i],e.normals[i+1],e.normals[i+2])),e.numberOfColors/4==e.positions.length/3&&n.push(new THREE.Color(e.colors[i],e.colors[i+1],e.colors[i+2]));for(var a=0;a<e.indices.length;a+=3){var r=new THREE.Vector3(e.normals[a],e.normals[a+1],e.normals[a+2]);e.numberOfColors/4==e.positions.length/3?s.faces.push(new THREE.Face3(e.indices[a],e.indices[a+1],e.indices[a+2],[o[e.indices[a]].clone(),o[e.indices[a+1]].clone(),o[e.indices[a+2]].clone()],[n[e.indices[a]].clone(),n[e.indices[a+1]].clone(),n[e.indices[a+2]].clone()])):s.faces.push(new THREE.Face3(e.indices[a],e.indices[a+1],e.indices[a+2],r))}if(0!=e.numberOfColors)for(var l=0;l<e.materialIndices.length;l++)s.faces[l].color.setRGB(e.colors[4*e.materialIndices[l]],e.colors[4*e.materialIndices[l]+1],e.colors[4*e.materialIndices[l]+2]);return s.computeBoundingBox(),self.componentGeometrys[t]=s,s},this.createGeometry2=function(e){var t,o=void 0!=e.guid?e.guid:void 0!=e._id?e._id:e.key,n=[],s=[],i=new THREE.BufferGeometry,a=new Float32Array(e.positions);if(i.addAttribute("position",new THREE.BufferAttribute(a,3)),0!=e.numberOfColors&&1!=e.numberOfColors){if(Array.fill)s=Array(e.positions.length).fill(1);else for(var r=0;r<e.positions.length;r++)s.push(1);var l=new Float32Array(s);i.addAttribute("color",new THREE.BufferAttribute(l,3,!0));for(var c,d=[],u=void 0,p=e.materialIndices,f=0;f<p.length;f++){var m=p[f];m!==u&&(u=m,void 0!==c&&(c.count=3*f-c.start,d.push(c)),c={start:3*f,materialIndex:u})}void 0!==c&&(c.count=3*f-c.start,d.push(c)),i.groups=d,l=null,c=null,d=null,u=null,p=null}return i.setIndex(e.indices),e.positions.length==e.normals.length?(n=e.normals,t=new Float32Array(n),i.addAttribute("normal",new THREE.BufferAttribute(t,3))):i.computeVertexNormals(),i.computeBoundingBox(),i.key=o,o=null,n=null,s=null,a=null,t=null,i},this.createObject=function(e,t,o,n){if(self.components[e])console.warn("该ID的组件已经存在于视图中: "+e);else if("IfcOpeningElement"!=t){var s,i=[],a={};if(1==o.length)a=self.componentGeometrys[o[0]];else{a=new THREE.Geometry;for(var r=0,l=o.length;r<l;r++)i.push(""+o[r]),a.merge(self.componentGeometrys[o[r]])}var c=new THREE.Matrix4;c.set(n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]);var d,u=[],p=self.componentData[o[0]].colors,f=self.componentData[o[0]].numberOfColors;if(void 0!=f&&0!=f&&1!=f){for(var m=[],r=0;r<f;r++){var h=new THREE.MeshLambertMaterial({color:new THREE.Color(p[4*r],p[4*r+1],p[4*r+2])});p[4*r+3]<1&&(h.transparent=!0,h.opacity=p[4*r+3]),h.side=THREE.DoubleSide,h.vertexColors=THREE.VertexColors,m.push(h),u.push({color:h.color.clone(),opacity:h.opacity,transparent:h.transparent}),h=null}d=m,m=null}else{var g;if(1==f)g=p;else{var Y=BIMWINNER.Material;(g=Y[t]?Y[t].color:void 0)||(console.log("Material not found for type: ",t),g=Y.DEFAULT.color),g||console.log("Default material not found for type: ",t)}d=new THREE.MeshLambertMaterial({color:new THREE.Color(g[0],g[1],g[2])}),g[3]<1&&(d.transparent=!0,d.opacity=g[3]),d.side=THREE.DoubleSide,Y=null,g=null}var E=new THREE.Mesh(a,d);if(E.key=""+e,E.applyMatrix(c),self.components[e]=E,E.userData.originalMaterial=[],$.isArray(d)?(E.userData.originalMaterial=u,E.userData.color=p):(E.userData.originalMaterial.push({color:d.color.clone(),opacity:d.opacity,transparent:d.transparent}),E.userData.color=d.color.clone()),E.highlight=!1,E.userData.useLevel=s,E.userData.type=t,"IfcSpace"==t&&(E.visible=!1),self.componentType[t]?self.componentType[t].push(""+e):(self.componentType[t]=[],self.componentType[t].push(""+e)),E.receiveShadow=!0,E.castShadow=!0,self.calculateBoundary){var v=(new THREE.Box3).setFromObject(E);self.modelBounds.isEmpty()?self.updateBound(v):self.modelBounds.containsBox(v)||self.updateBound(v),v=null}if(0!=self.modelExplosionCoefficient){var T=self.modelBounds.getCenter().x,b=self.modelBounds.getCenter().y,C=self.modelBounds.getCenter().z,M=E.position.x,L=E.position.y,S=E.position.z,Z=new THREE.Vector3;Z.setX(T+(1+2*self.modelExplosionCoefficient)*(M-T)),Z.setY(b+(1+2*self.modelExplosionCoefficient)*(L-b)),Z.setZ(C+(1+2*self.modelExplosionCoefficient)*(S-C)),E.position.set(Z.x,Z.y,Z.z),T=null,b=null,C=null,M=null,L=null,S=null,Z=null}self.alloids.push(E.key),self.root.add(E),i=null,a=null,s=null,c=null,d=null,u=null,p=null,f=null}},this.readStart=function(e,t){var o=new THREE.Box3(t,e);if(self.modelBounds.isEmpty()?self.modelBounds.copy(o):self.modelBounds.union(o),self.firstModel){self.firstModel=!1;var n=o.max.x+o.getSize().x/2,s=o.max.y+o.getSize().y/2,i=o.max.z+o.getSize().z/2,a=Math.sqrt(Math.pow(o.max.x-o.min.x,2)+Math.pow(o.max.y-o.min.y,2)+Math.pow(o.max.z-o.min.z,2));perspectiveCamera.far=20*a,perspectiveCamera.fov=37.8493,perspectiveCamera.zoomSpeedFactor=2,perspectiveCamera.position.set(n,s,i),perspectiveCamera.updateProjectionMatrix(),orthographicCamera.near=-1e5,orthographicCamera.far=20*a,orthographicCamera.zoomSpeedFactor=2,orthographicCamera.left=o.max.y/-.35,orthographicCamera.right=o.max.y/.35,orthographicCamera.top=o.max.z/.35,orthographicCamera.bottom=o.max.z/-.35,orthographicCamera.position.set(10*n,10*s,10*i),orthographicCamera.updateProjectionMatrix(),originalCameraLocation.look=(new THREE.Vector3).copy(self.modelBounds.getCenter()),originalCameraLocation.eye=perspectiveCamera.position.clone(),originalCameraLocation.up=perspectiveCamera.up.clone(),originalCameraLocation.zoom=perspectiveCamera.zoom,perspectiveCameraControl.target.copy(self.modelBounds.getCenter()),orthographicCameraControl.target.copy(self.modelBounds.getCenter()),self.resize()}},this.updateBound=function(e,t){if(self.modelBounds.isEmpty()){self.modelBounds=e;var o=self.modelBounds.max.x+self.modelBounds.getSize().x/2,n=self.modelBounds.max.y+self.modelBounds.getSize().y/2,s=self.modelBounds.max.z+self.modelBounds.getSize().z/2;perspectiveCamera.position.set(o,n,s)}else{self.modelBounds.union(e);var i=self.modelBounds.getCenter(),a=(new THREE.Vector3).copy(self.cameraControl.target).sub(i),r=new THREE.Vector3(self.modelBounds.max.x+self.modelBounds.getSize().x,self.modelBounds.max.y+self.modelBounds.getSize().y,self.modelBounds.max.z+self.modelBounds.getSize().z).sub(i),l=(new THREE.Vector3).copy(self.camera.position).sub(a).sub(i).setLength(r.length()).add(i);self.fly.flyTo({eye:l,look:i}),perspectiveCamera.position.copy(l)}var c=20*Math.sqrt(Math.pow(self.modelBounds.max.x-self.modelBounds.min.x,2)+Math.pow(self.modelBounds.max.y-self.modelBounds.min.y,2)+Math.pow(self.modelBounds.max.z-self.modelBounds.min.z,2));perspectiveCamera.far=c,perspectiveCamera.fovy=37.8493,perspectiveCamera.zoomSpeedFactor=2,perspectiveCamera.lookAt(self.modelBounds.getCenter()),perspectiveCamera.updateProjectionMatrix(),orthographicCamera.near=-1e5,orthographicCamera.far=c,orthographicCamera.zoomSpeedFactor=2,orthographicCamera.left=self.modelBounds.max.y/-.35,orthographicCamera.right=self.modelBounds.max.y/.35,orthographicCamera.top=self.modelBounds.max.z/.35,orthographicCamera.bottom=self.modelBounds.max.z/-.35,orthographicCamera.position.copy(perspectiveCamera.position),orthographicCamera.lookAt(self.modelBounds.getCenter()),orthographicCamera.updateProjectionMatrix(),t||(originalCameraLocation.look=self.modelBounds.getCenter().clone(),originalCameraLocation.eye=perspectiveCamera.position.clone(),originalCameraLocation.up=perspectiveCamera.up.clone(),originalCameraLocation.zoom=perspectiveCamera.zoom),o=null,n=null,s=null},this.automaticPathFinding=function(e,t,o,n,s){function i(){T==a.length-1?self.fly.flyTo({eye:[a[T][0],a[T][1],a[T][2]+r],look:[a[T][0],a[T][1],a[T][2]+r],up:[0,0,1]}):self.fly.flyTo({eye:[a[T][0],a[T][1],a[T][2]+r],look:[a[T+1][0],a[T+1][1],a[T+1][2]+r],up:[0,0,1]}),++T<a.length?setTimeout(i,c):t()}var a=[],r=1600,l=500,c=100;if(void 0!=e){void 0==o||"number"!=typeof o?console.warn("漫游高度未指定，将采用默认值 ：1600 mm"):r=o,void 0==n||"number"!=typeof n?console.warn("漫游步长未指定，将采用默认值 ：500 mm"):l=n,void 0==s||"number"!=typeof s?console.warn("漫游频率未指定，将采用默认值 ：100 ms"):c=s;for(var d=0;d<e.length;d++){var u=0;if(d!=e.length-1){var p=e[d+1][0]-e[d][0],f=e[d+1][1]-e[d][1],m=e[d+1][2]-e[d][2];u=Math.abs(p),Math.abs(f)>=u&&Math.abs(f)>=Math.abs(m)&&(u=Math.abs(f)),Math.abs(m)>=u&&Math.abs(m)>=Math.abs(f)&&(u=Math.abs(m));var h=Math.ceil(u/l),g=0,Y=0,E=0;0!=h&&(g=p/h,Y=f/h,E=m/h);for(var v=0;v<=h;v++)a.push([e[d][0]+g*v,e[d][1]+Y*v,e[d][2]+E*v])}}var T=0;i()}else self.promptingMessage("warning","路径点未指定！")},this.setEyesToRoaming=function(e){function t(){self.flyto(e[o]),++o<e.length&&setTimeout(t,1e3)}var o=0;t()},this.getEyesToRoaming=function(e){e({eye:self.camera.eye,look:self.camera.look,up:self.camera.up})},this.getDocument=function(e,t,o){if(self.documentInfo[e])t(self.documentInfo[e]);else{var n=encodeURIComponent(e),s=$.ajax({type:"GET",url:self.baseaddress+"files/"+n+"?token="+self.cn+"&devcode="+self.accessToken,data:{},success:function(o){if(self.subAjaxFromList(this),200==o.code){if(.5==o.data.status){var n=$("<div class='progressdiv' style=\"position: absolute;top: 20px; left:50%; margin-left: -140px; opacity: 0.6;z-index: 5000;padding: 10px; width: 280px;background-color: #555555;border-radius: 5px;\"></div>"),s=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;display: flex"><div>模型信息解析中，将在</div></div>'),i=$("<div style='color:rgb(0, 255, 255) ;font-weight: bolder;'>60</div>");i.appendTo(s),s.append($("<div>秒之后重试··</div>")),n.append(s);var a="#"+self.viewport;$(a).append(n);var r=0,l=setInterval(function(){r>=59&&(l=clearInterval(l),location.reload(!0)),r++,i.html(60-r)},1e3);return}1==o.data.status?(self.documentInfo[e]=o.data,t(o.data)):0==o.data.status?self.promptingMessage("error","模型未在解析队列，请重新发起解析服务··",!1):2==o.data.status?self.promptingMessage("error","模型解析失败，请重新发起解析服务··",!1):self.promptingMessage("warning","文件解析中，请稍后再试··",!1)}else if(console.warn("error: "+o.message),"document not found"==o.error&&""!=self.cn){var c=e.split("/")[1];$.ajax({type:"GET",url:self.webApiAddress+"?cn="+self.cn+"&fileid="+c,data:{},success:function(e){},error:function(e,t,o){}});var d=$("<div class='progressdiv' style=\"position: absolute;top: 20px; left:50%; margin-left: -130px; opacity: 0.6;z-index: 5000;padding: 10px; width: 260px;background-color: #555555;border-radius: 5px;\">"),u=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;display: flex"><div>文件尚未解析，将在</div></div>'),p=$("<div style='color:rgb(0, 255, 255) ;font-weight: bolder;'>60</div>");p.appendTo(u),u.append($("<div>秒之后重试··</div>")),d.append(u),$("#"+self.viewport).append(d);var f=0,m=setInterval(function(){f>59&&(m=clearInterval(m),location.reload(!0)),f++,p.html(60-f)},1e3)}else self.promptingMessage("warning",o.message,!1)},error:function(e,t,n){self.subAjaxFromList(this),"function"==typeof o?o(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(s)}},this.getComponent=function(e,t){for(var o=0;o<e.length;o++){var n=encodeURIComponent(e[o]),s=$.ajax({type:"GET",url:self.baseaddress+"components/"+n+"/geometry?token="+self.cn+"&devcode="+self.accessToken,data:{},success:function(e){self.subAjaxFromList(this),e.success?t(e.result):(console.warn("error: "+e.message),self.promptingMessage("warning",e.message))},error:function(e,o,n){self.subAjaxFromList(this);requestAgain(this.url,0,t)}});self.ajaxList.push(s)}},this.getComponentAttribute=function(e,t){0==e.indexOf("component/")&&(e=e.slice(10)),void 0!=self.componentAttribute[e]?t(self.componentAttribute[e]):self.getAttributeByComponentId([e],function(o){for(var n in o)o[n].length<1?self.componentAttribute[e]=null:self.componentAttribute[e]=o[n];t(self.componentAttribute[e])},function(){self.componentAttribute[e]=void 0,t(self.componentAttribute[e])})},this.getComponentBatch=function(e,t,o){for(var n=[],s=0;s<e.length;s++)n.push(self.components_primarities[e[s]].geometry);var i,a=n.concat();"3.0"==self.DBversion?(a,i="application/json"):({array:a},i=void 0);var r=$.ajax({type:"GET",url:self.baseaddress+"models/"+self.documentList[0]+"/geometries?token="+self.cn+"&devcode="+self.accessToken,contentType:i,success:function(e){self.subAjaxFromList(this),e.success?t(e.result):(console.warn("error: "+e.message),self.promptingMessage("warning",e.message))},error:function(e,t,n){self.subAjaxFromList(this),"function"==typeof o?o(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(r)},this.getComponentGeoFromDFS=function(){var e=function(e,t,o){var n=new XMLHttpRequest;self.ajaxList.push(n),n.open("POST",self.baseaddress+"models/"+e+"/geometries?token="+self.cn+"&devcode="+self.accessToken,!0),"responseType"in n&&(n.responseType="arraybuffer"),n.setRequestHeader("Content-type","application/json"),n.setRequestHeader("Authorization","AccessToken "+self.accessToken),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(e){var t;if(4===n.readyState&&(self.subAjaxFromList(this),200===n.status||0===n.status)){t=null,null;try{t=n.response||n.responseText}catch(e){new Error(e)}(new JSZip).loadAsync(t).then(function(e){Object.keys(e.files).map(function(t){return e.files[t]}).map(function(e){return e.async("string").then(function(t){data_obj=JSON.parse(t),data_obj.id=e.name,o(data_obj)})})})}},n.send(JSON.stringify(t))},t=function(e){var t=e.indexOf("/");return t>0&&(e=e.substring(t+1)),e};return function(o,n,s){for(var i={},a=0;a<o.length;a++){var r=self.componentInfo[self.componentData_Info[o[a]][0]].model;void 0==i[r]&&(i[r]=[]),i[r].push(o[a])}for(let o in i)for(var l=t(o),c=i[o];c.length>=1;){var d=c.splice(0,50);e(l,d,n)}}}(),this.getComponentDataBatch=function(){var e=function(e,t){var o,n={};if("3.0"==self.DBversion?(n=e,o="application/json"):(n={array:e},o=void 0),"app"==self.type){var s=$.ajax({type:"POST",url:self.baseaddress+"models/"+self.documentList[0]+"/geometries?token="+self.cn+"&devcode="+self.accessToken,data:JSON.stringify(e),headers:{authorization:"AccessToken "+self.accessToken,"content-type":"application/json"},success:function(e){self.subAjaxFromList(this);for(var o=0;o<e.length;o++)t(e[o])},error:function(e,t,o){self.subAjaxFromList(this),"function"==typeof error?error(e):e.responseJSON?self.promptingMessage("error","信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.message+","+e.responseJSON.data+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(s)}else{var i=$.ajax({type:"POST",url:self.baseaddress+"models/"+self.documentList[0]+"/geometries?token="+self.cn+"&devcode="+self.accessToken,data:JSON.stringify(n),contentType:o,success:function(e){if(self.subAjaxFromList(this),e.success)for(var o=0;o<e.result.length;o++)t(e.result[o]);else console.warn("error: "+e.message),self.promptingMessage("warning",e.message)},error:function(e,t,o){self.subAjaxFromList(this),"function"==typeof error?error(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(i)}};return function(t,o,n){var s=50;void 0!==n&&"number"==typeof n&&(s=n);for(var i=0,a=[],r=[],l=0;l<t.length;l++)self.componentInfo[self.componentData_Info[t[l]][0]].numberOfPrimitives?parseInt(self.componentInfo[self.componentData_Info[t[l]][0]].numberOfPrimitives)>5e4?(0==t[l].indexOf("componentGeoes/")&&(t[l]=t[l].slice(15)),e([t[l]],o)):(i+=parseInt(self.componentInfo[self.componentData_Info[t[l]][0]].numberOfPrimitives),"app"==self.type?0==t[l].indexOf("componentGeoes/")&&(t[l]=t[l].slice(15)):0!==t[l].indexOf("componentGeo/")&&(t[l]="componentGeo/"+t[l]),a.push(t[l]),i>5e4&&(i=0,e(a,o),a=null,a=[])):("app"==self.type?0==t[l].indexOf("componentGeoes/")&&(t[l]=t[l].slice(15)):0!==t[l].indexOf("componentGeo/")&&(t[l]="componentGeo/"+t[l]),r.push(t[l]));if(a.length>0&&(i=0,e(a,o),a=null,a=[]),r.length>0)for(;r.length>=1;){var c=r.splice(0,s);e(c,o)}}}(),this.getComponentFromDocument=function(e,t,o){e=encodeURIComponent(e);var n=$.ajax({type:"GET",url:self.baseaddress+"models/"+self.documentList[0]+"/components?token="+self.cn+"&devcode="+self.accessToken,data:{},contentType:"application/json",success:function(e){self.subAjaxFromList(this),e.success?t(e.result):(console.warn("error: "+e.error),self.promptingMessage("warning",e.error))},error:function(e,t,n){self.subAjaxFromList(this),"function"==typeof o?o(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(n)},this.getComponentIdByDocumentId=function(id,callback,error){var parameter={_from:id},ajax=$.ajax({type:"GET",url:self.baseaddress+"models/"+id+"/components?token="+self.cn+"&devcode="+self.accessToken,data:{},success:function(data){if(self.subAjaxFromList(this),200==data.code){var list=[],result=eval(data.data);if(result.length>0){for(var i=0;i<result.length;i++)list.push(result[i].key),self.componentInfo[result[i].key]=result[i];callback(list)}else self.promptingMessage("error","获取模型所有构件基本信息返回数据为空")}else console.warn("error: "+data.message),self.promptingMessage("warning",data.message)},error:function(e,t,o){self.subAjaxFromList(this),"function"==typeof error?error(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(ajax)},this.getComponentById=function(ids,callback,error){var ajax=$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:self.baseaddress+"components/primary?token="+self.cn+"&devcode="+self.accessToken,data:JSON.stringify(ids),success:function(data){if(self.subAjaxFromList(this),200==data.code){for(var list=[],result=eval(data.data),i=0;i<result.length;i++)list.push(result[i].key),self.componentInfo[result[i].key]=result[i];void 0!=callback&&callback(list)}else console.warn("error: "+data.message),self.promptingMessage("warning",data.message)},error:function(e,t,o){self.subAjaxFromList(this),"function"==typeof error?error(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(ajax)},this.getDocumentFromComponent=function(e,t,o){return self.componentInfo[e].model},this.stopFlashing=function(){void 0!=flashing&&clearTimeout(flashing),self.closetransParentObjs(),document.getElementById(self.viewer.canvasParent).style.background="white",self.setAllObjtColor(allcolor)},this.componentLocationAndFlashing=function(e){function t(){for(var e=0;e<o.length;e++)o[e].highlight=!o[e].highlight,o[e].color=o[e].highlight?allcolor[o[e].id]:[1,0,0,1];flashing=setTimeout(t,1e3)}var o=[];if(void 0!=e&&null!=e){if(self.stopFlashing(),self.objectSet.clear(),self.objectSet.addObjectIds(e),self.objectSet.numObjects<=0)return this;var n=1.5*self.objectSet.boundary.xmax,s=1.5*self.objectSet.boundary.ymax,i=1.5*self.objectSet.boundary.zmax,a=[(self.objectSet.boundary.xmax+self.objectSet.boundary.xmin)/2,(self.objectSet.boundary.ymax+self.objectSet.boundary.ymin)/2,(self.objectSet.boundary.zmax+self.objectSet.boundary.zmin)/2];if(self.fly.flyTo({eye:[n,s,i],look:a,up:[0,0,1],velocity:20}),!(self.alloids.length<=0)){for(var r=null,l=self.alloids.concat(),c=0;c<e.length;c++)for(var d=0;d<l.length;d++)if(e[c]==l[d]){if(void 0==(r=self.viewer.components[""+l[d]]))break;o.push(r),l.splice(d,1);break}for(var u=null,p=0;p<l.length;p++)void 0!=(u=self.viewer.components[""+l[p]])&&null!=r&&(u.color=[.5,.5,.5],u.transparent=!0);o.length>0&&(document.getElementById(self.viewer.canvasParent).style.background="grey",t())}}else self.promptingMessage("warning","没有发现选中的构件",!1)},this.getLodByComponentGeoId=function(e,t,o){for(var n=0;n<e.length;n++)"app"==self.type?0!==e[n].indexOf("componentGeo/")||(e[n]=e[n].slice(13)):0!==e[n].indexOf("componentGeo/")&&(e[n]="componentGeo/"+e[n]);var s={from:e};if("app"==self.type){var i=$.ajax({type:"POST",url:self.baseaddress+"model/relation/component/children/lod/id/batch?access_token="+self.accessToken+"&appKey="+self.appKey,data:JSON.stringify(s),success:function(e){self.subAjaxFromList(this),0==e.code?t(e.data):console.warn("error: "+e.message)},error:function(e,t,n){self.subAjaxFromList(this),"function"==typeof o?o(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(i)}else{var a=$.ajax({type:"POST",url:self.baseaddress+"componentGeo_lod/batch/rel/lod",data:JSON.stringify(s),success:function(e){self.subAjaxFromList(this),e.success?t(e.result):console.warn("error: "+e.message)},error:function(e,t,n){self.subAjaxFromList(this),"function"==typeof o?o(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(a)}},this.getAttributeByComponentId=function(e,t,o){for(var n={},s=0;s<e.length;s++){var i=$.ajax({type:"GET",url:self.baseaddress+"components/"+e[s]+"/attributes?token="+self.cn+"&devcode="+self.accessToken,async:!1,data:{},success:function(t){self.subAjaxFromList(this),null!=t.data||void 0!=t.data?n[e[s]]=t.data:console.warn("error: 没有找到id为："+e[s]+" 关联的构件")},error:function(e,t,n){self.subAjaxFromList(this),"function"==typeof o?o(e):e.responseJSON?self.promptingMessage("error","“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.message+","+e.responseJSON.data+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(i),t(n)}},this.outlineRequest=!1,this.showModelByDocumentId=function(){Array.prototype.diff=function(e){return this.filter(function(t){return e.indexOf(t)<0})};var e,t,o,n,s=function(){self.getDocument(self.modelId,function(e){const t=e.snapshotlist;let n=!1;null===t||t instanceof Array&&0!==t.length&&t.forEach(e=>{"snapshot"===e.id&&(n=!0)}),n||function(){var e=self.getModelPhoto(),t=null;t=JSON.stringify({snapshot:e.imgURL,width:e.width,height:e.height});$.ajax({type:"PUT",url:self.baseaddress+"files/"+self.modelId+"/snapshot?devcode="+self.accessToken,headers:{"content-type":"application/json"},data:t,contentType:"application/json",success:function(t){if(200===t.code){var n=$("#modelSnapShoot"+o),s=334*e.height/e.width;n.attr("src",e.imgURL),n.attr("height",s),n.attr("width","100%");var i="模型快照snapshot更新成功";console.log(i)}else console.error(i)},error:function(e,t,o){"function"==typeof error?error(e):e.responseJSON?self.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}})}()})},i=function(i){self.documentInfo[e]=i,self.documentList.push(e),$(".loading").addClass("hide"),i&&i.maxBoundary&&i.minBoundary?self.readStart(i.Attribute.maxBoundary,i.Attribute.minBoundary):self.calculateBoundary=!0,self.getComponentIdByDocumentId(e,function(i){!function(e,i){var a=$.ajax({type:"GET",url:self.baseaddress+"models/"+i+"/outlines?devcode="+self.accessToken,success:function(a){if(200===a.code){let r=a.data,l=e.diff(r);for(let e=0;e<l.length;e++)r.push(l[e]);self.showModelByComponentId(r,function(){self.listener.fire("finish",i,!0),self.resetScene(!0,!0,!0,!0,!0,!0,!0,s),"function"==typeof t&&t(i)},o,n)}else 404===a.code||500===a.code?self.showModelByComponentId(e,function(){self.listener.fire("finish",i,!0),self.resetScene(!0,!0,!0,!0,!0,!0,!0,s),"function"==typeof t&&t(i)},o,n):400===a.code&&self.promptingMessage("error","模型尚未解析或者还未解析完成，请解析成功后再试",!1)},error:function(e,t,o){self.subAjaxFromList(this),"function"==typeof error?error(e):e.responseJSON?self.promptingMessage("error","“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.message+","+e.responseJSON.data+"”"):self.promptingMessage("error","网络请求发生错误，请稍后再试。")}});self.ajaxList.push(a)}(i,e)})};return function(s,a,r,l){self.modelId=s,e=s,t=a,o=r,n=l,self.getDocument(s,i)}}(),this.showModelByComponentId=function(){var e,t,o=0,n=0,s=[],i=[],a=[],r=[],l=[],c=!1,d=!1,u=function(e,t,n){c=!0;for(var a=0;a<s.length;a++){var r=self.componentInfo[s[a]].geometry;r?(d=!0,self.componentGeometrys[r]?i.push(r):void 0!=self.componentData_Info[r]&&null!=self.componentData_Info[r]?self.componentData_Info[r].push(s[a]):(self.componentData_Info[r]=[],self.componentData_Info[r].push(s[a]),l.push(r))):o--}if(d)if(t)if(0==e.length){for(var u=[],p=0;p<l.length;p++)self.componentLod[l[p]]&&self.componentLod[l[p]][t]?(u.push(self.componentLod[l[p]][t]),self.componentData_Info[self.componentLod[l[p]][t]]=self.componentData_Info[l[p]]):u.push(l[p]);n(unique(u))}else self.getLodByComponentGeoId(unique(e),function(e){var o=[];for(var s in e)self.componentLod[s]=e[s][0];e=null;for(var i=0;i<l.length;i++)self.componentLod[l[i]]&&self.componentLod[l[i]][t]?(o.push(self.componentLod[l[i]][t]),self.componentData_Info[self.componentLod[l[i]][t]]=self.componentData_Info[l[i]]):o.push(l[i]);n(unique(o))});else c?n(l,i):n(unique(l),unique(i));else self.promptingMessage("error","该模型所有的构件都没有geometry信息，请检查模型解析是否正确")},p=function(e,t){for(var o=0;o<t.length;o++)f(t[o]);c?self.getComponentGeoFromDFS(e,function(e){var t,o=e;o._id||(t=o._id=o.id||o.gid||o.code),self.componentGeometrys[t]=self.createGeometry2(o),self.componentData[o._id]={},self.componentData[o._id].colors=o.colors,self.componentData[o._id].numberOfColors=o.colors.length/4,f(t)}):self.getComponentDataBatch(e,function(e){e._id||(e._id="componentGeoes/"+e.key),self.componentGeometrys[e._id]=self.createGeometry2(e),self.componentData[e._id]={},self.componentData[e._id].colors=e.colors,self.componentData[e._id].numberOfColors=e.numberOfColors,f(e._id)},30)},f=function(i){if(void 0!=self.componentData_Info[i]&&null!=self.componentData_Info[i]){self.componentData_Info[i]=unique(self.componentData_Info[i]),self.cameraControl.update();for(var c=0;c<self.componentData_Info[i].length;c++){var d=self.componentInfo[self.componentData_Info[i][c]];d&&(self.createObject(d.key,d.type,[i],d.matrix),d=null,n++,e.update(n,o),n==o&&"function"==typeof t&&(o=null,n=null,e=null,s=null,a=null,r=null,l=null,t()))}}},m=function(t){if(!$.isArray(t)||0==t.length)return self.promptingMessage("error","showModelByComponentId方法的参数需要为长度不为0的数组"),void(e&&e.update(1,1));for(var n=0;n<t.length;n++)self.componentInfo[t[n]]?(s.push(t[n]),self.componentLod[self.componentInfo[t[n]].geometry]||a.push(self.componentInfo[t[n]].geometry)):r.push(t[n]);r.length>0?("app"!=self.type&&self.getAttributeByComponentId(r,function(e){for(var o in e)e[o].length<1?self.componentAttribute[t]=null:self.componentAttribute[t]=e[o];callback(self.componentAttribute[t])},void 0),self.getComponentBatch(r,function(e){o=e.length;for(var t=0;t<e.length;t++){var n="";e[t]._id?(n=e[t]._id,e[t].key=e[t]._key):e[t].key&&(n=e[t].key),self.componentInfo[n]=e[t];var i=e[t].gid||e[t].geoGuid||e[t].geometry;self.componentLod[i]||a.push(i),s.push(n)}u(a,void 0,p)})):u(a,void 0,p)};return function(c,d,u,p){u=u,p=p,o=c.length,n=0,e=new self.downloadprogress(""),s=[],i=[],a=[],r=[],l=[],t=d,self.documentList.length<1?(t=function(){self.listener.fire("finish",c,!0),"function"==typeof d&&d(c)},self.calculateBoundary=!0,self.getComponentById(c,function(){m(c)})):m(c)}}(),this.promptingMessage=function(){var e,t="Success",o="",n="",s=!1,i=0;return function(a,r,l){return 5==a?$(".loading").addClass("hide"):t=a,"error"==a&&(s=!1),void 0!=r&&(o=r,void 0!=l&&(s=l)),(new Date).getTime()-i<5e3?o!=n&&(e=Lobibox.notify(t,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:s,msg:o}),i=(new Date).getTime(),e.$el[0].childNodes[1].childNodes[0].title=o):(e=Lobibox.notify(t,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:s,msg:o}),i=(new Date).getTime(),e.$el[0].childNodes[1].childNodes[0].title=o),n=o,e}}(),this.downloadprogress=function(e){var t=$("<div class='progressdiv' style=\"position: absolute;top: 20px; left:50%; margin-left: -150px; opacity: 0.6;z-index: 5000;padding: 10px; width: 300px;background-color: #555555;border-radius: 5px;\"></div>"),o=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;"></div>');o.html("加载中··");var n=$('<div class="progress active progress-striped"></div>'),s=$('<div class="progress-bar"></div>');t.append(o),n.append(s),t.append(n);var i="#"+self.viewport;$(i).append(t),this.update=function(e,n){o.html("正在加载构件("+e+"/"+n+")"),o.title="正在加载构件("+e+"/"+n+")",e<=1&&$(".loading").addClass("hide");var i=e/n;s.css("width",100*i+"%"),1==i&&(t.fadeOut(800),$(".progressdiv").remove())}},this.resetScene=function(e,t,o,n,s,i,a,r){self.objectSet.clear(),(void 0==t||t)&&self.showObjs(),(void 0==o||o)&&self.closeHighlightObjs(),(void 0==n||n)&&self.closeTransparentObjs(),(void 0==s||s)&&self.restoreObjtColor(),(void 0==i||i)&&self.closeWireframeObjs(),(void 0==e||e)&&(self.fly.flyTo({eye:originalCameraLocation.eye,look:originalCameraLocation.look,up:originalCameraLocation.up},r),self.camera.zoom=originalCameraLocation.zoom),self.viewportDiv.focus()},this.transparentObjs=function(e,t,o){if(!(self.alloids.length<=0)){var n=null,s=.5;if(void 0!=t&&(0<=Number(t)&&Number(t)<=1?s=t:self.promptingMessage("warning","透明度参数不合法",!1)),void 0!=e&&null!=e){for(var i=0;i<e.length;i++)if(n=self.components[""+e[i]])if(n.userData.transparentChange=!0,$.isArray(n.material))for(var a=0;a<n.material.length;a++)void 0!==o&&1==o&&n.material[a].color.setRGB(.5,.5,.5),n.material[a].opacity=s,n.material[a].transparent=s<1||self.objectSet.objects[e[i]];else void 0!==o&&1==o&&n.material.color.setRGB(.5,.5,.5),n.material.opacity=s,n.material.transparent=s<1||self.objectSet.objects[e[i]]}else self.promptingMessage("warning","没有发现选中的构件")}},this.reverseTransparentObjs=function(e,t,o){var n=self.alloids.concat(),s=null,i=.5;if(t&&(i=t),e){for(a=0;a<e.length;a++)for(r=0;r<n.length;r++)if(e[a]==n[r]){n.splice(r,1);break}for(var a=0;a<n.length;a++)if(s=self.components[""+n[a]])if(s.userData.transparentChange=!0,$.isArray(s.material))for(var r=0;r<s.material.length;r++)void 0!==o&&1==o&&s.material[r].color.setRGB(.5,.5,.5),s.material[r].opacity=i,s.material[r].transparent=i<1;else void 0!==o&&1==o&&s.material.color.setRGB(.5,.5,.5),s.material.opacity=i,s.material.transparent=i<1}else self.promptingMessage("warning","没有发现选中的构件")},this.closeTransparentObjs=function(e){if(!(self.alloids.length<=0)){var t=null;if(e){for(o=0;o<e.length;o++)if(t=self.components[""+e[o]])if(t.userData.transparentChange=!1,$.isArray(t.material))for(n=0;n<t.material.length;n++)t.material[n].opacity=t.userData.originalMaterial[n].opacity,t.material[n].transparent=t.userData.originalMaterial[n].transparent;else t.material.opacity=t.userData.originalMaterial[0].opacity,t.material.transparent=t.userData.originalMaterial[0].transparent}else for(var o=0;o<self.alloids.length;o++)if(t=self.components[""+self.alloids[o]])if(t.userData.transparentChange=!1,$.isArray(t.material))for(var n=0;n<t.material.length;n++)t.material[n].opacity=t.userData.originalMaterial[n].opacity,t.material[n].transparent=t.userData.originalMaterial[n].transparent;else t.material.opacity=t.userData.originalMaterial[0].opacity,t.material.transparent=t.userData.originalMaterial[0].transparent}},this.hideObjs=function(e){if(void 0!=e&&null!=e)for(var t=null,o=0;o<e.length;o++)(t=self.components[""+e[o]])&&(t.visible=!1);else self.promptingMessage("warning","没有发现选中的构件",!1)},this.showObjs=function(e){var t=self.alloids.concat(),o=null;if(e)for(var n=0;n<e.length;n++)(o=self.components[""+e[n]])&&"IfcSpace"!=o.userData.type&&(o.visible=!0);else for(var s=0;s<self.alloids.length;s++)(o=self.components[""+t[s]])&&"IfcSpace"!=o.userData.type&&(o.visible=!0)},this.isolationObjs=function(e){if(void 0!=e&&null!=e){if(self.showObjs(),!(self.alloids.length<=0)){for(var t=self.alloids.concat(),o=0;o<e.length;o++)for(s=0;s<t.length;s++)if(e[o]==t[s]){t.splice(s,1);break}for(var n=null,s=0;s<t.length;s++)(n=self.components[""+t[s]])&&(n.visible=!1)}}else self.promptingMessage("warning","没有发现选中的构件",!1)},this.showLable=function(){},this.highlightObjs=function(e){void 0!=e&&null!=e?self.alloids.length<=0||(self.closeTransparentObjs(),self.closeHighlightObjs(),self.objectSet.addObjectIds(e)):self.promptingMessage("warning","没有发现选中的构件",!1)},this.closeHighlightObjs=function(e){if(!(self.alloids.length<=0)){self.alloids.concat();e?self.objectSet.removeObjectIds(e):self.objectSet.removeObjectIds(self.alloids)}},this.wireframeObjs=function(e){if(void 0!=e&&null!=e){if(!(self.alloids.length<=0)){var t=null;if(void 0==e||null==e);else for(var o=0;o<e.length;o++)if(t=self.components[""+e[o]])if($.isArray(t.material))for(var n=0;n<t.material.length;n++)t.material[n].wireframe=!0;else t.material.wireframe=!0}}else self.promptingMessage("warning","没有发现选中的构件",!1)},this.closeWireframeObjs=function(e){if(!(self.alloids.length<=0)){var t=null;if(void 0==e||null==e)for(n=0;n<self.alloids.length;n++){var o=self.components[""+self.alloids[n]];if(o.isMesh)if($.isArray(o.material))for(s=0;s<o.material.length;s++)o.material[s].wireframe=!1;else o.material.wireframe=!1}else for(var n=0;n<e.length;n++)if(t=self.components[""+e[n]])if($.isArray(t.material))for(var s=0;s<t.material.length;s++)t.material[s].wireframe=!1;else t.material.wireframe=!1}},this.restoreObjtColor=function(e){if(!(self.alloids.length<=0))if(void 0==e||null==e)for(o=0;o<self.alloids.length;o++){var t=self.components[""+self.alloids[o]];if(t)if($.isArray(t.material)){t.userData.color=[];for(n=0;n<t.material.length;n++)t.material[n].color=t.userData.originalMaterial[n].color.clone(),t.userData.color.push(t.material[n].color.r,t.material[n].color.g,t.material[n].color.b,1)}else t.material.color=t.userData.originalMaterial[0].color.clone(),t.userData.color=t.material.color.clone()}else for(var o=0;o<e.length;o++)if(t=self.components[""+e[o]])if($.isArray(t.material)){t.userData.color=[];for(var n=0;n<t.material.length;n++)t.material[n].color=t.userData.originalMaterial[n].color.clone(),t.userData.color.push(t.material[n].color.r,t.material[n].color.g,t.material[n].color.b,1)}else t.material.color=t.userData.originalMaterial[0].color.clone(),t.userData.color=t.material.color.clone()},this.setObjtColor=function(e,t){self.setObjsColor(e,t)},this.setObjsColor=function(e,t){if(void 0!=e&&null!=e)if(void 0!=t&&null!=t){if(!(self.alloids.length<=0))for(var o=null,n=0;n<e.length;n++)if(o=self.components[""+e[n]]){if($.isArray(o.material))for(var s=0;s<o.material.length;s++)o.material[s].color.setRGB(t[0],t[1],t[2]);else o.material.color.setRGB(t[0],t[1],t[2]);o.userData.color=new THREE.Color(t[0],t[1],t[2])}}else self.promptingMessage("warning","未选中颜色",!1);else self.promptingMessage("warning","没有发现选中的构件",!1)},this.setColorProcess=function(e){var t=self.arrayConversion();self.setObjsColor(t,e)},this.destroyObjs=function(e){if(!(self.alloids.length<=0)){var t=null,o=self.alloids.concat();if(e)for(var n=0;n<e.length;n++)(t=self.components[""+e[n]])&&(t.geometry.dispose(),delete self.componentGeometrys[t.geometry.key],delete self.componentData_Info[t.geometry.key],self.alloids.splice(n,1),self.root.remove(t),self.components[""+e[n]]=null,delete self.components[""+e[n]]);else{for(var s=0;s<self.alloids.length;s++)(t=self.components[""+o[s]])&&(t.geometry.dispose(),delete self.componentGeometrys[t.geometry.key],delete self.componentData_Info[t.geometry.key],self.root.remove(t));self.alloids=null,self.components=null,self.alloids=[],self.components=[],self.componentGeometrys={},self.componentData_Info={}}}},this.findSceneNodes=function(e){if(void 0!=e&&null!=e){if(self.multiSelect||self.objectSet.clear(),self.objectSet.addObjectIds(e),self.objectSet.numObjects<=0)return this;var t=self.objectSet.getBoundary();if(t.isBox3){var o=t.getCenter(),n=(new THREE.Vector3).copy(self.cameraControl.target).sub(o),s=new THREE.Vector3(t.max.x+t.getSize().x,t.max.y+t.getSize().y,t.max.z+t.getSize().z).sub(o),i=(new THREE.Vector3).copy(self.camera.position).sub(n).sub(o).setLength(s.length()).add(o);self.fly.flyTo({eye:i,look:o})}}else self.promptingMessage("warning","没有发现选中的构件",!1)},this.listentoSelectObjs=function(e){self.objectSet.listener.on("updated",function(t){if($.isEmptyObject(self.objectSet.objects))e(null,null);else{var o=self.objectSet.objects,n="";for(var s in o)n=n+s+",";if(""==(n=n.substring(0,n.length-1)));else if(self.explorer){var i=n.split(",");self.listentree(i)}e(n,self.objectSet.objects)}})},this.getModelSnapshoot=function(){for(var e={},t=[],o={eye:self.camera.position.clone(),look:self.cameraControl.target.clone(),up:self.camera.up.clone(),zoom:self.camera.zoom},n=self.alloids.concat(),s=null,i=0;i<n.length;i++)if(s=self.components[""+n[i]]){var a=[];if($.isArray(s.material))for(var r=0;r<s.material.length;r++){var l={};l.color=s.material[r].color.clone(),l.opacity=s.material[r].opacity,l.transparent=s.material[r].transparent,a.push(l)}else{var c={};c.color=s.material.color.clone(),c.opacity=s.material.opacity,c.transparent=s.material.transparent,a.push(c)}t.push({oid:n[i],highlight:s.highlight,active:s.visible,material:a})}else t.push({});return self.Flag.clip&&(e=self.Clip.state),{componentState:t,camaraState:o,cuttingState:e}},this.setModelSnapshoot=function(e,t,o){if(self.objectSet.clear(),t&&(self.camera.zoom=t.zoom,t.eye&&t.look&&t.up&&self.fly.flyTo({eye:(new THREE.Vector3).copy(t.eye),look:(new THREE.Vector3).copy(t.look),up:(new THREE.Vector3).copy(t.up)})),!(self.alloids.length<=0)&&e&&o){for(var n=null,s=0;s<e.length;s++)if(e[s].oid&&(n=self.components[""+e[s].oid]))if(n.highlight=e[s].highlight,n.highlight&&self.objectSet.addObjectIds([e[s].oid]),n.visible=e[s].active,e[s].material.length>1)for(var i=0;i<e[s].material.length;i++)"object"==typeof e[s].material[i].color?n.material[i].color.copy(e[s].material[i].color):"string"!=typeof e[s].material[i].color&&"number"!=typeof e[s].material[i].color||n.material[i].color.setHex(e[s].material[i].color),n.material[i].opacity=e[s].material[i].opacity,n.material[i].transparent=e[s].material[i].transparent;else 1==e[s].material.length&&("object"==typeof e[s].material[0].color?n.material.color.copy(e[s].material[0].color):"string"!=typeof e[s].material[0].color&&"number"!=typeof e[s].material[0].color||n.material.color.setHex(e[s].material[0].color),n.material.opacity=e[s].material[0].opacity,n.material.transparent=e[s].material[0].transparent);if($.isEmptyObject(o))self.Flag.clip=!0,self.modelCutting();else{self.Flag.clip=!1,self.modelCutting();var a=o.x,r=o.y,l=o.z,c=o.x1,d=o.y1,u=o.z1;self.cutting(a,r,l,c,d,u,o.sensitivity)}}},this.flyToView=function(e){switch(e){case"Front":self.camera.rotation.x=0,self.camera.rotation.y=0,self.camera.rotation.z=0;break;case"Back":self.camera.rotation.x=0,self.camera.rotation.y=Math.PI,self.camera.rotation.z=0;break;case"Left":self.camera.rotation.x=0,self.camera.rotation.y=-Math.PI/2,self.camera.rotation.z=0;break;case"Right":self.camera.rotation.x=0,self.camera.rotation.y=Math.PI/2,self.camera.rotation.z=0;break;case"Top":self.camera.rotation.x=-Math.PI/2,self.camera.rotation.y=0,self.camera.rotation.z=0;break;case"Bottom":self.camera.rotation.x=Math.PI/2,self.camera.rotation.y=0,self.camera.rotation.z=0}},this.modelExplosion=function(e){for(var t=self.modelBounds.getCenter().x,o=self.modelBounds.getCenter().y,n=self.modelBounds.getCenter().z,s=0;s<self.alloids.length;s++){var i=self.components[""+self.alloids[s]];if(i.isMesh){var a=i.position.x,r=i.position.y,l=i.position.z,c=new THREE.Vector3;c.setX(t+(1+2*e)*(a-t)/(1+2*self.modelExplosionCoefficient)),c.setY(o+(1+2*e)*(r-o)/(1+2*self.modelExplosionCoefficient)),c.setZ(n+(1+2*e)*(l-n)/(1+2*self.modelExplosionCoefficient)),i.position.set(c.x,c.y,c.z),c=null}}self.modelExplosionCoefficient=e},this.modelCutting=function(){var e=self.input,t={},o="",n=(self.modelBounds.getCenter().x,self.modelBounds.getCenter().y),s=self.modelBounds.getCenter().z,i=self.modelBounds.getSize().x/2+.1,a=self.modelBounds.getSize().y/2+.1,r=self.modelBounds.getSize().z/2+.1,l=self.modelBounds.getCenter().x,c=self.modelBounds.getCenter().y,d=self.modelBounds.getCenter().z,u=l,p=c,f=d,m=i,h=a,g=r;self.x=m,self.y=h,self.z=g;var Y=u+m,E=u-m,v=f+g,T=f-g,b=p+h,C=p-h;if(self.Clip.cuttingfirst&&(self.cutting(i,a,r,l,c,d),self.Clip.cuttingfirst=!1),self.Flag.clip?(self.closeOrResetClips(!0),self.cameraControl.enabled=!0):self.Flag.clip=!0,self.Flag.clip){var M,L,S,Z=0,y=0,w=!1;self.modelCutting._onMouseDown=function(t){if(!w){var o=self._getClickCoordsWithinElement(t);if(e.mouseDownLeft){M=o[0],L=o[1],self.Clip.currentClipPlane="";var n=self.pick(o[0],o[1],self.Clip.boundingBox.children);n.length>0&&(self.Clip.currentClipPlane=n[0].object.name),void 0!=self.Clip.clipFace[self.Clip.currentClipPlane]?(S=!0,self.cameraControl.enabled=!1):self.Clip.currentClipPlane=""}else S=!1,self.cameraControl.enabled=!0}},self.modelCutting._onMouseUp=function(e){S=!1,self.cameraControl.enabled=!0},self.modelCutting._onMouseOut=function(){S=!1,self.cameraControl.enabled=!0},self.modelCutting._onMouseMove=function(w){var H=self._getClickCoordsWithinElement(w);if(self.Flag.clip&&!S&&!e.mouseDownLeft){M=H[0],L=H[1],self.Clip.currentClipPlane="";var B=self.pick(H[0],H[1],self.Clip.boundingBox.children);B.length>0&&(self.Clip.currentClipPlane=B[0].object.name),void 0!=self.Clip.clipFace[self.Clip.currentClipPlane]?(""==o?(o=self.Clip.currentClipPlane,(t=B[0].object).material.opacity=.3):B[0].object!=t&&(t.material.opacity=.15,o=self.Clip.currentClipPlane,(t=B[0].object).material.opacity=.3),self.viewportDiv.style.cursor="pointer"):(t.isMesh&&(t.material.opacity=.3,t={}),o="",self.viewportDiv.style.cursor="auto")}if(S){e.cuttingFlag=!0,self.Clip.cuttingfirst=!1;var X=self.camera.position.clone(),D=self.cameraControl.target.clone(),J=X.distanceTo(D)/5e3;"front"==self.Clip.currentClipPlane&&(Math.abs(X.x)>Math.abs(Y)&&(Z=X.y<n?(H[0]-M)*J:(M-H[0])*J,y=X.z>s?(H[1]-L)*J:(L-H[1])*J),M=H[0],L=H[1]),"back"==self.Clip.currentClipPlane&&(Math.abs(X.x)>Math.abs(E)&&(Z=X.y>n?(H[0]-M)*J:(M-H[0])*J,y=X.z>s?(H[1]-L)*J:(L-H[1])*J),M=H[0],L=H[1]),"top"==self.Clip.currentClipPlane&&(Math.abs(X.z)<Math.abs(v)?(Z=(H[0]-M)*J,y=(H[1]-L)*J):(Z=(M-H[0])*J,y=(L-H[1])*J),M=H[0],L=H[1]),"bottom"==self.Clip.currentClipPlane&&(Math.abs(X.z)>Math.abs(T)?(Z=(H[0]-M)*J,y=(H[1]-L)*J):(Z=(M-H[0])*J,y=(L-H[1])*J),M=H[0],L=H[1]),"right"==self.Clip.currentClipPlane&&(Math.abs(X.y)>Math.abs(b)&&(Z=X.x>0?(H[0]-M)*J:(M-H[0])*J,y=X.z>0?(H[1]-L)*J:(L-H[1])*J),M=H[0],L=H[1]),"left"==self.Clip.currentClipPlane&&(Math.abs(X.y)>Math.abs(C)&&(Z=X.x<0?(H[0]-M)*J:(M-H[0])*J,y=X.z>0?(H[1]-L)*J:(L-H[1])*J),M=H[0],L=H[1]);var x=0;if(x=Math.abs(Z)>=Math.abs(y)?Z:y,m+=x*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].x),h+=x*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].y),g+=x*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].z),m<0)return void(m-=x*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].x));if(h<0)return void(h-=x*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].y));if(g<0)return void(g-=x*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].z));if(u-=x*-self.Clip.clipFace[self.Clip.currentClipPlane].x,p-=x*-self.Clip.clipFace[self.Clip.currentClipPlane].y,f-=x*-self.Clip.clipFace[self.Clip.currentClipPlane].z,parseFloat((m+u).toFixed(10))>parseFloat((l+i).toFixed(10))||parseFloat((u-m).toFixed(10))<parseFloat((l-i).toFixed(10)))return m-=x,void(u-=x*self.Clip.clipFace[self.Clip.currentClipPlane].x);if(parseFloat((h+p).toFixed(10))>parseFloat((c+a).toFixed(10))||parseFloat((p-h).toFixed(10))<parseFloat((c-a).toFixed(10)))return h-=x,void(p-=x*self.Clip.clipFace[self.Clip.currentClipPlane].y);if(parseFloat((g+f).toFixed(10))>parseFloat((d+r).toFixed(10))||parseFloat((f-g).toFixed(10))<parseFloat((d-r).toFixed(10)))return g-=x,void(f-=x*self.Clip.clipFace[self.Clip.currentClipPlane].z);if(m<0||h<0||g<0)return;Y=u+m,E=u-m,v=f+g,T=f-g,b=p+h,C=p-h,self.cutting(m,h,g,u,p,f,J)}else e.cuttingFlag=!1},self.renderer.domElement.addEventListener("mouseout",self.modelCutting._onMouseOut,!1),self.renderer.domElement.addEventListener("mousedown",self.modelCutting._onMouseDown,!1),self.renderer.domElement.addEventListener("mouseup",self.modelCutting._onMouseUp,!1),self.renderer.domElement.addEventListener("mousemove",self.modelCutting._onMouseMove,!1),self.modelCutting._onTouchStart=function(e){w=!0;var n=[e.changedTouches[0].clientX,e.changedTouches[0].clientY];M=n[0],L=n[1],self.Clip.currentClipPlane="";var s=self.pick(n[0],n[1],self.Clip.boundingBox.children);s.length>0&&(self.Clip.currentClipPlane=s[0].object.name,S=!0,self.cameraControl.enabled=!1),void 0!=self.Clip.clipFace[self.Clip.currentClipPlane]?(""==o?(o=self.Clip.currentClipPlane,(t=s[0].object).material.opacity=.3,console.log(s[0])):s[0].object!=t&&(t.material.opacity=.15,o=self.Clip.currentClipPlane,(t=s[0].object).material.opacity=.3),self.viewportDiv.style.cursor="pointer"):(t.isMesh&&(t.material.opacity=.3,t={}),o="",self.viewportDiv.style.cursor="auto")},self.modelCutting._onTouchEnd=function(e){w=!1,S=!1,self.cameraControl.enabled=!0},self.modelCutting._onTouchMove=function(t){var o=[t.changedTouches[0].clientX,t.changedTouches[0].clientY];if(S){e.cuttingFlag=!0,self.Clip.cuttingfirst=!1;var w=self.camera.position.clone(),H=self.cameraControl.target.clone(),B=w.distanceTo(H)/5e3;"front"==self.Clip.currentClipPlane&&(Math.abs(w.x)>Math.abs(Y)&&(Z=w.y<n?(o[0]-M)*B:(M-o[0])*B,y=w.z>s?(o[1]-L)*B:(L-o[1])*B),M=o[0],L=o[1]),"back"==self.Clip.currentClipPlane&&(Math.abs(w.x)>Math.abs(E)&&(Z=w.y>n?(o[0]-M)*B:(M-o[0])*B,y=w.z>s?(o[1]-L)*B:(L-o[1])*B),M=o[0],L=o[1]),"top"==self.Clip.currentClipPlane&&(Math.abs(w.z)<Math.abs(v)?(Z=(o[0]-M)*B,y=(o[1]-L)*B):(Z=(M-o[0])*B,y=(L-o[1])*B),M=o[0],L=o[1]),"bottom"==self.Clip.currentClipPlane&&(Math.abs(w.z)>Math.abs(T)?(Z=(o[0]-M)*B,y=(o[1]-L)*B):(Z=(M-o[0])*B,y=(L-o[1])*B),M=o[0],L=o[1]),"right"==self.Clip.currentClipPlane&&(Math.abs(w.y)>Math.abs(b)&&(Z=w.x>0?(o[0]-M)*B:(M-o[0])*B,y=w.z>0?(o[1]-L)*B:(L-o[1])*B),M=o[0],L=o[1]),"left"==self.Clip.currentClipPlane&&(Math.abs(w.y)>Math.abs(C)&&(Z=w.x<0?(o[0]-M)*B:(M-o[0])*B,y=w.z>0?(o[1]-L)*B:(L-o[1])*B),M=o[0],L=o[1]);var X=0;if(X=Math.abs(Z)>=Math.abs(y)?Z:y,m+=X*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].x),h+=X*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].y),g+=X*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].z),m<0)return void(m-=X*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].x));if(h<0)return void(h-=X*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].y));if(g<0)return void(g-=X*Math.abs(self.Clip.clipFace[self.Clip.currentClipPlane].z));if(u-=X*-self.Clip.clipFace[self.Clip.currentClipPlane].x,p-=X*-self.Clip.clipFace[self.Clip.currentClipPlane].y,f-=X*-self.Clip.clipFace[self.Clip.currentClipPlane].z,parseFloat((m+u).toFixed(10))>parseFloat((l+i).toFixed(10))||parseFloat((u-m).toFixed(10))<parseFloat((l-i).toFixed(10)))return m-=X,u-=X*self.Clip.clipFace[self.Clip.currentClipPlane].x,void console.log("x:error");if(parseFloat((h+p).toFixed(10))>parseFloat((c+a).toFixed(10))||parseFloat((p-h).toFixed(10))<parseFloat((c-a).toFixed(10)))return h-=X,p-=X*self.Clip.clipFace[self.Clip.currentClipPlane].y,void console.log("y:error");if(parseFloat((g+f).toFixed(10))>parseFloat((d+r).toFixed(10))||parseFloat((f-g).toFixed(10))<parseFloat((d-r).toFixed(10)))return g-=X,f-=X*self.Clip.clipFace[self.Clip.currentClipPlane].z,void console.log("z:error");if(m<0||h<0||g<0)return void console.log("xyz:小于0");Y=u+m,E=u-m,v=f+g,T=f-g,b=p+h,C=p-h,self.cutting(m,h,g,u,p,f,B)}else e.cuttingFlag=!1},self.renderer.domElement.addEventListener("touchstart",self.modelCutting._onTouchStart,!1),self.renderer.domElement.addEventListener("touchend",self.modelCutting._onTouchEnd,!1),self.renderer.domElement.addEventListener("touchmove",self.modelCutting._onTouchMove,!1)}else self.renderer.domElement.removeEventListener("mouseout",self.modelCutting._onMouseOut,!1),self.renderer.domElement.removeEventListener("mousedown",self.modelCutting._onMouseDown,!1),self.renderer.domElement.removeEventListener("mouseup",self.modelCutting._onMouseUp,!1),self.renderer.domElement.removeEventListener("mousemove",self.modelCutting._onMouseMove,!1),self.renderer.domElement.removeEventListener("touchstart",self.modelCutting._onTouchStart,!1),self.renderer.domElement.removeEventListener("touchend",self.modelCutting._onTouchEnd,!1),self.renderer.domElement.removeEventListener("touchmove",self.modelCutting._onTouchMove,!1)},this.cutting=function(e,t,o,n,s,i,a){self.scene.remove(self.Clip.boundingBox),self.Clip.boundingBox=new THREE.Object3D,void 0==a&&(a=.1),self.Clip.state.x=e,self.Clip.state.y=t,self.Clip.state.z=o,self.Clip.state.x1=n,self.Clip.state.y1=s,self.Clip.state.z1=i,self.Clip.state.sensitivity=a,self.Clip.cuttingfirst?(self.Clip.clipPlane[0].constant=a-(n-e),self.Clip.clipPlane[1].constant=a+(n+e),self.Clip.clipPlane[2].constant=a-(s-t),self.Clip.clipPlane[3].constant=a+(s+t),self.Clip.clipPlane[4].constant=a-(i-o),self.Clip.clipPlane[5].constant=a+(i+o),self.renderer.clippingPlanes=self.Clip.clipPlane):(self.Clip.clipPlane[0].constant=a-(n-e),self.Clip.clipPlane[1].constant=a+(n+e),self.Clip.clipPlane[2].constant=a-(s-t),self.Clip.clipPlane[3].constant=a+(s+t),self.Clip.clipPlane[4].constant=a-(i-o),self.Clip.clipPlane[5].constant=a+(i+o));var r=new THREE.BufferGeometry;r.setIndex([0,1,2,0,2,3]);var l=new Float32Array([e,t,o,e,-t,o,e,-t,-o,e,t,-o]);r.addAttribute("position",new THREE.BufferAttribute(l,3));var c=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));c.translateX(n).translateY(s).translateZ(i).name="front",self.Clip.boundingBox.add(c);var d=new THREE.BufferGeometry;d.setIndex([0,1,2,0,2,3]),l=new Float32Array([-e,t,o,-e,t,-o,-e,-t,-o,-e,-t,o]),d.addAttribute("position",new THREE.BufferAttribute(l,3));var u=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));u.translateX(n).translateY(s).translateZ(i).name="back",self.Clip.boundingBox.add(u);var p=new THREE.BufferGeometry;p.setIndex([0,1,2,0,2,3]),l=new Float32Array([e,t,o,e,t,-o,-e,t,-o,-e,t,o]),p.addAttribute("position",new THREE.BufferAttribute(l,3));var f=new THREE.Mesh(p,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));f.translateX(n).translateY(s).translateZ(i).name="right",self.Clip.boundingBox.add(f);var m=new THREE.BufferGeometry;m.setIndex([0,1,2,0,2,3]),l=new Float32Array([-e,-t,-o,e,-t,-o,e,-t,o,-e,-t,o]),m.addAttribute("position",new THREE.BufferAttribute(l,3));var h=new THREE.Mesh(m,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));h.translateX(n).translateY(s).translateZ(i).name="left",self.Clip.boundingBox.add(h);var g=new THREE.BufferGeometry;g.setIndex([0,1,2,0,2,3]),l=new Float32Array([e,t,o,-e,t,o,-e,-t,o,e,-t,o]),g.addAttribute("position",new THREE.BufferAttribute(l,3));var Y=new THREE.Mesh(g,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));Y.translateX(n).translateY(s).translateZ(i).name="top",self.Clip.boundingBox.add(Y);var E=new THREE.BufferGeometry;E.setIndex([0,1,2,0,2,3]),l=new Float32Array([e,-t,-o,-e,-t,-o,-e,t,-o,e,t,-o]),E.addAttribute("position",new THREE.BufferAttribute(l,3));var v=new THREE.Mesh(E,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));v.translateX(n).translateY(s).translateZ(i).name="bottom",self.Clip.boundingBox.add(v),self.scene.add(self.Clip.boundingBox)},this.closeOrResetClips=function(e){if(self.Flag.clip)if(self.Clip.state={},void 0!=e&&e)void 0!=self.Clip.boundingBox&&(self.scene.remove(self.Clip.boundingBox),self.Flag.clip=!1,self.renderer.clippingPlanes=self.Clip.Empty,self.Clip.cuttingfirst=!0);else{var t=self.modelBounds.max.x/2+Math.abs(self.modelBounds.min.x/2)+.1,o=self.modelBounds.max.y/2+Math.abs(self.modelBounds.min.y/2)+.1,n=self.modelBounds.max.z/2+Math.abs(self.modelBounds.min.z/2)+.1,s=self.modelBounds.max.x/2-Math.abs(self.modelBounds.min.x/2),i=self.modelBounds.max.y/2-Math.abs(self.modelBounds.min.y/2),a=self.modelBounds.max.z/2-Math.abs(self.modelBounds.min.z/2);self.cutting(t,o,n,s,i,a)}},this.selecting=function(e,t,o,n,s,i,a){self.scene.remove(self.SelectBox.boundingBox),self.SelectBox.boundingBox=new THREE.Object3D;var r=new THREE.BufferGeometry;r.setIndex([0,1,2,0,2,3]);var l=new Float32Array([e,t,o,e,-t,o,e,-t,-o,e,t,-o]);r.addAttribute("position",new THREE.BufferAttribute(l,3));var c=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));c.translateX(n).translateY(s).translateZ(i).name="front",self.SelectBox.boundingBox.add(c);var d=new THREE.BufferGeometry;d.setIndex([0,1,2,0,2,3]),l=new Float32Array([-e,t,o,-e,t,-o,-e,-t,-o,-e,-t,o]),d.addAttribute("position",new THREE.BufferAttribute(l,3));var u=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));u.translateX(n).translateY(s).translateZ(i).name="back",self.SelectBox.boundingBox.add(u);var p=new THREE.BufferGeometry;p.setIndex([0,1,2,0,2,3]),l=new Float32Array([e,t,o,e,t,-o,-e,t,-o,-e,t,o]),p.addAttribute("position",new THREE.BufferAttribute(l,3));var f=new THREE.Mesh(p,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));f.translateX(n).translateY(s).translateZ(i).name="right",self.SelectBox.boundingBox.add(f);var m=new THREE.BufferGeometry;m.setIndex([0,1,2,0,2,3]),l=new Float32Array([-e,-t,-o,e,-t,-o,e,-t,o,-e,-t,o]),m.addAttribute("position",new THREE.BufferAttribute(l,3));var h=new THREE.Mesh(m,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));h.translateX(n).translateY(s).translateZ(i).name="left",self.SelectBox.boundingBox.add(h);var g=new THREE.BufferGeometry;g.setIndex([0,1,2,0,2,3]),l=new Float32Array([e,t,o,-e,t,o,-e,-t,o,e,-t,o]),g.addAttribute("position",new THREE.BufferAttribute(l,3));var Y=new THREE.Mesh(g,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));Y.translateX(n).translateY(s).translateZ(i).name="top",self.SelectBox.boundingBox.add(Y);var E=new THREE.BufferGeometry;E.setIndex([0,1,2,0,2,3]),l=new Float32Array([e,-t,-o,-e,-t,-o,-e,t,-o,e,t,-o]),E.addAttribute("position",new THREE.BufferAttribute(l,3));var v=new THREE.Mesh(E,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));v.translateX(n).translateY(s).translateZ(i).name="bottom",self.SelectBox.boundingBox.add(v),self.scene.add(self.SelectBox.boundingBox);var T=new THREE.Box3(new THREE.Vector3(-e+n,-t+s,-o+i),new THREE.Vector3(e+n,t+s,o+i));self.SelectBox.selectBox||(self.SelectBox.selectBox=T,self.SelectBox.selected=self.alloids,self.objectSet.addObjectIds(self.alloids));var b=null;self.objectSet.listener.on("updated",function(){self.SelectBox.selected.length!=self.objectSet.numObjects&&0==self.objectSet.numObjects&&self.Flag.selectBox&&(b=self.selectComponentByBox(self.SelectBox.selectBox,self.alloids),self.SelectBox.selected=b.selected,self.SelectBox.unselected=b.unselected,self.objectSet.addObjectIds(b.selected),self.transparentObjs(b.unselected,.4))}),self.SelectBox.selectBox.containsBox(T)?(b=self.selectComponentByBox(T,self.SelectBox.selected),self.SelectBox.unselected=self.SelectBox.unselected.concat(b.unselected),self.SelectBox.selected=b.selected,self.objectSet.removeObjectIds(b.unselected),self.transparentObjs(b.unselected,.4),b=null):(b=self.selectComponentByBox(T,self.SelectBox.unselected),self.SelectBox.selected=self.SelectBox.selected.concat(b.selected),self.SelectBox.unselected=b.unselected,self.closeTransparentObjs(b.selected),self.objectSet.addObjectIds(b.selected),self.transparentObjs(b.unselected,.4),b=null),self.SelectBox.selectBox=T,T=null},this.selectBoundingBox=function(){var e,t,o,n,s,i,a=self.input,r={},l="",c=(self.modelBounds.getCenter().x,self.modelBounds.getCenter().y),d=self.modelBounds.getCenter().z,u=self.modelBounds.getSize().x/2+.1,p=self.modelBounds.getSize().y/2+.1,f=self.modelBounds.getSize().z/2+.1,m=self.modelBounds.getCenter().x,h=self.modelBounds.getCenter().y,g=self.modelBounds.getCenter().z;if(self.objectSet.numObjects>0){var Y=self.objectSet.getBoundary();n=Y.getSize().x/2+.1,s=Y.getSize().y/2+.1,i=Y.getSize().z/2+.1,e=Y.getCenter().x,t=Y.getCenter().y,o=Y.getCenter().z,Y.getCenter().x,c=Y.getCenter().y,d=Y.getCenter().z}else e=m,t=h,o=g,n=u,s=p,i=f;var E=e+n,v=e-n,T=o+i,b=o-i,C=t+s,M=t-s;if(self.Flag.selectBox?(self.Flag.selectBox=!1,self.objectSet.clear(),self.scene.remove(self.SelectBox.boundingBox),self.SelectBox.selectBox=void 0,self.closeTransparentObjs(self.SelectBox.unselected),self.SelectBox.selected=[],self.SelectBox.unselected=[],self.cameraControl.enabled=!0):(self.Flag.selectBox=!0,self.selecting(n,s,i,e,t,o)),self.Flag.selectBox){var L,S,Z,y=0,w=0,H=!1;self.selectBoundingBox._onMouseDown=function(e){if(!H){var t=self._getClickCoordsWithinElement(e);if(a.mouseDownLeft){L=t[0],S=t[1],self.SelectBox.currentSelectPlane="";var o=self.pick(t[0],t[1],self.SelectBox.boundingBox.children);o.length>0&&(self.SelectBox.currentSelectPlane=o[0].object.name),void 0!=self.SelectBox.selectFace[self.SelectBox.currentSelectPlane]?(Z=!0,self.cameraControl.enabled=!1):self.SelectBox.currentSelectPlane=""}else Z=!1,self.cameraControl.enabled=!0}},self.selectBoundingBox._onMouseUp=function(e){Z=!1,self.cameraControl.enabled=!0},self.selectBoundingBox._onMouseOut=function(e){Z=!1,self.cameraControl.enabled=!0},self.selectBoundingBox._onMouseMove=function(Y){var H=self._getClickCoordsWithinElement(Y);if(self.Flag.selectBox&&!Z&&!a.mouseDownLeft){L=H[0],S=H[1],self.SelectBox.currentSelectPlane="";var B=self.pick(H[0],H[1],self.SelectBox.boundingBox.children);B.length>0&&(self.SelectBox.currentSelectPlane=B[0].object.name),void 0!=self.SelectBox.selectFace[self.SelectBox.currentSelectPlane]?(""==l?(l=self.SelectBox.currentSelectPlane,(r=B[0].object).material.opacity=.3):B[0].object!=r&&(r.material.opacity=.15,l=self.SelectBox.currentSelectPlane,(r=B[0].object).material.opacity=.3),self.viewportDiv.style.cursor="pointer"):(r.isMesh&&(r.material.opacity=.15,r={}),l="",self.viewportDiv.style.cursor="auto")}if(Z){a.selectingFlag=!0,self.Clip.cuttingfirst=!1;var X=self.camera.position.clone(),D=self.cameraControl.target.clone(),J=X.distanceTo(D)/5e3;"front"==self.SelectBox.currentSelectPlane&&(Math.abs(X.x)>Math.abs(E)&&(y=X.y<c?(H[0]-L)*J:(L-H[0])*J,w=X.z>d?(H[1]-S)*J:(S-H[1])*J),L=H[0],S=H[1]),"back"==self.SelectBox.currentSelectPlane&&(Math.abs(X.x)>Math.abs(v)&&(y=X.y>c?(H[0]-L)*J:(L-H[0])*J,w=X.z>d?(H[1]-S)*J:(S-H[1])*J),L=H[0],S=H[1]),"top"==self.SelectBox.currentSelectPlane&&(Math.abs(X.z)<Math.abs(T)?(y=(H[0]-L)*J,w=(H[1]-S)*J):(y=(L-H[0])*J,w=(S-H[1])*J),L=H[0],S=H[1]),"bottom"==self.SelectBox.currentSelectPlane&&(Math.abs(X.z)>Math.abs(b)?(y=(H[0]-L)*J,w=(H[1]-S)*J):(y=(L-H[0])*J,w=(S-H[1])*J),L=H[0],S=H[1]),"right"==self.SelectBox.currentSelectPlane&&(Math.abs(X.y)>Math.abs(C)&&(y=X.x>0?(H[0]-L)*J:(L-H[0])*J,w=X.z>0?(H[1]-S)*J:(S-H[1])*J),L=H[0],S=H[1]),"left"==self.SelectBox.currentSelectPlane&&(Math.abs(X.y)>Math.abs(M)&&(y=X.x<0?(H[0]-L)*J:(L-H[0])*J,w=X.z>0?(H[1]-S)*J:(S-H[1])*J),L=H[0],S=H[1]);var x=0;if(x=Math.abs(y)>=Math.abs(w)?y:w,n+=x*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x),s+=x*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y),i+=x*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z),n<0)return void(n-=x*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x));if(s<0)return void(s-=x*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y));if(i<0)return void(i-=x*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z));if(e-=x*-self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x,t-=x*-self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y,o-=x*-self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z,parseFloat((n+e).toFixed(10))>parseFloat((m+u).toFixed(10))||parseFloat((e-n).toFixed(10))<parseFloat((m-u).toFixed(10)))return n-=x,void(e-=x*self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x);if(parseFloat((s+t).toFixed(10))>parseFloat((h+p).toFixed(10))||parseFloat((t-s).toFixed(10))<parseFloat((h-p).toFixed(10)))return s-=x,void(t-=x*self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y);if(parseFloat((i+o).toFixed(10))>parseFloat((g+f).toFixed(10))||parseFloat((o-i).toFixed(10))<parseFloat((g-f).toFixed(10)))return i-=x,void(o-=x*self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z);if(n<0||s<0||i<0)return;E=e+n,v=e-n,T=o+i,b=o-i,C=t+s,M=t-s,self.selecting(n,s,i,e,t,o,J)}else a.selectingFlag=!1},self.renderer.domElement.addEventListener("mouseout",self.selectBoundingBox._onMouseOut,!1),self.renderer.domElement.addEventListener("mousedown",self.selectBoundingBox._onMouseDown,!1),self.renderer.domElement.addEventListener("mouseup",self.selectBoundingBox._onMouseUp,!1),self.renderer.domElement.addEventListener("mousemove",self.selectBoundingBox._onMouseMove,!1),self.selectBoundingBox._onTouchStart=function(e){H=!0;var t=[e.changedTouches[0].clientX,e.changedTouches[0].clientY];L=t[0],S=t[1],self.SelectBox.currentSelectPlane="";var o=self.pick(t[0],t[1],self.SelectBox.boundingBox.children);o.length>0&&(self.SelectBox.currentSelectPlane=o[0].object.name,Z=!0,self.cameraControl.enabled=!1),void 0!=self.SelectBox.selectFace[self.SelectBox.currentSelectPlane]?(""==l?(l=self.SelectBox.currentSelectPlane,(r=o[0].object).material.opacity=.3,console.log(o[0])):o[0].object!=r&&(r.material.opacity=.15,l=self.SelectBox.currentSelectPlane,(r=o[0].object).material.opacity=.3),self.viewportDiv.style.cursor="pointer"):(r.isMesh&&(r.material.opacity=.15,r={}),l="",self.viewportDiv.style.cursor="auto")},self.selectBoundingBox._onTouchEnd=function(e){H=!1,Z=!1,self.cameraControl.enabled=!0},self.selectBoundingBox._onTouchMove=function(r){var l=[r.changedTouches[0].clientX,r.changedTouches[0].clientY];if(Z){a.selectingFlag=!0;var Y=self.camera.position.clone(),H=self.cameraControl.target.clone(),B=Y.distanceTo(H)/5e3;"front"==self.SelectBox.currentSelectPlane&&(Math.abs(Y.x)>Math.abs(E)&&(y=Y.y<c?(l[0]-L)*B:(L-l[0])*B,w=Y.z>d?(l[1]-S)*B:(S-l[1])*B),L=l[0],S=l[1]),"back"==self.SelectBox.currentSelectPlane&&(Math.abs(Y.x)>Math.abs(v)&&(y=Y.y>c?(l[0]-L)*B:(L-l[0])*B,w=Y.z>d?(l[1]-S)*B:(S-l[1])*B),L=l[0],S=l[1]),"top"==self.SelectBox.currentSelectPlane&&(Math.abs(Y.z)<Math.abs(T)?(y=(l[0]-L)*B,w=(l[1]-S)*B):(y=(L-l[0])*B,w=(S-l[1])*B),L=l[0],S=l[1]),"bottom"==self.SelectBox.currentSelectPlane&&(Math.abs(Y.z)>Math.abs(b)?(y=(l[0]-L)*B,w=(l[1]-S)*B):(y=(L-l[0])*B,w=(S-l[1])*B),L=l[0],S=l[1]),"right"==self.SelectBox.currentSelectPlane&&(Math.abs(Y.y)>Math.abs(C)&&(y=Y.x>0?(l[0]-L)*B:(L-l[0])*B,w=Y.z>0?(l[1]-S)*B:(S-l[1])*B),L=l[0],S=l[1]),"left"==self.SelectBox.currentSelectPlane&&(Math.abs(Y.y)>Math.abs(M)&&(y=Y.x<0?(l[0]-L)*B:(L-l[0])*B,w=Y.z>0?(l[1]-S)*B:(S-l[1])*B),L=l[0],S=l[1]);var X=0;if(X=Math.abs(y)>=Math.abs(w)?y:w,n+=X*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x),s+=X*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y),i+=X*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z),n<0)return void(n-=X*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x));if(s<0)return void(s-=X*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y));if(i<0)return void(i-=X*Math.abs(self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z));if(e-=X*-self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x,t-=X*-self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y,o-=X*-self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z,parseFloat((n+e).toFixed(10))>parseFloat((m+u).toFixed(10))||parseFloat((e-n).toFixed(10))<parseFloat((m-u).toFixed(10)))return n-=X,e-=X*self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].x,void console.log("x:error");if(parseFloat((s+t).toFixed(10))>parseFloat((h+p).toFixed(10))||parseFloat((t-s).toFixed(10))<parseFloat((h-p).toFixed(10)))return s-=X,t-=X*self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].y,void console.log("y:error");if(parseFloat((i+o).toFixed(10))>parseFloat((g+f).toFixed(10))||parseFloat((o-i).toFixed(10))<parseFloat((g-f).toFixed(10)))return i-=X,o-=X*self.SelectBox.selectFace[self.SelectBox.currentSelectPlane].z,void console.log("z:error");if(n<0||s<0||i<0)return void console.log("xyz:小于0");E=e+n,v=e-n,T=o+i,b=o-i,C=t+s,M=t-s,self.selecting(n,s,i,e,t,o,B)}else a.selectingFlag=!1},self.renderer.domElement.addEventListener("touchstart",self.selectBoundingBox._onTouchStart,!1),self.renderer.domElement.addEventListener("touchend",self.selectBoundingBox._onTouchEnd,!1),self.renderer.domElement.addEventListener("touchmove",self.selectBoundingBox._onTouchMove,!1)}else self.renderer.domElement.removeEventListener("mouseout",self.selectBoundingBox._onMouseDown,!1),self.renderer.domElement.removeEventListener("mousedown",self.selectBoundingBox._onMouseDown,!1),self.renderer.domElement.removeEventListener("mouseup",self.selectBoundingBox._onMouseUp,!1),self.renderer.domElement.removeEventListener("mousemove",self.selectBoundingBox._onMouseMove,!1),self.renderer.domElement.removeEventListener("touchstart",self.selectBoundingBox._onTouchStart,!1),self.renderer.domElement.removeEventListener("touchend",self.selectBoundingBox._onTouchEnd,!1),self.renderer.domElement.removeEventListener("touchmove",self.selectBoundingBox._onTouchMove,!1)},this.selectComponentByBox=function(e,t){var o=[],n=[];if(!(!e instanceof THREE.Box3)){t||(t=self.alloids);for(var s=0;s<t.length;s++)if(self.components[t[s]]&&self.components[t[s]].visible){var i=(new THREE.Box3).expandByObject(self.components[t[s]]);e.min.x-.1<=i.min.x&&i.max.x<=e.max.x+.1&&e.min.y-.1<=i.min.y&&i.max.y<=e.max.y+.1&&e.min.z-.1<=i.min.z&&i.max.z<=e.max.z+.1?o.push(t[s]):n.push(t[s]),i=null}return{selected:o,unselected:n}}self.promptingMessage("warning","参数需要为 THREE.Box3 对象",!1)},this.getObjectByProperty=function(e,t,o,n){for(var s=0,i=o.children.length;s<i;s++){var a=o.children[s];if(a[e]===t)return a;if(n){var r=self.getObjectByProperty(e,t,a,!0);if(void 0!==r)return r}}},this.queryObjectIdByType=function(e){for(var t=[],o=0;o<self.root.children.length;o++)self.root.children[o].userData.type==e&&t.push(self.root.children[o].key);return t},this.queryResultByString=function(e,t,o){var n=Object.getOwnPropertyNames(self.components).length,s=0,i=!1,a=new RegExp(e,"ig");if("string"==typeof e)if("app"==self.type)for(var r in self.components){l={};self.componentInfo[r].name.search(a)>=0||self.componentInfo[r].type.search(a)>=0||self.componentInfo[r].ifcGuid.search(a)>=0?self.getComponentAttribute(r,function(e){s++,e&&(l=$.extend({},e)),l.name=self.componentInfo[r].name,l.ifcType=self.componentInfo[r].type,l.guid=self.componentInfo[r].ifcGuid,l.id=r,l["其他"]&&l["其他"]["类型"]&&(l["类型"]=l["其他"]["类型"]),i=!0,t(l),s>=n&&o()}):self.getComponentAttribute(r,function(e){s++,e&&JSON.stringify(e).search(a)>=0&&((l=jQuery.extend({},e)).name=self.componentInfo[r].name,l.ifcType=self.componentInfo[r].type,l.guid=self.componentInfo["component/"+r].guid,l.id=r,l["其他"]&&(l["其他"]["构件名称"]&&(l["构件名称"]=l["其他"]["构件名称"]),l["其他"]["类型"]&&(l["类型"]=l["其他"]["类型"])),i=!0,t(l)),s>=n&&o()})}else for(var r in self.components){var l={};self.componentInfo["component/"+r].name.search(a)>=0||self.componentInfo["component/"+r].type.search(a)>=0||self.componentInfo["component/"+r].guid.search(a)>=0?self.getComponentAttribute(r,function(e){s++,e&&(l=jQuery.extend({},e)),l.name=self.componentInfo["component/"+r].name,l.ifcType=self.componentInfo["component/"+r].type,l.guid=self.componentInfo["component/"+r].guid,l.id=r,l["其他"]&&l["其他"]["类型"]&&(l["类型"]=l["其他"]["类型"]),i=!0,t(l),s>=n&&o()}):self.getComponentAttribute(r,function(e){s++,e&&JSON.stringify(e).search(a)>=0&&((l=jQuery.extend({},e)).name=self.componentInfo["component/"+r].name,l.ifcType=self.componentInfo["component/"+r].type,l.guid=self.componentInfo["component/"+r].guid,l.id=r,l["其他"]&&(l["其他"]["构件名称"]&&(l["构件名称"]=l["其他"]["构件名称"]),l["其他"]["类型"]&&(l["类型"]=l["其他"]["类型"])),i=!0,t(l)),s>=n&&o()})}},this.getComponentTypeArray=function(){for(var e in self.componentType)self.componentType[e]=unique(self.componentType[e]);return self.componentType},this.lastCanvasContainerWidth=0,this.lastCanvasContainerHeight=0,this.lastCanvasflag=!1,this.resize=function(e,t){var o=800,n=800,s="#"+self.viewport;e&&t?($(s).height(e).width(t),self.camera.aspect=t/e,self.camera.updateProjectionMatrix(),self.renderer.setSize(t,e)):self.autoResize&&(n=window.innerHeight,o=window.innerWidth,$(s).height(n).width(o),$(s).height(n).width(o),self.camera.aspect=o/n,self.camera.updateProjectionMatrix(),self.renderer.setSize(o,n))};var promptingMessage1,promptingMessage2;this.measuredDistance=function(e){var t=self.input;if(self.Flag.measuredDistance?(self.Flag.measuredDistance=!1,self.ClickSelectObjects.enabled=!0,self.scene.remove(self.Measurement.measuredNode),self.scene.remove(self.Measurement.mark),self.Measurement={measuredNode:{},tempLine:new THREE.Object3D,tempPoint:new THREE.Object3D,point1:{},point2:{},pointCoord1:{},pointCorrd2:{},line:{},mark1:{},mark2:{},markX:{},markY:{},markZ:{},lineX:{},lineY:{},lineZ:{}},promptingMessage1&&(promptingMessage1.remove(),promptingMessage1=null),promptingMessage2&&(promptingMessage2.remove(),promptingMessage2=null)):(self.ClickSelectObjects.enabled=!1,self.Flag.measuredDistance=!0),t.theMeasuredDistance=self.Flag.measuredDistance,self.Flag.measuredDistance){promptingMessage1=self.promptingMessage("info","请选择第一个点",!1);var o,n,s=.1,i=!1,a=!0,r=!1,l=!1,c=new THREE.SphereBufferGeometry(1);self.Measurement.measuredNode=new THREE.Object3D,self.scene.add(self.Measurement.measuredNode);var d=new THREE.TextureLoader,u=d.load(self.imgURL+"measuredDistance/1.png"),p=d.load(self.imgURL+"measuredDistance/2.png"),f=d.load(self.imgURL+"measuredDistance/X.png"),m=d.load(self.imgURL+"measuredDistance/Y.png"),h=d.load(self.imgURL+"measuredDistance/Z.png"),g=new THREE.SpriteMaterial({map:u,color:16777215,depthTest:!1}),Y=new THREE.SpriteMaterial({map:p,color:16777215,depthTest:!1}),E=new THREE.SpriteMaterial({map:f,color:16777215,depthTest:!1}),v=new THREE.SpriteMaterial({map:m,color:16777215,depthTest:!1}),T=new THREE.SpriteMaterial({map:h,color:16777215,depthTest:!1});self.measuredDistance._onTick=self.listener.on("tick",function(){if(self.camera&&self.Flag.measuredDistance){var e=self.camera.position.clone(),t=self.cameraControl.target.clone(),o=e.distanceTo(t);s=o/350,$.isEmptyObject(self.Measurement.point1)||self.Measurement.point1.scale.set(o/200,o/200,o/200),$.isEmptyObject(self.Measurement.point2)||self.Measurement.point2.scale.set(o/200,o/200,o/200),$.isEmptyObject(self.Measurement.mark1)||self.Measurement.mark1.scale.set(o/30,o/30,1),$.isEmptyObject(self.Measurement.mark2)||self.Measurement.mark2.scale.set(o/30,o/30,1),$.isEmptyObject(self.Measurement.markX)||self.Measurement.markX.scale.set(o/30,o/30,1),$.isEmptyObject(self.Measurement.markY)||self.Measurement.markY.scale.set(o/30,o/30,1),$.isEmptyObject(self.Measurement.markZ)||self.Measurement.markZ.scale.set(o/30,o/30,1),e=null,t=null,o=null}}),self.measuredDistance._onMouseDown=function(e){var t=self._getClickCoordsWithinElement(e);o=t[0],n=t[1];self.pick(t[0],t[1],self.root.children).length>0&&(i=!0)},self.measuredDistance._onMouseMove=function(e){var t=self._getClickCoordsWithinElement(e);if((n!=t[1]||o!=t[0])&&!i){o=t[0],n=t[1];var s,l=self.pick(t[0],t[1],self.root.children);if(l.length>0)if(s=l[0].point,a){self.Measurement.measuredNode.remove(self.Measurement.point1);var d=new THREE.MeshBasicMaterial({color:415753,depthTest:!1});self.Measurement.point1=new THREE.Mesh(c,d),self.Measurement.point1.position.copy(s),self.Measurement.measuredNode.add(self.Measurement.point1)}else if(!r){self.Measurement.measuredNode.remove(self.Measurement.point2),self.Measurement.measuredNode.remove(self.Measurement.line);var u=new THREE.MeshBasicMaterial({color:new THREE.Color(.24,.52,.77),depthTest:!1});self.Measurement.point2=new THREE.Mesh(c,u),self.Measurement.point2.position.copy(s),self.Measurement.measuredNode.add(self.Measurement.point2);var p=new THREE.LineBasicMaterial({color:16776960,linewidth:10,depthTest:!1}),f=new THREE.Geometry;f.vertices.push(self.Measurement.pointCoord1,s),self.Measurement.line=new THREE.Line(f,p),self.Measurement.measuredNode.add(self.Measurement.line)}}},self.measuredDistance._onMouseUp=function(t){var s=self._getClickCoordsWithinElement(t);if(i&&(i=!1,(s[0]>o?s[0]-o<5:o-s[0]<5)&&(s[1]>n?s[1]-n<5:n-s[1]<5)))if(a)self.Measurement.point1.material.color.setRGB(.24,.52,.77),self.Measurement.pointCoord1=self.Measurement.point1.position.clone(),a=!1,self.Measurement.mark1=new THREE.Sprite(g),self.Measurement.mark1.position.copy(self.Measurement.pointCoord1),self.Measurement.measuredNode.add(self.Measurement.mark1),promptingMessage1&&(promptingMessage1.remove(),promptingMessage1=null),promptingMessage2=self.promptingMessage("info","请选择第二个点",!1),e({state:"first",result:self.Measurement.pointCoord1.clone()});else{r=!0,self.Measurement.mark2=new THREE.Sprite(Y),self.Measurement.mark2.position.copy(self.Measurement.point2.position),self.Measurement.measuredNode.add(self.Measurement.mark2);var l=new THREE.Vector3(self.Measurement.point2.position.x,self.Measurement.point1.position.y,self.Measurement.point1.position.z),c=new THREE.Vector3(self.Measurement.point2.position.x,self.Measurement.point1.position.y,self.Measurement.point2.position.z),d=new THREE.LineBasicMaterial({color:16711680,linewidth:10,depthTest:!1}),u=new THREE.LineBasicMaterial({color:65280,linewidth:10,depthTest:!1}),p=new THREE.LineBasicMaterial({color:255,linewidth:10,depthTest:!1}),f=new THREE.Geometry,m=new THREE.Geometry,h=new THREE.Geometry;f.vertices.push(self.Measurement.point1.position,l),h.vertices.push(l,c),m.vertices.push(c,self.Measurement.point2.position),self.Measurement.lineX=new THREE.Line(f,d),self.Measurement.lineY=new THREE.Line(m,u),self.Measurement.lineZ=new THREE.Line(h,p),self.Measurement.measuredNode.add(self.Measurement.lineX),self.Measurement.measuredNode.add(self.Measurement.lineY),self.Measurement.measuredNode.add(self.Measurement.lineZ),self.Measurement.markX=new THREE.Sprite(E),self.Measurement.markX.position.set((self.Measurement.point1.position.x+self.Measurement.point2.position.x)/2,self.Measurement.point1.position.y,self.Measurement.point1.position.z),self.Measurement.measuredNode.add(self.Measurement.markX),self.Measurement.markY=new THREE.Sprite(v),self.Measurement.markY.position.set(self.Measurement.point2.position.x,(self.Measurement.point1.position.y+self.Measurement.point2.position.y)/2,self.Measurement.point2.position.z),self.Measurement.measuredNode.add(self.Measurement.markY),self.Measurement.markZ=new THREE.Sprite(T),self.Measurement.markZ.position.set(self.Measurement.point2.position.x,self.Measurement.point1.position.y,(self.Measurement.point1.position.z+self.Measurement.point2.position.z)/2),self.Measurement.measuredNode.add(self.Measurement.markZ),promptingMessage2&&(promptingMessage2.remove(),promptingMessage2=null),e({state:"second",result:self.Measurement.point2.position.clone()})}},self.measuredDistance._onTouchStart=function(e){var t=[e.changedTouches[0].clientX,e.changedTouches[0].clientY];o=t[0],n=t[1];self.pick(t[0],t[1],self.root.children).length>0&&(l=!0)},self.measuredDistance._onTouchEnd=function(t){l=!1;var s=[t.changedTouches[0].clientX,t.changedTouches[0].clientY];if((s[0]>o?s[0]-o<5:o-s[0]<5)&&(s[1]>n?s[1]-n<5:n-s[1]<5)){o=s[0],n=s[1];var i,d=self.pick(s[0],s[1],self.root.children);if(d.length>0)if(i=d[0].point,a){self.Measurement.measuredNode.remove(self.Measurement.point1);var u=new THREE.MeshBasicMaterial({color:new THREE.Color(.24,.52,.77),depthTest:!1});self.Measurement.point1=new THREE.Mesh(c,u),self.Measurement.point1.position.copy(i),self.Measurement.pointCoord1=self.Measurement.point1.position.clone(),a=!1,self.Measurement.mark1=new THREE.Sprite(g),self.Measurement.mark1.position.copy(self.Measurement.pointCoord1),self.Measurement.measuredNode.add(self.Measurement.mark1),self.Measurement.measuredNode.add(self.Measurement.point1),promptingMessage1&&promptingMessage1.remove(),promptingMessage2=self.promptingMessage("info","请选择第二个点",!1),e({state:"first",result:self.Measurement.pointCoord1.clone()})}else if(!r){r=!0,self.Measurement.measuredNode.remove(self.Measurement.point2),self.Measurement.measuredNode.remove(self.Measurement.line);var p=new THREE.MeshBasicMaterial({color:new THREE.Color(.24,.52,.77),depthTest:!1});self.Measurement.point2=new THREE.Mesh(c,p),self.Measurement.point2.position.copy(i),self.Measurement.measuredNode.add(self.Measurement.point2);var f=new THREE.LineBasicMaterial({color:16776960,linewidth:10,depthTest:!1}),m=new THREE.Geometry;m.vertices.push(self.Measurement.pointCoord1,i),self.Measurement.line=new THREE.Line(m,f),self.Measurement.measuredNode.add(self.Measurement.line),r=!0,self.Measurement.mark2=new THREE.Sprite(Y),self.Measurement.mark2.position.copy(self.Measurement.point2.position),self.Measurement.measuredNode.add(self.Measurement.mark2);var h=new THREE.Vector3(self.Measurement.point2.position.x,self.Measurement.point1.position.y,self.Measurement.point1.position.z),b=new THREE.Vector3(self.Measurement.point2.position.x,self.Measurement.point1.position.y,self.Measurement.point2.position.z),C=new THREE.LineBasicMaterial({color:16711680,linewidth:10,depthTest:!1}),M=new THREE.LineBasicMaterial({color:65280,linewidth:10,depthTest:!1}),L=new THREE.LineBasicMaterial({color:255,linewidth:10,depthTest:!1}),S=new THREE.Geometry,Z=new THREE.Geometry,y=new THREE.Geometry;S.vertices.push(self.Measurement.point1.position,h),y.vertices.push(h,b),Z.vertices.push(b,self.Measurement.point2.position),self.Measurement.lineX=new THREE.Line(S,C),self.Measurement.lineY=new THREE.Line(Z,M),self.Measurement.lineZ=new THREE.Line(y,L),self.Measurement.measuredNode.add(self.Measurement.lineX),self.Measurement.measuredNode.add(self.Measurement.lineY),self.Measurement.measuredNode.add(self.Measurement.lineZ),self.Measurement.markX=new THREE.Sprite(E),self.Measurement.markX.position.set((self.Measurement.point1.position.x+self.Measurement.point2.position.x)/2,self.Measurement.point1.position.y,self.Measurement.point1.position.z),self.Measurement.measuredNode.add(self.Measurement.markX),self.Measurement.markY=new THREE.Sprite(v),self.Measurement.markY.position.set(self.Measurement.point2.position.x,(self.Measurement.point1.position.y+self.Measurement.point2.position.y)/2,self.Measurement.point2.position.z),self.Measurement.measuredNode.add(self.Measurement.markY),self.Measurement.markZ=new THREE.Sprite(T),self.Measurement.markZ.position.set(self.Measurement.point2.position.x,self.Measurement.point1.position.y,(self.Measurement.point1.position.z+self.Measurement.point2.position.z)/2),self.Measurement.measuredNode.add(self.Measurement.markZ),promptingMessage2&&promptingMessage2.remove(),e({state:"second",result:self.Measurement.point2.position.clone()})}}},self.renderer.domElement.addEventListener("mousedown",self.measuredDistance._onMouseDown,!1),self.renderer.domElement.addEventListener("mouseup",self.measuredDistance._onMouseUp,!1),self.renderer.domElement.addEventListener("mousemove",self.measuredDistance._onMouseMove,!1),self.renderer.domElement.addEventListener("touchstart",self.measuredDistance._onTouchStart,!1),self.renderer.domElement.addEventListener("touchend",self.measuredDistance._onTouchEnd,!1)}else self.listener.off(self.measuredDistance._onTick),self.renderer.domElement.removeEventListener("mousedown",self.measuredDistance._onMouseDown,!1),self.renderer.domElement.removeEventListener("mouseup",self.measuredDistance._onMouseUp,!1),self.renderer.domElement.removeEventListener("mousemove",self.measuredDistance._onMouseMove,!1),self.renderer.domElement.removeEventListener("touchstart",self.measuredDistance._onTouchStart,!1),self.renderer.domElement.removeEventListener("touchend",self.measuredDistance._onTouchEnd,!1)},$(window).on("resize",self.resize),$(document).ready(function(){$(document).trigger("click")}),this.theFirstPerspective=function(){function e(e,o){if(self.camera&&e&&e.isVector3){self.cameraControl.dispose();var n=new BIMWINNER.FirstPersonControls(self.camera,self.renderer.domElement,self);n.target.copy(self.cameraControl.target),self.cameraControl=n,self.camera.position.copy(e),self.camera.zoom=.5,e=null,self.cameraControl.movementSpeed=50,self.cameraControl.lookSpeed=.125,self.cameraControl.lookVertical=!0,self.cameraControl.constrainVertical=!0,o&&o.remove(),self.ClickSelectObjects.enabled=!0,self.listener.off(self.theFirstPerspective._onTick),t.listener.off(self.theFirstPerspective._onMouseDown),t.listener.off(self.theFirstPerspective._onMouseUp),t.listener.off(self.theFirstPerspective._onTouchStart),t.listener.off(self.theFirstPerspective._onTouchEnd)}}var t=self.input,o=!1;return function(n){if(o){o=!1,self.cameraControl.dispose();var s=perspectiveCameraControl;s.target.copy(self.cameraControl.target),self.cameraControl=s,self.cameraControl.activeEventListener()}else o=!0;if(o)if(n){if(n.isVector3)e(n);else if($.isArray(n)){e(new THREE.Vector3(n[0],n[1],n[2]))}}else{var i=0,a=0,r=Lobibox.notify("info",{size:"mini",rounded:!0,position:"center top",sound:!1,delay:!1,msg:"请用鼠标点击选择漫游起点"});self.ClickSelectObjects.enabled=!1,self.theFirstPerspective._onMouseDown=t.listener.on("mousedown",function(e){i=e[0],a=e[1]}),self.theFirstPerspective._onMouseUp=t.listener.on("mouseup",function(t){if((t[0]>i?t[0]-i<5:i-t[0]<5)&&(t[1]>a?t[1]-a<5:a-t[1]<5)){i=t[0],a=t[1];var o=self.pick(t[0],t[1],self.root.children);o.length>0&&e(o[0].point,r)}}),self.theFirstPerspective._onTouchStart=t.listener.on("touchstart",function(e){i=e[0],a=e[1]}),self.theFirstPerspective._onTouchEnd=t.listener.on("touchend",function(t){if((t[0]>i?t[0]-i<5:i-t[0]<5)&&(t[1]>a?t[1]-a<5:a-t[1]<5)){i=t[0],a=t[1];var o=self.pick(t[0],t[1],self.root.children);o.length>0&&e(o[0].point,r)}})}}}(),this.pick=function(e,t,o){var n=new THREE.Raycaster,s=new THREE.Vector3(e/self.renderer.domElement.clientWidth*2-1,-t/self.renderer.domElement.clientHeight*2+1,.5);n.setFromCamera(s,self.camera);var i=n.intersectObjects(o);return n=null,s=null,i},this._getClickCoordsWithinElement=function(e){var t=[0,0];if(e){for(var o=e.target,n=0,s=0;o.offsetParent;)n+=o.offsetLeft,s+=o.offsetTop,o=o.offsetParent;t[0]=e.pageX-n,t[1]=e.pageY-s}else e=window.event,t.x=e.x,t.y=e.y;return t},this.get2DCoordFrom3DCoord=function(e){var t,o=[];if(e.isVector3)return t=e.distanceTo(self.camera.position),e.project(self.camera),o[0]=(e.x+1)*self.renderer.domElement.clientWidth/2,o[1]=(1-e.y)*self.renderer.domElement.clientHeight/2,o[2]=t,o;if($.isArray(e)){var n=new THREE.Vector3(e[0],e[1],e[2]);return t=n.distanceTo(self.camera.position),n.project(self.camera),o[0]=(n.x+1)*self.renderer.domElement.clientWidth/2,o[1]=(1-n.y)*self.renderer.domElement.clientHeight/2,o[2]=t,n=null,o}},this.get3DCoordFrom2DCoord=function(e){var t=[];if(e.isVector2){var o=new THREE.Vector3(e.x,e.y,0);return o.unproject(self.camera),t[0]=o.x/self.renderer.domElement.clientWidth*2-1,t[1]=-o.y/self.renderer.domElement.clientHeight*2+1,t[2]=0,t}if($.isArray(e)){var n=new THREE.Vector3(e[0],e[1],0);return n.unproject(self.camera),t[0]=n.x/self.renderer.domElement.clientWidth*2-1,t[1]=-n.y/self.renderer.domElement.clientHeight*2+1,t[2]=0,t}},this.setSceneBackGroundColor=function(e){self.scene.background=new THREE.Color(e[0],e[1],e[2])},this.getModelPhoto=function(){return{imgURL:self.renderer.domElement.toDataURL("image/png"),height:$(self.renderer.domElement).height(),width:$(self.renderer.domElement).width()}},this.setSceneBackGroundImage=function(e){(new THREE.TextureLoader).load(e,function(e){self.scene.background=e})},this.adaptiveSize=function(e){var t=void 0;if(Array.isArray(e)&&e.length>0){for(var o=!0,n=0;n<e.length;n++)if(self.components[e[n]].visible&&void 0!==self.components[e[n]].visible){var s=(new THREE.Box3).expandByObject(self.components[e[n]]);o?(t=s.clone(),o=!1):t.union(s),s=null}}else t=$.isEmptyObject(self.objectSet.objects)?self.modelBounds:self.objectSet.getBoundary();if(t.isBox3){var i=t.getCenter(),a=(new THREE.Vector3).copy(self.cameraControl.target).sub(i),r=new THREE.Vector3(t.max.x+t.getSize().x,t.max.y+t.getSize().y,t.max.z+t.getSize().z).sub(i),l=(new THREE.Vector3).copy(self.camera.position).sub(a).sub(i).setLength(r.length()).add(i);self.fly.flyTo({eye:l,look:i})}},$(self.viewportDiv).attr("tabindex",1).keyup(function(e){var t;"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("h"==e.key&&(t=self.arrayConversion(),self.hideObjs(t)),"i"==e.key&&(t=self.arrayConversion(),self.isolationObjs(t)),"t"==e.key&&(t=self.arrayConversion(),self.transparentObjs(t)),"l"==e.key&&(t=self.arrayConversion(),self.wireframeObjs(t)),"g"==e.key&&(t=self.arrayConversion(),self.highlightObjs(t)),e.ctrlKey||(self.multiSelect=!1),"Escape"==e.key&&self.listener.fire("esc",!0,!0),"Delete"==e.key&&self.listener.fire("delete",!0,!0))}),$(self.viewportDiv).attr("tabindex",1).keydown(function(e){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&e.ctrlKey&&(self.multiSelect=!0)}),this.jishu=function(){for(var e=0,t=0,o=0,n=0,s=self.root.children.length;n<s;n++){self.root.children[n].traverseVisible(function(n){if(e++,n instanceof THREE.Mesh){var s=n.geometry;s instanceof THREE.Geometry?(t+=s.vertices.length,o+=s.faces.length):s instanceof THREE.BufferGeometry&&(null!==s.index?(t+=3*s.index.count,o+=s.index.count):(t+=s.attributes.position.count,o+=s.attributes.position.count/3))}})}console.log("objects: "+e+"  vertices: "+t+"  triangles:"+o)},this.fixedCameraAngle=function(e){if(self.cameraControl instanceof BIMWINNER.OrbitControls){var t=.25*Math.PI;e&&(t=e),self.cameraControl.minPolarAngle=t,self.cameraControl.maxPolarAngle=t}},this.freeCameraAnale=function(){self.cameraControl instanceof BIMWINNER.OrbitControls&&(self.cameraControl.minPolarAngle=0,self.cameraControl.maxPolarAngle=Math.PI)},this.deletePath=function(e){self.scene.remove(e)},this.drawPath=function(e,t,o){var n={segment:!1,color:[1,1,1]},s={URL:"",width:1,height:1,scale:[1,1,1],color:[1,1,1],emissive:[0,0,0]};if(!Array.isArray(e)||e.length<1)return!1;var i={};if("line"===t){i=$.extend({},n,o);for(var a=new THREE.Vector3,r=new THREE.Geometry,l=new THREE.LineBasicMaterial({color:new THREE.Color(i.color[0],i.color[1],i.color[2]),linewidth:10,depthTest:!1}),c=0;c<e.length;c++)a.fromArray(e[c]),r.vertices.push(a.clone());var d;return d=i.segment?new THREE.Line(r,l):new THREE.LineSegments(r,l),self.scene.add(d),d}if("image"===t){i=$.extend({},s,o);for(var u=new THREE.Object3D,p=(new THREE.TextureLoader).load(i.URL),f=new THREE.MeshPhongMaterial({map:p,side:THREE.DoubleSide,transparent:!0,color:new THREE.Color(i.color[0],i.color[1],i.color[2]),emissive:new THREE.Color(i.emissive[0],i.emissive[1],i.emissive[2])}),m=new THREE.PlaneBufferGeometry(i.width,i.height,1,1),h=new THREE.Mesh(m,f),c=0;c<e.length-1;c++){var g=(e[c][0]+e[c+1][0])/2,Y=(e[c][1]+e[c+1][1])/2,E=(e[c][2]+e[c+1][2])/2,v=0,T=0,b=e[c+1][0]-e[c][0],C=e[c+1][1]-e[c][1],M=e[c+1][2]-e[c][2],L=new THREE.Vector3(b,C,M);if(b>0?v=C>0?-Math.atan(b/C):C<0?Math.atan(b/C)-Math.PI/2:-Math.PI/2:b<0?v=C>0?-Math.atan(b/C):C<0?-Math.atan(b/C)-Math.PI:Math.PI/2:C>0||C<0&&(v=Math.PI),0!=M){var S=L.length();T=Math.asin(M/S)}var Z=new THREE.Matrix4;Z.makeRotationAxis(new THREE.Vector3(0,0,1),v);var y=new THREE.Matrix4;y.makeRotationAxis(new THREE.Vector3(1,0,0),T),Z.multiply(y);var w=h.clone();w.applyMatrix(Z),w.position.set(g,Y,E),w.scale.fromArray(i.scale),u.add(w)}return self.scene.add(u),u}return"geometry"===t&&void 0},this.addThreeDimensionalText=function(e,t){var o,n,s,i=new THREE.FontLoader,a={};a=$.extend({},{color:16711680,content:"https://xhz.bos.xyz/",textpath:"./fonts/helvetiker_regular.typeface.json",offsetX:0,offsetY:0,offsetZ:0,depthTest:!1,textLength:1e3,textWidth:1e3,scale:1,defaultPosition:{x:0,y:0,z:0}},e),i.load(a.textpath,function(e){function i(){n.rotation.x=self.camera.rotation.x,n.rotation.y=self.camera.rotation.y,n.rotation.z=self.camera.rotation.z}var r=new THREE.BufferGeometry,l=a.color,c=(new THREE.LineBasicMaterial({color:l,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:l,transparent:!0,opacity:.4,side:THREE.DoubleSide}));s=a.content;var d=e.generateShapes(s,a.textLength*a.scale,a.textWidth*a.scale),u=new THREE.ShapeGeometry(d);u.computeBoundingBox(),o=-.5*(u.boundingBox.max.x-u.boundingBox.min.x),u.translate(o,0,0),r.fromGeometry(u),n=new THREE.Mesh(r,c);var p;p=a.componentId?self.components[a.componentId].position:a.position?a.position:a.defaultPosition;var f={};f.x=p.x+a.offsetX,f.y=p.y+a.offsetY,f.z=p.z+a.offsetZ,n.position.x=f.x,n.position.y=f.y,n.position.z=f.z,n.material.depthTest=a.depthTest,i(),vizbim.cameraControl.addEventListener("change",function(){i()}),t(n)})},this.addThreeBallMarker=function(e){var t={};t=$.extend({},{color:6591981,offsetX:0,offsetY:0,offsetZ:0,depthTest:!1,position:{x:0,y:0,z:0},scale:1},e);var o=new THREE.Object3D,n=new THREE.SphereGeometry(700,32,32),s=new THREE.MeshBasicMaterial({color:t.color,side:THREE.DoubleSide}),i=window.sphere=new THREE.Mesh(n,s);i.position.set(0,0,750),i.material.depthTest=t.depthTest,o.add(i);var a=new THREE.CylinderGeometry(700,-1,1300,32),r=new THREE.MeshBasicMaterial({color:t.color,side:THREE.DoubleSide}),l=window.cylinder=new THREE.Mesh(a,r);l.position.set(0,0,0),l.rotation.x+=Math.PI/2,l.material.depthTest=t.depthTest,o.add(l);var c;return c=t.componentId?self.components[t.componentId].position:t.position,o.position.set(c.x+t.offsetX,c.y+t.offsetY,c.z+t.offsetZ),o.scale.set(t.scale,t.scale,t.scale),o},this.addThreeWordMarker=function(e,t){function o(e){e.rotation.x=vizbim.camera.rotation.x,e.rotation.y=vizbim.camera.rotation.y,e.rotation.z=vizbim.camera.rotation.z}var n={};n=$.extend({},{color:255,offsetX:0,offsetY:0,offsetZ:0,depthTest:!1,position:{x:0,y:0,z:0},startPosition:{x:0,y:0,z:0},endPosition:{x:0,y:0,z:0},lineLength:3e4,lineCorlor:255,rimWidth:3e3,rimLength:1e4,rimColor:255,scale:100,content:"小红砖好",textFont:"15px",textColorful:!1,useImageSize:!0,id:""},e);const s=new THREE.Object3D;""===n.id?s.key=s.uuid:s.key=n.id;const i=new THREE.Vector3(n.startPosition.x,n.startPosition.y,n.startPosition.z),a=new THREE.Vector3(n.startPosition.x+n.offsetX,n.startPosition.y+n.offsetY,n.startPosition.z+n.offsetZ);p=new THREE.LineBasicMaterial({color:n.lineCorlor});(u=new THREE.Geometry).vertices.push(i,a);m=new THREE.Line(u,p);s.add(m);let r=n.content.length*n.textFont.split("px")[0];const l=n.content.replace(/[^0-9]/gi,"").length;l>0&&(r-=l*n.textFont.split("px")[0]/2);const c=(r+4)*n.scale,d=n.textFont.split("px")[0]*n.scale+10;var u=new THREE.PlaneGeometry(1,1,32),p=new THREE.MeshBasicMaterial({color:15658734,side:THREE.DoubleSide}),f=new THREE.Mesh(u,p);s.add(f),f.position.set(a.x,a.y,a.z),f.rotation.x+=Math.PI/2,f.geometry.computeBoundingBox(),o(f),self.cameraControl.addEventListener("change",function(){o(f)});p=new THREE.LineBasicMaterial({color:n.rimColor});(u=new THREE.Geometry).vertices.push(new THREE.Vector3(-c/2-n.scale,-d/2-4*n.scale,0),new THREE.Vector3(-c/2-n.scale,d/2+4*n.scale,0),new THREE.Vector3(c/2+n.scale,d/2+4*n.scale,0),new THREE.Vector3(c/2+n.scale,-d/2-4*n.scale,0),new THREE.Vector3(-c/2-n.scale,-d/2-4*n.scale,0));var m=new THREE.Line(u,p);f.add(m);var h=document.createElement("canvas");h.id="text_canvas",h.width=String(r),h.height="100";var g=h.getContext("2d");if(g.font="20px Arial",n.textColorful){var Y=g.createLinearGradient(0,0,h.width,0);Y.addColorStop("0","magenta"),Y.addColorStop("0.5","blue"),Y.addColorStop("1.0","red"),g.fillStyle=Y}g.fillText(n.content,0,56,r+1);const E=h.toDataURL("image/png");console.log("imgUrl:",E);const v=[a.x,a.y,a.z];var T=new THREE.Texture(h);T.needsUpdate=!0;var b=new THREE.SpriteMaterial({map:T,depthTest:n.depthTest}),C=new THREE.Sprite(b),M=b.map.image.width,L=b.map.image.height;C.scale.set(n.scale*M,n.scale*L,1),C.position.set(v[0],v[1],v[2]),s.add(C),""!==n.id?(C.key=n.id,"function"==typeof t&&t(s)):"function"==typeof t&&t(s)},this.drawingHtmlBodyImage=function(e){var t=document.body,o=t.clientWidth,n=t.clientHeight,s=document.createElement("canvas");s.width=1*o,s.height=1*n,s.style.width=1*t.clientWidth+"px",s.style.height=1*t.clientHeight+"px",s.getContext("2d").scale(1,1);var i={scale:1,canvas:s,logging:!1,width:o,height:n,useCORS:!0};html2canvas(t,i).then(function(t){let o=t.toDataURL("image/png");"function"==typeof e&&e(o)})},this.createArrow=function(e){var t={color:255,depthTest:!1,scale:1,flowDerection:"y+",id:THREE.Math.generateUUID()},o={};o=$.extend({},t,e);var n=new THREE.Object3D;n.key=o.id;var s=new THREE.CylinderGeometry(100,100,40,3,1,!1),i=new THREE.CubeGeometry(40,180,40),a=new THREE.MeshBasicMaterial({color:16711680,transparent:!0}),r=window.cube=new THREE.Mesh(s,a),l=window.cube2=new THREE.Mesh(i,a);switch(l.position.y=-40,o.flowDerection){case"y-":r.rotation.x+=Math.PI/2,r.rotation.z-=Math.PI/2,l.position.y+=100;break;case"y+":r.rotation.x+=Math.PI/2*3,r.rotation.z-=Math.PI/2,l.position.y-=100;break;case"x-":r.rotation.y-=Math.PI/2,r.rotation.x-=Math.PI/2,l.rotation.z-=Math.PI/2,l.rotation.x-=Math.PI/2,l.position.x+=100;break;case"x+":r.rotation.y+=Math.PI/2,r.rotation.x-=Math.PI/2,l.rotation.z-=Math.PI/2,l.rotation.x-=Math.PI/2,l.position.x-=100;break;case"z+":r.rotation.z+=Math.PI/2,l.rotation.x-=Math.PI/2,l.position.z-=100;break;case"z-":r.rotation.z-=Math.PI/2,r.rotation.x-=Math.PI,l.rotation.x+=Math.PI/2,l.position.z+=100}return n.scale.set(o.scale,o.scale,o.scale),n.add(r),n.add(l),n.depthTest=o.depthTest,n},this.setArrowOpacity=function(e,t){e.children.forEach(function(e){e.material.opacity=t})}},BIMWINNER.SpriteMark=function(e){function t(e){var t=a(e);u.x=l=t[0],u.y=c=t[1]}function o(e){var t=a(e);(t[0]>l?t[0]-l<5:l-t[0]<5)&&(t[1]>c?t[1]-c<5:c-t[1]<5)&&(u.x=l=t[0],u.y=c=t[1],i("pick"))}function n(e){u.x=l=e.changedTouches[0].clientX,u.y=c=e.changedTouches[0].clientY}function s(e){(e.changedTouches[0].clientX>l?e.changedTouches[0].clientX-l<5:l-e.changedTouches[0].clientX<5)&&(e.changedTouches[0].clientY>c?e.changedTouches[0].clientY-c<5:c-e.changedTouches[0].clientY<5)&&(u.x=l=e.changedTouches[0].clientX,u.y=c=e.changedTouches[0].clientY,i("pick"))}function i(t){var o=new THREE.Vector3(u.x/e.renderer.domElement.clientWidth*2-1,-u.y/e.renderer.domElement.clientHeight*2+1,.5);r.raycaster.setFromCamera(o,e.camera);var n=r.raycaster.intersectObjects(r.marks.children);n.length>0&&r.selectedMark!=n[0].object?(r.selectedMark=n[0].object,r.listener.fire("updated",{added:{objects:r.selectedMark}})):(r.selectedMark={},r.listener.fire("updated",{removed:{objects:r.selectedMark}}))}function a(e){var t=[0,0];if(e){for(var o=e.target,n=0,s=0;o.offsetParent;)n+=o.offsetLeft,s+=o.offsetTop,o=o.offsetParent;t[0]=e.pageX-n,t[1]=e.pageY-s}else e=window.event,t.x=e.x,t.y=e.y;return t}var r=this;this.marks=new THREE.Object3D,e.scene.add(r.marks),this.selectedMark={},this.components={},this.allOids=[];var l,c,d={id:"",URL:"",width:1,height:1,scale:1,alwaysVisible:!0,position:[0,0,0],useImageSize:!0},u=new THREE.Vector2;this.raycaster=new THREE.Raycaster,this.active=!0,r.raycaster.setFromCamera(u,e.camera),r.domElement=e.renderer.domElement,this.enabled=function(){this.mousedown=e.renderer.domElement.addEventListener("mousedown",t,!1),this.mouseup=e.renderer.domElement.addEventListener("mouseup",o,!1)},this.disabled=function(){this.mousedown=e.renderer.domElement.removeEventListener("mousedown",t,!1),this.mouseup=e.renderer.domElement.removeEventListener("mouseup",o,!1)},this.touchEnabled=function(){this.touchstart=e.renderer.domElement.addEventListener("touchstart",n,!1),this.touchend=e.renderer.domElement.addEventListener("touchend",s,!1)},this.touchDisabled=function(){this.touchstart=e.renderer.domElement.removeEventListener("touchstart",n,!1),this.touchend=e.renderer.domElement.removeEventListener("touchend",s,!1)},this.enabled(),this.listener=new BIMWINNER.Listener,this.add=function(t,o){var n=1,s=1,i=$.extend({},d,t);(new THREE.TextureLoader).load(i.URL,function(e){var t=new THREE.SpriteMaterial({map:e,color:16777215,depthTest:i.alwaysVisible});n=i.useImageSize&&t.map&&t.map.image&&t.map.image.width?t.map.image.width:i.width,s=i.useImageSize&&t.map&&t.map.image&&t.map.image.width?t.map.image.height:i.height;var a=new THREE.Sprite(t);a.scale.set(i.scale*n,i.scale*s,1),i.position.isVector3?a.position.copy(i.position):a.position.set(i.position[0],i.position[1],i.position[2]),r.marks.add(a),""!==i.id?(a.key=i.id,r.components[i.id]=a,r.allOids.push(i.id),"function"==typeof o&&o(i.id)):(r.components[a.uuid]=a,r.allOids.push(a.uuid),"function"==typeof o&&o(a.uuid))},function(){},function(t){e.promptingMessage("warning","加载材质出错")})},this.remove=function(t){if(void 0!=t&&null!=t)for(var o=null,n=0;n<t.length;n++)o=r.components[""+t[n]],r.allOids.splice(n,1),r.marks.remove(o);else e.promptingMessage("warning","未选中mark")},this.hide=function(t){if(void 0!=t&&null!=t)for(var o=null,n=0;n<t.length;n++)(o=r.components[""+t[n]])&&(o.visible=!1);else e.promptingMessage("warning","未选中mark")},this.show=function(e){var t=r.allOids.concat(),o=null;if(e)for(var n=0;n<e.length;n++)(o=r.components[""+e[n]])&&(o.visible=!0);else for(var s=0;s<r.components.length;s++)(o=r.components[""+t[s]])&&(o.visible=!0)},this.isolation=function(t){if(void 0!=t&&null!=t){if(r.show(),!(r.allOids.length<=0)){for(var o=r.allOids.concat(),n=0;n<t.length;n++)for(var s=t[n],i=0;i<o.length;i++)if(s==o[i]){o.splice(i,1);break}for(var a=null,i=0;i<o.length;i++)(a=r.components[""+o[i]])&&(a.visible=!1)}}else e.promptingMessage("warning","未选中mark")},this.resize=function(t,o,n){if(void 0!=t&&null!=t)if(o&&n)for(var s=null,i=0;i<t.length;i++)(s=r.components[""+t[i]])&&s.scale.set(o,n,1);else e.promptingMessage("warning","未指定尺寸");else e.promptingMessage("warning","未选中mark")},this.listentoSelectMarks=function(e){r.listener.on("updated",function(){$.isEmptyObject(r.selectedMark)?e(null,null):r.selectedMark.key?e(r.selectedMark.key,r.selectedMark):e(r.selectedMark.uuid,r.selectedMark)})}},BIMWINNER.PlaneMark=function(e){function t(e){var t=a(e);u.x=l=t[0],u.y=c=t[1]}function o(e){var t=a(e);(t[0]>l?t[0]-l<5:l-t[0]<5)&&(t[1]>c?t[1]-c<5:c-t[1]<5)&&(u.x=l=t[0],u.y=c=t[1],i("pick"))}function n(e){u.x=l=e.changedTouches[0].clientX,u.y=c=e.changedTouches[0].clientY}function s(e){(e.changedTouches[0].clientX>l?e.changedTouches[0].clientX-l<5:l-e.changedTouches[0].clientX<5)&&(e.changedTouches[0].clientY>c?e.changedTouches[0].clientY-c<5:c-e.changedTouches[0].clientY<5)&&(u.x=l=e.changedTouches[0].clientX,u.y=c=e.changedTouches[0].clientY,i("pick"))}function i(t){var o=new THREE.Vector3(u.x/e.renderer.domElement.clientWidth*2-1,-u.y/e.renderer.domElement.clientHeight*2+1,.5);r.raycaster.setFromCamera(o,e.camera);var n=r.raycaster.intersectObjects(r.marks.children);n.length>0&&r.selectedMark!=n[0].object?(r.selectedMark=n[0].object,r.listener.fire("updated",{added:{objects:r.selectedMark}})):(r.selectedMark={},r.listener.fire("updated",{removed:{objects:r.selectedMark}}))}function a(e){var t=[0,0];if(e){for(var o=e.target,n=0,s=0;o.offsetParent;)n+=o.offsetLeft,s+=o.offsetTop,o=o.offsetParent;t[0]=e.pageX-n,t[1]=e.pageY-s}else e=window.event,t.x=e.x,t.y=e.y;return t}var r=this;this.marks=new THREE.Object3D,e.scene.add(r.marks),this.selectedMark={},this.components={},this.allOids=[];var l,c,d={id:"",URL:"",side:2,width:1,height:1,alwaysVisible:!0,opacity:1,transparent:!1,color:[1,1,1],emissive:[0,0,0],matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],useImageSize:!0},u=new THREE.Vector2;this.raycaster=new THREE.Raycaster,this.active=!0,r.raycaster.setFromCamera(u,e.camera),r.domElement=e.renderer.domElement,this.enabled=function(){this.mousedown=e.renderer.domElement.addEventListener("mousedown",t,!1),this.mouseup=e.renderer.domElement.addEventListener("mouseup",o,!1)},this.disabled=function(){this.mousedown=e.renderer.domElement.removeEventListener("mousedown",t,!1),this.mouseup=e.renderer.domElement.removeEventListener("mouseup",o,!1)},this.touchEnabled=function(){this.touchstart=e.renderer.domElement.addEventListener("touchstart",n,!1),this.touchend=e.renderer.domElement.addEventListener("touchend",s,!1)},this.touchDisabled=function(){this.touchstart=e.renderer.domElement.removeEventListener("touchstart",n,!1),this.touchend=e.renderer.domElement.removeEventListener("touchend",s,!1)},this.enabled(),this.listener=new BIMWINNER.Listener,this.add=function(t,o){var n=1,s=1,i=$.extend({},d,t);(new THREE.TextureLoader).load(i.URL,function(e){var t=new THREE.MeshLambertMaterial({color:new THREE.Color(i.color[0],i.color[1],i.color[2]),emissive:new THREE.Color(i.emissive[0],i.emissive[1],i.emissive[2]),map:e,depthTest:i.alwaysVisible,side:i.side,opacity:i.opacity,transparent:i.transparent});n=i.useImageSize&&t.map&&t.map.image&&t.map.image.width?t.map.image.width:i.width,s=i.useImageSize&&t.map&&t.map.image&&t.map.image.width?t.map.image.height:i.height;var a=new THREE.Mesh(new THREE.PlaneBufferGeometry(n,s,1,1),t),l=(new THREE.Matrix4).fromArray(i.matrix);a.applyMatrix(l),r.marks.add(a),""!==i.id?(a.key=i.id,r.components[i.id]=a,r.allOids.push(i.id),"function"==typeof o&&o(i.id)):(r.components[a.uuid]=a,r.allOids.push(a.uuid),"function"==typeof o&&o(a.uuid))},function(){},function(t){e.promptingMessage("warning","加载材质出错")})},this.updateMarkImage=function(t,o){if(Array.isArray(t)){if(o){(new THREE.TextureLoader).load(o,function(e){for(var o=0;o<t.length;o++)if(r.components[t[o]]){r.components[t[o]].material.map=e}},function(){},function(t){e.promptingMessage("warning","加载材质出错")})}}else if(r.components[t]){var n=r.components[t].material;if(o){(new THREE.TextureLoader).load(o,function(e){n.map=e},function(){},function(t){e.promptingMessage("warning","加载材质出错")})}}},this.updateMarkOpacity=function(e,t){if(Array.isArray(e)){for(var o=0;o<e.length;o++)if(r.components[e[o]]){var n=r.components[e[o]].material;"number"==typeof t&&(n.opacity=t)}}else if(r.components[e]){var s=r.components[e].material;"number"==typeof t&&(s.opacity=t)}},this.updateMarkSide=function(e,t){if(Array.isArray(e)){for(var o=0;o<e.length;o++)if(r.components[e[o]]){var n=r.components[e[o]].material;"number"==typeof t&&(n.side=t)}}else if(r.components[e]){var s=r.components[e].material;"number"==typeof t&&(s.side=t)}},this.updateMarkTransparent=function(e,t){if(Array.isArray(e)){for(var o=0;o<e.length;o++)if(r.components[e[o]]){var n=r.components[e[o]].material;"boolean"==typeof t&&(n.transparent=t)}}else if(r.components[e]){var s=r.components[e].material;"boolean"==typeof t&&(s.transparent=t)}},this.updateMarkAlwaysVisible=function(e,t){if(Array.isArray(e)){for(var o=0;o<e.length;o++)if(r.components[e[o]]){var n=r.components[e[o]].material;"boolean"==typeof t&&(n.depthTest=t)}}else if(r.components[e]){var s=r.components[e].material;"boolean"==typeof t&&(s.depthTest=t)}},this.updateMarkColor=function(e,t){if(Array.isArray(e)){for(var o=0;o<e.length;o++)if(r.components[e[o]]){var n=r.components[e[o]].material;Array.isArray(t)&&n.color.setRGB(t[0],t[1],t[2])}}else if(r.components[e]){var s=r.components[e].material;Array.isArray(t)&&s.color.setRGB(t[0],t[1],t[2])}},this.updateMarkEmissive=function(e,t){if(Array.isArray(e)){for(var o=0;o<e.length;o++)if(r.components[e[o]]){var n=r.components[e[o]].material;Array.isArray(t)&&n.emissive.setRGB(t[0],t[1],t[2])}}else if(r.components[e]){var s=r.components[e].material;Array.isArray(t)&&s.emissive.setRGB(t[0],t[1],t[2])}},this.updateMarkMatrix=function(e,t){if(Array.isArray(e)){if(Array.isArray(t))for(var o=(new THREE.Matrix4).fromArray(t),n=0;n<e.length;n++){r.components[e[n]].applyMatrix(o)}}else if(r.components[e]){var s=r.components[e];if(Array.isArray(t)){var i=(new THREE.Matrix4).fromArray(t);s.applyMatrix(i)}}},this.remove=function(t){if(void 0!=t&&null!=t)for(var o=null,n=0;n<t.length;n++)o=r.components[""+t[n]],r.allOids.splice(n,1),r.marks.remove(o);else e.promptingMessage("warning","未选中mark")},this.hide=function(t){if(void 0!=t&&null!=t)for(var o=null,n=0;n<t.length;n++)(o=r.components[""+t[n]])&&(o.visible=!1);else e.promptingMessage("warning","未选中mark")},this.show=function(e){var t=r.allOids.concat(),o=null;if(e)for(var n=0;n<e.length;n++)(o=r.components[""+e[n]])&&(o.visible=!0);else for(var s=0;s<r.components.length;s++)(o=r.components[""+t[s]])&&(o.visible=!0)},this.isolation=function(t){if(void 0!=t&&null!=t){if(r.show(),!(r.allOids.length<=0)){for(var o=r.allOids.concat(),n=0;n<t.length;n++)for(var s=t[n],i=0;i<o.length;i++)if(s==o[i]){o.splice(i,1);break}for(var a=null,i=0;i<o.length;i++)(a=r.components[""+o[i]])&&(a.visible=!1)}}else e.promptingMessage("warning","未选中mark")},this.listentoSelectMarks=function(e){r.listener.on("updated",function(){$.isEmptyObject(r.selectedMark)?e(null,null):r.selectedMark.key?e(r.selectedMark.key,r.selectedMark):e(r.selectedMark.uuid,r.selectedMark)})}},BIMWINNER.DOMMark=function(e){var t=this;this.marks={};this.listener=new BIMWINNER.Listener,this.allOids=[];var o={id:"",startPosition:[0,0,0],offsetPosition:[1,1],color:[.5,.5,.5],draggable:!0,componentId:"",title:"mark"};this.getClickCoordsWithinElement=function(t){var o=[0,0];if(t){for(var n=e.viewportDiv,s=0,i=0;n.offsetParent;)s+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;o[0]=t.pageX-s,o[1]=t.pageY-i}else t=window.event,o.x=t.x,o.y=t.y;return o},this.add=function(n,s){var i=$.extend({},o,n);""===i.id&&(i.id=THREE.Math.generateUUID()),t.marks[i.id]=i;var a=e.get2DCoordFrom3DCoord(i.startPosition),r=i.offsetPosition.concat(),l=r[0],c=r[1],d=[a[0]+r[0],a[1]+r[1]],u=Math.sqrt(l*l+c*c),p=$('<div class="labelingDiv" id="'+i.id+'" onmouseover="this.style.cursor=\'move\'" onmouseout="this.style.cursor=\'auto\'" style="     border:2px solid;\n    border-radius:5px;\n    -moz-border-radius:5px; /* Old Firefox */\n    min-width: 66px;\n    background: #FFFFFF;left:'+d[0]+"px; top: "+d[1]+"px; position: absolute;\n    width: -webkit-fit-content;\n    border-color: rgb("+i.color[0]+","+i.color[1]+","+i.color[2]+');\n    width: -moz-fit-content;" ></div>');p.appendTo(e.viewportDiv);$('<span class="label-title" style="padding: 5px 20px 5px 20px;\n    color: #000000;width: -moz-fit-content;" >'+i.title+"</span>").appendTo(p),i.domElement&&p.append(i.domElement);var f=Math.atan(c/l)/Math.PI*180;l<=0&&(c>0?f+=180:f-=180);$("<div id='labelStart"+i.id+"' class='labelStart' style='    border:2px solid;\n    border-radius:5px;\n    -moz-border-radius:5px; /* Old Firefox */\n    height: 4px;\n    width: 4px;\n    position: absolute;\n    margin-left: -3px;\n    margin-top: -3px;background-color:rgb("+i.color[0]+","+i.color[1]+","+i.color[2]+");top:"+a[1]+"px;left: "+a[0]+"px '></div>").appendTo(e.viewportDiv);$("<div class='label_line' id='labelLine"+i.id+"' style='  height: 2px;\n    position: absolute;\n    transform-origin: 0 0;width: "+u+";-ms-transform:rotateZ("+f+"deg); /* IE 9 */\n-moz-transform:rotateZ("+f+"deg); /* Firefox */\n-webkit-transform:rotateZ("+f+"deg); /* Safari and Chrome */\n-o-transform:rotateZ("+f+"deg); /* Opera */\ntransform:rotateZ("+f+"deg);left:"+d[0]+";background-color:rgb("+i.color[0]+","+i.color[1]+","+i.color[2]+");top:"+d[1]+"'></div>").appendTo(e.viewportDiv),i.draggable&&t._enableDrag(p),t.allOids.push(i.id),"function"==typeof s&&s(i.id)},this.select=function(o){if($(".labelingDiv").css({backgroundColor:""}),Array.isArray(o)){for(var n=[],s=0;s<o.length;s++){var i=o[s],a=t.marks[i].color;$("#"+i).css({backgroundColor:"rgb("+a[0]+","+a[1]+","+a[2]+")"}),""!=t.marks[i].componentId&&n.push(t.marks[i].componentId)}e.highlightObjs(n)}else{var r=o,l=t.marks[r].color;$("#"+r).css({backgroundColor:"rgb("+l[0]+","+l[1]+","+l[2]+")"}),""!=t.marks[r].componentId&&e.highlightObjs([t.marks[r].componentId])}},this.remove=function(e){if(Array.isArray(e))for(var o=0;o<e.length;o++){var n=e[o];try{return delete t.marks[n],$("#labelLine"+n).remove(),$("#labelStart"+n).remove(),$("#"+n).remove(),t.allOids.splice(o,1),!0}catch(e){}}else{var s=e;try{delete t.marks[s],$("#labelLine"+s).remove(),$("#labelStart"+s).remove(),$("#"+s).remove();var i=t.allOids.indexOf(s);return t.allOids.splice(i,1),!0}catch(e){return!1}}},this._update=function(){for(var o in t.marks){var n=t.marks[o],s=e.get2DCoordFrom3DCoord(n.startPosition),i=n.offsetPosition.concat(),a=$("#"+n.id).width(),r=$("#"+n.id).height(),l=[];0>i[0]+a/2?l[0]=i[0]+a:l[0]=i[0],0>i[1]+r/2?l[1]=i[1]+r:l[1]=i[1];var c=l[0],d=l[1],u=Math.sqrt(c*c+d*d),p=Math.atan(d/c)/Math.PI*180;c<=0&&(d>0?p+=180:p-=180),$("#labelLine"+n.id).css({transform:"rotateZ("+p+"deg)",width:u,left:s[0],top:s[1]}),$("#labelStart"+n.id).css({left:s[0],top:s[1]}),$("#"+n.id).css({left:s[0]+i[0],top:s[1]+i[1]})}},this._enableDrag=function(o){var n=o,s=o.find(".label-title"),i=o.attr("id"),a=(t.marks[i].offsetPosition.concat(),[0,0]);s.on("mousedown.label-title",function(e){e.preventDefault(),n.attr("offset-left",e.offsetX),n.attr("offset-top",e.offsetY),n.attr("allow-drag","true"),a=[o.position().left,o.position().top]}),s.on("touchstart.label-title",function(e){e.preventDefault();var t=n.position().left,s=n.position().top,i=e.originalEvent.targetTouches[0].clientX,r=e.originalEvent.targetTouches[0].clientY;n.attr("offset-left",i-t),n.attr("offset-top",r-s),n.attr("allow-drag","true"),a=[o.position().left,o.position().top]}),$(document).on("mouseup.label-title",function(e){if(e.preventDefault(),"true"===n.attr("allow-drag")){n.attr("allow-drag","false");var s=o.position().left,r=o.position().top;if(s!==a[0]||r!==a[1]){var l=[s,r];t.listener.fire("drag",{value:l,uuid:i})}}}),$(document).on("mousemove.label-title",function(o){if(o.preventDefault(),"true"===n.attr("allow-drag")){var s=o.clientX-parseInt(n.attr("offset-left"),10)-parseInt(n.css("border-left-width"),10),a=o.clientY-parseInt(n.attr("offset-top"),10)-parseInt(n.css("border-top-width"),10);a<0&&(a=5),a>$(window).height()&&(a=$(window).height()-10),s<0&&(s=5),s>$(window).width()&&(s=$(window).width()-10),n.css({left:s,top:a});var r=e.get2DCoordFrom3DCoord(t.marks[i].startPosition);t.marks[i].offsetPosition=[s-r[0],a-r[1]]}}),$(document).on("touchend.label-title",function(e){if(e.preventDefault(),"true"===n.attr("allow-drag")){n.attr("allow-drag","false");var s=o.position().left,r=o.position().top;if(s!==a[0]||r!==a[1]){var l=[s,r];t.listener.fire("drag",{value:l,uuid:i})}}}),$(document).on("touchmove.label-title",function(o){if(o.preventDefault(),"true"===n.attr("allow-drag")){var s=o.originalEvent.targetTouches[0].clientX-parseInt(n.attr("offset-left"),10)-parseInt(n.css("border-left-width"),10),a=o.originalEvent.targetTouches[0].clientY-parseInt(n.attr("offset-top"),10)-parseInt(n.css("border-top-width"),10);a<0&&(a=5),a>$(window).height()&&(a=$(window).height()-10),s<0&&(s=5),s>$(window).width()&&(s=$(window).width()-10),n.css({left:s,top:a});var r=e.get2DCoordFrom3DCoord(t.marks[i].startPosition);t.marks[i].offsetPosition=[s-r[0],a-r[1]]}})},this.updateColor=function(e,t){if(Array.isArray(e))for(var o=0;o<e.length;o++){var n=e[o];$("#"+n).css({borderColor:"rgb("+255*t[0]+","+255*t[1]+","+255*t[2]+")"}),$("#labelLine"+n).css("background-color","rgb("+255*t[0]+","+255*t[1]+","+255*t[2]+")"),$("#labelStart"+n).css("background-color","rgb("+255*t[0]+","+255*t[1]+","+255*t[2]+")")}else{var s=e;$("#"+s).css({borderColor:"rgb("+255*t[0]+","+255*t[1]+","+255*t[2]+")"}),$("#labelLine"+s).css("background-color","rgb("+255*t[0]+","+255*t[1]+","+255*t[2]+")"),$("#labelStart"+s).css("background-color","rgb("+255*t[0]+","+255*t[1]+","+255*t[2]+")")}},this.hide=function(t){if(void 0!=t&&null!=t)for(var o=0;o<t.length;o++)$("#labelLine"+t[o]).addClass("hide"),$("#labelStart"+t[o]).addClass("hide"),$("#"+t[o]).addClass("hide");else e.promptingMessage("warning","未选中mark")},this.show=function(e){var o=t.allOids.concat();if(e)for(var n=0;n<e.length;n++)$("#labelLine"+e[n]).removeClass("hide"),$("#labelStart"+e[n]).removeClass("hide"),$("#"+e[n]).removeClass("hide");else for(var s=0;s<o.length;s++)$("#labelLine"+o[s]).removeClass("hide"),$("#labelStart"+o[s]).removeClass("hide"),$("#"+o[s]).removeClass("hide")},this.isolation=function(o){if(void 0!==o&&null!=o){if(t.show(),!(t.allOids.length<=0)){for(var n=t.allOids.concat(),s=0;s<o.length;s++)for(var i=o[s],a=0;a<n.length;a++)if(i===n[a]){n.splice(a,1);break}for(var r=0;r<n.length;r++)$("#labelLine"+n[r]).addClass("hide"),$("#labelStart"+n[r]).addClass("hide"),$("#"+n[r]).addClass("hide")}}else e.promptingMessage("warning","未选中mark")},e.listener.on("tick",function(){t._update()})},BIMWINNER.Tool=function(e,t){var o=this,n=e.Lobibox,s=e.uuid,i={roam:!1,sectioning:!1,multiple:!1,fullScreen:!1,attribute:!1,search:!1,measurement:!1,modelTree:!1,treeDataLoad:!1,modelphoto:!1,modelapi:!1},a={home:!0,fit:!0,restore:!0,roam:!0,multiple:!0,transparent:!0,hide:!0,isolation:!0,sectioning:!0,modelPartition:!0,wireframe:!0,color:!0,setting:!0,modelTree:!0,modelphoto:!0,attribute:!0,search:!1,measurement:!0,modelapi:!1},r="",l=0;this.className="BIMWINNER.Tool";this.snapshotsPlateFlag=!1,this.snapshots={models:{},lookAts:{},cutting:{}};this.projectTreeFlag=!1;var c;try{c=new Intl.Collator("zh",{sensitivity:"case",numeric:!0})}catch(e){c={},console.log("当前浏览器不支持'Intl.Collator',无法有效排序"),c.compare=function(e,t){return-1}}var d=function(e,t){return c.compare(e.text,t.text)};this.createTool=function(t){function n(){l.find('[id="restoreModal'+s+'"]').hide(),l.find('[id="transparentModal'+s+'"]').hide(),l.find('[id="modelPartitionModal'+s+'"]').hide(),l.find('[id="colorModal'+s+'"]').hide(),l.find('[id="setModal'+s+'"]').hide()}function r(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}o.options=$.extend({},a,t);var l=$('<div class="yj-tool" id="my-tool'+s+'" ></div>');l.appendTo($("#"+e.viewport));var c=$('<div class="yj-group"></div>');c.appendTo(l);var d=$('<button type="button" class="yj-but" title="初始化" id="home'+s+'"><div class="yj-icon home-icon"   ></div></button>');o.options.home&&d.appendTo(c);var u=$('<button type="button" class="yj-but" title="聚焦" id="fit'+s+'"><div class="yj-icon fit-icon"  ></div></button>');o.options.fit&&u.appendTo(c);var p=$('<button type="button" class="yj-but" title="复位" id="restore'+s+'"></button>');$('<div class="yj-icon restore-icon"  ></div>').appendTo(p);var f=$('<ul class="restoreModal" id="restoreModal'+s+'" ><li class="input-group-addon"><input type="checkbox" id="showSet'+s+'" class="check" /><label for="showSet'+s+'"> 复位构件可见设置</label></li><li class="input-group-addon"><input type="checkbox" id="highlightSet'+s+'" class="check" /><label for="highlightSet'+s+'"> 复位构件高亮设置</label></li><li class="input-group-addon"><input type="checkbox" id="viewSet'+s+'" class="check" /><label for="viewSet'+s+'"> 复位模型视角设置</label></li><li class="input-group-addon"><input type="checkbox" id="transparentSet'+s+'" class="check" /><label for="transparentSet'+s+'">  复位构件透明设置</label></li><li class="input-group-addon"><input type="checkbox" id="wireframeSet'+s+'" class="check" /><label for="wireframeSet'+s+'">  复位构件线框设置</label></li><li class="input-group-addon"><input type="checkbox" id="colorSet'+s+'" class="check"/><label for="colorSet'+s+'">  复位构件颜色设置</label></li><li class="input-group-addon"><input type="checkbox" id="checkAll'+s+'" class="checkAll" /><label for="checkAll'+s+'">  全选</label><input type="button" id="reset'+s+'" class="reset" value="复位选中项"></li></ul>');o.options.restore&&(p.appendTo(c),f.appendTo(c),f.css({"margin-left":p.position().left-f.width()/2}));var m=$('<button type="button" class="yj-but" title="漫游" id="roam'+s+'"><div class="yj-icon roam-icon"   ></div></button>');o.options.roam&&m.appendTo(c);var h=$('<div class="yj-group"></div>');h.appendTo(l);var g=$('<button type="button" class="yj-but" title="框选" id="multiple'+s+'"><div class="yj-icon multiple-icon"   ></div></button>');o.options.multiple&&g.appendTo(h);var Y=$('<button type="button" class="yj-but" title="构件透明化" id="transparent'+s+'"></button>');$('<div class="yj-icon transparent-icon"  ></div>').appendTo(Y);var E=$('<div class="transparentModal clearfix" id="transparentModal'+s+'"><div><span class="transparent-info">提示信息</span></div><div class="subtract">-</div><div class="transparentRangeParent"><input type="range" class="transparentRange"  step="0.01" min="0" max="1" /></div><div class="add">+</div></div>');o.options.transparent&&(Y.appendTo(h),E.appendTo(h),E.css({"margin-left":Y.position().left-E.width()/2}));$('<button type="button" class="yj-but" title="构件隐藏" id="hide'+s+'"><div class="yj-icon hide-icon"   ></div></button>').appendTo(h);$('<button type="button" class="yj-but" title="构件隔离" id="insulate'+s+'"><div class="yj-icon insulate-icon"   ></div></button>').appendTo(h);$('<button type="button" class="yj-but" title="模型剖切" id="sectioning'+s+'"><div class="yj-icon sectioning-icon"   ></div></button>').appendTo(h);var v=$('<button type="button" class="yj-but" title="模型分解" id="modelPartition'+s+'"></button>');$('<div class="yj-icon modelPartition-icon"  ></div>').appendTo(v);var T=$('<div class="modelPartitionModal" id="modelPartitionModal'+s+'"><div><span  class="modelPartition-info">提示信息</span></div><div class="subtract">-</div><div class="modelPartitionRangeParent"><input type="range" class="modelPartitionRange" value="0" name="points" step="0.01" min="0" max="2" /></div><div class="add">+</div></div>');o.options.modelPartition&&(v.appendTo(h),T.appendTo(h),T.css({"margin-left":v.position().left-T.width()/2}));var b=$('<button type="button" class="yj-but" title="构件线框化" id="wireframeModel'+s+'"><div class="yj-icon wireframeModel-icon"></div></button>');o.options.wireframe&&b.appendTo(h);var C=$('<div class="colorModal" id="colorModal'+s+'"><div class="colorModalDiv" title="选择构件颜色"><input id="objColorSet'+s+'"/></div></div>'),M=$('<button type="button" class="yj-but" title="构件变色" id="color'+s+'"></button>');$('<div class="yj-icon color-icon"></div>').appendTo(M),o.options.color&&(C.appendTo(h),M.appendTo(h),C.css({"margin-left":M.position().left}));var L=$('<div class="yj-group"></div>');L.appendTo(l);var S=$('<button type="button" class="yj-but" title="设置" id="set'+s+'" style="border-radius: 6px;"></button>');$('<div class="yj-icon set-icon" ></div>').appendTo(S);var Z=$('<div class="setModal" id="setModal'+s+'"><div class="sceneColorDiv" title="选择背景颜色"><input id="sceneColorSet'+s+'"/></div><div class="fullScreenDiv"><button class="fullScreen" id="Fullscreen'+s+'" style="cursor: pointer" title="全屏显示"></button></div></div>');o.options.setting&&(S.appendTo(L),Z.appendTo(L)),$(document).bind("click",function(e){n()}),l.find('[id="home'+s+'"]').on("click",function(){e.resetScene()}),l.find('[id="fit'+s+'"]').on("click",function(){e.adaptiveSize()}),l.find('[id="restore'+s+'"]').on("click",function(e){l.find('[id="restoreModal'+s+'"]').is(":hidden")&&n(),l.find('[id="restoreModal'+s+'"]').on("click",function(e){r(e)}),l.find('[id="restoreModal'+s+'"]').toggle(),r(e)}),l.find('[id="reset'+s+'"]').on("click",function(t){var o=$("#viewSet"+s).prop("checked"),n=$("#showSet"+s).prop("checked"),i=$("#highlightSet"+s).prop("checked"),a=$("#transparentSet"+s).prop("checked"),r=$("#colorSet"+s).prop("checked"),l=$("#wireframeSet"+s).prop("checked");e.resetScene(o,n,i,a,r,l)});var y=$("#restoreModal"+s+" .check");$("#restoreModal"+s+" .checkAll").on("click",function(){for(var e=0;e<y.length;e++)y[e].checked=this.checked}),y.on("click",function(){$("#restoreModal"+s+" .checkAll")[0].checked=y.length==$("#restoreModal"+s+" .check:checked").length}),$("#objColorSet"+s).spectrum({showButtons:!1,cancelText:"取消",chooseText:"选择",togglePaletteMoreText:"更多",togglePaletteLessText:"简洁",clearText:"清除颜色缓存",noColorSelectedText:"没有选择颜色",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",color:"#ECC",showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"hex",localStorageKey:"spectrum.demo",appendTo:"parent",clickoutFiresChange:!1,move:function(t){var o=[t._r/255,t._g/255,t._b/255];e.setColorProcess(o)},show:function(){},beforeShow:function(){},hide:function(){},change:function(e){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]}),$("#sceneColorSet"+s).spectrum({showButtons:!1,cancelText:"取消",chooseText:"选择",togglePaletteMoreText:"更多",togglePaletteLessText:"简洁",clearText:"清除颜色缓存",noColorSelectedText:"没有选择颜色",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",color:"#ECC",showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"hex",localStorageKey:"spectrum.demo",appendTo:"parent",clickoutFiresChange:!1,move:function(t){var o=[t._r/255,t._g/255,t._b/255];e.setSceneBackGroundColor(o)},show:function(){},beforeShow:function(){},hide:function(){},change:function(e){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]}),e.listener.on("esc",function(){i.roam&&$("#roam"+s).click(),i.measurement&&$("#measurement"+s).click(),i.multiple&&$("#multiple"+s).click(),i.sectioning&&$("#sectioning"+s).click()}),l.find('[id="roam'+s+'"]').on("click",function(){e.modelExplosion(0),i.measurement&&($("#measurement"+s)[0]&&($("#measurement"+s)[0].style.backgroundColor=""),o.message("info","漫游模式下将关闭测量功能",!1),i.measurement=!1,e.measuredDistance()),i.sectioning&&($("#sectioning"+s)[0]&&($("#sectioning"+s)[0].style.backgroundColor=""),o.message("info","漫游模式下将关闭剖切功能",!1),i.sectioning=!1,e.modelCutting()),i.multiple&&($("#multiple"+s)[0]&&($("#multiple"+s)[0].style.backgroundColor=""),this.style.backgroundColor="",o.message("info","漫游模式下将关闭框选功能",!1),i.multiple=!1,e.selectBoundingBox()),i.roam?this.style.backgroundColor="":this.style.backgroundColor="#1f89de",i.roam=!i.roam,e.theFirstPerspective()}),l.find('[id="multiple'+s+'"]').on("click",function(){e.modelExplosion(0),i.roam&&($("#roam"+s)[0]&&($("#roam"+s)[0].style.backgroundColor=""),o.message("info","框选模式下将关闭漫游功能",!1),i.roam=!1,e.theFirstPerspective()),i.measurement&&($("#measurement"+s)[0]&&($("#measurement"+s)[0].style.backgroundColor=""),o.message("info","框选模式下将关闭测量功能",!1),i.measurement=!1,e.measuredDistance()),i.sectioning&&($("#sectioning"+s)[0]&&($("#sectioning"+s)[0].style.backgroundColor=""),o.message("info","框选模式下将关闭剖切功能",!1),i.sectioning=!1,e.modelCutting()),i.multiple?this.style.backgroundColor="":this.style.backgroundColor="#1f89de",i.multiple=!i.multiple,e.selectBoundingBox()});var w=$("#transparentModal"+s+" .subtract"),H=$("#transparentModal"+s+" .add"),B=$("#transparentModal"+s+" .transparentRange");l.find('[id="transparent'+s+'"]').on("click",function(t){l.find('[id="transparentModal'+s+'"]').is(":hidden")&&n(),l.find('[id="transparentModal'+s+'"]').on("click",function(e){r(e)}),l.find('[id="transparentModal'+s+'"]').toggle(),B.val(1);e.arrayConversion()?$(".transparent-info").text("透明度： "+(100*Number(B.val())).toFixed(0)+"%"):$(".transparent-info").text("未选择构件"),r(t)});var X=null;X=BIMWINNER.DeviceTypeTest.isIE11()?"change":"input",B.bind(X,function(t){var o=[];(o=e.arrayConversion())?($(".transparent-info").text("透明度： "+(100*Number(B.val())).toFixed(0)+"%"),e.transparentObjs(o,Number(B.val()))):$(".transparent-info").text("未选择构件")}),w.on("click",function(){var t=Number(B.val()),o=Number(B.attr("step"));B.val(t-o);var n=[];(n=e.arrayConversion())?($(".transparent-info").text("透明度： "+(100*t).toFixed(0)+"%"),e.transparentObjs(n,t)):$(".transparent-info").text("未选择构件")}),H.on("click",function(){var t=Number(B.val()),o=Number(B.attr("step"));B.val(t+o);var n=[];(n=e.arrayConversion())?($(".transparent-info").text("透明度： "+(100*t).toFixed(0)+"%"),e.transparentObjs(n,t)):$(".transparent-info").text("未选择构件")}),l.find('[id="hide'+s+'"]').on("click",function(){e.hideObjs(e.arrayConversion())}),l.find('[id="insulate'+s+'"]').on("click",function(){e.isolationObjs(e.arrayConversion())}),l.find('[id="sectioning'+s+'"]').on("click",function(){e.modelExplosion(0),i.roam&&($("#roam"+s)[0]&&($("#roam"+s)[0].style.backgroundColor=""),o.message("info","剖切模式下将关闭漫游功能",!1),i.roam=!1,e.theFirstPerspective()),i.measurement&&($("#measurement"+s)[0]&&($("#measurement"+s)[0].style.backgroundColor=""),o.message("info","剖切模式下将关闭测量功能",!1),i.measurement=!1,e.measuredDistance()),i.multiple&&($("#multiple"+s)[0]&&($("#multiple"+s)[0].style.backgroundColor=""),this.style.backgroundColor="",o.message("info","剖切模式下将关闭框选功能",!1),i.multiple=!1,e.selectBoundingBox()),i.sectioning?this.style.backgroundColor="":this.style.backgroundColor="#1f89de",i.sectioning=!i.sectioning,e.modelCutting()});var D=$("#modelPartitionModal"+s+" .subtract"),J=$("#modelPartitionModal"+s+" .add"),x=$("#modelPartitionModal"+s+" .modelPartitionRange");l.find('[id="modelPartition'+s+'"]').on("click",function(t){i.roam&&($("#roam"+s)[0]&&($("#roam"+s)[0].style.backgroundColor=""),o.message("info","模型分解模式下将关闭漫游功能",!1),i.roam=!1,e.theFirstPerspective()),i.measurement&&($("#measurement"+s)[0]&&($("#measurement"+s)[0].style.backgroundColor=""),o.message("info","模型分解模式下将关闭测量功能",!1),i.measurement=!1,e.measuredDistance()),i.sectioning&&($("#sectioning"+s)[0]&&($("#sectioning"+s)[0].style.backgroundColor=""),o.message("info","模型分解模式下将关闭剖切功能",!1),i.sectioning=!1,e.modelCutting()),i.multiple&&($("#multiple"+s)[0]&&($("#multiple"+s)[0].style.backgroundColor=""),this.style.backgroundColor="",o.message("info","模型分解模式下将关闭框选功能",!1),i.multiple=!1,e.selectBoundingBox()),l.find('[id="modelPartitionModal'+s+'"]').is(":hidden")&&n(),l.find('[id="modelPartitionModal'+s+'"]').on("click",function(e){r(e)}),l.find('[id="modelPartitionModal'+s+'"]').toggle(),$(".modelPartition-info").text("离散系数： "+x.val()),r(t)}),x.bind(X,function(t){$(".modelPartition-info").text("离散系数： "+x.val()),e.modelExplosion(Number(x.val()))}),D.on("click",function(){var t=x.val(),o=Number(x.attr("step"));x.val(t-o),$(".modelPartition-info").text("离散系数： "+x.val()),e.modelExplosion(Number(x.val()))}),J.on("click",function(){var t=x.val(),o=Number(x.attr("step"));x.val(Number(t)+o),$(".modelPartition-info").text("离散系数： "+x.val()),e.modelExplosion(Number(x.val()))}),l.find('[id="wireframeModel'+s+'"]').on("click",function(){e.wireframeObjs(e.arrayConversion())}),l.find('[id="color'+s+'"]').on("click",function(e){l.find('[id="colorModal'+s+'"]').is(":hidden")&&n(),l.find('[id="colorModal'+s+'"]').on("click",function(e){r(e)}),l.find('[id="colorModal'+s+'"]').toggle(),r(e)}),l.find('[id="set'+s+'"]').on("click",function(e){l.find('[id="setModal'+s+'"]').is(":hidden")&&n(),l.find('[id="setModal'+s+'"]').on("click",function(e){r(e)}),l.find('[id="setModal'+s+'"]').toggle(),r(e)}),l.find('[id="set'+s+'"]').on("mouseover",function(t){var o=document.getElementById("Fullscreen"+s),n=e.viewportDiv;"number"==typeof window.screenLeft?window.screenLeft:window.screenX,"number"==typeof window.screenTop?window.screenTop:window.screenY;n.offsetWidth!=window.screen.width||n.offsetHeight!=window.screen.height&&n.offsetHeight!=window.screen.height-1?(o.className="fullScreen",o.title="全屏显示",i.fullScreen=!1):(o.className="cancelFullScreen",o.title="取消全屏",i.fullScreen=!0)}),l.find('[id="Fullscreen'+s+'"]').on("click",function(t){var o=e.viewportDiv;e.lastCanvasContainerHeight=o.offsetHeight,e.lastCanvasContainerWidth=o.offsetWidth,n();var a=document.getElementById("Fullscreen"+s);if(i.fullScreen)i.fullScreen=!1,e.lastCanvasflag=!0,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen(),a.className="fullScreen",a.title="全屏显示";else{i.fullScreen=!0;var r=e.viewportDiv;r.fullScreenElement?r.fullScreenElement():r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.msRequestFullscreen&&r.msRequestFullscreen(),a.className="cancelFullScreen",a.title="取消全屏"}}),e.viewportDiv.focus(),l.css({"margin-left":-l.width()/2}),o.createTool2(),l.find("button").mouseover(function(e){this.style.backgroundColor="#1f89de"}),l.find("button").mouseout(function(e){i[this.id.split(s)[0]]||(this.style.backgroundColor="")})},this.createTool2=function(){function t(t,n){var s=[];(s=function(e){for(var t,o=[],n={},s=0;null!=(t=e[s]);s++)n[t]||(o.push(t),n[t]=!0);return o}(s=a(n))).length>0?(e.resetScene(!1,!1,!1,!0,!0,!1),e.adaptiveSize(s),e.reverseTransparentObjs(s,.4,!0)):o.message("warning","未选中构件")}function a(e){var t=[];if(e.nodes)for(var o=0;o<e.nodes.length;o++){t=a(e.nodes[o]).reduce(function(e,t){return e.push(t),e},t)}else t.push(e.id);return t}var c;c=0===$(e.renderer.domElement).height()?688:$(e.renderer.domElement).height()-120;var u,p=$('<div class="yj-tool2" id="my-tool2'+s+'" ></div>');p.appendTo($("#"+e.viewport));var f=$('<div class="yj-group"></div>');f.appendTo(p);var m=$('<button type="button" class="yj-but" title="API" id="modelapi'+s+'"><div class="yj-icon modelapi-icon"></div></button>');o.options.modelapi&&(m.appendTo(f),$.getJSON("apiInfo.json",e=>{e.forEach(e=>{"serverApi"===e.type?""===e.link&&"无"===e.name?$("#serverApi").after(`<tr><td style="padding: 3px 0; font-size: 14px">${e.name}</td></tr>`):$("#serverApi").after(`<tr><td style="padding: 3px 0"><a style='font-size: 14px' target="_blank" href=${e.link}>${e.name}</a></td></tr>`):"threeDimensionalApi"===e.type&&(""===e.link&&"无"===e.name?$("#serverApi").after(`<tr><td style="padding: 3px 0; font-size: 14px">${e.name}</td></tr>`):$("#threeDimensionalApi").after(`<tr ><td style="padding: 5px 0"><a style='font-size: 14px; ' target="_blank" href=${e.link}>${e.name}</a></td></tr>`))})}));var h=$('<button type="button" class="yj-but" title="模型树" id="modelTree'+s+'"><div class="yj-icon modelTree-icon" ></div></button>');o.options.modelTree&&h.appendTo(f);var g=$('<button type="button" class="yj-but" title="构件属性" id="attribute'+s+'"><div class="yj-icon attribute-icon" ></div></button>');o.options.attribute&&g.appendTo(f);var Y=$('<button type="button" class="yj-but" title="查询" id="search'+s+'"><div class="yj-icon search-tool-icon" ></div></button>');o.options.search&&Y.appendTo(f);var E=$('<button type="button" class="yj-but" title="模型测量" id="measurement'+s+'"><div class="yj-icon measurement-icon"></div></button>');o.options.measurement&&E.appendTo(f);var v=$('<button type="button" class="yj-but" title="模型快照" id="modelphoto'+s+'"><div class="yj-icon modelphoto-icon"></div></button>');o.options.modelphoto&&v.appendTo(f),p.find("button").mouseover(function(e){this.style.backgroundColor="#1f89de"}),p.find("button").mouseout(function(e){i[this.id.split(s)[0]]||(this.style.backgroundColor="")}),$(document).bind("click",function(e){});var T={title:"构件信息",width:334,height:c,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(e){var t=document.getElementById("attribute"+s);i.attribute=!1,t&&(t.style.backgroundColor="")},content:'<div class="tab-body" id="tab-properties'+s+'"> <table class="sx-table table-no-top"><thead></thead><tbody style="background-color: rgba(247, 247, 247, 0.8)"><tr class="noprop"><td>尚未选择构件</td></tr></tbody></table></div>'};this.attributeWindow=n.window(T),o.attributeWindow.setPosition({left:"",right:5,top:60}),o.attributeWindow.windowHide();var b={title:"搜索",width:334,height:c,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(e){var t=document.getElementById("search"+s);i.search=!1,t&&(t.style.backgroundColor="")},content:'<div class="search-body"><div class="search-input-div"><input class="search-input" id="search-input'+s+'" placeholder="请输入关键词"> <button type="button" class="search-but" title="搜索" id="search-but'+s+'"><div class="search-icon"></div></button></div><span class="searching hide">正在查找</span><div class="search-info hide">        <span >关键词： “</span> <span class="search-key"></span> <span>”，共搜索到</span> <span class="search-num"></span> <span>个构件</span></div><div class="search-result-body" id="search-result-body'+s+'"></div></div>'};this.searchWindow=n.window(b),o.searchWindow.setPosition({left:"",right:5,top:60}),o.searchWindow.windowHide();var C=function(){var e,t=function(e,t,o,n){var s=$("<tr></tr>");o.after(s);var i=$("<td></td>");s.append(i);var a=$("<td>");s.append(a);var r=null==t?"":t;if(/[\u4e00-\u9fa5]/.test(n)){var l=e.split(n);i.append("<span>"+l[0]+"</span>");for(var c=1;c<l.length;c++)i.append("<span class='search-key-highlight'>"+n+"</span>"),i.append("<span>"+l[c]+"</span>");var d=r.split(n);a.append("<span>"+d[0]+"</span>");for(v=1;v<d.length;v++)a.append("<span class='search-key-highlight'>"+n+"</span>"),a.append("<span>"+d[v]+"</span>")}else{var u=new RegExp(n,"ig"),p=e.match(u),f=r.match(u);if(p)for(var m=e.toLocaleLowerCase(),h=n.toLocaleLowerCase(),g=n.length,Y=m.split(h),E=0,v=0;v<Y.length;v++){var T=e.substr(E,E+Y[v].length);E+=Y[v].length,E+=g,i.append("<span>"+T+"</span>");var b=p[v]?p[v]:"";i.append("<span class='search-key-highlight'>"+b+"</span>")}else i.append("<span>"+e+"</span>");if(f)for(var C=r.toLocaleLowerCase(),M=n.toLocaleLowerCase(),L=n.length,S=C.split(M),Z=0,y=0;y<S.length;y++){var w=r.substr(Z,Z+S[y].length);Z+=S[y].length,Z+=L,a.append("<span>"+w+"</span>");var H=f[y]?f[y]:"";a.append("<span class='search-key-highlight'>"+H+"</span>")}else a.append("<span>"+r+"</span>")}},o=function(o,n,s){var i=$('<tr class="sx-active"></tr>');e.find("table tbody").append(i);var a=$("<td colspan=\"2\" style='font-size: 14px'></td>");i.append(a);var r=$("<b></b>");a.append(r);if(/[\u4e00-\u9fa5]/.test(s)){var l=o.split(s);r.append("<span>"+l[0]+"</span>");for(var c=1;c<l.length;c++)r.append("<span class='search-key-highlight'>"+s+"</span>"),r.append("<span>"+l[c]+"</span>")}else{var d=new RegExp(s,"ig"),u=o.match(d);if(u)for(var p=o.toLocaleLowerCase(),f=s.toLocaleLowerCase(),m=s.length,h=p.split(f),g=0,Y=0;Y<h.length;Y++){var E=o.substr(g,g+h[Y].length);g+=h[Y].length,g+=m,r.append("<span>"+E+"</span>");var v=u[Y]?u[Y]:"";r.append("<span class='search-key-highlight'>"+v+"</span>")}else r.append("<span>"+o+"</span>")}for(var T in n)t(T,n[T],i,s)};return function(n,s,i){e=i,i.append($('<table class="sx-table table-no-top"><thead></thead><tbody style="background-color: rgba(247, 247, 247, 0.8)"></tbody></table>')),e.find("table tbody").append('<tr class="noprop"><td><span class="value nonEditable">名称</span></td><td><span class="value nonEditable">值</span></td></tr>');var a=s,r=$('<tr class="sx-active"></tr>');e.find("table tbody").append(r);var l=$("<td colspan=\"2\" style='font-size: 14px'></td>");r.append(l),l.append("<b>信息</b>");for(var c in a)"string"==typeof a[c]&&t(c,a[c],r,n);for(var d in a)"object"==typeof a[d]?o(d,a[d],n):a[d]}}(),M={title:"测量",width:334,height:411,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(t){var o=document.getElementById("measurement"+s);i.measurement&&(u&&(u.remove(),u=null),e.measuredDistance()),i.measurement=!1,o&&(o.style.backgroundColor="")},content:'<div class="measurement-body"><table class="cl-table"><tr style="color: #696969;height: 90px;"><td><span>起点:</span></td><td><span class="cl-start-x"></span><br><span class="cl-start-y"></span><br><span class="cl-start-z"></span></td></tr><tr style="color: #696969;height: 90px;"><td><span>终点:</span></td><td><span class="cl-end-x"></span><br><span class="cl-end-y"></span><br><span class="cl-end-z"></span></td></tr><tr style="height: 30px;"><td style="font-size:14px"><span>测量结果</span></td><td></td></tr><tr style="color:red;height: 30px;"><td><span>∆X:</span></td><td><span class="cl-result-x"></span></td></tr><tr style="color:green;height: 30px;"><td><span>∆Y:</span></td><td><span class="cl-result-y"></span></td></tr><tr style="color:blue;height: 30px;"><td><span>∆Z:</span></td><td><span class="cl-result-z"></span></td></tr><tr style="color: #696969;height: 30px;"><td><span>直线距离:</span></td><td><span class="cl-result"></span></td></tr></table></div>'};this.measurementWindow=n.window(M),o.measurementWindow.setPosition({left:"",right:5,top:60}),o.measurementWindow.windowHide();var L={title:"模型快照",width:334,height:c,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(e){var t=document.getElementById("modelphoto"+s);i.modelphoto=!1,t&&(t.style.backgroundColor="")},content:'<div class="modelphotoContainer" id="modelphotoContainer'+s+'"><button class="layui-btn layui-btn-primary" style="width:300px; position: fixed; z-index: 1" id="createModelphoto'+s+'" >新建模型快照</button><div style="padding-top: 50px" id="snapshotContainer'+s+'"></div></div>'};this.modelphotoWindow=n.window(L),o.modelphotoWindow.setPosition({left:"",right:5,top:60}),o.modelphotoWindow.windowHide();var S={title:"相关接口",width:334,height:c,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(e){var t=document.getElementById("modelapi"+s);i.modelapi=!1,t&&(t.style.backgroundColor="")},content:'<div class="modelapiContainer" id="modelapiOutContainer'+s+'"><table id="modelapiOutContainerTable" class="sx-table table-no-top"><thead></thead><tbody style="background-color: rgba(247, 247, 247, 0.8)"><tr id="serverApi" class="sx-active"><td colspan="2" style=\'font-size: 14px;\'><b>数据接口</b></td></tr><tr id="threeDimensionalApi" class="sx-active"><td colspan="2" style=\'font-size: 14px;\'><b>可视化接口</b></td></tr></tbody></table></div>'};this.modelapiWindow=n.window(S),o.modelapiWindow.setPosition({left:"",right:5,top:60}),o.modelapiWindow.windowHide();var Z={title:"模型浏览器",width:334,height:c,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(t){var o=document.getElementById("modelTree"+s);i.modelTree=!1,o&&(o.style.backgroundColor=""),e.resetScene(!1,!1,!1,!0,!0,!1)},content:'<div class="modelTree"><div class="modelTree-head"><button class="but-tree" id="butLocationTree'+s+'"><span>空间</span></button> <button class="but-tree" id="butSystemTree'+s+'"><span>系统</span></button> <button class="but-tree" id="butTypeTree'+s+'"><span>类型</span></button> <button class="but-tree" id="butFileTree'+s+'"><span>文件</span></button></div><div class="modelTree-body"><div class="location-tree" id="locationTree'+s+'">正在等待模型加载···</div><div class="system-tree" id="systemTree'+s+'"></div><div class="type-tree" id="typeTree'+s+'"></div><div class="file-tree" id="fileTree'+s+'"></div></div></div>'};this.modelTreeWindow=n.window(Z),o.modelTreeWindow.setPosition({left:"",right:5,top:60}),o.modelTreeWindow.windowHide();var y,w,H,B;$("#butLocationTree"+s).click(function(){$("#locationTree"+s).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)",$("#systemTree"+s).hide(),$("#butSystemTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#typeTree"+s).hide(),$("#butTypeTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#fileTree"+s).hide(),$("#butFileTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"})}),$("#butSystemTree"+s).click(function(){$("#locationTree"+s).hide(),$("#butLocationTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#systemTree"+s).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)",$("#typeTree"+s).hide(),$("#butTypeTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#fileTree"+s).hide(),$("#butFileTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"})}),$("#butTypeTree"+s).click(function(){$("#locationTree"+s).hide(),$("#butLocationTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#systemTree"+s).hide(),$("#butSystemTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#typeTree"+s).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)",$("#fileTree"+s).hide(),$("#butFileTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"})}),$("#butFileTree"+s).click(function(){$("#locationTree"+s).hide(),$("#butLocationTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#systemTree"+s).hide(),$("#butSystemTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#typeTree"+s).hide(),$("#butTypeTree"+s).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#fileTree"+s).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)"}),$("#search-input"+s).keyup(function(e){"Enter"==e.key&&$("#search-but"+s).click()}),$("#search-but"+s).on("click",function(){var t=$("#search-input"+s).val();""==t?o.message("warning","请输入关键字"):r!=t&&(r=t,$("#search-result-body"+s).empty(),$(".searching").removeClass("hide"),$(".search-info").addClass("hide"),l=0,e.queryResultByString(t,function(o){l++,function(t,o){var n=$('<div class="search-result" key="'+t.id+'"></div>');n.on("click",function(t){"more-icon-close"!=t.target.className&&"more-icon-open"!=t.target.className&&e.findSceneNodes([$(this).attr("key")])}),n.appendTo($("#search-result-body"+s));var i=$('<div class="search-result-info"></div>');i.appendTo(n);var a=$('<div class="search-type-icon"></div>');a.appendTo(i);var r="";switch(t.ifcType){case"IfcDoor":r="door";break;case"IfcBeam":r="beam";break;case"IfcWindow":r="window";break;case"IfcWall":case"IfcWallStandardCase":r="wall";break;case"IfcStair":case"IfcStairFlight":r="stair";break;case"IfcFlowSegment":case"IfcFlowFitting":r="pipeline";break;case"IfcFlowTerminal":r="equipment";break;default:r="other"}a.addClass(r);var l=$('<table class="ss-table"></table>');l.appendTo(i);var c=$("<tr></tr>");c.appendTo(l),$("<td>类型</td>").appendTo(c);var d="未知";t["类型"]&&(d=t["类型"]),$("<td>"+d+"</td>").appendTo(c);var u=$("<tr></tr>");u.appendTo(l),$("<td>名称</td>").appendTo(u);var p="未知";""!=t.name&&(p=t.name),$("<td>"+p+"</td>").appendTo(u);var f=$("<tr></tr>");f.appendTo(l),$("<td>GUID</td>").appendTo(f);var m="未知";t.guid&&(m=t.guid),$("<td>"+m+"</td>").appendTo(f);var h=$('<button type="button" class="more-but" title="更多"> <div class="more-icon-close" style="">更多</div> </button>');h.appendTo(n);var g=$('<div class="search-result-more hide"></div>');g.appendTo(n),h.on("click",function(e){e.preventDefault(),"more-icon-close"==e.target.className?(e.target.className="more-icon-open",e.target.innerText="收起",g.removeClass("hide")):(e.target.className="more-icon-close",e.target.innerText="更多",g.addClass("hide"))}),C(o,t,g)}(o,t)},function(){$(".searching").addClass("hide"),0!=l?($(".search-info").removeClass("hide"),$(".search-key").text(t),$(".search-num").text(l)):$("#search-result-body"+s).append("<span>未找到相符的结果</span>")}))}),p.find('[id="modelTree'+s+'"]').on("click",function(){i.modelTree?(this.style.backgroundColor="",o.modelTreeWindow.windowHide()):(i.modelTree=!i.modelTree,this.style.backgroundColor="#1f89de",o.modelTreeWindow.windowShow(),o.treeDataLoad||(o.treeDataLoad=!0,o.loadTree(e.documentList[0])))}),p.find('[id="attribute'+s+'"]').on("click",function(){i.attribute?(this.style.backgroundColor="",o.attributeWindow.windowHide()):(i.attribute=!i.attribute,this.style.backgroundColor="#1f89de",o.attributeWindow.windowShow(),e.selectedPartsVal&&o.showComponentAttribute(e.selectedPartsVal.split(",")[0]))}),e.objectSet.listener.on("updated",function(t){if(i.attribute)if($.isEmptyObject(e.objectSet.objects))o.showComponentAttribute();else{var n="";for(var s in e.objectSet.objects)n=n+s+",";n=n.substring(0,n.length-1),o.showComponentAttribute(n.split(",")[0]||void 0)}}),p.find('[id="search'+s+'"]').on("click",function(e){i.search?(this.style.backgroundColor="",o.searchWindow.windowHide()):(i.search=!i.search,this.style.backgroundColor="#1f89de",o.searchWindow.windowShow())});var X={snapPhoto1:!1,snapPhoto2:!1,snapPhoto3:!1},D=!0;p.find('[id="modelphoto'+s+'"]').on("click",function(t){if(i.modelphoto)this.style.backgroundColor="",o.modelphotoWindow.windowHide();else if(i.modelphoto=!i.modelphoto,this.style.backgroundColor="#1f89de",o.modelphotoWindow.windowShow(),D){D=!1;$.ajax({type:"GET",url:e.baseaddress+"files/"+e.modelId+"?devcode="+e.accessToken,success:function(e){if(200===e.code){const t=e.data;null!==t.snapshotlist&&t.snapshotlist instanceof Array&&0!==t.snapshotlist.length&&t.snapshotlist.forEach((e,t)=>{"snapshot1"===e.id?J(e.snapshot,function(t){var o={};o.height=e.height,o.width=e.width,o.imgURL=t,A(o,1),X.snapPhoto1=!0}):"snapshot2"===e.id?J(e.snapshot,function(t){var o={};o.height=e.height,o.width=e.width,o.imgURL=t,A(o,2),X.snapPhoto2=!0}):"snapshot3"===e.id&&J(e.snapshot,function(t){var o={};o.height=e.height,o.width=e.width,o.imgURL=t,A(o,3),X.snapPhoto3=!0})})}},error:function(e,t,o){"function"==typeof error?error(e):e.responseJSON}})}}),p.find('[id="modelapi'+s+'"]').on("click",function(e){i.modelapi?(this.style.backgroundColor="",o.modelapiWindow.windowHide()):(i.modelapi=!i.modelapi,this.style.backgroundColor="#1f89de",o.modelapiWindow.windowShow())});var J=function(t,o){var n;(n=new XMLHttpRequest).open("GET",e.baseaddress+t+"?devcode="+e.accessToken,!0),n.responseType="blob",n.onload=function(){if(200==this.status){var e=this.response,t=window.URL.createObjectURL(e);"function"==typeof o&&o(t)}},n.send()},x=function(t,n){$.ajax({type:"PUT",url:e.baseaddress+"files/"+e.modelId+"/attributes/"+t+"?devcode="+e.accessToken+"&value=",success:function(e){console.log("删除模型快照成功result",e),200===e.code&&"function"==typeof n&&n(e)},error:function(e,t,n){"function"==typeof error?error(e):e.responseJSON?o.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):o.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},R=function(t){var n=e.getModelPhoto(),s=null;1===t?s=JSON.stringify({snapshot1:n.imgURL,width:n.width,height:n.height}):2===t?s=JSON.stringify({snapshot2:n.imgURL,width:n.width,height:n.height}):3===t?s=JSON.stringify({snapshot3:n.imgURL,width:n.width,height:n.height}):0===t&&(s=JSON.stringify({snapshot:n.imgURL,width:n.width,height:n.height}));$.ajax({type:"PUT",url:e.baseaddress+"files/"+e.modelId+"/snapshot?devcode="+e.accessToken,headers:{"content-type":"application/json"},data:s,contentType:"application/json",success:function(o){if(200===o.code){var s=$("#modelSnapShoot"+t),i=334*n.height/n.width;s.attr("src",n.imgURL),s.attr("height",i),s.attr("width","100%");var a="模型快照"+t+"更新成功";e.promptingMessage("success",a,1500)}else if(401===o.code){var s=$("#modelSnapShoot"+t),i=334*n.height/n.width;s.attr("src",n.imgURL),s.attr("height",i),s.attr("width","100%"),console.warn("非本人模型没有更新模型快照权限!")}else e.promptingMessage("error","错误码:"+o.code+","+o.message)},error:function(e,t,n){"function"==typeof error?error(e):e.responseJSON?o.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):o.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},P=function(){$("#saveModelPhotoButton1").on("click",function(e){R(1)}),$("#saveModelPhotoButton2").on("click",function(e){R(2)}),$("#saveModelPhotoButton3").on("click",function(e){R(3)})},A=function(t,o){var n=$('<div class="layui-card" id=\'layui-card'+o+"' style=''>\n  <div class=\"layui-card-header\" id='layui-card-header"+o+"' >快照"+o+"</div>\n  <div class=\"layui-card-body\" style='padding-bottom:35px' id='layui-card-body"+o+"'></div></div>\n"),a=$("<img id='modelSnapShoot"+o+"' />"),r=$('<button class="layui-btn layui-btn-primary" id=\'saveModelPhotoButton'+o+"' style='line-height: 20px;  height:25px; float:right; padding:0 10px;'>更新</button>");$("<div style='float: right'><i class=\"layui-icon layui-icon-close\" id='removeModelPhotoButton"+o+"' style='margin-left: 200px; cursor: pointer'></i></div>");$("#snapshotContainer"+s).append(n);var l=334*t.height/t.width;a.attr("src",t.imgURL),a.attr("height",l),a.attr("width","100%"),$("#layui-card-body"+o).append(a),$("#layui-card-body"+o).append($("<hr>")),$("#layui-card-body"+o).append(r),n.find('[id="removeModelPhotoButton'+o+'"]').on("click",function(t){!function(t){console.log("layui-icon layui-icon-close",i.modelphoto),1===t&&X.snapPhoto1?(X.snapPhoto1=!1,x("snapshot1",function(){$("#layui-card"+t).remove();var o="模型快照"+t+"删除成功";e.promptingMessage("success",o,2e3)})):2===t?(X.snapPhoto2=!1,x("snapshot2",function(){$("#layui-card"+t).remove();var o="模型快照"+t+"删除成功";e.promptingMessage("success",o,2e3)})):3===t&&(X.snapPhoto3=!1,x("snapshot3",function(){$("#layui-card"+t).remove();var o="模型快照"+t+"删除成功";e.promptingMessage("success",o,2e3)}))}(o)}),n.find('[id="saveModelPhotoButton'+o+'"]').on("click",function(e){R(o)}),$("#snapshotContainer"+s).children("div").length>1&&function(e){var t=$("#snapshotContainer"+s).children("div").sort(function(e,t){return $(e)[0].id.substring(10)>$(t)[0].id.substring(10)});$("#snapshotContainer"+s).children("div").remove(),$("#snapshotContainer"+s).append(t),"function"==typeof e&&e()}(P)},Q=function(t,n){var s=e.getModelPhoto(),i=null;1===t?i=JSON.stringify({snapshot1:s.imgURL,width:s.width,height:s.height}):2===t?i=JSON.stringify({snapshot2:s.imgURL,width:s.width,height:s.height}):3===t&&(i=JSON.stringify({snapshot3:s.imgURL,width:s.width,height:s.height}));$.ajax({type:"PUT",url:e.baseaddress+"files/"+e.modelId+"/snapshot?devcode="+e.accessToken,headers:{"content-type":"application/json"},data:i,contentType:"application/json",success:function(o){if(200===o.code){o.data;A(s,t);var i="模型快照"+t+"添加成功";e.promptingMessage("success",i,1500),"function"==typeof n&&n()}else e.promptingMessage("error","错误码:"+o.code+","+o.message)},error:function(e,t,n){"function"==typeof error?error(e):e.responseJSON?o.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):o.promptingMessage("error","网络请求发生错误，请稍后再试。")}})};$("#createModelphoto"+s).on("click",function(t){!1===X.snapPhoto1?Q(1,function(){X.snapPhoto1=!X.snapPhoto1}):!1===X.snapPhoto2?Q(2,function(){X.snapPhoto2=!X.snapPhoto2}):!1===X.snapPhoto3?Q(3,function(){X.snapPhoto3=!X.snapPhoto3}):e.promptingMessage("warning","模型快照只能保存3张!",1500)}),e.listener.on("delete",function(){i.measurement&&($(".cl-start-x").text(""),$(".cl-start-y").text(""),$(".cl-start-z").text(""),$(".cl-end-x").text(""),$(".cl-end-y").text(""),$(".cl-end-z").text(""),$(".cl-result-x").text(""),$(".cl-result-y").text(""),$(".cl-result-z").text(""),$(".cl-result").text(""),e.measuredDistance(),e.measuredDistance(function(e){"first"==e.state?(start=e.result.clone(),$(".cl-start-x").text("x: "+e.result.x.toFixed(2)),$(".cl-start-y").text("y: "+e.result.y.toFixed(2)),$(".cl-start-z").text("z: "+e.result.z.toFixed(2))):(end=e.result.clone(),$(".cl-end-x").text("x: "+e.result.x.toFixed(2)),$(".cl-end-y").text("y: "+e.result.y.toFixed(2)),$(".cl-end-z").text("z: "+e.result.z.toFixed(2)),$(".cl-result-x").text(Math.abs(end.x-start.x).toFixed(2)),$(".cl-result-y").text(Math.abs(end.y-start.y).toFixed(2)),$(".cl-result-z").text(Math.abs(end.z-start.z).toFixed(2)),$(".cl-result").text(end.distanceTo(start).toFixed(2)))}))}),p.find('[id="measurement'+s+'"]').on("click",function(t){if(e.modelExplosion(0),i.roam&&($("#roam"+s)[0]&&($("#roam"+s)[0].style.backgroundColor=""),o.message("info","测量模式下将关闭漫游功能",!1),i.roam=!1,e.theFirstPerspective()),i.sectioning&&($("#sectioning"+s)[0]&&($("#sectioning"+s)[0].style.backgroundColor=""),o.message("info","测量模式下将关闭剖切功能",!1),i.sectioning=!1,e.modelCutting()),i.multiple&&($("#multiple"+s)[0]&&($("#multiple"+s)[0].style.backgroundColor=""),this.style.backgroundColor="",o.message("info","测量模式下将关闭框选功能",!1),i.multiple=!1,e.selectBoundingBox()),i.measurement)this.style.backgroundColor="",o.measurementWindow.windowHide();else{BIMWINNER.DeviceTypeTest.isMobileDevice()||(u=o.message("info","按'ESC'键退出测量，按'Del'键重新测量",!1)),i.measurement=!i.measurement,this.style.backgroundColor="#1f89de",o.measurementWindow.windowShow();var n,a;$(".cl-start-x").text(""),$(".cl-start-y").text(""),$(".cl-start-z").text(""),$(".cl-end-x").text(""),$(".cl-end-y").text(""),$(".cl-end-z").text(""),$(".cl-result-x").text(""),$(".cl-result-y").text(""),$(".cl-result-z").text(""),$(".cl-result").text(""),e.measuredDistance(function(e){"first"==e.state?(n=e.result.clone(),$(".cl-start-x").text("x: "+e.result.x.toFixed(2)),$(".cl-start-y").text("y: "+e.result.y.toFixed(2)),$(".cl-start-z").text("z: "+e.result.z.toFixed(2))):(a=e.result.clone(),$(".cl-end-x").text("x: "+e.result.x.toFixed(2)),$(".cl-end-y").text("y: "+e.result.y.toFixed(2)),$(".cl-end-z").text("z: "+e.result.z.toFixed(2)),$(".cl-result-x").text(Math.abs(a.x-n.x).toFixed(2)),$(".cl-result-y").text(Math.abs(a.y-n.y).toFixed(2)),$(".cl-result-z").text(Math.abs(a.z-n.z).toFixed(2)),$(".cl-result").text(a.distanceTo(n).toFixed(2)))})}}),o.loadTree=function(n){y=$.Deferred(),function(t,n){var s=function(t){for(var o=[],n=0;n<t.length;n++){var i={};i.id=t[n].key;var a="";switch(t[n].type){case"IfcProject":case"IFCPROJECT":a="项目(未命名)";break;case"IFCSITE":a="场地(未命名)";break;case"IFCBUILDING":a="建筑(未命名)";break;case"IFCBUILDINGSTOREY":a="楼层(未命名)";break;case"IfcSpace":a="空间(未命名)";break;default:a="构件(未命名)"}if(i.text=t[n].name||a,t[n].childrenResultList&&t[n].childrenResultList.length>0)i.nodes=s(t[n].childrenResultList);else{if("IfcSpace"==t[n].type)continue;if(t[n].childrenResultList&&0===t[n].childrenResultList.length)continue;if(!e.components[t[n].key]){console.log("该构件无几何:",t[n]);continue}}o.push(i)}return o};t=encodeURIComponent(t),$.ajax({type:"GET",url:e.baseaddress+"models/"+t+"/trees/location?devcode="+e.accessToken,data:{},contentType:"application/json",success:function(e){if(200===e.code){const t=e.data;let o=[];if(0==t.length)return o.push({text:"该模型无空间划分"}),void n(o);o=s(t),n(o)}},error:function(e,t,n){"function"==typeof error?error(e):e.responseJSON?o.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+e.responseJSON.code+" 错误信息："+e.responseJSON.errorMessage+"”"):o.promptingMessage("error","网络请求发生错误，请稍后再试。")}})}(n,function(e){y.resolve(e)}),w=$.Deferred(),function(t,o){$.ajax({type:"GET",url:e.baseaddress+"models/"+t+"/components/system?devcode="+e.accessToken,success:function(e){if(200===e.code){const i=e.data;var t=[];if(0==i.length)t.push({text:"该模型无系统划分"}),o(t);else for(var n=0;n<i.length;n++)if("IFCSYSTEM"==i[n].type){var s={};s.text=""===i[n].name?"系统(未命名)":i[n].name,s.id=i[n].key,s.type="system",s.systemgroup=i[n].systemgroup,t.push(s)}t.sort(d),o(t)}},error:function(e,t,o){"function"==typeof error?error(e):e.responseJSON}})}(n,function(e){w.resolve(e)}),H=o.getSimpleTypeTree(),B=function(t){var o=[],n={};return n.text=(e.documentInfo[t]?e.documentInfo[t].name:t)||t,n.id=t,n.type="document",n.expandIcon="other_small treeNodeIcon",n.collapseIcon="other_small treeNodeIcon",n.icon="other_small treeNodeIcon",o.push(n),o}(n),$.when(y).done(function(e){o.locationTree=$("#locationTree"+s).treeview({data:e,levels:1,onNodeSelected:function(e,o){t(0,o)}}).hide()}),$.when(w).done(function(t){o.systemTree=$("#systemTree"+s).treeview({data:t,levels:1,onNodeSelected:function(t,n){!function(t,n){n.systemgroup&&n.systemgroup.length>0?(e.resetScene(!1,!1,!1,!0,!0,!1),e.adaptiveSize(n.systemgroup),e.reverseTransparentObjs(n.systemgroup,.4,!0)):n.systemgroup&&o.message("warning","未选中构件")}(0,n)}}).hide()}),o.typeTree=$("#typeTree"+s).treeview({data:H,levels:1,onNodeSelected:function(e,o){t(0,o)}}).hide(),$("#typeTree"+s).hide(),o.fileTree=$("#fileTree"+s).treeview({data:B,levels:1,onNodeSelected:function(t,o){e.resetScene(!1,!1,!1,!0,!0,!1),e.reverseTransparentObjs(e.alloids,.4,!0)}}).hide()},e.viewportDiv.focus()},this.getSimpleTypeTree=function(){var t=e.getComponentTypeArray(),o=[],n=e.componentInfo;for(var s in t){var i={};i.text=s,i.type="type",i.nodes=[];for(var a=0;a<t[s].length;a++){var r={};e.type,r.text=n[t[s][a]].name||"构件(未命名)",r.id=t[s][a],r.type="component",i.nodes.push(r)}i.nodes.sort(d),o.push(i)}return o.sort(d),o},this.getTypeTree=function(){var t=[],o={},n=e.componentAttribute,s=e.componentInfo;for(var i in n){var a=n[i];if(a){var r="其他",l="未命名",c="未命名",d="未命名",u="";a["其他"]&&a["其他"]["类别"]&&(r=a["其他"]["类别"]),a["其他"]&&a["其他"]["类型"]&&(l=a["其他"]["类型"].split(":")[0]);for(var p in a)a[p].Reference&&(c=a[p].Reference);s["component/"+i]&&s["component/"+i].name&&""!=s["component/"+i].name&&(d=s["component/"+i].name,u=s["component/"+i].type),o[r]?(o[r][l]?o[r][l][c]||(o[r][l][c]=[]):(o[r][l]={},o[r][l][c]=[]),o[r][l][c].push({id:i,name:d,type:u})):(o[r]={},o[r][l]={},o[r][l][c]=[],o[r][l][c].push({id:i,name:d,type:u}))}}for(var f in o){var m={};m.text=f,m.type="type",m.nodes=[];for(var h in o[f]){var g={};g.text=h,g.type="type",g.nodes=[];for(var Y in o[f][h]){var E={};E.text=Y,E.type="type",E.nodes=[];for(var v=0;v<o[f][h][Y].length;v++){var T={};T.text=o[f][h][Y][v].name,T.id=o[f][h][Y][v].id,T.type="component";var b="";switch(o[f][h][Y][v].type){case"IfcDoor":b="door_small treeNodeIcon";break;case"IfcBeam":b="beam_small treeNodeIcon";break;case"IfcWindow":b="window_small treeNodeIcon";break;case"IfcWall":case"IfcWallStandardCase":b="wall_small treeNodeIcon";break;case"IfcStair":case"IfcStairFlight":b="stair_small treeNodeIcon";break;case"IfcFlowSegment":case"IfcFlowFitting":b="pipeline_small treeNodeIcon";break;case"IfcFlowTerminal":b="equipment_small treeNodeIcon";break;default:b="other_small treeNodeIcon"}T.icon=b,E.nodes.push(T)}g.nodes.push(E)}m.nodes.push(g)}t.push(m)}return t},this.showComponentAttribute=function(t){var o="",n=$("#tab-properties"+s),i=function(e,t,o){var n=$("<tr></tr>");o.after(n),n.append("<td>"+e+"</td>");var s=$("<td>"),i=null==t?"":t,a=$('<span class="value nonEditable">'+i+"</span>");s.append(a),n.append(s)},a=function(e,t){var o=$('<tr class="sx-active"></tr>');n.find("table tbody").append(o);var s=$("<td colspan=\"2\" style='font-size: 14px'></td>");o.append(s),s.append("<b>"+e+"</b>");for(var a in t)i(a,t[a],o)},r=function(){const t=$.find("span.nonEditable");$("#tab-properties"+e.uuid).find("td");t.forEach(e=>{const t=$(e);t.css("word-wrap","break-word"),t.css("display","inline-block");const o=t.html();if(o.length>20){t.css("width","198px");t.html().substring(0,26),$("<i style='cursor: pointer;position:absolute;right: 20px' title='显示全部' class='fas fa-caret-down' id="+o+"></i>")}})};return function(t){if(n=$("#tab-properties"+s),t!=o){if(void 0==t)return n.find("table tbody tr").remove(),n.find("table tbody").append('<tr class="noprop"><td>未选中构件</td></tr>'),void(o=t);o=t,n.find("table tbody tr").remove(),e.getComponentAttribute(t,function(t){if(null==t);else if(void 0==t)return void n.find("table tbody").append('<tr class="noprop"><td>属性加载失败</td></tr>');n.find("table tbody").append('<tr class="noprop"><th><span class="value nonEditable">名称</span></th><th><span class="value nonEditable">值</span></th></tr>');var o;if("object"==typeof t?o=t:"string"==typeof t&&"构件属性为空。"!==t&&(o=JSON.parse(t)),function(){const t=e.arrayConversion()[0];if(e.componentInfo[t]){const t=e.componentInfo[e.arrayConversion()[0]],n={"构件基本信息":{guid:t.guid,"几何 Key":t.geometry,"模型 id":t.model.split("/")[1],"父级构件":t.parent,"构件类型":t.type,"构件 Key":t.key,"构件名称":t.name}};for(var o in n)"object"==typeof n[o]&&a(o,n[o]),r()}}(),o&&"object"==typeof o)for(var s in o)"object"==typeof o[s]?a(s,o[s]):o[s]})}}}(),this.message=function(){var e,t="Success",o="",s="",i=!1,a=0;return function(r,l,c){return 5==r?$(".loading").addClass("hide"):t=r,"error"==r&&(i=!1),void 0!=l&&(o=l,void 0!=c&&(i=c)),(new Date).getTime()-a<5e3?o!=s&&(e=n.notify(t,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:i,msg:o}),a=(new Date).getTime(),e.$el[0].childNodes[1].childNodes[0].title=o):(e=n.notify(t,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:i,msg:o}),a=(new Date).getTime(),e.$el[0].childNodes[1].childNodes[0].title=o),s=o,e}}()},function(){"use strict";var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(e.prototype=Object.create(THREE.MeshBasicMaterial.prototype)).constructor=e;var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(t.prototype=Object.create(THREE.LineBasicMaterial.prototype)).constructor=t;var o=new e({visible:!1,transparent:!1});THREE.TransformGizmo=function(){this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),o={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)};this.activePlane=o.XYZE,o.YZ.rotation.set(0,Math.PI/2,0),o.XZ.rotation.set(-Math.PI/2,0,0);for(var n in o)o[n].name=n,this.planes.add(o[n]),this.planes[n]=o[n];var s=function(e,t){for(var o in e)for(n=e[o].length;n--;){var s=e[o][n][0],i=e[o][n][1],a=e[o][n][2];s.name=o,i&&s.position.set(i[0],i[1],i[2]),a&&s.rotation.set(a[0],a[1],a[2]),t.add(s)}};s(this.handleGizmos,this.handles),s(this.pickerGizmos,this.pickers),this.traverse(function(e){if(e instanceof THREE.Mesh){e.updateMatrix();var t=e.geometry.clone();t.applyMatrix(e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name===e?t.material.highlight(!0):t.material.highlight(!1))})}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo,THREE.TransformGizmo.prototype.update=function(e,t){var o=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,1,0),s=new THREE.Matrix4;this.traverse(function(i){-1!==i.name.search("E")?i.quaternion.setFromRotationMatrix(s.lookAt(t,o,n)):-1===i.name.search("X")&&-1===i.name.search("Y")&&-1===i.name.search("Z")||i.quaternion.setFromEuler(e)})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var n=new THREE.Geometry,s=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));s.position.y=.5,s.updateMatrix(),n.merge(s.geometry,s.matrix);var i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,1,0],3));var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(n,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new t({color:16711680}))]],Y:[[new THREE.Mesh(n,new e({color:65280})),[0,.5,0]],[new THREE.Line(a,new t({color:65280}))]],Z:[[new THREE.Mesh(n,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),o),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),o),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),o),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),o)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),o),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),o),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),o),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(e,t){var o=new THREE.Matrix4;t.applyMatrix4(o.getInverse(o.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE),"XY"===e&&(this.activePlane=this.planes.XY),"YZ"===e&&(this.activePlane=this.planes.YZ),"XZ"===e&&(this.activePlane=this.planes.XZ)},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate,THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var e=function(e,t,o){var n=new THREE.BufferGeometry,s=[];o=o||1;for(var i=0;i<=64*o;++i)"x"===t&&s.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e),"y"===t&&s.push(Math.cos(i/32*Math.PI)*e,0,Math.sin(i/32*Math.PI)*e),"z"===t&&s.push(Math.sin(i/32*Math.PI)*e,Math.cos(i/32*Math.PI)*e,0);return n.addAttribute("position",new THREE.Float32BufferAttribute(s,3)),n};this.handleGizmos={X:[[new THREE.Line(new e(1,"x",.5),new t({color:16711680}))]],Y:[[new THREE.Line(new e(1,"y",.5),new t({color:65280}))]],Z:[[new THREE.Line(new e(1,"z",.5),new t({color:255}))]],E:[[new THREE.Line(new e(1.25,"z",1),new t({color:13421568}))]],XYZE:[[new THREE.Line(new e(1,"z",1),new t({color:7895160}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),o)]],XYZE:[[new THREE.Mesh]]},this.setActivePlane=function(e){"E"===e&&(this.activePlane=this.planes.XYZE),"X"===e&&(this.activePlane=this.planes.YZ),"Y"===e&&(this.activePlane=this.planes.XZ),"Z"===e&&(this.activePlane=this.planes.XY)},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);this.handles,this.pickers;var o=new THREE.Matrix4,n=new THREE.Euler(0,0,1),s=new THREE.Quaternion,i=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,d=new THREE.Quaternion,u=t.clone();n.copy(this.planes.XY.rotation),s.setFromEuler(n),o.makeRotationFromQuaternion(s).getInverse(o),u.applyMatrix4(o),this.traverse(function(e){s.setFromEuler(n),"X"===e.name&&(l.setFromAxisAngle(i,Math.atan2(-u.y,u.z)),s.multiplyQuaternions(s,l),e.quaternion.copy(s)),"Y"===e.name&&(c.setFromAxisAngle(a,Math.atan2(u.x,u.z)),s.multiplyQuaternions(s,c),e.quaternion.copy(s)),"Z"===e.name&&(d.setFromAxisAngle(r,Math.atan2(u.y,u.x)),s.multiplyQuaternions(s,d),e.quaternion.copy(s))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate,THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var n=new THREE.Geometry,s=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));s.position.y=.5,s.updateMatrix(),n.merge(s.geometry,s.matrix);var i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,1,0],3));var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(n,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new t({color:16711680}))]],Y:[[new THREE.Mesh(n,new e({color:65280})),[0,.5,0]],[new THREE.Line(a,new t({color:65280}))]],Z:[[new THREE.Mesh(n,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),o),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),o),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),o),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),o)]]},this.setActivePlane=function(e,t){var o=new THREE.Matrix4;t.applyMatrix4(o.getInverse(o.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE)},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale,BIMWINNER.TransformControls=function(e,t,o){function n(e){if(void 0!==l.object&&!0!==d&&(void 0===e.button||0===e.button)){var t=r(e.changedTouches?e.changedTouches[0]:e,u[c].pickers.children),o=null;t&&(o=t.object.name,e.preventDefault()),l.axis!==o&&(l.axis=o,l.update(),l.dispatchEvent(m))}}function s(e){if(void 0!==l.object&&!0!==d&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e;if(0===t.button||void 0===t.button){var n=r(t,u[c].pickers.children);if(n){e.preventDefault(),e.stopPropagation(),l.dispatchEvent(h),l.axis=n.object.name,l.update(),Z.copy($).sub(k).normalize(),u[c].setActivePlane(l.axis,Z);var s=r(t,[u[c].activePlane]);s&&(o&&(o.cameraControl.enabled=!1),Q.copy(l.object.position),F.copy(l.object.scale),G.extractRotation(l.object.matrix),K.extractRotation(l.object.matrixWorld),N.extractRotation(l.object.parent.matrixWorld),W.setFromMatrixScale(y.getInverse(l.object.parent.matrixWorld)),b.copy(s.point))}}d=!0}}function i(e){if(void 0!==l.object&&null!==l.axis&&!1!==d&&(void 0===e.button||0===e.button)){var t=r(e.changedTouches?e.changedTouches[0]:e,[u[c].activePlane]);!1!==t&&(e.preventDefault(),e.stopPropagation(),T.copy(t.point),"translate"===c?(T.sub(b),T.multiply(W),"local"===l.space&&(T.applyMatrix4(y.getInverse(K)),-1===l.axis.search("X")&&(T.x=0),-1===l.axis.search("Y")&&(T.y=0),-1===l.axis.search("Z")&&(T.z=0),T.applyMatrix4(G),l.object.position.copy(Q),l.object.position.add(T)),"world"!==l.space&&-1===l.axis.search("XYZ")||(-1===l.axis.search("X")&&(T.x=0),-1===l.axis.search("Y")&&(T.y=0),-1===l.axis.search("Z")&&(T.z=0),T.applyMatrix4(y.getInverse(N)),l.object.position.copy(Q),l.object.position.add(T)),null!==l.translationSnap&&("local"===l.space&&l.object.position.applyMatrix4(y.getInverse(K)),-1!==l.axis.search("X")&&(l.object.position.x=Math.round(l.object.position.x/l.translationSnap)*l.translationSnap),-1!==l.axis.search("Y")&&(l.object.position.y=Math.round(l.object.position.y/l.translationSnap)*l.translationSnap),-1!==l.axis.search("Z")&&(l.object.position.z=Math.round(l.object.position.z/l.translationSnap)*l.translationSnap),"local"===l.space&&l.object.position.applyMatrix4(K))):"scale"===c?(T.sub(b),T.multiply(W),"local"===l.space&&("XYZ"===l.axis?(L=1+T.y/10/Math.max(F.x,F.y,F.z),l.object.scale.x=F.x*L,l.object.scale.y=F.y*L,l.object.scale.z=F.z*L):(T.applyMatrix4(y.getInverse(K)),"X"===l.axis&&(l.object.scale.x=F.x*(1+T.x/F.x)),"Y"===l.axis&&(l.object.scale.y=F.y*(1+T.y/F.y)),"Z"===l.axis&&(l.object.scale.z=F.z*(1+T.z/F.z))))):"rotate"===c&&(T.sub(k),T.multiply(W),w.copy(b).sub(k),w.multiply(W),"E"===l.axis?(T.applyMatrix4(y.getInverse(S)),w.applyMatrix4(y.getInverse(S)),C.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),H.setFromRotationMatrix(y.getInverse(N)),A.setFromAxisAngle(Z,C.z-M.z),J.setFromRotationMatrix(K),H.multiplyQuaternions(H,A),H.multiplyQuaternions(H,J),l.object.quaternion.copy(H)):"XYZE"===l.axis?(A.setFromEuler(T.clone().cross(w).normalize()),H.setFromRotationMatrix(y.getInverse(N)),x.setFromAxisAngle(A,-T.clone().angleTo(w)),J.setFromRotationMatrix(K),H.multiplyQuaternions(H,x),H.multiplyQuaternions(H,J),l.object.quaternion.copy(H)):"local"===l.space?(T.applyMatrix4(y.getInverse(K)),w.applyMatrix4(y.getInverse(K)),C.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),J.setFromRotationMatrix(G),null!==l.rotationSnap?(x.setFromAxisAngle(B,Math.round((C.x-M.x)/l.rotationSnap)*l.rotationSnap),R.setFromAxisAngle(X,Math.round((C.y-M.y)/l.rotationSnap)*l.rotationSnap),P.setFromAxisAngle(D,Math.round((C.z-M.z)/l.rotationSnap)*l.rotationSnap)):(x.setFromAxisAngle(B,C.x-M.x),R.setFromAxisAngle(X,C.y-M.y),P.setFromAxisAngle(D,C.z-M.z)),"X"===l.axis&&J.multiplyQuaternions(J,x),"Y"===l.axis&&J.multiplyQuaternions(J,R),"Z"===l.axis&&J.multiplyQuaternions(J,P),l.object.quaternion.copy(J)):"world"===l.space&&(C.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),H.setFromRotationMatrix(y.getInverse(N)),null!==l.rotationSnap?(x.setFromAxisAngle(B,Math.round((C.x-M.x)/l.rotationSnap)*l.rotationSnap),R.setFromAxisAngle(X,Math.round((C.y-M.y)/l.rotationSnap)*l.rotationSnap),P.setFromAxisAngle(D,Math.round((C.z-M.z)/l.rotationSnap)*l.rotationSnap)):(x.setFromAxisAngle(B,C.x-M.x),R.setFromAxisAngle(X,C.y-M.y),P.setFromAxisAngle(D,C.z-M.z)),J.setFromRotationMatrix(K),"X"===l.axis&&H.multiplyQuaternions(H,x),"Y"===l.axis&&H.multiplyQuaternions(H,R),"Z"===l.axis&&H.multiplyQuaternions(H,P),H.multiplyQuaternions(H,J),l.object.quaternion.copy(H))),l.update(),l.dispatchEvent(m),l.dispatchEvent(Y))}}function a(e){e.preventDefault(),void 0!==e.button&&0!==e.button||(d&&null!==l.axis&&(g.mode=c,l.dispatchEvent(g),o&&(o.cameraControl.enabled=!0)),d=!1,"TouchEvent"in window&&e instanceof TouchEvent?(l.axis=null,l.update(),l.dispatchEvent(m),o&&(o.cameraControl.enabled=!0)):n(e))}function r(o,n){var s=t.getBoundingClientRect(),i=(o.clientX-s.left)/s.width,a=(o.clientY-s.top)/s.height;v.set(2*i-1,-2*a+1),E.setFromCamera(v,e);var r=E.intersectObjects(n,!0);return!!r[0]&&r[0]}THREE.Object3D.call(this),t=void 0!==t?t:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var l=this,c="translate",d=!1,u={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale};for(var p in u){var f=u[p];f.visible=p===c,this.add(f)}var m={type:"change"},h={type:"mouseDown"},g={type:"mouseUp",mode:c},Y={type:"objectChange"},E=new THREE.Raycaster,v=new THREE.Vector2,T=new THREE.Vector3,b=new THREE.Vector3,C=new THREE.Vector3,M=new THREE.Vector3,L=1,S=new THREE.Matrix4,Z=new THREE.Vector3,y=new THREE.Matrix4,w=new THREE.Vector3,H=new THREE.Quaternion,B=new THREE.Vector3(1,0,0),X=new THREE.Vector3(0,1,0),D=new THREE.Vector3(0,0,1),J=new THREE.Quaternion,x=new THREE.Quaternion,R=new THREE.Quaternion,P=new THREE.Quaternion,A=new THREE.Quaternion,Q=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Matrix4,N=new THREE.Matrix4,W=new THREE.Vector3,k=new THREE.Vector3,I=new THREE.Euler,K=new THREE.Matrix4,$=new THREE.Vector3,O=new THREE.Euler;t.addEventListener("mousedown",s,!1),t.addEventListener("touchstart",s,!1),t.addEventListener("mousemove",n,!1),t.addEventListener("touchmove",n,!1),t.addEventListener("mousemove",i,!1),t.addEventListener("touchmove",i,!1),t.addEventListener("mouseup",a,!1),t.addEventListener("mouseout",a,!1),t.addEventListener("touchend",a,!1),t.addEventListener("touchcancel",a,!1),t.addEventListener("touchleave",a,!1),this.dispose=function(){t.removeEventListener("mousedown",s),t.removeEventListener("touchstart",s),t.removeEventListener("mousemove",n),t.removeEventListener("touchmove",n),t.removeEventListener("mousemove",i),t.removeEventListener("touchmove",i),t.removeEventListener("mouseup",a),t.removeEventListener("mouseout",a),t.removeEventListener("touchend",a),t.removeEventListener("touchcancel",a),t.removeEventListener("touchleave",a)},this.attach=function(e){this.object=e,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return c},this.setMode=function(e){"scale"===(c=e||c)&&(l.space="local");for(var t in u)u[t].visible=t===c;this.update(),l.dispatchEvent(m)},this.setTranslationSnap=function(e){l.translationSnap=e},this.setRotationSnap=function(e){l.rotationSnap=e},this.setSize=function(e){l.size=e,this.update(),l.dispatchEvent(m)},this.setSpace=function(e){l.space=e,this.update(),l.dispatchEvent(m)},this.update=function(){void 0!==l.object&&(l.object.updateMatrixWorld(),k.setFromMatrixPosition(l.object.matrixWorld),I.setFromRotationMatrix(y.extractRotation(l.object.matrixWorld)),e.updateMatrixWorld(),$.setFromMatrixPosition(e.matrixWorld),O.setFromRotationMatrix(y.extractRotation(e.matrixWorld)),L=k.distanceTo($)/6*l.size,this.position.copy(k),this.scale.set(L,L,L),e instanceof THREE.PerspectiveCamera?Z.copy($).sub(k).normalize():e instanceof THREE.OrthographicCamera&&Z.copy($).normalize(),"local"===l.space?u[c].update(I,Z):"world"===l.space&&u[c].update(new THREE.Euler,Z),u[c].highlight(l.axis))}},BIMWINNER.TransformControls.prototype=Object.create(THREE.Object3D.prototype),BIMWINNER.TransformControls.prototype.constructor=BIMWINNER.TransformControls}(),"object"==typeof module&&(module.exports=BIMWINNER);